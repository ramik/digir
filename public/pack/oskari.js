function phi4z(e,t,i,s,a,r,n,o,l){var h,u,p,c,d,m,y,f,g;for(l=r,g=1;15>=g;g++)if(h=Math.sin(l),tanphi=Math.tan(l),o=tanphi*Math.sqrt(1-e*h*h),u=Math.sin(2*l),p=t*l-i*u+s*Math.sin(4*l)-a*Math.sin(6*l),c=t-2*i*Math.cos(2*l)+4*s*Math.cos(4*l)-6*a*Math.cos(6*l),d=2*p+o*(p*p+n)-2*r*(o*p+1),m=e*u*(p*p+n-2*r*p)/(2*o),y=2*(r-p)*(o*c-2/u)-2*c,f=d/(m+y),l+=f,1e-10>=Math.abs(f))return l;return Proj4js.reportError("phi4z: No convergence"),null}function e4fn(e){var t,i;return t=1+e,i=1-e,Math.sqrt(Math.pow(t,t)*Math.pow(i,i))}Oskari.clazz.define("Oskari.mapframework.openlayers.theme.default.Bundle",function(){},{create:function(){return this},update:function(){},start:function(){var e=this.mediator.manager.stateForBundleDefinitions["openlayers-default-theme"].bundlePath;OpenLayers.ImgPath=e+"/img/"},stop:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.bundle.BundleInstance"],source:{scripts:[{type:"text/css",src:"../../../../resources/openlayers/theme/default/style.css"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"openlayers-default-theme","Bundle-Name":"mapframework.openlayers-default-theme.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{Part:"OpenLayers","License-Name":"BSD","License-Online-Resource":"http://svn.openlayers.org/trunk/openlayers/license.txt"},License:{Part:"Proj4JS","License-Name":"LGPL/BSD","License-Online-Resource":""}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.core.Bundle",Title:" mapframework.core.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("openlayers-default-theme","Oskari.mapframework.openlayers.theme.default.Bundle"),function(){Oskari.clazz.define("Oskari.openlayers.bundle.openlayers-single-full.OpenLayersBundle",function(){},{create:function(){return this},update:function(){},start:function(){},stop:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.bundle.BundleInstance"],source:{scripts:[{type:"text/javascript",src:"../../../../libraries/proj4js-1.0.1/proj4js-compressed.js"},{type:"text/javascript",src:"../../../../libraries/OpenLayers/OpenLayers-2.11.js"}]},bundle:{manifest:{"Bundle-Identifier":"openlayers-map-full","Bundle-Name":"mapframework.openlayers.mapfull.Bundle","Bundle-Author":[{Name:"ah",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{Part:"OpenLayers","License-Name":"BSD","License-Online-Resource":"http://svn.openlayers.org/trunk/openlayers/license.txt"},License:{Part:"Proj4JS","License-Name":"LGPL/BSD","License-Online-Resource":""}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("openlayers-single-full","Oskari.openlayers.bundle.openlayers-single-full.OpenLayersBundle")}(),Proj4js={defaultDatum:"WGS84",transform:function(e,t,i){if(!e.readyToUse||!t.readyToUse)return this.reportError("Proj4js initialization for "+e.srsCode+" not yet complete"),i;if("900913"==e.srsProjNumber&&"WGS84"!=t.datumCode||"900913"==t.srsProjNumber&&"WGS84"!=e.datumCode){var s=Proj4js.WGS84;this.transform(e,s,i),e=s}return"longlat"==e.projName?(i.x*=Proj4js.common.D2R,i.y*=Proj4js.common.D2R):(e.to_meter&&(i.x*=e.to_meter,i.y*=e.to_meter),e.inverse(i)),e.from_greenwich&&(i.x+=e.from_greenwich),i=this.datum_transform(e.datum,t.datum,i),t.from_greenwich&&(i.x-=t.from_greenwich),"longlat"==t.projName?(i.x*=Proj4js.common.R2D,i.y*=Proj4js.common.R2D):(t.forward(i),t.to_meter&&(i.x/=t.to_meter,i.y/=t.to_meter)),i},datum_transform:function(e,t,i){return e.compare_datums(t)?i:e.datum_type==Proj4js.common.PJD_NODATUM||t.datum_type==Proj4js.common.PJD_NODATUM?i:(e.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),t.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),(e.es!=t.es||e.a!=t.a||e.datum_type==Proj4js.common.PJD_3PARAM||e.datum_type==Proj4js.common.PJD_7PARAM||t.datum_type==Proj4js.common.PJD_3PARAM||t.datum_type==Proj4js.common.PJD_7PARAM)&&(e.geodetic_to_geocentric(i),(e.datum_type==Proj4js.common.PJD_3PARAM||e.datum_type==Proj4js.common.PJD_7PARAM)&&e.geocentric_to_wgs84(i),(t.datum_type==Proj4js.common.PJD_3PARAM||t.datum_type==Proj4js.common.PJD_7PARAM)&&t.geocentric_from_wgs84(i),t.geocentric_to_geodetic(i)),t.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),i)},reportError:function(){},extend:function(e,t){if(e=e||{},t)for(var i in t){var s=t[i];void 0!==s&&(e[i]=s)}return e},Class:function(){for(var e,t=function(){this.initialize.apply(this,arguments)},i={},s=0;arguments.length>s;++s)e="function"==typeof arguments[s]?arguments[s].prototype:arguments[s],Proj4js.extend(i,e);return t.prototype=i,t},bind:function(e,t){var i=Array.prototype.slice.apply(arguments,[2]);return function(){var s=i.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,s)}},scriptName:"proj4js-compressed.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath)return this.libPath;for(var e=this.scriptName,t=e.length,i=document.getElementsByTagName("script"),s=0;i.length>s;s++){var a=i[s].getAttribute("src");if(a){var r=a.lastIndexOf(e);if(r>-1&&r+t==a.length){this.libPath=a.slice(0,-t);break}}}return this.libPath||""},loadScript:function(e,t,i,s){var a=document.createElement("script");a.defer=!1,a.type="text/javascript",a.id=e,a.src=e,a.onload=t,a.onerror=i,a.loadCheck=s,/MSIE/.test(navigator.userAgent)&&(a.onreadystatechange=this.checkReadyState),document.getElementsByTagName("head")[0].appendChild(a)},checkReadyState:function(){"loaded"==this.readyState&&(this.loadCheck()?this.onload():this.onerror())}},Proj4js.Proj=Proj4js.Class({readyToUse:!1,title:null,projName:null,units:null,datum:null,x0:0,y0:0,initialize:function(e){if(this.srsCodeInput=e,0==e.indexOf("urn:")){var t=e.split(":");"ogc"!=t[1]&&"x-ogc"!=t[1]||"def"!=t[2]||"crs"!=t[3]||(e=t[4]+":"+t[t.length-1])}else if(0==e.indexOf("http://")){var i=e.split("#");i[0].match(/epsg.org/)?e="EPSG:"+i[1]:i[0].match(/RIG.xml/)&&(e="IGNF:"+i[1])}this.srsCode=e.toUpperCase(),0==this.srsCode.indexOf("EPSG")?(this.srsCode=this.srsCode,this.srsAuth="epsg",this.srsProjNumber=this.srsCode.substring(5)):0==this.srsCode.indexOf("IGNF")?(this.srsCode=this.srsCode,this.srsAuth="IGNF",this.srsProjNumber=this.srsCode.substring(5)):0==this.srsCode.indexOf("CRS")?(this.srsCode=this.srsCode,this.srsAuth="CRS",this.srsProjNumber=this.srsCode.substring(4)):(this.srsAuth="",this.srsProjNumber=this.srsCode),this.loadProjDefinition()},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode])return this.defsLoaded(),void 0;var e=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(e,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))},loadFromService:function(){var e=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js/";Proj4js.loadScript(e,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))},defsLoaded:function(){this.parseDefs(),this.loadProjCode(this.projName)},checkDefsLoaded:function(){return Proj4js.defs[this.srsCode]?!0:!1},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode),Proj4js.defs[this.srsCode]=Proj4js.defs.WGS84,this.defsLoaded()},loadProjCode:function(e){if(Proj4js.Proj[e])return this.initTransforms(),void 0;var t=Proj4js.getScriptLocation()+"projCode/"+e+".js";Proj4js.loadScript(t,Proj4js.bind(this.loadProjCodeSuccess,this,e),Proj4js.bind(this.loadProjCodeFailure,this,e),Proj4js.bind(this.checkCodeLoaded,this,e))},loadProjCodeSuccess:function(e){Proj4js.Proj[e].dependsOn?this.loadProjCode(Proj4js.Proj[e].dependsOn):this.initTransforms()},loadProjCodeFailure:function(e){Proj4js.reportError("failed to find projection file for: "+e)},checkCodeLoaded:function(e){return Proj4js.Proj[e]?!0:!1},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]),this.init(),this.readyToUse=!0},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var e,t;if(this.defData){for(var i=this.defData.split("+"),s=0;i.length>s;s++){var a=i[s].split("=");switch(e=a[0].toLowerCase(),t=a[1],e.replace(/\s/gi,"")){case"":break;case"title":this.title=t;break;case"proj":this.projName=t.replace(/\s/gi,"");break;case"units":this.units=t.replace(/\s/gi,"");break;case"datum":this.datumCode=t.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=t.replace(/\s/gi,"");break;case"ellps":this.ellps=t.replace(/\s/gi,"");break;case"a":this.a=parseFloat(t);break;case"b":this.b=parseFloat(t);break;case"rf":this.rf=parseFloat(t);break;case"lat_0":this.lat0=t*Proj4js.common.D2R;break;case"lat_1":this.lat1=t*Proj4js.common.D2R;break;case"lat_2":this.lat2=t*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=t*Proj4js.common.D2R;break;case"lon_0":this.long0=t*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(t)*Proj4js.common.D2R;break;case"lonc":this.longc=t*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(t);break;case"y_0":this.y0=parseFloat(t);break;case"k_0":this.k0=parseFloat(t);break;case"k":this.k0=parseFloat(t);break;case"r_a":this.R_A=!0;break;case"zone":this.zone=parseInt(t);break;case"south":this.utmSouth=!0;break;case"towgs84":this.datum_params=t.split(",");break;case"to_meter":this.to_meter=parseFloat(t);break;case"from_greenwich":this.from_greenwich=t*Proj4js.common.D2R;break;case"pm":t=t.replace(/\s/gi,""),this.from_greenwich=Proj4js.PrimeMeridian[t]?Proj4js.PrimeMeridian[t]:parseFloat(t),this.from_greenwich*=Proj4js.common.D2R;break;case"no_defs":break;default:}}this.deriveConstants()}},deriveConstants:function(){if("@null"==this.nagrids&&(this.datumCode="none"),this.datumCode&&"none"!=this.datumCode){var e=Proj4js.Datum[this.datumCode];e&&(this.datum_params=e.towgs84?e.towgs84.split(","):null,this.ellps=e.ellipse,this.datumName=e.datumName?e.datumName:this.datumCode)}if(!this.a){var t=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;Proj4js.extend(this,t)}this.rf&&!this.b&&(this.b=(1-1/this.rf)*this.a),Math.abs(this.a-this.b)<Proj4js.common.EPSLN&&(this.sphere=!0,this.b=this.a),this.a2=this.a*this.a,this.b2=this.b*this.b,this.es=(this.a2-this.b2)/this.a2,this.e=Math.sqrt(this.es),this.R_A&&(this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.common.RA4+this.es*Proj4js.common.RA6)),this.a2=this.a*this.a,this.b2=this.b*this.b,this.es=0),this.ep2=(this.a2-this.b2)/this.b2,this.k0||(this.k0=1),this.datum=new Proj4js.datum(this)}}),Proj4js.Proj.longlat={init:function(){},forward:function(e){return e},inverse:function(e){return e}},Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:3785":"+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"},Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:3785"],Proj4js.defs["EPSG:900913"]=Proj4js.defs["EPSG:3785"],Proj4js.defs["EPSG:102113"]=Proj4js.defs["EPSG:3785"],Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:.7853981633974483,R2D:57.29577951308232,D2R:.017453292519943295,SEC_TO_RAD:484813681109536e-20,EPSLN:1e-10,MAX_ITER:20,COS_67P5:.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:.16666666666666666,RA4:.04722222222222222,RA6:.022156084656084655,RV4:.06944444444444445,RV6:.04243827160493827,msfnz:function(e,t,i){var s=e*t;return i/Math.sqrt(1-s*s)},tsfnz:function(e,t,i){var s=e*i,a=.5*e;return s=Math.pow((1-s)/(1+s),a),Math.tan(.5*(this.HALF_PI-t))/s},phi2z:function(e,t){var s,a,r=.5*e,n=this.HALF_PI-2*Math.atan(t);for(i=0;15>=i;i++)if(s=e*Math.sin(n),a=this.HALF_PI-2*Math.atan(t*Math.pow((1-s)/(1+s),r))-n,n+=a,1e-10>=Math.abs(a))return n;return alert("phi2z has NoConvergence"),-9999},qsfnz:function(e,t){var i;return e>1e-7?(i=e*t,(1-e*e)*(t/(1-i*i)-.5/e*Math.log((1-i)/(1+i)))):2*t},asinz:function(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)},e0fn:function(e){return 1-.25*e*(1+e/16*(3+1.25*e))},e1fn:function(e){return.375*e*(1+.25*e*(1+.46875*e))},e2fn:function(e){return.05859375*e*e*(1+.75*e)},e3fn:function(e){return e*e*e*(35/3072)},mlfn:function(e,t,i,s,a){return e*a-t*Math.sin(2*a)+i*Math.sin(4*a)-s*Math.sin(6*a)},srat:function(e,t){return Math.pow((1-e)/(1+e),t)},sign:function(e){return 0>e?-1:1},adjust_lon:function(e){return e=Math.abs(e)<this.PI?e:e-this.sign(e)*this.TWO_PI},adjust_lat:function(e){return e=Math.abs(e)<this.HALF_PI?e:e-this.sign(e)*this.PI},latiso:function(e,t,i){if(Math.abs(t)>this.HALF_PI)return+Number.NaN;if(t==this.HALF_PI)return Number.POSITIVE_INFINITY;if(t==-1*this.HALF_PI)return-1*Number.POSITIVE_INFINITY;var s=e*i;return Math.log(Math.tan((this.HALF_PI+t)/2))+e*Math.log((1-s)/(1+s))/2},fL:function(e,t){return 2*Math.atan(e*Math.exp(t))-this.HALF_PI},invlatiso:function(e,t){var i=this.fL(1,t),s=0,a=0;do s=i,a=e*Math.sin(s),i=this.fL(Math.exp(e*Math.log((1+a)/(1-a))/2),t);while(Math.abs(i-s)>1e-12);return i},sinh:function(e){var t=Math.exp(e);return t=(t-1/t)/2},cosh:function(e){var t=Math.exp(e);return t=(t+1/t)/2},tanh:function(e){var t=Math.exp(e);return t=(t-1/t)/(t+1/t)},asinh:function(e){var t=e>=0?1:-1;return t*Math.log(Math.abs(e)+Math.sqrt(e*e+1))},acosh:function(e){return 2*Math.log(Math.sqrt((e+1)/2)+Math.sqrt((e-1)/2))},atanh:function(e){return Math.log((e-1)/(e+1))/2},gN:function(e,t,i){var s=t*i;return e/Math.sqrt(1-s*s)}},Proj4js.datum=Proj4js.Class({initialize:function(e){if(this.datum_type=Proj4js.common.PJD_WGS84,e.datumCode&&"none"==e.datumCode&&(this.datum_type=Proj4js.common.PJD_NODATUM),e&&e.datum_params){for(var t=0;e.datum_params.length>t;t++)e.datum_params[t]=parseFloat(e.datum_params[t]);(0!=e.datum_params[0]||0!=e.datum_params[1]||0!=e.datum_params[2])&&(this.datum_type=Proj4js.common.PJD_3PARAM),e.datum_params.length>3&&(0!=e.datum_params[3]||0!=e.datum_params[4]||0!=e.datum_params[5]||0!=e.datum_params[6])&&(this.datum_type=Proj4js.common.PJD_7PARAM,e.datum_params[3]*=Proj4js.common.SEC_TO_RAD,e.datum_params[4]*=Proj4js.common.SEC_TO_RAD,e.datum_params[5]*=Proj4js.common.SEC_TO_RAD,e.datum_params[6]=e.datum_params[6]/1e6+1)}e&&(this.a=e.a,this.b=e.b,this.es=e.es,this.ep2=e.ep2,this.datum_params=e.datum_params)},compare_datums:function(e){return this.datum_type!=e.datum_type?!1:this.a!=e.a||Math.abs(this.es-e.es)>5e-11?!1:this.datum_type==Proj4js.common.PJD_3PARAM?this.datum_params[0]==e.datum_params[0]&&this.datum_params[1]==e.datum_params[1]&&this.datum_params[2]==e.datum_params[2]:this.datum_type==Proj4js.common.PJD_7PARAM?this.datum_params[0]==e.datum_params[0]&&this.datum_params[1]==e.datum_params[1]&&this.datum_params[2]==e.datum_params[2]&&this.datum_params[3]==e.datum_params[3]&&this.datum_params[4]==e.datum_params[4]&&this.datum_params[5]==e.datum_params[5]&&this.datum_params[6]==e.datum_params[6]:this.datum_type==Proj4js.common.PJD_GRIDSHIFT?0==strcmp(pj_param(this.params,"snadgrids").s,pj_param(e.params,"snadgrids").s):!0},geodetic_to_geocentric:function(e){var t,i,s,a,r,n,o,l=e.x,h=e.y,u=e.z?e.z:0,p=0;if(-Proj4js.common.HALF_PI>h&&h>-1.001*Proj4js.common.HALF_PI)h=-Proj4js.common.HALF_PI;else if(h>Proj4js.common.HALF_PI&&1.001*Proj4js.common.HALF_PI>h)h=Proj4js.common.HALF_PI;else if(-Proj4js.common.HALF_PI>h||h>Proj4js.common.HALF_PI)return Proj4js.reportError("geocent:lat out of range:"+h),null;return l>Proj4js.common.PI&&(l-=2*Proj4js.common.PI),r=Math.sin(h),o=Math.cos(h),n=r*r,a=this.a/Math.sqrt(1-this.es*n),t=(a+u)*o*Math.cos(l),i=(a+u)*o*Math.sin(l),s=(a*(1-this.es)+u)*r,e.x=t,e.y=i,e.z=s,p},geocentric_to_geodetic:function(e){var t,i,s,a,r,n,o,l,h,u,p,c,d,m,y,f,g,v=1e-12,L=v*v,b=30,O=e.x,S=e.y,w=e.z?e.z:0;if(d=!1,t=Math.sqrt(O*O+S*S),i=Math.sqrt(O*O+S*S+w*w),v>t/this.a){if(d=!0,y=0,v>i/this.a)return f=Proj4js.common.HALF_PI,g=-this.b,void 0}else y=Math.atan2(S,O);s=w/i,a=t/i,r=1/Math.sqrt(1-this.es*(2-this.es)*a*a),l=a*(1-this.es)*r,h=s*r,m=0;do m++,o=this.a/Math.sqrt(1-this.es*h*h),g=t*l+w*h-o*(1-this.es*h*h),n=this.es*o/(o+g),r=1/Math.sqrt(1-n*(2-n)*a*a),u=a*(1-n)*r,p=s*r,c=p*l-u*h,l=u,h=p;while(c*c>L&&b>m);return f=Math.atan(p/Math.abs(u)),e.x=y,e.y=f,e.z=g,e},geocentric_to_geodetic_noniter:function(e){var t,i,s,a,r,n,o,l,h,u,p,c,d,m,y,f,g,v=e.x,L=e.y,b=e.z?e.z:0;if(v=parseFloat(v),L=parseFloat(L),b=parseFloat(b),g=!1,0!=v)t=Math.atan2(L,v);else if(L>0)t=Proj4js.common.HALF_PI;else if(0>L)t=-Proj4js.common.HALF_PI;else if(g=!0,t=0,b>0)i=Proj4js.common.HALF_PI;else{if(!(0>b))return i=Proj4js.common.HALF_PI,s=-this.b,void 0;i=-Proj4js.common.HALF_PI}return r=v*v+L*L,a=Math.sqrt(r),n=b*Proj4js.common.AD_C,l=Math.sqrt(n*n+r),u=n/l,c=a/l,p=u*u*u,o=b+this.b*this.ep2*p,f=a-this.a*this.es*c*c*c,h=Math.sqrt(o*o+f*f),d=o/h,m=f/h,y=this.a/Math.sqrt(1-this.es*d*d),s=m>=Proj4js.common.COS_67P5?a/m-y:-Proj4js.common.COS_67P5>=m?a/-m-y:b/d+y*(this.es-1),0==g&&(i=Math.atan(d/m)),e.x=t,e.y=i,e.z=s,e},geocentric_to_wgs84:function(e){if(this.datum_type==Proj4js.common.PJD_3PARAM)e.x+=this.datum_params[0],e.y+=this.datum_params[1],e.z+=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var t=this.datum_params[0],i=this.datum_params[1],s=this.datum_params[2],a=this.datum_params[3],r=this.datum_params[4],n=this.datum_params[5],o=this.datum_params[6],l=o*(e.x-n*e.y+r*e.z)+t,h=o*(n*e.x+e.y-a*e.z)+i,u=o*(-r*e.x+a*e.y+e.z)+s;e.x=l,e.y=h,e.z=u}},geocentric_from_wgs84:function(e){if(this.datum_type==Proj4js.common.PJD_3PARAM)e.x-=this.datum_params[0],e.y-=this.datum_params[1],e.z-=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var t=this.datum_params[0],i=this.datum_params[1],s=this.datum_params[2],a=this.datum_params[3],r=this.datum_params[4],n=this.datum_params[5],o=this.datum_params[6],l=(e.x-t)/o,h=(e.y-i)/o,u=(e.z-s)/o;e.x=l+n*h-r*u,e.y=-n*l+h+a*u,e.z=r*l-a*h+u}}}),Proj4js.Point=Proj4js.Class({initialize:function(e,t,i){if("object"==typeof e)this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("string"==typeof e){var s=e.split(",");this.x=parseFloat(s[0]),this.y=parseFloat(s[1]),this.z=parseFloat(s[2])||0}else this.x=e,this.y=t,this.z=i||0},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return"x="+this.x+",y="+this.y},toShortString:function(){return this.x+", "+this.y}}),Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}},Proj4js.WGS84=new Proj4js.Proj("WGS84"),Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36,Proj4js.Proj.aea={init:function(){return Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN?(Proj4js.reportError("aeaInitEqualLatitudes"),void 0):(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po),this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po),this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.ns0=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0,void 0)},forward:function(e){var t=e.x,i=e.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var s=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi),a=this.a*Math.sqrt(this.c-this.ns0*s)/this.ns0,r=this.ns0*Proj4js.common.adjust_lon(t-this.long0),n=a*Math.sin(r)+this.x0,o=this.rh-a*Math.cos(r)+this.y0;return e.x=n,e.y=o,e},inverse:function(e){var t,i,s,a,r,n;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),s=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),s=-1),a=0,0!=t&&(a=Math.atan2(s*e.x,s*e.y)),s=t*this.ns0/this.a,i=(this.c-s*s)/this.ns0,this.e3>=1e-10?(s=1-.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3,n=Math.abs(Math.abs(s)-Math.abs(i))>1e-10?this.phi1z(this.e3,i):i>=0?.5*PI:-.5*PI):n=this.phi1z(e3,i),r=Proj4js.common.adjust_lon(a/this.ns0+this.long0),e.x=r,e.y=n,e},phi1z:function(e,t){var i,s,a,r=Proj4js.common.asinz(.5*t);if(Proj4js.common.EPSLN>e)return r;for(var n=e*e,o=1;25>=o;o++)if(sinphi=Math.sin(r),cosphi=Math.cos(r),i=e*sinphi,s=1-i*i,a=.5*s*s/cosphi*(t/(1-n)-sinphi/s+.5/e*Math.log((1-i)/(1+i))),r+=a,1e-7>=Math.abs(a))return r;return Proj4js.reportError("aea:phi1z:Convergence error"),null}},Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){return Proj4js.Proj.gauss.init.apply(this),this.rc?(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"),void 0):(Proj4js.reportError("sterea:init:E_ERROR_0"),void 0)},forward:function(e){return e.x=Proj4js.common.adjust_lon(e.x-this.long0),Proj4js.Proj.gauss.forward.apply(this,[e]),sinc=Math.sin(e.y),cosc=Math.cos(e.y),cosl=Math.cos(e.x),k=this.k0*this.R2/(1+this.sinc0*sinc+this.cosc0*cosc*cosl),e.x=k*cosc*Math.sin(e.x),e.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){var t,i;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(rho=Math.sqrt(e.x*e.x+e.y*e.y))?(c=2*Math.atan2(rho,this.R2),sinc=Math.sin(c),cosc=Math.cos(c),i=Math.asin(cosc*this.sinc0+e.y*sinc*this.cosc0/rho),t=Math.atan2(e.x*sinc,rho*this.cosc0*cosc-e.y*this.sinc0*sinc)):(i=this.phic0,t=0),e.x=t,e.y=i,Proj4js.Proj.gauss.inverse.apply(this,[e]),e.x=Proj4js.common.adjust_lon(e.x+this.long0),e}},Proj4js.Proj.poly={init:function(){(this.lat0=0)&&(this.lat0=90),this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,i,s,a,r,n,o,l=e.x,h=e.y;return s=Proj4js.common.adjust_lon(l-this.long0),1e-7>=Math.abs(h)?(n=this.x0+this.a*s,o=this.y0-this.a*this.ml0):(t=Math.sin(h),i=Math.cos(h),a=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,h),r=Proj4js.common.msfnz(this.e,t,i),s=t,n=this.x0+this.a*r*Math.sin(s)/t,o=this.y0+this.a*(a-this.ml0+r*(1-Math.cos(s))/t)),e.x=n,e.y=o,e},inverse:function(e){var t,i,s,a,r,n;if(e.x-=this.x0,e.y-=this.y0,t=this.ml0+e.y/this.a,a=0,1e-7>=Math.abs(t))r=e.x/this.a+this.long0,n=0;else{if(i=t*t+e.x/this.a*(e.x/this.a),a=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,i,s,n),1!=a)return a;r=Proj4js.common.adjust_lon(Proj4js.common.asinz(e.x*s/this.a)/Math.sin(n)+this.long0)}return e.x=r,e.y=n,e}},Proj4js.Proj.equi={init:function(){this.x0||(this.x0=0),this.y0||(this.y0=0),this.lat0||(this.lat0=0),this.long0||(this.long0=0)},forward:function(e){var t=e.x,i=e.y,s=Proj4js.common.adjust_lon(t-this.long0),a=this.x0+this.a*s*Math.cos(this.lat0),r=this.y0+this.a*i;return this.t1=a,this.t2=Math.cos(this.lat0),e.x=a,e.y=r,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=e.y/this.a;Math.abs(t)>Proj4js.common.HALF_PI&&Proj4js.reportError("equi:Inv:DataError");var i=Proj4js.common.adjust_lon(this.long0+e.x/(this.a*Math.cos(this.lat0)));e.x=i,e.y=t}},Proj4js.Proj.merc={init:function(){this.lat_ts&&(this.k0=this.sphere?Math.cos(this.lat_ts):Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t=e.x,i=e.y;if(i*Proj4js.common.R2D>90&&-90>i*Proj4js.common.R2D&&t*Proj4js.common.R2D>180&&-180>t*Proj4js.common.R2D)return Proj4js.reportError("merc:forward: llInputOutOfRange: "+t+" : "+i),null;var s,a;if(Math.abs(Math.abs(i)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)return Proj4js.reportError("merc:forward: ll2mAtPoles"),null;if(this.sphere)s=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(t-this.long0),a=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+.5*i));else{var r=Math.sin(i),n=Proj4js.common.tsfnz(this.e,i,r);s=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(t-this.long0),a=this.y0-this.a*this.k0*Math.log(n)}return e.x=s,e.y=a,e},inverse:function(e){var t,i,s=e.x-this.x0,a=e.y-this.y0;if(this.sphere)i=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-a/this.a*this.k0));else{var r=Math.exp(-a/(this.a*this.k0));if(i=Proj4js.common.phi2z(this.e,r),-9999==i)return Proj4js.reportError("merc:inverse: lat = -9999"),null}return t=Proj4js.common.adjust_lon(this.long0+s/(this.a*this.k0)),e.x=t,e.y=i,e}},Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){return this.zone?(this.lat0=0,this.long0=(6*Math.abs(this.zone)-183)*Proj4js.common.D2R,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Proj4js.Proj.tmerc.init.apply(this),this.forward=Proj4js.Proj.tmerc.forward,this.inverse=Proj4js.Proj.tmerc.inverse,void 0):(Proj4js.reportError("utm:init: zone must be specified for UTM"),void 0)}},Proj4js.Proj.eqdc={init:function(){this.mode||(this.mode=0),this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi),this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1),0!=this.mode?(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN&&Proj4js.reportError("eqdc:Init:EqualLatitudes"),this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi),this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN?(this.ms1-this.ms2)/(this.ml2-this.ml1):this.sinphi):this.ns=this.sinphi,this.g=this.ml1+this.ms1/this.ns,this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0)},forward:function(e){var t=e.x,i=e.y,s=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,i),a=this.a*(this.g-s),r=this.ns*Proj4js.common.adjust_lon(t-this.long0),n=this.x0+a*Math.sin(r),o=this.y0+this.rh-a*Math.cos(r);return e.x=n,e.y=o,e},inverse:function(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var t,i;if(this.ns>=0)var i=Math.sqrt(e.x*e.x+e.y*e.y),t=1;else i=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1;var s=0;0!=i&&(s=Math.atan2(t*e.x,t*e.y)),this.g-i/this.a;var a=this.phi3z(this.ml,this.e0,this.e1,this.e2,this.e3),r=Proj4js.common.adjust_lon(this.long0+s/this.ns);return e.x=r,e.y=a,e},phi3z:function(e,t,i,s,a){var r,n;r=e;for(var o=0;15>o;o++)if(n=(e+i*Math.sin(2*r)-s*Math.sin(4*r)+a*Math.sin(6*r))/t-r,r+=n,1e-10>=Math.abs(n))return r;return Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations"),null}},Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,i,s,a=e.x,r=e.y,n=Proj4js.common.adjust_lon(a-this.long0),o=Math.sin(r),l=Math.cos(r);if(this.sphere){var h=l*Math.sin(n);if(1e-10>Math.abs(Math.abs(h)-1))return Proj4js.reportError("tmerc:forward: Point projects into infinity"),93;
i=.5*this.a*this.k0*Math.log((1+h)/(1-h)),t=Math.acos(l*Math.cos(n)/Math.sqrt(1-h*h)),0>r&&(t=-t),s=this.a*this.k0*(t-this.lat0)}else{var u=l*n,p=Math.pow(u,2),c=this.ep2*Math.pow(l,2),d=Math.tan(r),m=Math.pow(d,2);t=1-this.es*Math.pow(o,2);var y=this.a/Math.sqrt(t),f=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,r);i=this.k0*y*u*(1+p/6*(1-m+c+p/20*(5-18*m+Math.pow(m,2)+72*c-58*this.ep2)))+this.x0,s=this.k0*(f-this.ml0+y*d*p*(.5+p/24*(5-m+9*c+4*Math.pow(c,2)+p/30*(61-58*m+Math.pow(m,2)+600*c-330*this.ep2))))+this.y0}return e.x=i,e.y=s,e},inverse:function(e){var t,i,s,a,r,n,o=6;if(this.sphere){var l=Math.exp(e.x/(this.a*this.k0)),h=.5*(l-1/l),u=this.lat0+e.y/(this.a*this.k0),p=Math.cos(u);t=Math.sqrt((1-p*p)/(1+h*h)),r=Proj4js.common.asinz(t),0>u&&(r=-r),n=0==h&&0==p?this.long0:Proj4js.common.adjust_lon(Math.atan2(h,p)+this.long0)}else{var c=e.x-this.x0,d=e.y-this.y0;for(t=(this.ml0+d/this.k0)/this.a,i=t,a=0;!0&&(s=(t+this.e1*Math.sin(2*i)-this.e2*Math.sin(4*i)+this.e3*Math.sin(6*i))/this.e0-i,i+=s,!(Math.abs(s)<=Proj4js.common.EPSLN));a++)if(a>=o)return Proj4js.reportError("tmerc:inverse: Latitude failed to converge"),95;if(Math.abs(i)<Proj4js.common.HALF_PI){var m=Math.sin(i),y=Math.cos(i),f=Math.tan(i),g=this.ep2*Math.pow(y,2),v=Math.pow(g,2),L=Math.pow(f,2),b=Math.pow(L,2);t=1-this.es*Math.pow(m,2);var O=this.a/Math.sqrt(t),S=O*(1-this.es)/t,w=c/(O*this.k0),_=Math.pow(w,2);r=i-O*f*_/S*(.5-_/24*(5+3*L+10*g-4*v-9*this.ep2-_/30*(61+90*L+298*g+45*b-252*this.ep2-3*v))),n=Proj4js.common.adjust_lon(this.long0+w*(1-_/6*(1+2*L+g-_/20*(5-2*g+28*L-3*v+8*this.ep2+24*b)))/y)}else r=Proj4js.common.HALF_PI*Proj4js.common.sign(d),n=this.long0}return e.x=n,e.y=r,e}},Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs",Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE,Proj4js.Proj.gstmerc={init:function(){var e=this.b/this.a;this.e=Math.sqrt(1-e*e),this.lc=this.long0,this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));var t=Math.sin(this.lat0),i=Math.asin(t/this.rs),s=Math.sin(i);this.cp=Proj4js.common.latiso(0,i,s)-this.rs*Proj4js.common.latiso(this.e,this.lat0,t),this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*t*t),this.xs=this.x0,this.ys=this.y0-this.n2*i,this.title||(this.title="Gauss Schreiber transverse mercator")},forward:function(e){var t=e.x,i=e.y,s=this.rs*(t-this.lc),a=this.cp+this.rs*Proj4js.common.latiso(this.e,i,Math.sin(i)),r=Math.asin(Math.sin(s)/Proj4js.common.cosh(a)),n=Proj4js.common.latiso(0,r,Math.sin(r));return e.x=this.xs+this.n2*n,e.y=this.ys+this.n2*Math.atan(Proj4js.common.sinh(a)/Math.cos(s)),e},inverse:function(e){var t=e.x,i=e.y,s=Math.atan(Proj4js.common.sinh((t-this.xs)/this.n2)/Math.cos((i-this.ys)/this.n2)),a=Math.asin(Math.sin((i-this.ys)/this.n2)/Proj4js.common.cosh((t-this.xs)/this.n2)),r=Proj4js.common.latiso(0,a,Math.sin(a));return e.x=this.lc+s/this.rs,e.y=Proj4js.common.invlatiso(this.e,(r-this.cp)/this.rs),e}},Proj4js.Proj.ortho={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,i,s,a,r,n,o=e.x,l=e.y;if(s=Proj4js.common.adjust_lon(o-this.long0),t=Math.sin(l),i=Math.cos(l),a=Math.cos(s),n=this.sin_p14*t+this.cos_p14*i*a,r=1,n>0||Math.abs(n)<=Proj4js.common.EPSLN)var h=this.a*r*i*Math.sin(s),u=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*i*a);else Proj4js.reportError("orthoFwdPointError");return e.x=h,e.y=u,e},inverse:function(e){var t,i,s,a,r,n,o;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),t>this.a+1e-7&&Proj4js.reportError("orthoInvDataError"),i=Proj4js.common.asinz(t/this.a),s=Math.sin(i),a=Math.cos(i),n=this.long0,Math.abs(t)<=Proj4js.common.EPSLN&&(o=this.lat0),o=Proj4js.common.asinz(a*this.sin_p14+e.y*s*this.cos_p14/t),r=Math.abs(lat0)-Proj4js.common.HALF_PI,Math.abs(r)<=Proj4js.common.EPSLN&&(n=this.lat0>=0?Proj4js.common.adjust_lon(this.long0+Math.atan2(e.x,-e.y)):Proj4js.common.adjust_lon(this.long0-Math.atan2(-e.x,e.y))),r=a-this.sin_p14*Math.sin(o),(Math.abs(r)>=Proj4js.common.EPSLN||Math.abs(x)>=Proj4js.common.EPSLN)&&(n=Proj4js.common.adjust_lon(this.long0+Math.atan2(e.x*s*this.cos_p14,r*t))),e.x=n,e.y=o,e}},Proj4js.Proj.somerc={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),i=this.a,s=this.rf,a=1/s,r=2*a-Math.pow(a,2),n=this.e=Math.sqrt(r);this.R=i*Math.sqrt(1-r)/(1-r*Math.pow(t,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha),this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+e/2))+this.alpha*n/2*Math.log((1+n*t)/(1-n*t))},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),s=-this.alpha*(t+i)+this.K,a=2*(Math.atan(Math.exp(s))-Math.PI/4),r=this.alpha*(e.x-this.lambda0),n=Math.atan(Math.sin(r)/(Math.sin(this.b0)*Math.tan(a)+Math.cos(this.b0)*Math.cos(r))),o=Math.asin(Math.cos(this.b0)*Math.sin(a)-Math.sin(this.b0)*Math.cos(a)*Math.cos(r));return e.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,e.x=this.R*n+this.x0,e},inverse:function(e){for(var t=e.x-this.x0,i=e.y-this.y0,s=t/this.R,a=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),r=Math.asin(Math.cos(this.b0)*Math.sin(a)+Math.sin(this.b0)*Math.cos(a)*Math.cos(s)),n=Math.atan(Math.sin(s)/(Math.cos(this.b0)*Math.cos(s)-Math.sin(this.b0)*Math.tan(a))),o=this.lambda0+n/this.alpha,l=0,h=r,u=-1e3,p=0;Math.abs(h-u)>1e-7;){if(++p>20)return Proj4js.reportError("omercFwdInfinity"),void 0;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+r/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),u=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return e.x=o,e.y=h,e}},Proj4js.Proj.stere={ssfn_:function(e,t,i){return t*=i,Math.tan(.5*(Proj4js.common.HALF_PI+e))*Math.pow((1-t)/(1+t),.5*i)},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var e=Math.abs(this.lat0);if(this.mode=Math.abs(e)-Proj4js.common.HALF_PI<Proj4js.common.EPSLN?0>this.lat0?this.S_POLE:this.N_POLE:e>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT,this.phits=Math.abs(this.phits),this.es){var t;switch(this.mode){case this.N_POLE:case this.S_POLE:Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)):(e=Math.sin(this.phits),this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,e),e*=this.e,this.akm1/=Math.sqrt(1-e*e));break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:e=Math.sin(this.lat0),t=2*Math.atan(this.ssfn_(this.lat0,e,this.e))-Proj4js.common.HALF_PI,e*=this.e,this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-e*e),this.sinX1=Math.sin(t),this.cosX1=Math.cos(t)}}else switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-.5*this.phits):2*this.k0}},forward:function(e){var t=e.x;t=Proj4js.common.adjust_lon(t-this.long0);var i,s,a=e.y;if(this.sphere){var r,n,o,l;switch(r=Math.sin(a),n=Math.cos(a),o=Math.cos(t),l=Math.sin(t),this.mode){case this.EQUIT:s=1+n*o,Proj4js.common.EPSLN>=s,s=this.akm1/s,i=s*n*l,s*=r;break;case this.OBLIQ:s=1+this.sinph0*r+this.cosph0*n*o,Proj4js.common.EPSLN>=s,s=this.akm1/s,i=s*n*l,s*=this.cosph0*r-this.sinph0*n*o;break;case this.N_POLE:o=-o,a=-a;case this.S_POLE:Math.abs(a-Proj4js.common.HALF_PI)<this.TOL,s=this.akm1*Math.tan(Proj4js.common.FORTPI+.5*a),i=l*s,s*=o}}else{switch(o=Math.cos(t),l=Math.sin(t),r=Math.sin(a),(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(X=2*Math.atan(this.ssfn_(a,r,this.e)),sinX=Math.sin(X-Proj4js.common.HALF_PI),cosX=Math.cos(X)),this.mode){case this.OBLIQ:A=this.akm1/(this.cosX1*(1+this.sinX1*sinX+this.cosX1*cosX*o)),s=A*(this.cosX1*sinX-this.sinX1*cosX*o),i=A*cosX;break;case this.EQUIT:A=2*this.akm1/(1+cosX*o),s=A*sinX,i=A*cosX;break;case this.S_POLE:a=-a,o=-o,r=-r;case this.N_POLE:i=this.akm1*Proj4js.common.tsfnz(this.e,a,r),s=-i*o}i*=l}return e.x=i*this.a+this.x0,e.y=s*this.a+this.y0,e},inverse:function(e){var t,i,s,a,r,n,o=(e.x-this.x0)/this.a,l=(e.y-this.y0)/this.a,h=0,u=0,p=0,c=0;if(this.sphere){var d,m,y,f;switch(m=Math.sqrt(o*o+l*l),d=2*Math.atan(m/this.akm1),y=Math.sin(d),f=Math.cos(d),t=0,this.mode){case this.EQUIT:i=Math.abs(m)<=Proj4js.common.EPSLN?0:Math.asin(l*y/m),(0!=f||0!=o)&&(t=Math.atan2(o*y,f*m));break;case this.OBLIQ:i=Math.abs(m)<=Proj4js.common.EPSLN?this.phi0:Math.asin(f*sinph0+l*y*cosph0/m),d=f-sinph0*Math.sin(i),(0!=d||0!=o)&&(t=Math.atan2(o*y*cosph0,d*m));break;case this.N_POLE:l=-l;case this.S_POLE:i=Math.abs(m)<=Proj4js.common.EPSLN?this.phi0:Math.asin(this.mode==this.S_POLE?-f:f),t=0==o&&0==l?0:Math.atan2(o,l)}}else{switch(r=Math.sqrt(o*o+l*l),this.mode){case this.OBLIQ:case this.EQUIT:h=2*Math.atan2(r*this.cosX1,this.akm1),s=Math.cos(h),a=Math.sin(h),u=0==r?Math.asin(s*this.sinX1):Math.asin(s*this.sinX1+l*a*this.cosX1/r),h=Math.tan(.5*(Proj4js.common.HALF_PI+u)),o*=a,l=r*this.cosX1*s-l*this.sinX1*a,c=Proj4js.common.HALF_PI,p=.5*this.e;break;case this.N_POLE:l=-l;case this.S_POLE:h=-r/this.akm1,u=Proj4js.common.HALF_PI-2*Math.atan(h),c=-Proj4js.common.HALF_PI,p=-.5*this.e}for(n=this.NITER;n--;u=i)if(a=this.e*Math.sin(u),i=2*Math.atan(h*Math.pow((1+a)/(1-a),p))-c,Math.abs(u-i)<this.CONV)return this.mode==this.S_POLE&&(i=-i),t=0==o&&0==l?0:Math.atan2(o,l),e.x=Proj4js.common.adjust_lon(t+this.long0),e.y=i,e}}},Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=Array(),this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=Array(),this.B_im=Array(),this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=Array(),this.C_im=Array(),this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=Array(),this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(e){var t=e.x,i=e.y,s=i-this.lat0,a=t-this.long0,r=1e-5*(s/Proj4js.common.SEC_TO_RAD),o=a,l=1,h=0;for(n=1;10>=n;n++)l*=r,h+=this.A[n]*l;var u,p,c=h,d=o,m=1,f=0,g=0,v=0;for(n=1;6>=n;n++)u=m*c-f*d,p=f*c+m*d,m=u,f=p,g=g+this.B_re[n]*m-this.B_im[n]*f,v=v+this.B_im[n]*m+this.B_re[n]*f;return x=v*this.a+this.x0,y=g*this.a+this.y0,e.x=x,e.y=y,e},inverse:function(e){var t,s,a=e.x,r=e.y,o=a-this.x0,l=r-this.y0,h=l/this.a,u=o/this.a,p=1,c=0,d=0,m=0;for(n=1;6>=n;n++)t=p*h-c*u,s=c*h+p*u,p=t,c=s,d=d+this.C_re[n]*p-this.C_im[n]*c,m=m+this.C_im[n]*p+this.C_re[n]*c;for(i=0;this.iterations>i;i++){var y,f,g=d,v=m,L=h,b=u;for(n=2;6>=n;n++)y=g*d-v*m,f=v*d+g*m,g=y,v=f,L+=(n-1)*(this.B_re[n]*g-this.B_im[n]*v),b+=(n-1)*(this.B_im[n]*g+this.B_re[n]*v);g=1,v=0;var O=this.B_re[1],S=this.B_im[1];for(n=2;6>=n;n++)y=g*d-v*m,f=v*d+g*m,g=y,v=f,O+=n*(this.B_re[n]*g-this.B_im[n]*v),S+=n*(this.B_im[n]*g+this.B_re[n]*v);var w=O*O+S*S;d=(L*O+b*S)/w,m=(b*O-L*S)/w}var _=d,x=m,k=1,C=0;for(n=1;9>=n;n++)k*=_,C+=this.D[n]*k;var M=this.lat0+1e5*C*Proj4js.common.SEC_TO_RAD,E=this.long0+x;return e.x=E,e.y=M,e}},Proj4js.Proj.mill={init:function(){},forward:function(e){var t=e.x,i=e.y,s=Proj4js.common.adjust_lon(t-this.long0),a=this.x0+this.a*s,r=this.y0+1.25*this.a*Math.log(Math.tan(Proj4js.common.PI/4+i/2.5));return e.x=a,e.y=r,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=Proj4js.common.adjust_lon(this.long0+e.x/this.a),i=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Proj4js.common.PI/4);return e.x=t,e.y=i,e}},Proj4js.Proj.gnom={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a},forward:function(e){var t,i,s,a,r,n,o=e.x,l=e.y;return s=Proj4js.common.adjust_lon(o-this.long0),t=Math.sin(l),i=Math.cos(l),a=Math.cos(s),n=this.sin_p14*t+this.cos_p14*i*a,r=1,n>0||Math.abs(n)<=Proj4js.common.EPSLN?(x=this.x0+this.a*r*i*Math.sin(s)/n,y=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*i*a)/n):(Proj4js.reportError("orthoFwdPointError"),x=this.x0+this.infinity_dist*i*Math.sin(s),y=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*i*a)),e.x=x,e.y=y,e},inverse:function(e){var t,i,s,a,r,n;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(a=Math.atan2(t,this.rc),i=Math.sin(a),s=Math.cos(a),n=Proj4js.common.asinz(s*this.sin_p14+e.y*i*this.cos_p14/t),r=Math.atan2(e.x*i,t*this.cos_p14*s-e.y*this.sin_p14*i),r=Proj4js.common.adjust_lon(this.long0+r)):(n=this.phic0,r=0),e.x=r,e.y=n,e}},Proj4js.Proj.sinu={init:function(){this.R=6370997},forward:function(e){var t,i,s,a=e.x,r=e.y;return s=Proj4js.common.adjust_lon(a-this.long0),t=this.R*s*Math.cos(r)+this.x0,i=this.R*r+this.y0,e.x=t,e.y=i,e},inverse:function(e){var t,i,s;return e.x-=this.x0,e.y-=this.y0,t=e.y/this.R,Math.abs(t)>Proj4js.common.HALF_PI&&Proj4js.reportError("sinu:Inv:DataError"),i=Math.abs(t)-Proj4js.common.HALF_PI,Math.abs(i)>Proj4js.common.EPSLN?(i=this.long0+e.x/(this.R*Math.cos(t)),s=Proj4js.common.adjust_lon(i)):s=this.long0,e.x=s,e.y=t,e}},Proj4js.Proj.vandg={init:function(){this.R=6370997},forward:function(e){var t,i,s=e.x,a=e.y,r=Proj4js.common.adjust_lon(s-this.long0);Math.abs(a)<=Proj4js.common.EPSLN&&(t=this.x0+this.R*r,i=this.y0);var n=Proj4js.common.asinz(2*Math.abs(a/Proj4js.common.PI));(Math.abs(r)<=Proj4js.common.EPSLN||Math.abs(Math.abs(a)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)&&(t=this.x0,i=a>=0?this.y0+Proj4js.common.PI*this.R*Math.tan(.5*n):this.y0+Proj4js.common.PI*this.R*-Math.tan(.5*n));var o=.5*Math.abs(Proj4js.common.PI/r-r/Proj4js.common.PI),l=o*o,h=Math.sin(n),u=Math.cos(n),p=u/(h+u-1),c=p*p,d=p*(2/h-1),m=d*d,y=Proj4js.common.PI*this.R*(o*(p-m)+Math.sqrt(l*(p-m)*(p-m)-(m+l)*(c-m)))/(m+l);return 0>r&&(y=-y),t=this.x0+y,y=Math.abs(y/(Proj4js.common.PI*this.R)),i=a>=0?this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-y*y-2*o*y):this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-y*y-2*o*y),e.x=t,e.y=i,e},inverse:function(e){var t,i,s,a,r,n,o,l,h,u,p;return e.x-=this.x0,e.y-=this.y0,h=Proj4js.common.PI*this.R,t=e.x/h,i=e.y/h,s=t*t+i*i,a=-Math.abs(i)*(1+s),r=a-2*i*i+t*t,n=-2*a+1+2*i*i+s*s,p=i*i/n+(2*r*r*r/n/n/n-9*a*r/n/n)/27,o=(a-r*r/3/n)/n,l=2*Math.sqrt(-o/3),h=3*p/o/l,Math.abs(h)>1&&(h=h>=0?1:-1),u=Math.acos(h)/3,lat=e.y>=0?(-l*Math.cos(u+Proj4js.common.PI/3)-r/3/n)*Proj4js.common.PI:-(-l*Math.cos(u+PI/3)-r/3/n)*Proj4js.common.PI,Math.abs(t)<Proj4js.common.EPSLN&&(lon=this.long0),lon=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(s-1+Math.sqrt(1+2*(t*t-i*i)+s*s))/2/t),e.x=lon,e.y=lat,e}},Proj4js.Proj.cea={init:function(){},forward:function(e){var t=e.x,i=e.y;dlon=Proj4js.common.adjust_lon(t-this.long0);var s=this.x0+this.a*dlon*Math.cos(this.lat_ts),a=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);return e.x=s,e.y=a,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=Proj4js.common.adjust_lon(this.long0+e.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(e.y/this.a*Math.cos(this.lat_ts));return e.x=t,e.y=i,e}},Proj4js.Proj.eqc={init:function(){this.x0||(this.x0=0),this.y0||(this.y0=0),this.lat0||(this.lat0=0),this.long0||(this.long0=0),this.lat_ts||(this.lat_ts=0),this.title||(this.title="Equidistant Cylindrical (Plate Carre)"),this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,i=e.y,s=Proj4js.common.adjust_lon(t-this.long0),a=Proj4js.common.adjust_lat(i-this.lat0);return e.x=this.x0+this.a*s*this.rc,e.y=this.y0+this.a*a,e},inverse:function(e){var t=e.x,i=e.y;return e.x=Proj4js.common.adjust_lon(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=Proj4js.common.adjust_lat(this.lat0+(i-this.y0)/this.a),e}},Proj4js.Proj.cass={init:function(){this.sphere||(this.en=this.pj_enfn(this.es),this.m0=this.pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},C1:.16666666666666666,C2:.008333333333333333,C3:.041666666666666664,C4:.3333333333333333,C5:.06666666666666667,forward:function(e){var t,i,s=e.x,a=e.y;return s=Proj4js.common.adjust_lon(s-this.long0),this.sphere?(t=Math.asin(Math.cos(a)*Math.sin(s)),i=Math.atan2(Math.tan(a),Math.cos(s))-this.phi0):(this.n=Math.sin(a),this.c=Math.cos(a),i=this.pj_mlfn(a,this.n,this.c,this.en),this.n=1/Math.sqrt(1-this.es*this.n*this.n),this.tn=Math.tan(a),this.t=this.tn*this.tn,this.a1=s*this.c,this.c*=this.es*this.c/(1-this.es),this.a2=this.a1*this.a1,t=this.n*this.a1*(1-this.a2*this.t*(this.C1-(8-this.t+8*this.c)*this.a2*this.C2)),i-=this.m0-this.n*this.tn*this.a2*(.5+(5-this.t+6*this.c)*this.a2*this.C3)),e.x=this.a*t+this.x0,e.y=this.a*i+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,i=e.y/this.a;return this.sphere?(this.dd=i+this.lat0,phi=Math.asin(Math.sin(this.dd)*Math.cos(t)),lam=Math.atan2(Math.tan(t),Math.cos(this.dd))):(ph1=this.pj_inv_mlfn(this.m0+i,this.es,this.en),this.tn=Math.tan(ph1),this.t=this.tn*this.tn,this.n=Math.sin(ph1),this.r=1/(1-this.es*this.n*this.n),this.n=Math.sqrt(this.r),this.r*=(1-this.es)*this.n,this.dd=t/this.n,this.d2=this.dd*this.dd,phi=ph1-this.n*this.tn/this.r*this.d2*(.5-(1+3*this.t)*this.d2*this.C3),lam=this.dd*(1+this.t*this.d2*(-this.C4+(1+3*this.t)*this.d2*this.C5))/Math.cos(ph1)),e.x=Proj4js.common.adjust_lon(this.long0+lam),e.y=phi,e},pj_enfn:function(e){en=Array(),en[0]=this.C00-e*(this.C02+e*(this.C04+e*(this.C06+e*this.C08))),en[1]=e*(this.C22-e*(this.C04+e*(this.C06+e*this.C08)));var t=e*e;return en[2]=t*(this.C44-e*(this.C46+e*this.C48)),t*=e,en[3]=t*(this.C66-e*this.C68),en[4]=t*e*this.C88,en},pj_mlfn:function(e,t,i,s){return i*=t,t*=t,s[0]*e-i*(s[1]+t*(s[2]+t*(s[3]+t*s[4])))},pj_inv_mlfn:function(e,a,r){for(k=1/(1-a),phi=e,i=Proj4js.common.MAX_ITER;i;--i)if(s=Math.sin(phi),t=1-a*s*s,t=(this.pj_mlfn(phi,s,Math.cos(phi),r)-e)*t*Math.sqrt(t)*k,phi-=t,Math.abs(t)<Proj4js.common.EPSLN)return phi;return Proj4js.reportError("cass:pj_inv_mlfn: Convergence error"),phi},C00:1,C02:.25,C04:.046875,C06:.01953125,C08:.01068115234375,C22:.75,C44:.46875,C46:.013020833333333334,C48:.007120768229166667,C66:.3645833333333333,C68:.005696614583333333,C88:.3076171875},Proj4js.Proj.gauss={init:function(){sphi=Math.sin(this.lat0),cphi=Math.cos(this.lat0),cphi*=cphi,this.rc=Math.sqrt(1-this.es)/(1-this.es*sphi*sphi),this.C=Math.sqrt(1+this.es*cphi*cphi/(1-this.es)),this.phic0=Math.asin(sphi/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*sphi,this.ratexp))},forward:function(e){var t=e.x,i=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(i),this.ratexp))-Proj4js.common.HALF_PI,e.x=this.C*t,e},inverse:function(e){var t=1e-14,i=e.x/this.C,s=e.y;num=Math.pow(Math.tan(.5*s+Proj4js.common.FORTPI)/this.K,1/this.C);for(var a=Proj4js.common.MAX_ITER;a>0&&(s=2*Math.atan(num*Proj4js.common.srat(this.e*Math.sin(e.y),-.5*this.e))-Proj4js.common.HALF_PI,!(t>Math.abs(s-e.y)));--a)e.y=s;return a?(e.x=i,e.y=s,e):(Proj4js.reportError("gauss:inverse:convergence failed"),null)}},Proj4js.Proj.omerc={init:function(){this.mode||(this.mode=0),this.lon1||(this.lon1=0,this.mode=1),this.lon2||(this.lon2=0),this.lat2||(this.lat2=0);var e=this.b/this.a,t=1-Math.pow(e,2);Math.sqrt(t),this.sin_p20=Math.sin(this.lat0),this.cos_p20=Math.cos(this.lat0),this.con=1-this.es*this.sin_p20*this.sin_p20,this.com=Math.sqrt(1-t),this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-t)),this.al=this.a*this.bl*this.k0*this.com/this.con,Math.abs(this.lat0)<Proj4js.common.EPSLN?(this.ts=1,this.d=1,this.el=1):(this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20),this.con=Math.sqrt(this.con),this.d=this.bl*this.com/(this.cos_p20*this.con),this.f=this.d*this.d-1>0?this.lat0>=0?this.d+Math.sqrt(this.d*this.d-1):this.d-Math.sqrt(this.d*this.d-1):this.d,this.el=this.f*Math.pow(this.ts,this.bl)),0!=this.mode?(this.g=.5*(this.f-1/this.f),this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d),this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl,this.con=Math.abs(this.lat0),this.con>Proj4js.common.EPSLN&&Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(this.singam=Math.sin(this.gama),this.cosgam=Math.cos(this.gama),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)):Proj4js.reportError("omerc:Init:DataError")):(this.sinphi=Math.sin(this.at1),this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi),this.sinphi=Math.sin(this.lat2),this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi),this.h=Math.pow(this.ts1,this.bl),this.l=Math.pow(this.ts2,this.bl),this.f=this.el/this.h,this.g=.5*(this.f-1/this.f),this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h),this.p=(this.l-this.h)/(this.l+this.h),this.dlon=this.lon1-this.lon2,this.dlon<-Proj4js.common.PI&&(this.lon2=this.lon2-2*Proj4js.common.PI),this.dlon>Proj4js.common.PI&&(this.lon2=this.lon2+2*Proj4js.common.PI),this.dlon=this.lon1-this.lon2,this.longc=.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(.5*this.bl*this.dlon)/this.p)/this.bl,this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc),this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g),this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama)),Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):this.con=Math.abs(this.lat1),this.con<=Proj4js.common.EPSLN||Math.abs(this.con-HALF_PI)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercInitDataError"),this.singam=Math.sin(this.gam),this.cosgam=Math.cos(this.gam),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz))},forward:function(e){var t,i,s,a,r,n,o,l,h,u,p,c=e.x,d=e.y;t=Math.sin(d),u=Proj4js.common.adjust_lon(c-this.longc),n=Math.sin(this.bl*u),Math.abs(Math.abs(d)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(p=Proj4js.common.tsfnz(this.e,d,t),a=this.el/Math.pow(p,this.bl),h=.5*(a-1/a),i=.5*(a+1/a),o=(h*this.singam-n*this.cosgam)/i,s=Math.cos(this.bl*u),1e-7>Math.abs(s)?r=this.al*this.bl*u:(r=this.al*Math.atan((h*this.cosgam+n*this.singam)/s)/this.bl,0>s&&(r+=Proj4js.common.PI*this.al/this.bl))):(o=d>=0?this.singam:-this.singam,r=this.al*d/this.bl),Math.abs(Math.abs(o)-1)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercFwdInfinity"),l=.5*this.al*Math.log((1-o)/(1+o))/this.bl,r-=this.u;var m=this.x0+l*this.cosaz+r*this.sinaz,y=this.y0+r*this.cosaz-l*this.sinaz;return e.x=m,e.y=y,e},inverse:function(e){var t,i,s,a,r,n,o,l,h,u,p;return e.x-=this.x0,e.y-=this.y0,p=0,a=e.x*this.cosaz-e.y*this.sinaz,r=e.y*this.cosaz+e.x*this.sinaz,r+=this.u,n=Math.exp(-this.bl*a/this.al),o=.5*(n-1/n),i=.5*(n+1/n),h=Math.sin(this.bl*r/this.al),u=(h*this.cosgam+o*this.singam)/i,Math.abs(Math.abs(u)-1)<=Proj4js.common.EPSLN?(lon=this.longc,lat=u>=0?Proj4js.common.HALF_PI:-Proj4js.common.HALF_PI):(s=1/this.bl,l=Math.pow(this.el/Math.sqrt((1+u)/(1-u)),s),lat=Proj4js.common.phi2z(this.e,l),t=this.longc-Math.atan2(o*this.cosgam-h*this.singam,s)/this.bl,lon=Proj4js.common.adjust_lon(t)),e.x=lon,e.y=lat,e}},Proj4js.Proj.lcc={init:function(){if(this.lat2||(this.lat2=this.lat0),this.k0||(this.k0=1),Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN)return Proj4js.reportError("lcc:init: Equal Latitudes"),void 0;var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),i=Math.cos(this.lat1),s=Proj4js.common.msfnz(this.e,t,i),a=Proj4js.common.tsfnz(this.e,this.lat1,t),r=Math.sin(this.lat2),n=Math.cos(this.lat2),o=Proj4js.common.msfnz(this.e,r,n),l=Proj4js.common.tsfnz(this.e,this.lat2,r),h=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));this.ns=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?Math.log(s/o)/Math.log(a/l):t,this.f0=s/(this.ns*Math.pow(a,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")},forward:function(e){var t=e.x,i=e.y;if(!(90>=i&&i>=-90&&180>=t&&t>=-180))return Proj4js.reportError("lcc:forward: llInputOutOfRange: "+t+" : "+i),null;var s,a,r=Math.abs(Math.abs(i)-Proj4js.common.HALF_PI);if(r>Proj4js.common.EPSLN)s=Proj4js.common.tsfnz(this.e,i,Math.sin(i)),a=this.a*this.f0*Math.pow(s,this.ns);else{if(r=i*this.ns,0>=r)return Proj4js.reportError("lcc:forward: No Projection"),null;a=0}var n=this.ns*Proj4js.common.adjust_lon(t-this.long0);return e.x=this.k0*a*Math.sin(n)+this.x0,e.y=this.k0*(this.rh-a*Math.cos(n))+this.y0,e},inverse:function(e){var t,i,s,a,r;x=(e.x-this.x0)/this.k0,y=this.rh-(e.y-this.y0)/this.k0,this.ns>0?(t=Math.sqrt(x*x+y*y),i=1):(t=-Math.sqrt(x*x+y*y),i=-1);var n=0;if(0!=t&&(n=Math.atan2(i*x,i*y)),0!=t||this.ns>0){if(i=1/this.ns,s=Math.pow(t/(this.a*this.f0),i),a=Proj4js.common.phi2z(this.e,s),-9999==a)return null}else a=-Proj4js.common.HALF_PI;return r=Proj4js.common.adjust_lon(n/this.ns+this.long0),e.x=r,e.y=a,e}},Proj4js.Proj.laea={S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4,init:function(){var e=Math.abs(this.lat0);if(this.mode=Math.abs(e-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?0>this.lat0?this.S_POLE:this.N_POLE:Math.abs(e)<Proj4js.common.EPSLN?this.EQUIT:this.OBLIQ,this.es>0){var t;switch(this.qp=Proj4js.common.qsfnz(this.e,1),this.mmf=.5/(1-this.es),this.apa=this.authset(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Proj4js.common.qsfnz(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode==this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(e){var t,i,s=e.x,a=e.y;if(s=Proj4js.common.adjust_lon(s-this.long0),this.sphere){var r,n,o;switch(o=Math.sin(a),n=Math.cos(a),r=Math.cos(s),this.mode){case this.EQUIT:if(i=this.mode==this.EQUIT?1+n*r:1+this.sinph0*o+this.cosph0*n*r,Proj4js.common.EPSLN>=i)return Proj4js.reportError("laea:fwd:y less than eps"),null;i=Math.sqrt(2/i),t=i*n*Math.sin(s),i*=this.mode==this.EQUIT?o:this.cosph0*o-this.sinph0*n*r;break;case this.N_POLE:r=-r;case this.S_POLE:if(Math.abs(a+this.phi0)<Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:phi < eps"),null;i=Proj4js.common.FORTPI-.5*a,i=2*(this.mode==this.S_POLE?Math.cos(i):Math.sin(i)),t=i*Math.sin(s),i*=r}}else{var r,l,o,h,u=0,p=0,c=0;switch(r=Math.cos(s),l=Math.sin(s),o=Math.sin(a),h=Proj4js.common.qsfnz(this.e,o),(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(u=h/this.qp,p=Math.sqrt(1-u*u)),this.mode){case this.OBLIQ:c=1+this.sinb1*u+this.cosb1*p*r;break;case this.EQUIT:c=1+p*r;break;case this.N_POLE:c=Proj4js.common.HALF_PI+a,h=this.qp-h;break;case this.S_POLE:c=a-Proj4js.common.HALF_PI,h=this.qp+h}if(Math.abs(c)<Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:b < eps"),null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),i=this.mode==this.OBLIQ?this.ymf*c*(this.cosb1*u-this.sinb1*p*r):(c=Math.sqrt(2/(1+p*r)))*u*this.ymf,t=this.xmf*c*p*l;break;case this.N_POLE:case this.S_POLE:h>=0?(t=(c=Math.sqrt(h))*l,i=r*(this.mode==this.S_POLE?c:-c)):t=i=0}}return e.x=this.a*t+this.x0,e.y=this.a*i+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,i=e.y/this.a;if(this.sphere){var s,a=0,r=0;s=Math.sqrt(t*t+i*i);var n=.5*s;if(n>1)return Proj4js.reportError("laea:Inv:DataError"),null;switch(n=2*Math.asin(n),(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(r=Math.sin(n),a=Math.cos(n)),this.mode){case this.EQUIT:n=Math.abs(s)<=Proj4js.common.EPSLN?0:Math.asin(i*r/s),t*=r,i=a*s;break;case this.OBLIQ:n=Math.abs(s)<=Proj4js.common.EPSLN?this.phi0:Math.asin(a*sinph0+i*r*cosph0/s),t*=r*cosph0,i=(a-Math.sin(n)*sinph0)*s;break;case this.N_POLE:i=-i,n=Proj4js.common.HALF_PI-n;break;case this.S_POLE:n-=Proj4js.common.HALF_PI}lam=0!=i||this.mode!=this.EQUIT&&this.mode!=this.OBLIQ?Math.atan2(t,i):0}else{var o,l,h,u,p=0;switch(this.mode){case this.EQUIT:case this.OBLIQ:if(t/=this.dd,i*=this.dd,u=Math.sqrt(t*t+i*i),Proj4js.common.EPSLN>u)return e.x=0,e.y=this.phi0,e;l=2*Math.asin(.5*u/this.rq),o=Math.cos(l),t*=l=Math.sin(l),this.mode==this.OBLIQ?(p=o*this.sinb1+i*l*this.cosb1/u,h=this.qp*p,i=u*this.cosb1*o-i*this.sinb1*l):(p=i*l/u,h=this.qp*p,i=u*o);break;case this.N_POLE:i=-i;case this.S_POLE:if(h=t*t+i*i,!h)return e.x=0,e.y=this.phi0,e;p=1-h/this.qp,this.mode==this.S_POLE&&(p=-p)}lam=Math.atan2(t,i),n=this.authlat(Math.asin(p),this.apa)}return e.x=Proj4js.common.adjust_lon(this.long0+lam),e.y=n,e},P00:.3333333333333333,P01:.17222222222222222,P02:.10257936507936508,P10:.06388888888888888,P11:.0664021164021164,P20:.016415012942191543,authset:function(e){var t,i=Array();return i[0]=e*this.P00,t=e*e,i[0]+=t*this.P01,i[1]=t*this.P10,t*=e,i[0]+=t*this.P02,i[1]+=t*this.P11,i[2]=t*this.P20,i},authlat:function(e,t){var i=e+e;return e+t[0]*Math.sin(i)+t[1]*Math.sin(i+i)+t[2]*Math.sin(i+i+i)}},Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t=e.x;e.y;var i,s=Math.sin(e.y),a=Math.cos(e.y),r=Proj4js.common.adjust_lon(t-this.long0),n=Math.cos(r),o=this.sin_p12*s+this.cos_p12*a*n;if(Math.abs(Math.abs(o)-1)<Proj4js.common.EPSLN){if(i=1,0>o)return Proj4js.reportError("aeqd:Fwd:PointError"),void 0}else{var l=Math.acos(o);i=l/Math.sin(l)}return e.x=this.x0+this.a*i*a*Math.sin(r),e.y=this.y0+this.a*i*(this.cos_p12*s-this.sin_p12*a*n),e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=Math.sqrt(e.x*e.x+e.y*e.y);if(t>2*Proj4js.common.HALF_PI*this.a)return Proj4js.reportError("aeqdInvDataError"),void 0;var i,s=t/this.a,a=Math.sin(s),r=Math.cos(s),n=this.long0;if(Math.abs(t)<=Proj4js.common.EPSLN)i=this.lat0;else{i=Proj4js.common.asinz(r*this.sin_p12+e.y*a*this.cos_p12/t);var o=Math.abs(this.lat0)-Proj4js.common.HALF_PI;Math.abs(o)<=Proj4js.common.EPSLN?n=lat0>=0?Proj4js.common.adjust_lon(this.long0+Math.atan2(e.x,-e.y)):Proj4js.common.adjust_lon(this.long0-Math.atan2(-e.x,e.y)):(o=r-this.sin_p12*Math.sin(i),Math.abs(o)<Proj4js.common.EPSLN&&Math.abs(e.x)<Proj4js.common.EPSLN||(Math.atan2(e.x*a*this.cos_p12,o*t),n=Proj4js.common.adjust_lon(this.long0+Math.atan2(e.x*a*this.cos_p12,o*t))))}return e.x=n,e.y=i,e}},Proj4js.Proj.moll={init:function(){},forward:function(e){for(var t=e.x,i=e.y,s=Proj4js.common.adjust_lon(t-this.long0),a=i,r=Proj4js.common.PI*Math.sin(i),n=0;!0;n++){var o=-(a+Math.sin(a)-r)/(1+Math.cos(a));if(a+=o,Math.abs(o)<Proj4js.common.EPSLN)break;n>=50&&Proj4js.reportError("moll:Fwd:IterationError")}a/=2,Proj4js.common.PI/2-Math.abs(i)<Proj4js.common.EPSLN&&(s=0);var l=.900316316158*this.a*s*Math.cos(a)+this.x0,h=1.4142135623731*this.a*Math.sin(a)+this.y0;return e.x=l,e.y=h,e},inverse:function(e){var t,i;e.x-=this.x0;var i=e.y/(1.4142135623731*this.a);Math.abs(i)>.999999999999&&(i=.999999999999);var t=Math.asin(i),s=Proj4js.common.adjust_lon(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));
-Proj4js.common.PI>s&&(s=-Proj4js.common.PI),s>Proj4js.common.PI&&(s=Proj4js.common.PI),i=(2*t+Math.sin(2*t))/Proj4js.common.PI,Math.abs(i)>1&&(i=1);var a=Math.asin(i);return e.x=s,e.y=a,e}};var OpenLayers={VERSION_NUMBER:"Release 2.11",singleFile:!0,_getScriptLocation:function(){for(var e,t,i=RegExp("(^|(.*?\\/))(OpenLayers.js)(\\?|$)"),s=document.getElementsByTagName("script"),a="",r=0,n=s.length;n>r;r++)if(e=s[r].getAttribute("src")){var t=e.match(i);if(t){a=t[1];break}}return function(){return a}}()};if(function(){var e="object"==typeof OpenLayers&&OpenLayers.singleFile,t=e?"OpenLayers.js":"lib/OpenLayers.js",i=window.OpenLayers;if(window.OpenLayers={_getScriptLocation:function(){for(var e,i,s=RegExp("(^|(.*?\\/))("+t+")(\\?|$)"),a=document.getElementsByTagName("script"),r="",n=0,o=a.length;o>n;n++)if(e=a[n].getAttribute("src")){var i=e.match(s);if(i){r=i[1];break}}return function(){return r}}()},!e){i||(i=["OpenLayers/BaseTypes/Class.js","OpenLayers/Util.js","OpenLayers/BaseTypes.js","OpenLayers/BaseTypes/Bounds.js","OpenLayers/BaseTypes/Date.js","OpenLayers/BaseTypes/Element.js","OpenLayers/BaseTypes/LonLat.js","OpenLayers/BaseTypes/Pixel.js","OpenLayers/BaseTypes/Size.js","OpenLayers/Console.js","OpenLayers/Tween.js","OpenLayers/Kinetic.js","Rico/Corner.js","Rico/Color.js","OpenLayers/Ajax.js","OpenLayers/Events.js","OpenLayers/Request.js","OpenLayers/Request/XMLHttpRequest.js","OpenLayers/Projection.js","OpenLayers/Map.js","OpenLayers/Layer.js","OpenLayers/Icon.js","OpenLayers/Marker.js","OpenLayers/Marker/Box.js","OpenLayers/Popup.js","OpenLayers/Tile.js","OpenLayers/Tile/Image.js","OpenLayers/Tile/Image/IFrame.js","OpenLayers/Tile/WFS.js","OpenLayers/Layer/Image.js","OpenLayers/Layer/SphericalMercator.js","OpenLayers/Layer/EventPane.js","OpenLayers/Layer/FixedZoomLevels.js","OpenLayers/Layer/Google.js","OpenLayers/Layer/Google/v3.js","OpenLayers/Layer/VirtualEarth.js","OpenLayers/Layer/Yahoo.js","OpenLayers/Layer/HTTPRequest.js","OpenLayers/Layer/Grid.js","OpenLayers/Layer/MapGuide.js","OpenLayers/Layer/MapServer.js","OpenLayers/Layer/MapServer/Untiled.js","OpenLayers/Layer/KaMap.js","OpenLayers/Layer/KaMapCache.js","OpenLayers/Layer/MultiMap.js","OpenLayers/Layer/Markers.js","OpenLayers/Layer/Text.js","OpenLayers/Layer/WorldWind.js","OpenLayers/Layer/ArcGIS93Rest.js","OpenLayers/Layer/WMS.js","OpenLayers/Layer/WMS/Untiled.js","OpenLayers/Layer/WMS/Post.js","OpenLayers/Layer/WMTS.js","OpenLayers/Layer/ArcIMS.js","OpenLayers/Layer/GeoRSS.js","OpenLayers/Layer/Boxes.js","OpenLayers/Layer/XYZ.js","OpenLayers/Layer/Bing.js","OpenLayers/Layer/TMS.js","OpenLayers/Layer/TileCache.js","OpenLayers/Layer/Zoomify.js","OpenLayers/Layer/ArcGISCache.js","OpenLayers/Popup/Anchored.js","OpenLayers/Popup/AnchoredBubble.js","OpenLayers/Popup/Framed.js","OpenLayers/Popup/FramedCloud.js","OpenLayers/Feature.js","OpenLayers/Feature/Vector.js","OpenLayers/Feature/WFS.js","OpenLayers/Handler.js","OpenLayers/Handler/Click.js","OpenLayers/Handler/Hover.js","OpenLayers/Handler/Point.js","OpenLayers/Handler/Path.js","OpenLayers/Handler/Polygon.js","OpenLayers/Handler/Feature.js","OpenLayers/Handler/Drag.js","OpenLayers/Handler/Pinch.js","OpenLayers/Handler/RegularPolygon.js","OpenLayers/Handler/Box.js","OpenLayers/Handler/MouseWheel.js","OpenLayers/Handler/Keyboard.js","OpenLayers/Control.js","OpenLayers/Control/Attribution.js","OpenLayers/Control/Button.js","OpenLayers/Control/ZoomBox.js","OpenLayers/Control/ZoomToMaxExtent.js","OpenLayers/Control/DragPan.js","OpenLayers/Control/Navigation.js","OpenLayers/Control/PinchZoom.js","OpenLayers/Control/TouchNavigation.js","OpenLayers/Control/MouseDefaults.js","OpenLayers/Control/MousePosition.js","OpenLayers/Control/OverviewMap.js","OpenLayers/Control/KeyboardDefaults.js","OpenLayers/Control/PanZoom.js","OpenLayers/Control/PanZoomBar.js","OpenLayers/Control/ArgParser.js","OpenLayers/Control/Permalink.js","OpenLayers/Control/Scale.js","OpenLayers/Control/ScaleLine.js","OpenLayers/Control/Snapping.js","OpenLayers/Control/Split.js","OpenLayers/Control/LayerSwitcher.js","OpenLayers/Control/DrawFeature.js","OpenLayers/Control/DragFeature.js","OpenLayers/Control/ModifyFeature.js","OpenLayers/Control/Panel.js","OpenLayers/Control/SelectFeature.js","OpenLayers/Control/NavigationHistory.js","OpenLayers/Control/Measure.js","OpenLayers/Control/WMSGetFeatureInfo.js","OpenLayers/Control/WMTSGetFeatureInfo.js","OpenLayers/Control/Graticule.js","OpenLayers/Control/TransformFeature.js","OpenLayers/Control/SLDSelect.js","OpenLayers/Geometry.js","OpenLayers/Geometry/Rectangle.js","OpenLayers/Geometry/Collection.js","OpenLayers/Geometry/Point.js","OpenLayers/Geometry/MultiPoint.js","OpenLayers/Geometry/Curve.js","OpenLayers/Geometry/LineString.js","OpenLayers/Geometry/LinearRing.js","OpenLayers/Geometry/Polygon.js","OpenLayers/Geometry/MultiLineString.js","OpenLayers/Geometry/MultiPolygon.js","OpenLayers/Geometry/Surface.js","OpenLayers/Renderer.js","OpenLayers/Renderer/Elements.js","OpenLayers/Renderer/NG.js","OpenLayers/Renderer/SVG.js","OpenLayers/Renderer/SVG2.js","OpenLayers/Renderer/Canvas.js","OpenLayers/Renderer/VML.js","OpenLayers/Layer/Vector.js","OpenLayers/Layer/PointGrid.js","OpenLayers/Layer/Vector/RootContainer.js","OpenLayers/Strategy.js","OpenLayers/Strategy/Filter.js","OpenLayers/Strategy/Fixed.js","OpenLayers/Strategy/Cluster.js","OpenLayers/Strategy/Paging.js","OpenLayers/Strategy/BBOX.js","OpenLayers/Strategy/Save.js","OpenLayers/Strategy/Refresh.js","OpenLayers/Filter.js","OpenLayers/Filter/FeatureId.js","OpenLayers/Filter/Logical.js","OpenLayers/Filter/Comparison.js","OpenLayers/Filter/Spatial.js","OpenLayers/Filter/Function.js","OpenLayers/Protocol.js","OpenLayers/Protocol/HTTP.js","OpenLayers/Protocol/SQL.js","OpenLayers/Protocol/SQL/Gears.js","OpenLayers/Protocol/WFS.js","OpenLayers/Protocol/WFS/v1.js","OpenLayers/Protocol/WFS/v1_0_0.js","OpenLayers/Protocol/WFS/v1_1_0.js","OpenLayers/Protocol/Script.js","OpenLayers/Protocol/SOS.js","OpenLayers/Protocol/SOS/v1_0_0.js","OpenLayers/Layer/PointTrack.js","OpenLayers/Layer/GML.js","OpenLayers/Style.js","OpenLayers/Style2.js","OpenLayers/StyleMap.js","OpenLayers/Rule.js","OpenLayers/Format.js","OpenLayers/Format/QueryStringFilter.js","OpenLayers/Format/XML.js","OpenLayers/Format/XML/VersionedOGC.js","OpenLayers/Format/Context.js","OpenLayers/Format/ArcXML.js","OpenLayers/Format/ArcXML/Features.js","OpenLayers/Format/GML.js","OpenLayers/Format/GML/Base.js","OpenLayers/Format/GML/v2.js","OpenLayers/Format/GML/v3.js","OpenLayers/Format/Atom.js","OpenLayers/Format/KML.js","OpenLayers/Format/GeoRSS.js","OpenLayers/Format/WFS.js","OpenLayers/Format/WFSCapabilities.js","OpenLayers/Format/WFSCapabilities/v1.js","OpenLayers/Format/WFSCapabilities/v1_0_0.js","OpenLayers/Format/WFSCapabilities/v1_1_0.js","OpenLayers/Format/WFSDescribeFeatureType.js","OpenLayers/Format/WMSDescribeLayer.js","OpenLayers/Format/WMSDescribeLayer/v1_1.js","OpenLayers/Format/WKT.js","OpenLayers/Format/CQL.js","OpenLayers/Format/OSM.js","OpenLayers/Format/GPX.js","OpenLayers/Format/Filter.js","OpenLayers/Format/Filter/v1.js","OpenLayers/Format/Filter/v1_0_0.js","OpenLayers/Format/Filter/v1_1_0.js","OpenLayers/Format/SLD.js","OpenLayers/Format/SLD/v1.js","OpenLayers/Format/SLD/v1_0_0.js","OpenLayers/Format/OWSCommon.js","OpenLayers/Format/OWSCommon/v1.js","OpenLayers/Format/OWSCommon/v1_0_0.js","OpenLayers/Format/OWSCommon/v1_1_0.js","OpenLayers/Format/CSWGetDomain.js","OpenLayers/Format/CSWGetDomain/v2_0_2.js","OpenLayers/Format/CSWGetRecords.js","OpenLayers/Format/CSWGetRecords/v2_0_2.js","OpenLayers/Format/WFST.js","OpenLayers/Format/WFST/v1.js","OpenLayers/Format/WFST/v1_0_0.js","OpenLayers/Format/WFST/v1_1_0.js","OpenLayers/Format/Text.js","OpenLayers/Format/JSON.js","OpenLayers/Format/GeoJSON.js","OpenLayers/Format/WMC.js","OpenLayers/Format/WMC/v1.js","OpenLayers/Format/WMC/v1_0_0.js","OpenLayers/Format/WMC/v1_1_0.js","OpenLayers/Format/WCSGetCoverage.js","OpenLayers/Format/WMSCapabilities.js","OpenLayers/Format/WMSCapabilities/v1.js","OpenLayers/Format/WMSCapabilities/v1_1.js","OpenLayers/Format/WMSCapabilities/v1_1_0.js","OpenLayers/Format/WMSCapabilities/v1_1_1.js","OpenLayers/Format/WMSCapabilities/v1_3.js","OpenLayers/Format/WMSCapabilities/v1_3_0.js","OpenLayers/Format/WMSCapabilities/v1_1_1_WMSC.js","OpenLayers/Format/WMSGetFeatureInfo.js","OpenLayers/Format/SOSCapabilities.js","OpenLayers/Format/SOSCapabilities/v1_0_0.js","OpenLayers/Format/SOSGetFeatureOfInterest.js","OpenLayers/Format/SOSGetObservation.js","OpenLayers/Format/OWSContext.js","OpenLayers/Format/OWSContext/v0_3_1.js","OpenLayers/Format/WMTSCapabilities.js","OpenLayers/Format/WMTSCapabilities/v1_0_0.js","OpenLayers/Format/WPSCapabilities.js","OpenLayers/Format/WPSCapabilities/v1_0_0.js","OpenLayers/Format/WPSDescribeProcess.js","OpenLayers/Format/WPSExecute.js","OpenLayers/Format/XLS.js","OpenLayers/Format/XLS/v1.js","OpenLayers/Format/XLS/v1_1_0.js","OpenLayers/Format/OGCExceptionReport.js","OpenLayers/Layer/WFS.js","OpenLayers/Control/GetFeature.js","OpenLayers/Control/MouseToolbar.js","OpenLayers/Control/NavToolbar.js","OpenLayers/Control/PanPanel.js","OpenLayers/Control/Pan.js","OpenLayers/Control/ZoomIn.js","OpenLayers/Control/ZoomOut.js","OpenLayers/Control/ZoomPanel.js","OpenLayers/Control/EditingToolbar.js","OpenLayers/Control/Geolocate.js","OpenLayers/Symbolizer.js","OpenLayers/Symbolizer/Point.js","OpenLayers/Symbolizer/Line.js","OpenLayers/Symbolizer/Polygon.js","OpenLayers/Symbolizer/Text.js","OpenLayers/Symbolizer/Raster.js","OpenLayers/Lang.js","OpenLayers/Lang/en.js"]);for(var s=Array(i.length),a=OpenLayers._getScriptLocation()+"lib/",r=0,n=i.length;n>r;r++)s[r]="<script src='"+a+i[r]+"'></script>";s.length>0&&document.write(s.join(""))}}(),OpenLayers.VERSION_NUMBER="Release 2.11",OpenLayers.String={startsWith:function(e,t){return 0==e.indexOf(t)},contains:function(e,t){return-1!=e.indexOf(t)},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){for(var t=e.split("-"),i=t[0],s=1,a=t.length;a>s;s++){var r=t[s];i+=r.charAt(0).toUpperCase()+r.substring(1)}return i},format:function(e,t,i){t||(t=window);var s=function(e,s){for(var a,r=s.split(/\.+/),n=0;r.length>n;n++)0==n&&(a=t),a=a[r[n]];return"function"==typeof a&&(a=i?a.apply(null,i):a()),a===void 0?"undefined":a};return e.replace(OpenLayers.String.tokenRegEx,s)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return OpenLayers.String.numberRegEx.test(e)},numericIf:function(e){return OpenLayers.String.isNumeric(e)?parseFloat(e):e}},String.prototype.startsWith||(String.prototype.startsWith=function(e){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.startsWith"})),OpenLayers.String.startsWith(this,e)}),String.prototype.contains||(String.prototype.contains=function(e){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.contains"})),OpenLayers.String.contains(this,e)}),String.prototype.trim||(String.prototype.trim=function(){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.trim"})),OpenLayers.String.trim(this)}),String.prototype.camelize||(String.prototype.camelize=function(){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.camelize"})),OpenLayers.String.camelize(this)}),OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var i=0;return t>0&&(i=parseFloat(e.toPrecision(t))),i},format:function(e,t,i,s){t=t!==void 0?t:0,i=i!==void 0?i:OpenLayers.Number.thousandsSeparator,s=s!==void 0?s:OpenLayers.Number.decimalSeparator,null!=t&&(e=parseFloat(e.toFixed(t)));var a=(""+e).split(".");1==a.length&&null==t&&(t=0);var r=a[0];if(i)for(var n=/(-?[0-9]+)([0-9]{3})/;n.test(r);)r=r.replace(n,"$1"+i+"$2");var o;if(0==t)o=r;else{var l=a.length>1?a[1]:"0";null!=t&&(l+=Array(t-l.length+1).join("0")),o=r+s+l}return o}},Number.prototype.limitSigDigs||(Number.prototype.limitSigDigs=function(e){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Number.limitSigDigs"})),OpenLayers.Number.limitSigDigs(this,e)}),OpenLayers.Function={bind:function(e,t){var i=Array.prototype.slice.apply(arguments,[2]);return function(){var s=i.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,s)}},bindAsEventListener:function(e,t){return function(i){return e.call(t,i||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},Function.prototype.bind||(Function.prototype.bind=function(){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bind"})),Array.prototype.unshift.apply(arguments,[this]),OpenLayers.Function.bind.apply(null,arguments)}),Function.prototype.bindAsEventListener||(Function.prototype.bindAsEventListener=function(e){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bindAsEventListener"})),OpenLayers.Function.bindAsEventListener(this,e)}),OpenLayers.Array={filter:function(e,t,i){var s=[];if(Array.prototype.filter)s=e.filter(t,i);else{var a=e.length;if("function"!=typeof t)throw new TypeError;for(var r=0;a>r;r++)if(r in e){var n=e[r];t.call(i,n,r,e)&&s.push(n)}}return s}},OpenLayers.Class=function(){var e=arguments.length,t=arguments[0],i=arguments[e-1],s="function"==typeof i.initialize?i.initialize:function(){t.prototype.initialize.apply(this,arguments)};if(e>1){var a=[s,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),i);OpenLayers.inherit.apply(null,a)}else s.prototype=i;return s},OpenLayers.Class.isPrototype=function(){},OpenLayers.Class.create=function(){return function(){arguments&&arguments[0]!=OpenLayers.Class.isPrototype&&this.initialize.apply(this,arguments)}},OpenLayers.Class.inherit=function(e){var t=function(){e.call(this)},i=[t].concat(Array.prototype.slice.call(arguments));return OpenLayers.inherit.apply(null,i),t.prototype},OpenLayers.inherit=function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i;var s,a,r;for(s=2,a=arguments.length;a>s;s++)r=arguments[s],"function"==typeof r&&(r=r.prototype),OpenLayers.Util.extend(e.prototype,r)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(e,t){if(e=e||{},t){for(var i in t){var s=t[i];void 0!==s&&(e[i]=s)}var a="function"==typeof window.Event&&t instanceof window.Event;!a&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(e.toString=t.toString)}return e},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var e=[],t=0,i=arguments.length;i>t;t++){var s=arguments[t];if("string"==typeof s&&(s=document.getElementById(s)),1==arguments.length)return s;e.push(s)}return e},OpenLayers.Util.isElement=function(e){return!(!e||1!==e.nodeType)},OpenLayers.Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},window.$===void 0&&(window.$=OpenLayers.Util.getElement),OpenLayers.Util.removeItem=function(e,t){for(var i=e.length-1;i>=0;i--)e[i]==t&&e.splice(i,1);return e},OpenLayers.Util.clearArray=function(e){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"array = []"})),e.length=0},OpenLayers.Util.indexOf=function(e,t){if("function"==typeof e.indexOf)return e.indexOf(t);for(var i=0,s=e.length;s>i;i++)if(e[i]==t)return i;return-1},OpenLayers.Util.modifyDOMElement=function(e,t,i,s,a,r,n,o){t&&(e.id=t),i&&(e.style.left=i.x+"px",e.style.top=i.y+"px"),s&&(e.style.width=s.w+"px",e.style.height=s.h+"px"),a&&(e.style.position=a),r&&(e.style.border=r),n&&(e.style.overflow=n),parseFloat(o)>=0&&1>parseFloat(o)?(e.style.filter="alpha(opacity="+100*o+")",e.style.opacity=o):1==parseFloat(o)&&(e.style.filter="",e.style.opacity="")},OpenLayers.Util.createDiv=function(e,t,i,s,a,r,n,o){var l=document.createElement("div");return s&&(l.style.backgroundImage="url("+s+")"),e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),a||(a="absolute"),OpenLayers.Util.modifyDOMElement(l,e,t,i,a,r,n,o),l},OpenLayers.Util.createImage=function(e,t,i,s,a,r,n,o){var l=document.createElement("img");return e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),a||(a="relative"),OpenLayers.Util.modifyDOMElement(l,e,t,i,a,r,null,n),o&&(l.style.display="none",OpenLayers.Event.observe(l,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,l)),OpenLayers.Event.observe(l,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,l))),l.style.alt=e,l.galleryImg="no",s&&(l.src=s),l},OpenLayers.Util.setOpacity=function(e,t){OpenLayers.Util.modifyDOMElement(e,null,null,null,null,null,null,t)},OpenLayers.Util.onImageLoad=function(){(!this.viewRequestID||this.map&&this.viewRequestID==this.map.viewRequestID)&&(this.style.display=""),OpenLayers.Element.removeClass(this,"olImageLoadError")},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.onImageLoadError=function(){if(this._attempts=this._attempts?this._attempts+1:1,this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){var e=this.urls;if(e&&OpenLayers.Util.isArray(e)&&e.length>1){var t,i,s=""+this.src;for(i=0;(t=e[i])&&-1==s.indexOf(t);i++);var a=Math.floor(e.length*Math.random()),r=e[a];for(i=0;r==t&&4>i++;)a=Math.floor(e.length*Math.random()),r=e[a];this.src=s.replace(t,r)}else this.src=this.src}else OpenLayers.Element.addClass(this,"olImageLoadError");this.style.display=""},OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var e=navigator.appVersion.split("MSIE"),t=parseFloat(e[1]),i=!1;try{i=!!document.body.filters}catch(s){}OpenLayers.Util.alphaHackNeeded=i&&t>=5.5&&7>t}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(e,t,i,s,a,r,n,o,l){OpenLayers.Util.modifyDOMElement(e,t,i,s,r,null,null,l);var h=e.childNodes[0];a&&(h.src=a),OpenLayers.Util.modifyDOMElement(h,e.id+"_innerImage",null,s,"relative",n),OpenLayers.Util.alphaHack()&&("none"!=e.style.display&&(e.style.display="inline-block"),null==o&&(o="scale"),e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+h.src+"', "+"sizingMethod='"+o+"')",parseFloat(e.style.opacity)>=0&&1>parseFloat(e.style.opacity)&&(e.style.filter+=" alpha(opacity="+100*e.style.opacity+")"),h.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(e,t,i,s,a,r,n,o,l){var h=OpenLayers.Util.createDiv(),u=OpenLayers.Util.createImage(null,null,null,null,null,null,null,!1);return h.appendChild(u),l&&(u.style.display="none",OpenLayers.Event.observe(u,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,h)),OpenLayers.Event.observe(u,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,h))),OpenLayers.Util.modifyAlphaImageDiv(h,e,t,i,s,a,r,n,o),h},OpenLayers.Util.upperCaseObject=function(e){var t={};for(var i in e)t[i.toUpperCase()]=e[i];return t},OpenLayers.Util.applyDefaults=function(e,t){e=e||{};var i="function"==typeof window.Event&&t instanceof window.Event;for(var s in t)(void 0===e[s]||!i&&t.hasOwnProperty&&t.hasOwnProperty(s)&&!e.hasOwnProperty(s))&&(e[s]=t[s]);return!i&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString),e},OpenLayers.Util.getParameterString=function(e){var t=[];for(var i in e){var s=e[i];if(null!=s&&"function"!=typeof s){var a;if("object"==typeof s&&s.constructor==Array){for(var r,n=[],o=0,l=s.length;l>o;o++)r=s[o],n.push(encodeURIComponent(null===r||void 0===r?"":r));a=n.join(",")}else a=encodeURIComponent(s);t.push(encodeURIComponent(i)+"="+a)}}return t.join("&")},OpenLayers.Util.urlAppend=function(e,t){var i=e;if(t){var s=(e+" ").split(/[?&]/);i+=" "===s.pop()?t:s.length?"&"+t:"?"+t}return i},OpenLayers.ImgPath="",OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.Try=function(){for(var e=null,t=0,i=arguments.length;i>t;t++){var s=arguments[t];try{e=s();break}catch(a){}}return e},OpenLayers.Util.getXmlNodeValue=function(e){var t=null;return OpenLayers.Util.Try(function(){t=e.text,t||(t=e.textContent),t||(t=e.firstChild.nodeValue)},function(){t=e.textContent}),t},OpenLayers.Util.mouseLeft=function(e,t){for(var i=e.relatedTarget?e.relatedTarget:e.toElement;i!=t&&null!=i;)i=i.parentNode;return i!=t},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(e,t){return null==t&&(t=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof e&&(e=parseFloat(e)),0===t?e:parseFloat(e.toPrecision(t))},OpenLayers.Util.rad=function(e){return e*Math.PI/180},OpenLayers.Util.deg=function(e){return 180*e/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(e,t){for(var i=OpenLayers.Util.VincentyConstants,s=i.a,a=i.b,r=i.f,n=OpenLayers.Util.rad(t.lon-e.lon),o=Math.atan((1-r)*Math.tan(OpenLayers.Util.rad(e.lat))),l=Math.atan((1-r)*Math.tan(OpenLayers.Util.rad(t.lat))),h=Math.sin(o),u=Math.cos(o),p=Math.sin(l),c=Math.cos(l),d=n,m=2*Math.PI,y=20;Math.abs(d-m)>1e-12&&--y>0;){var f=Math.sin(d),g=Math.cos(d),v=Math.sqrt(c*f*c*f+(u*p-h*c*g)*(u*p-h*c*g));if(0==v)return 0;var L=h*p+u*c*g,b=Math.atan2(v,L),O=Math.asin(u*c*f/v),S=Math.cos(O)*Math.cos(O),w=L-2*h*p/S,_=r/16*S*(4+r*(4-3*S));m=d,d=n+(1-_)*r*Math.sin(O)*(b+_*v*(w+_*L*(-1+2*w*w)))}if(0==y)return 0/0;var x=S*(s*s-a*a)/(a*a),k=1+x/16384*(4096+x*(-768+x*(320-175*x))),C=x/1024*(256+x*(-128+x*(74-47*x))),M=C*v*(w+C/4*(L*(-1+2*w*w)-C/6*w*(-3+4*v*v)*(-3+4*w*w))),E=a*k*(b-M),P=E.toFixed(3)/1e3;return P},OpenLayers.Util.destinationVincenty=function(e,t,i){for(var s=OpenLayers.Util,a=s.VincentyConstants,r=a.a,n=a.b,o=a.f,l=e.lon,h=e.lat,u=i,p=s.rad(t),c=Math.sin(p),d=Math.cos(p),m=(1-o)*Math.tan(s.rad(h)),y=1/Math.sqrt(1+m*m),f=m*y,g=Math.atan2(m,d),v=y*c,L=1-v*v,b=L*(r*r-n*n)/(n*n),O=1+b/16384*(4096+b*(-768+b*(320-175*b))),S=b/1024*(256+b*(-128+b*(74-47*b))),w=u/(n*O),_=2*Math.PI;Math.abs(w-_)>1e-12;){var x=Math.cos(2*g+w),k=Math.sin(w),C=Math.cos(w),M=S*k*(x+S/4*(C*(-1+2*x*x)-S/6*x*(-3+4*k*k)*(-3+4*x*x)));_=w,w=u/(n*O)+M}var E=f*k-y*C*d,P=Math.atan2(f*C+y*k*d,(1-o)*Math.sqrt(v*v+E*E)),N=Math.atan2(k*c,y*C-f*k*d),T=o/16*L*(4+o*(4-3*L)),j=N-(1-T)*o*v*(w+T*k*(x+T*C*(-1+2*x*x)));return Math.atan2(v,-E),new OpenLayers.LonLat(l+s.deg(j),s.deg(P))},OpenLayers.Util.getParameters=function(e){e=null===e||void 0===e?window.location.href:e;var t="";if(OpenLayers.String.contains(e,"?")){var i=e.indexOf("?")+1,s=OpenLayers.String.contains(e,"#")?e.indexOf("#"):e.length;t=e.substring(i,s)}for(var a={},r=t.split(/[&;]/),n=0,o=r.length;o>n;++n){var l=r[n].split("=");if(l[0]){var h=l[0];try{h=decodeURIComponent(h)}catch(u){h=unescape(h)}var p=(l[1]||"").replace(/\+/g," ");try{p=decodeURIComponent(p)}catch(u){p=unescape(p)}p=p.split(","),1==p.length&&(p=p[0]),a[h]=p}}return a},OpenLayers.Util.getArgs=function(e){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Util.getParameters"})),OpenLayers.Util.getParameters(e)},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(e){return null==e&&(e="id_"),OpenLayers.Util.lastSeqID+=1,e+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(e){var t=e>1?1/e:e;return t},OpenLayers.Util.getResolutionFromScale=function(e,t){var i;if(e){null==t&&(t="degrees");var s=OpenLayers.Util.normalizeScale(e);i=1/(s*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH)}return i},OpenLayers.Util.getScaleFromResolution=function(e,t){null==t&&(t="degrees");var i=e*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH;return i},OpenLayers.Util.safeStopPropagation=function(e){OpenLayers.Event.stop(e,!0)},OpenLayers.Util.pagePosition=function(e){var t=[0,0],i=OpenLayers.Util.getViewportElement();if(!e||e==window||e==i)return t;var s,a=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(e,"position")&&(""==e.style.top||""==e.style.left),r=null;if(e.getBoundingClientRect){s=e.getBoundingClientRect();var n=i.scrollTop,o=i.scrollLeft;t[0]=s.left+o,t[1]=s.top+n}else if(document.getBoxObjectFor&&!a){s=document.getBoxObjectFor(e);var l=document.getBoxObjectFor(i);t[0]=s.screenX-l.screenX,t[1]=s.screenY-l.screenY}else{if(t[0]=e.offsetLeft,t[1]=e.offsetTop,r=e.offsetParent,r!=e)for(;r;)t[0]+=r.offsetLeft,t[1]+=r.offsetTop,r=r.offsetParent;var h=OpenLayers.BROWSER_NAME;for(("opera"==h||"safari"==h&&"absolute"==OpenLayers.Element.getStyle(e,"position"))&&(t[1]-=document.body.offsetTop),r=e.offsetParent;r&&r!=document.body;)t[0]-=r.scrollLeft,("opera"!=h||"TR"!=r.tagName)&&(t[1]-=r.scrollTop),r=r.offsetParent}return t},OpenLayers.Util.getViewportElement=function(){var e=arguments.callee.viewportElement;return void 0==e&&(e="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=e),e},OpenLayers.Util.isEquivalentUrl=function(e,t,i){i=i||{},OpenLayers.Util.applyDefaults(i,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0});var s=OpenLayers.Util.createUrlObject(e,i),a=OpenLayers.Util.createUrlObject(t,i);for(var r in s)if("args"!==r&&s[r]!=a[r])return!1;for(var r in s.args){if(s.args[r]!=a.args[r])return!1;delete a.args[r]}for(var r in a.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(e,t){if(t=t||{},!/^\w+:\/\//.test(e)){var i=window.location,s=i.port?":"+i.port:"",a=i.protocol+"//"+i.host.split(":").shift()+s;if(0===e.indexOf("/"))e=a+e;else{var r=i.pathname.split("/");r.pop(),e=a+r.join("/")+"/"+e}}t.ignoreCase&&(e=e.toLowerCase());var n=document.createElement("a");n.href=e;var o={};o.host=n.host.split(":").shift(),o.protocol=n.protocol,o.port=t.ignorePort80?"80"==n.port||"0"==n.port?"":n.port:""==n.port||"0"==n.port?"80":n.port,o.hash=t.ignoreHash||"#"===n.hash?"":n.hash;var l=n.search;if(!l){var h=e.indexOf("?");l=-1!=h?e.substr(h):""}return o.args=OpenLayers.Util.getParameters(l),o.pathname="/"==n.pathname.charAt(0)?n.pathname:"/"+n.pathname,o},OpenLayers.Util.removeTail=function(e){var t=null,i=e.indexOf("?"),s=e.indexOf("#");return t=-1==i?-1!=s?e.substr(0,s):e:-1!=s?e.substr(0,Math.min(i,s)):e.substr(0,i)},OpenLayers.IS_GECKO=function(){var e=navigator.userAgent.toLowerCase();return-1==e.indexOf("webkit")&&-1!=e.indexOf("gecko")}(),OpenLayers.BROWSER_NAME=function(){var e="",t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("opera")?e="opera":-1!=t.indexOf("msie")?e="msie":-1!=t.indexOf("safari")?e="safari":-1!=t.indexOf("mozilla")&&(e=-1!=t.indexOf("firefox")?"firefox":"mozilla"),e}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(e,t,i){var s,a,r=document.createElement("div");r.style.visibility="hidden";var n=i&&i.containerElement?i.containerElement:document.body;t&&(t.w?(s=t.w,r.style.width=s+"px"):t.h&&(a=t.h,r.style.height=a+"px")),i&&i.displayClass&&(r.className=i.displayClass);var o=document.createElement("div");if(o.innerHTML=e,o.style.overflow="visible",o.childNodes)for(var l=0,h=o.childNodes.length;h>l;l++)o.childNodes[l].style&&(o.childNodes[l].style.overflow="visible");r.appendChild(o),n.appendChild(r);for(var u=!1,p=r.parentNode;p&&"body"!=p.tagName.toLowerCase();){var c=OpenLayers.Element.getStyle(p,"position");if("absolute"==c){u=!0;break}if(c&&"static"!=c)break;p=p.parentNode}return u||(r.style.position="absolute"),s||(s=parseInt(o.scrollWidth),r.style.width=s+"px"),a||(a=parseInt(o.scrollHeight)),r.removeChild(o),n.removeChild(r),new OpenLayers.Size(s,a)},OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(null==e){var t=null,i=null,s=0,a=0;t=document.createElement("div"),t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.width="100px",t.style.height="50px",t.style.overflow="hidden",i=document.createElement("div"),i.style.width="100%",i.style.height="200px",t.appendChild(i),document.body.appendChild(t),s=i.offsetWidth,t.style.overflow="scroll",a=i.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=s-a,e=OpenLayers.Util._scrollbarWidth}return e},OpenLayers.Util.getFormattedLonLat=function(e,t,i){i||(i="dms"),e=(e+540)%360-180;
var s=Math.abs(e),a=Math.floor(s),r=(s-a)/(1/60),n=r;r=Math.floor(r);var o=(n-r)/(1/60);o=Math.round(10*o),o/=10,o>=60&&(o-=60,r+=1,r>=60&&(r-=60,a+=1)),10>a&&(a="0"+a);var l=a+"°";return i.indexOf("dm")>=0&&(10>r&&(r="0"+r),l+=r+"'",i.indexOf("dms")>=0&&(10>o&&(o="0"+o),l+=o+'"')),l+="lon"==t?0>e?OpenLayers.i18n("W"):OpenLayers.i18n("E"):0>e?OpenLayers.i18n("S"):OpenLayers.i18n("N")},OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Corner={round:function(e,t){e=OpenLayers.Util.getElement(e),this._setOptions(t);var i=this.options.color;"fromElement"==this.options.color&&(i=this._background(e));var s=this.options.bgColor;"fromParent"==this.options.bgColor&&(s=this._background(e.offsetParent)),this._roundCornersImpl(e,i,s)},changeColor:function(e,t){e.style.backgroundColor=t;for(var i=e.parentNode.getElementsByTagName("span"),s=0;i.length>s;s++)i[s].style.backgroundColor=t},changeOpacity:function(e,t){var i=t,s="alpha(opacity="+100*t+")";e.style.opacity=i,e.style.filter=s;for(var a=e.parentNode.getElementsByTagName("span"),r=0;a.length>r;r++)a[r].style.opacity=i,a[r].style.filter=s},reRound:function(e,t){var i=e.parentNode.childNodes[0],s=e.parentNode.childNodes[2];e.parentNode.removeChild(i),e.parentNode.removeChild(s),this.round(e.parentNode,t)},_roundCornersImpl:function(e,t,i){this.options.border&&this._renderBorder(e,i),this._isTopRounded()&&this._roundTopCorners(e,t,i),this._isBottomRounded()&&this._roundBottomCorners(e,t,i)},_renderBorder:function(e,t){var i="1px solid "+this._borderColor(t),s="border-left: "+i,a="border-right: "+i,r="style='"+s+";"+a+"'";e.innerHTML="<div "+r+">"+e.innerHTML+"</div>"},_roundTopCorners:function(e,t,i){for(var s=this._createCorner(i),a=0;this.options.numSlices>a;a++)s.appendChild(this._createCornerSlice(t,i,a,"top"));e.style.paddingTop=0,e.insertBefore(s,e.firstChild)},_roundBottomCorners:function(e,t,i){for(var s=this._createCorner(i),a=this.options.numSlices-1;a>=0;a--)s.appendChild(this._createCornerSlice(t,i,a,"bottom"));e.style.paddingBottom=0,e.appendChild(s)},_createCorner:function(e){var t=document.createElement("div");return t.style.backgroundColor=this._isTransparent()?"transparent":e,t},_createCornerSlice:function(e,t,i,s){var a=document.createElement("span"),r=a.style;r.backgroundColor=e,r.display="block",r.height="1px",r.overflow="hidden",r.fontSize="1px";var n=this._borderColor(e,t);return this.options.border&&0==i?(r.borderTopStyle="solid",r.borderTopWidth="1px",r.borderLeftWidth="0px",r.borderRightWidth="0px",r.borderBottomWidth="0px",r.height="0px",r.borderColor=n):n&&(r.borderColor=n,r.borderStyle="solid",r.borderWidth="0px 1px"),this.options.compact||i!=this.options.numSlices-1||(r.height="2px"),this._setMargin(a,i,s),this._setBorder(a,i,s),a},_setOptions:function(e){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:!0,border:!1,compact:!1},OpenLayers.Util.extend(this.options,e||{}),this.options.numSlices=this.options.compact?2:4,this._isTransparent()&&(this.options.blend=!1)},_whichSideTop:function(){return this._hasString(this.options.corners,"all","top")?"":this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0?"":this.options.corners.indexOf("tl")>=0?"left":this.options.corners.indexOf("tr")>=0?"right":""},_whichSideBottom:function(){return this._hasString(this.options.corners,"all","bottom")?"":this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0?"":this.options.corners.indexOf("bl")>=0?"left":this.options.corners.indexOf("br")>=0?"right":""},_borderColor:function(e,t){return"transparent"==e?t:this.options.border?this.options.border:this.options.blend?this._blend(t,e):""},_setMargin:function(e,t,i){var s=this._marginSize(t),a="top"==i?this._whichSideTop():this._whichSideBottom();"left"==a?(e.style.marginLeft=s+"px",e.style.marginRight="0px"):"right"==a?(e.style.marginRight=s+"px",e.style.marginLeft="0px"):(e.style.marginLeft=s+"px",e.style.marginRight=s+"px")},_setBorder:function(e,t,i){var s=this._borderSize(t),a="top"==i?this._whichSideTop():this._whichSideBottom();"left"==a?(e.style.borderLeftWidth=s+"px",e.style.borderRightWidth="0px"):"right"==a?(e.style.borderRightWidth=s+"px",e.style.borderLeftWidth="0px"):(e.style.borderLeftWidth=s+"px",e.style.borderRightWidth=s+"px"),0!=this.options.border&&(e.style.borderLeftWidth=s+"px",e.style.borderRightWidth=s+"px")},_marginSize:function(e){if(this._isTransparent())return 0;var t=[5,3,2,1],i=[3,2,1,0],s=[2,1],a=[1,0];return this.options.compact&&this.options.blend?a[e]:this.options.compact?s[e]:this.options.blend?i[e]:t[e]},_borderSize:function(e){var t=[5,3,2,1],i=[2,1,1,1],s=[1,0],a=[0,2,0,0];return this.options.compact&&(this.options.blend||this._isTransparent())?1:this.options.compact?s[e]:this.options.blend?i[e]:this.options.border?a[e]:this._isTransparent()?t[e]:0},_hasString:function(e){for(var t=1;arguments.length>t;t++)if(e.indexOf(arguments[t])>=0)return!0;return!1},_blend:function(e,t){var i=OpenLayers.Rico.Color.createFromHex(e);return i.blend(OpenLayers.Rico.Color.createFromHex(t)),i},_background:function(e){try{return OpenLayers.Rico.Color.createColorFromBackground(e).asHex()}catch(t){return"#ffffff"}},_isTransparent:function(){return"transparent"==this.options.color},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(e){return 1==e.childNodes.length&&3==e.childNodes[0].nodeType}},function(){if(!window.google||!google.gears){var e=null;if("undefined"!=typeof GearsFactory)e=new GearsFactory;else try{e=new ActiveXObject("Gears.Factory"),-1!=e.getBuildInfo().indexOf("ie_mobile")&&e.privateSetGlobalObject(this)}catch(t){navigator.mimeTypes!==void 0&&navigator.mimeTypes["application/x-googlegears"]&&(e=document.createElement("object"),e.style.display="none",e.width=0,e.height=0,e.type="application/x-googlegears",document.documentElement.appendChild(e))}e&&(window.google||(google={}),google.gears||(google.gears={factory:e}))}}(),OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(e){e=e||{},OpenLayers.Util.extend(this,e),this.options=e},mergeWithDefaultFilter:function(e){var t;return t=e&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,e]}):e||this.defaultFilter||void 0},destroy:function(){this.options=null,this.format=null},read:function(e){e=e||{},e.filter=this.mergeWithDefaultFilter(e.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(){},createCallback:function(e,t,i){return OpenLayers.Function.bind(function(){e.apply(this,[t,i])},this)},CLASS_NAME:"OpenLayers.Protocol"}),OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,reqFeatures:null,priv:null,error:null,initialize:function(e){OpenLayers.Util.extend(this,e)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"}),OpenLayers.Protocol.Response.SUCCESS=1,OpenLayers.Protocol.Response.FAILURE=0,OpenLayers.Protocol.SQL=OpenLayers.Class(OpenLayers.Protocol,{databaseName:"ol",tableName:"ol_vector_features",postReadFiltering:!0,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e])},destroy:function(){OpenLayers.Protocol.prototype.destroy.apply(this)},supported:function(){return!1},evaluateFilter:function(e,t){return t&&this.postReadFiltering?t.evaluate(e):!0},CLASS_NAME:"OpenLayers.Protocol.SQL"}),OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var e=document.getElementsByTagName("script"),t=0,i=e.length;i>t;++t)if(-1!=e[t].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(e){var t;e||(e="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);var i=e.split("-");if(i[0]=i[0].toLowerCase(),"object"==typeof OpenLayers.Lang[i[0]]&&(t=i[0]),i[1]){var s=i[0]+"-"+i[1].toUpperCase();"object"==typeof OpenLayers.Lang[s]&&(t=s)}t||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+i.join("-")+" dictionary, falling back to default language"),t=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=t},translate:function(e,t){var i=OpenLayers.Lang[OpenLayers.Lang.getCode()],s=i&&i[e];return s||(s=e),t&&(s=OpenLayers.String.format(s,t)),s}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,t,i,s){null!=e&&(this.left=OpenLayers.Util.toFloat(e)),null!=t&&(this.bottom=OpenLayers.Util.toFloat(t)),null!=i&&(this.right=OpenLayers.Util.toFloat(i)),null!=s&&(this.top=OpenLayers.Util.toFloat(s))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(e){var t=!1;return null!=e&&(t=this.left==e.left&&this.right==e.right&&this.top==e.top&&this.bottom==e.bottom),t},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(e){return e===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(e,t){null==e&&(e=6);var i=Math.pow(10,e),s=Math.round(this.left*i)/i,a=Math.round(this.bottom*i)/i,r=Math.round(this.right*i)/i,n=Math.round(this.top*i)/i;return t===!0?a+","+s+","+n+","+r:s+","+a+","+r+","+n},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(e,t){null==t&&(t=this.getCenterLonLat());var i,s;"OpenLayers.LonLat"==t.CLASS_NAME?(i=t.lon,s=t.lat):(i=t.x,s=t.y);var a=(this.left-i)*e+i,r=(this.bottom-s)*e+s,n=(this.right-i)*e+i,o=(this.top-s)*e+s;return new OpenLayers.Bounds(a,r,n,o)},add:function(e,t){if(null==e||null==t){var i=OpenLayers.i18n("boundsAddError");return OpenLayers.Console.error(i),null}return new OpenLayers.Bounds(this.left+e,this.bottom+t,this.right+e,this.top+t)},extend:function(e){var t=null;if(e){switch(e.CLASS_NAME){case"OpenLayers.LonLat":t=new OpenLayers.Bounds(e.lon,e.lat,e.lon,e.lat);break;case"OpenLayers.Geometry.Point":t=new OpenLayers.Bounds(e.x,e.y,e.x,e.y);break;case"OpenLayers.Bounds":t=e}t&&(this.centerLonLat=null,(null==this.left||t.left<this.left)&&(this.left=t.left),(null==this.bottom||t.bottom<this.bottom)&&(this.bottom=t.bottom),(null==this.right||t.right>this.right)&&(this.right=t.right),(null==this.top||t.top>this.top)&&(this.top=t.top))}},containsLonLat:function(e,t){return this.contains(e.lon,e.lat,t)},containsPixel:function(e,t){return this.contains(e.x,e.y,t)},contains:function(e,t,i){if(null==i&&(i=!0),null==e||null==t)return!1;e=OpenLayers.Util.toFloat(e),t=OpenLayers.Util.toFloat(t);var s=!1;return s=i?e>=this.left&&this.right>=e&&t>=this.bottom&&this.top>=t:e>this.left&&this.right>e&&t>this.bottom&&this.top>t},intersectsBounds:function(e,t){null==t&&(t=!0);var i=!1,s=this.left==e.right||this.right==e.left||this.top==e.bottom||this.bottom==e.top;if(t||!s){var a=e.bottom>=this.bottom&&e.bottom<=this.top||this.bottom>=e.bottom&&this.bottom<=e.top,r=e.top>=this.bottom&&e.top<=this.top||this.top>e.bottom&&this.top<e.top,n=e.left>=this.left&&e.left<=this.right||this.left>=e.left&&this.left<=e.right,o=e.right>=this.left&&e.right<=this.right||this.right>=e.left&&this.right<=e.right;i=(a||r)&&(n||o)}return i},containsBounds:function(e,t,i){null==t&&(t=!1),null==i&&(i=!0);var s=this.contains(e.left,e.bottom,i),a=this.contains(e.right,e.bottom,i),r=this.contains(e.left,e.top,i),n=this.contains(e.right,e.top,i);return t?s||a||r||n:s&&a&&r&&n},determineQuadrant:function(e){var t="",i=this.getCenterLonLat();return t+=e.lat<i.lat?"b":"t",t+=e.lon<i.lon?"l":"r"},transform:function(e,t){this.centerLonLat=null;var i=OpenLayers.Projection.transform({x:this.left,y:this.bottom},e,t),s=OpenLayers.Projection.transform({x:this.right,y:this.bottom},e,t),a=OpenLayers.Projection.transform({x:this.left,y:this.top},e,t),r=OpenLayers.Projection.transform({x:this.right,y:this.top},e,t);return this.left=Math.min(i.x,a.x),this.bottom=Math.min(i.y,s.y),this.right=Math.max(s.x,r.x),this.top=Math.max(a.y,r.y),this},wrapDateLine:function(e,t){t=t||{};var i=t.leftTolerance||0,s=t.rightTolerance||0,a=this.clone();if(e){for(;a.left<e.left&&a.right-s<=e.left;)a=a.add(e.getWidth(),0);for(;a.left+i>=e.right&&a.right>e.right;)a=a.add(-e.getWidth(),0)}return a},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(e,t){var i=e.split(",");return OpenLayers.Bounds.fromArray(i,t)},OpenLayers.Bounds.fromArray=function(e,t){return t===!0?new OpenLayers.Bounds(parseFloat(e[1]),parseFloat(e[0]),parseFloat(e[3]),parseFloat(e[2])):new OpenLayers.Bounds(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))},OpenLayers.Bounds.fromSize=function(e){return new OpenLayers.Bounds(0,e.h,e.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(e){var t="";return t+="t"==e.charAt(0)?"b":"t",t+="l"==e.charAt(1)?"r":"l"},OpenLayers.Element={visible:function(e){return"none"!=OpenLayers.Util.getElement(e).style.display},toggle:function(){for(var e=0,t=arguments.length;t>e;e++){var i=OpenLayers.Util.getElement(arguments[e]),s=OpenLayers.Element.visible(i)?"hide":"show";OpenLayers.Element[s](i)}},hide:function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"element.style.display = 'none';"}));for(var e=0,t=arguments.length;t>e;e++){var i=OpenLayers.Util.getElement(arguments[e]);i&&(i.style.display="none")}},show:function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"element.style.display = '';"}));for(var e=0,t=arguments.length;t>e;e++){var i=OpenLayers.Util.getElement(arguments[e]);i&&(i.style.display="")}},remove:function(e){e=OpenLayers.Util.getElement(e),e.parentNode.removeChild(e)},getHeight:function(e){return e=OpenLayers.Util.getElement(e),e.offsetHeight},getDimensions:function(e){if(e=OpenLayers.Util.getElement(e),"none"!=OpenLayers.Element.getStyle(e,"display"))return{width:e.offsetWidth,height:e.offsetHeight};var t=e.style,i=t.visibility,s=t.position,a=t.display;t.visibility="hidden",t.position="absolute",t.display="";var r=e.clientWidth,n=e.clientHeight;return t.display=a,t.position=s,t.visibility=i,{width:r,height:n}},hasClass:function(e,t){var i=e.className;return!!i&&RegExp("(^|\\s)"+t+"(\\s|$)").test(i)},addClass:function(e,t){return OpenLayers.Element.hasClass(e,t)||(e.className+=(e.className?" ":"")+t),e},removeClass:function(e,t){var i=e.className;return i&&(e.className=OpenLayers.String.trim(i.replace(RegExp("(^|\\s+)"+t+"(\\s+|$)")," "))),e},toggleClass:function(e,t){return OpenLayers.Element.hasClass(e,t)?OpenLayers.Element.removeClass(e,t):OpenLayers.Element.addClass(e,t),e},getStyle:function(e,t){e=OpenLayers.Util.getElement(e);var i=null;if(e&&e.style){if(i=e.style[OpenLayers.String.camelize(t)],!i)if(document.defaultView&&document.defaultView.getComputedStyle){var s=document.defaultView.getComputedStyle(e,null);i=s?s.getPropertyValue(t):null}else e.currentStyle&&(i=e.currentStyle[OpenLayers.String.camelize(t)]);var a=["left","top","right","bottom"];window.opera&&-1!=OpenLayers.Util.indexOf(a,t)&&"static"==OpenLayers.Element.getStyle(e,"position")&&(i="auto")}return"auto"==i?null:i}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(e,t){this.lon=OpenLayers.Util.toFloat(e),this.lat=OpenLayers.Util.toFloat(t)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(e,t){if(null==e||null==t){var i=OpenLayers.i18n("lonlatAddError");return OpenLayers.Console.error(i),null}return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(e),this.lat+OpenLayers.Util.toFloat(t))},equals:function(e){var t=!1;return null!=e&&(t=this.lon==e.lon&&this.lat==e.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(e.lon)&&isNaN(e.lat)),t},transform:function(e,t){var i=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,t);return this.lon=i.x,this.lat=i.y,this},wrapDateLine:function(e){var t=this.clone();if(e){for(;t.lon<e.left;)t.lon+=e.getWidth();for(;t.lon>e.right;)t.lon-=e.getWidth()}return t},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(e){var t=e.split(",");return new OpenLayers.LonLat(t[0],t[1])},OpenLayers.LonLat.fromArray=function(e){var t=OpenLayers.Util.isArray(e),i=t&&e[0],s=t&&e[1];return new OpenLayers.LonLat(i,s)},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(e,t){this.x=parseFloat(e),this.y=parseFloat(t)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},add:function(e,t){if(null==e||null==t){var i=OpenLayers.i18n("pixelAddError");return OpenLayers.Console.error(i),null}return new OpenLayers.Pixel(this.x+e,this.y+t)},offset:function(e){var t=this.clone();return e&&(t=this.add(e.x,e.y)),t},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(e,t){this.w=parseFloat(e),this.h=parseFloat(t)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(e){var t=!1;return null!=e&&(t=this.w==e.w&&this.h==e.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(e.w)&&isNaN(e.h)),t},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e},destroy:function(){},read:function(){OpenLayers.Console.userError(OpenLayers.i18n("readNotImplemented"))},write:function(){OpenLayers.Console.userError(OpenLayers.i18n("writeNotImplemented"))},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(json,filter){function walk(e,t){if(t&&"object"==typeof t)for(var i in t)t.hasOwnProperty(i)&&(t[i]=walk(i,t[i]));return filter(e,t)}var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(object=eval("("+json+")"),"function"==typeof filter&&(object=walk("",object)))}catch(e){}return this.keepData&&(this.data=object),object},write:function(e,t){this.pretty=!!t;var i=null,s=typeof e;if(this.serialize[s])try{i=!this.pretty&&this.nativeJSON?JSON.stringify(e):this.serialize[s].apply(this,[e])}catch(a){OpenLayers.Console.error("Trouble serializing: "+a)}return i},writeIndent:function(){var e=[];if(this.pretty)for(var t=0;this.level>t;++t)e.push(this.indent);return e.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(e){if(null==e)return"null";if(e.constructor==Date)return this.serialize.date.apply(this,[e]);if(e.constructor==Array)return this.serialize.array.apply(this,[e]);var t=["{"];this.level+=1;var i,s,a,r=!1;for(i in e)e.hasOwnProperty(i)&&(s=OpenLayers.Format.JSON.prototype.write.apply(this,[i,this.pretty]),a=OpenLayers.Format.JSON.prototype.write.apply(this,[e[i],this.pretty]),null!=s&&null!=a&&(r&&t.push(","),t.push(this.writeNewline(),this.writeIndent(),s,":",this.writeSpace(),a),r=!0));return this.level-=1,t.push(this.writeNewline(),this.writeIndent(),"}"),t.join("")},array:function(e){var t,i=["["];this.level+=1;for(var s=0,a=e.length;a>s;++s)t=OpenLayers.Format.JSON.prototype.write.apply(this,[e[s],this.pretty]),null!=t&&(s>0&&i.push(","),i.push(this.writeNewline(),this.writeIndent(),t));return this.level-=1,i.push(this.writeNewline(),this.writeIndent(),"]"),i.join("")},string:function(e){var t={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,function(e,i){var s=t[i];return s?s:(s=i.charCodeAt(),"\\u00"+Math.floor(s/16).toString(16)+(s%16).toString(16))})+'"':'"'+e+'"'},number:function(e){return isFinite(e)?e+"":"null"},"boolean":function(e){return e+""},date:function(e){function t(e){return 10>e?"0"+e:e}return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"}),OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,t,i){this.layer=e,this.lonlat=t,this.data=null!=i?i:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.layer=null,this.id=null,this.lonlat=null,this.data=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var e=!1;if(null!=this.layer&&null!=this.layer.map){var t=this.layer.map.getExtent();e=t.containsLonLat(this.lonlat)}return e},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(e){if(null!=this.lonlat){if(!this.popup){var t=this.marker?this.marker.icon:null,i=this.popupClass?this.popupClass:OpenLayers.Popup.AnchoredBubble;this.popup=new i(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,t,e)}null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this}return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(e,t,i){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,t]),this.lonlat=null,this.geometry=e?e:null,this.state=null,this.attributes={},t&&(this.attributes=OpenLayers.Util.extend(this.attributes,t)),this.style=i?i:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,this.modified=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(e){var t=!1;if(this.layer&&this.layer.map){var i=this.layer.map.getExtent();if(e){var s=this.geometry.getBounds();t=i.intersectsBounds(s)}else{var a=i.toGeometry();t=a.intersects(this.geometry)}}return t},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,t,i){var s=!1;return this.geometry&&(s=this.geometry.atPoint(e,t,i)),s},destroyPopup:function(){},move:function(e){if(!this.layer||!this.geometry.move)return void 0;var t;t="OpenLayers.LonLat"==e.CLASS_NAME?this.layer.getViewPortPxFromLonLat(e):e;var i=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),s=this.layer.map.getResolution();return this.geometry.move(s*(t.x-i.x),s*(i.y-t.y)),this.layer.drawFeature(this),i},toState:function(e){if(e==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=e;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:}else if(e==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=e}else if(e==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=e}else e==OpenLayers.State.UNKNOWN&&(this.state=e)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer"},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},"delete":{display:"none"}},OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(e){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},OpenLayers.Format.prototype.initialize.apply(this,[e])},read:function(e){var t,i,s;e=e.replace(/[\n\r]/g," ");var a=this.regExes.typeStr.exec(e);if(a&&(i=a[1].toLowerCase(),s=a[2],this.parse[i]&&(t=this.parse[i].apply(this,[s])),this.internalProjection&&this.externalProjection))if(t&&"OpenLayers.Feature.Vector"==t.CLASS_NAME)t.geometry.transform(this.externalProjection,this.internalProjection);else if(t&&"geometrycollection"!=i&&"object"==typeof t)for(var r=0,n=t.length;n>r;r++){var o=t[r];o.geometry.transform(this.externalProjection,this.internalProjection)}return t},write:function(e){var t,i,s;e.constructor==Array?(t=e,s=!0):(t=[e],s=!1);var a=[];s&&a.push("GEOMETRYCOLLECTION(");for(var r=0,n=t.length;n>r;++r)s&&r>0&&a.push(","),i=t[r].geometry,a.push(this.extractGeometry(i));return s&&a.push(")"),a.join("")},extractGeometry:function(e){var t=e.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[t])return null;this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var i="collection"==t?"GEOMETRYCOLLECTION":t.toUpperCase(),s=i+"("+this.extract[t].apply(this,[e])+")";return s},extract:{point:function(e){return e.x+" "+e.y},multipoint:function(e){for(var t=[],i=0,s=e.components.length;s>i;++i)t.push("("+this.extract.point.apply(this,[e.components[i]])+")");return t.join(",")},linestring:function(e){for(var t=[],i=0,s=e.components.length;s>i;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t.join(",")},multilinestring:function(e){for(var t=[],i=0,s=e.components.length;s>i;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},polygon:function(e){for(var t=[],i=0,s=e.components.length;s>i;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},multipolygon:function(e){for(var t=[],i=0,s=e.components.length;s>i;++i)t.push("("+this.extract.polygon.apply(this,[e.components[i]])+")");return t.join(",")},collection:function(e){for(var t=[],i=0,s=e.components.length;s>i;++i)t.push(this.extractGeometry.apply(this,[e.components[i]]));return t.join(",")}},parse:{point:function(e){var t=OpenLayers.String.trim(e).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t[0],t[1]))},multipoint:function(e){for(var t,i=OpenLayers.String.trim(e).split(","),s=[],a=0,r=i.length;r>a;++a)t=i[a].replace(this.regExes.trimParens,"$1"),s.push(this.parse.point.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(s))},linestring:function(e){for(var t=OpenLayers.String.trim(e).split(","),i=[],s=0,a=t.length;a>s;++s)i.push(this.parse.point.apply(this,[t[s]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(i))},multilinestring:function(e){for(var t,i=OpenLayers.String.trim(e).split(this.regExes.parenComma),s=[],a=0,r=i.length;r>a;++a)t=i[a].replace(this.regExes.trimParens,"$1"),s.push(this.parse.linestring.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(s))},polygon:function(e){for(var t,i,s,a=OpenLayers.String.trim(e).split(this.regExes.parenComma),r=[],n=0,o=a.length;o>n;++n)t=a[n].replace(this.regExes.trimParens,"$1"),i=this.parse.linestring.apply(this,[t]).geometry,s=new OpenLayers.Geometry.LinearRing(i.components),r.push(s);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(r))},multipolygon:function(e){for(var t,i=OpenLayers.String.trim(e).split(this.regExes.doubleParenComma),s=[],a=0,r=i.length;r>a;++a)t=i[a].replace(this.regExes.trimParens,"$1"),s.push(this.parse.polygon.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(s))},geometrycollection:function(e){e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var t=OpenLayers.String.trim(e).split("|"),i=[],s=0,a=t.length;a>s;++s)i.push(OpenLayers.Format.WKT.prototype.read.apply(this,[t[s]]));return i}},CLASS_NAME:"OpenLayers.Format.WKT"}),OpenLayers.Protocol.SQL.Gears=OpenLayers.Class(OpenLayers.Protocol.SQL,{FID_PREFIX:"__gears_fid__",NULL_GEOMETRY:"__gears_null_geometry__",NULL_FEATURE_STATE:"__gears_null_feature_state__",jsonParser:null,wktParser:null,fidRegExp:null,saveFeatureState:!0,typeOfFid:"string",db:null,initialize:function(e){this.supported()&&(OpenLayers.Protocol.SQL.prototype.initialize.apply(this,[e]),this.jsonParser=new OpenLayers.Format.JSON,this.wktParser=new OpenLayers.Format.WKT,this.fidRegExp=RegExp("^"+this.FID_PREFIX),this.initializeDatabase())},initializeDatabase:function(){this.db=google.gears.factory.create("beta.database"),this.db.open(this.databaseName),this.db.execute("CREATE TABLE IF NOT EXISTS "+this.tableName+" (fid TEXT UNIQUE, geometry TEXT, properties TEXT,"+"  state TEXT)")
},destroy:function(){this.db.close(),this.db=null,this.jsonParser=null,this.wktParser=null,OpenLayers.Protocol.SQL.prototype.destroy.apply(this)},supported:function(){return!(!window.google||!google.gears)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=OpenLayers.Util.applyDefaults(e,this.options);for(var t,i=[],s=this.db.execute("SELECT * FROM "+this.tableName);s.isValidRow();)t=this.unfreezeFeature(s),this.evaluateFilter(t,e.filter)&&(e.noFeatureStateReset||(t.state=null),i.push(t)),s.next();s.close();var a=new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,requestType:"read",features:i});return e&&e.callback&&e.callback.call(e.scope,a),a},unfreezeFeature:function(e){var t,i=e.fieldByName("geometry");t=i==this.NULL_GEOMETRY?new OpenLayers.Feature.Vector:this.wktParser.read(i),t.attributes=this.jsonParser.read(e.fieldByName("properties")),t.fid=this.extractFidFromField(e.fieldByName("fid"));var s=e.fieldByName("state");return s==this.NULL_FEATURE_STATE&&(s=null),t.state=s,t},extractFidFromField:function(e){return e.match(this.fidRegExp)||"number"!=this.typeOfFid||(e=parseFloat(e)),e},create:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i=this.createOrUpdate(e);return i.requestType="create",t&&t.callback&&t.callback.call(t.scope,i),i},update:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i=this.createOrUpdate(e);return i.requestType="update",t&&t.callback&&t.callback.call(t.scope,i),i},createOrUpdate:function(e){OpenLayers.Util.isArray(e)||(e=[e]);var t,i,s=e.length,a=Array(s);for(t=0;s>t;t++){i=e[t];var r=this.freezeFeature(i);this.db.execute("REPLACE INTO "+this.tableName+" (fid, geometry, properties, state)"+" VALUES (?, ?, ?, ?)",r);var n=i.clone();n.fid=this.extractFidFromField(r[0]),a[t]=n}return new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,features:a,reqFeatures:e})},freezeFeature:function(e){e.fid=null!=e.fid?""+e.fid:OpenLayers.Util.createUniqueID(this.FID_PREFIX);var t=null!=e.geometry?""+e.geometry:this.NULL_GEOMETRY,i=this.jsonParser.write(e.attributes),s=this.getFeatureStateForFreeze(e);return[e.fid,t,i,s]},getFeatureStateForFreeze:function(e){var t;return t=this.saveFeatureState?this.createdOffline(e)?OpenLayers.State.INSERT:e.state:this.NULL_FEATURE_STATE},"delete":function(e,t){OpenLayers.Util.isArray(e)||(e=[e]),t=OpenLayers.Util.applyDefaults(t,this.options);var i,s,a;for(i=0,s=e.length;s>i;i++)if(a=e[i],this.saveFeatureState&&!this.createdOffline(a)){var r=a.clone();r.fid=a.fid,r.geometry&&(r.geometry.destroy(),r.geometry=null),r.state=a.state,this.createOrUpdate(r)}else this.db.execute("DELETE FROM "+this.tableName+" WHERE fid = ?",[a.fid]);var n=new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,requestType:"delete",reqFeatures:e});return t&&t.callback&&t.callback.call(t.scope,n),n},createdOffline:function(e){return"string"==typeof e.fid&&!!e.fid.match(this.fidRegExp)},commit:function(e,t){function i(e){n>++o&&(e.last=!1),this.callUserCallback(t,e)}for(var s,a,r=[],n=0,o=0,l=[],h=[],u=[],p=e.length-1;p>=0;p--)switch(a=e[p],a.state){case OpenLayers.State.INSERT:l.push(a);break;case OpenLayers.State.UPDATE:h.push(a);break;case OpenLayers.State.DELETE:u.push(a)}return l.length>0&&(n++,s=OpenLayers.Util.applyDefaults({callback:i,scope:this},t.create),r.push(this.create(l,s))),h.length>0&&(n++,s=OpenLayers.Util.applyDefaults({callback:i,scope:this},t.update),r.push(this.update(h,s))),u.length>0&&(n++,s=OpenLayers.Util.applyDefaults({callback:i,scope:this},t["delete"]),r.push(this["delete"](u,s))),r},clear:function(){this.db.execute("DELETE FROM "+this.tableName)},callUserCallback:function(e,t){var i=e[t.requestType];i&&i.callback&&i.callback.call(i.scope,t),t.last&&e.callback&&e.callback.call(e.scope)},CLASS_NAME:"OpenLayers.Protocol.SQL.Gears"}),OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(e){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),OpenLayers.Format.prototype.initialize.apply(this,[e]),this.namespaces=OpenLayers.Util.extend({},this.namespaces),this.namespaceAlias={};for(var t in this.namespaces)this.namespaceAlias[this.namespaces[t]]=t},destroy:function(){this.xmldom=null,OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(e,t){this.namespaces[e]=t,this.namespaceAlias[t]=e},read:function(e){var t=e.indexOf("<");t>0&&(e=e.substring(t));var i=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var t;return t=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom,t.loadXML(e),t},this),function(){return(new DOMParser).parseFromString(e,"text/xml")},function(){var t=new XMLHttpRequest;return t.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1),t.overrideMimeType&&t.overrideMimeType("text/xml"),t.send(null),t.responseXML});return this.keepData&&(this.data=i),i},write:function(e){var t;if(this.xmldom)t=e.xml;else{var i=new XMLSerializer;if(1==e.nodeType){var s=document.implementation.createDocument("","",null);s.importNode&&(e=s.importNode(e,!0)),s.appendChild(e),t=i.serializeToString(s)}else t=i.serializeToString(e)}return t},createElementNS:function(e,t){var i;return i=this.xmldom?"string"==typeof e?this.xmldom.createNode(1,t,e):this.xmldom.createNode(1,t,""):document.createElementNS(e,t)},createTextNode:function(e){var t;return"string"!=typeof e&&(e+=""),t=this.xmldom?this.xmldom.createTextNode(e):document.createTextNode(e)},getElementsByTagNameNS:function(e,t,i){var s=[];if(e.getElementsByTagNameNS)s=e.getElementsByTagNameNS(t,i);else for(var a,r,n=e.getElementsByTagName("*"),o=0,l=n.length;l>o;++o)a=n[o],r=a.prefix?a.prefix+":"+i:i,("*"==i||r==a.nodeName)&&("*"==t||t==a.namespaceURI)&&s.push(a);return s},getAttributeNodeNS:function(e,t,i){var s=null;if(e.getAttributeNodeNS)s=e.getAttributeNodeNS(t,i);else for(var a,r,n=e.attributes,o=0,l=n.length;l>o;++o)if(a=n[o],a.namespaceURI==t&&(r=a.prefix?a.prefix+":"+i:i,r==a.nodeName)){s=a;break}return s},getAttributeNS:function(e,t,i){var s="";if(e.getAttributeNS)s=e.getAttributeNS(t,i)||"";else{var a=this.getAttributeNodeNS(e,t,i);a&&(s=a.nodeValue)}return s},getChildValue:function(e,t){var i=t||"";if(e)for(var s=e.firstChild;s;s=s.nextSibling)switch(s.nodeType){case 3:case 4:i+=s.nodeValue}return i},concatChildValues:function(e,t){for(var i,s="",a=e.firstChild;a;)i=a.nodeValue,i&&(s+=i),a=a.nextSibling;return""==s&&void 0!=t&&(s=t),s},isSimpleContent:function(e){for(var t=!0,i=e.firstChild;i;i=i.nextSibling)if(1===i.nodeType){t=!1;break}return t},contentType:function(e){for(var t=!1,i=!1,s=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,a=e.firstChild;a;a=a.nextSibling){switch(a.nodeType){case 1:i=!0;break;case 8:break;default:t=!0}if(i&&t)break}if(i&&t)s=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(i)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(t)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return s},hasAttributeNS:function(e,t,i){var s=!1;return s=e.hasAttributeNS?e.hasAttributeNS(t,i):!!this.getAttributeNodeNS(e,t,i)},setAttributeNS:function(e,t,i,s){if(e.setAttributeNS)e.setAttributeNS(t,i,s);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(t){var a=e.ownerDocument.createNode(2,i,t);a.nodeValue=s,e.setAttributeNode(a)}else e.setAttribute(i,s)}},createElementNSPlus:function(e,t){t=t||{};var i=t.uri||this.namespaces[t.prefix];if(!i){var s=e.indexOf(":");i=this.namespaces[e.substring(0,s)]}i||(i=this.namespaces[this.defaultPrefix]);var a=this.createElementNS(i,e);t.attributes&&this.setAttributes(a,t.attributes);var r=t.value;return null!=r&&a.appendChild(this.createTextNode(r)),a},setAttributes:function(e,t){var i,s;for(var a in t)null!=t[a]&&t[a].toString&&(i=""+t[a],s=this.namespaces[a.substring(0,a.indexOf(":"))]||null,this.setAttributeNS(e,s,a,i))},readNode:function(e,t){t||(t={});var i=this.readers[e.namespaceURI?this.namespaceAlias[e.namespaceURI]:this.defaultPrefix];if(i){var s=e.localName||e.nodeName.split(":").pop(),a=i[s]||i["*"];a&&a.apply(this,[e,t])}return t},readChildNodes:function(e,t){t||(t={});for(var i,s=e.childNodes,a=0,r=s.length;r>a;++a)i=s[a],1==i.nodeType&&this.readNode(i,t);return t},writeNode:function(e,t,i){var s,a,r=e.indexOf(":");r>0?(s=e.substring(0,r),a=e.substring(r+1)):(s=i?this.namespaceAlias[i.namespaceURI]:this.defaultPrefix,a=e);var n=this.writers[s][a].apply(this,[t]);return i&&i.appendChild(n),n},getChildEl:function(e,t,i){return e&&this.getThisOrNextEl(e.firstChild,t,i)},getNextEl:function(e,t,i){return e&&this.getThisOrNextEl(e.nextSibling,t,i)},getThisOrNextEl:function(e,t,i){e:for(var s=e;s;s=s.nextSibling)switch(s.nodeType){case 1:if(!(t&&t!==(s.localName||s.nodeName.split(":").pop())||i&&i!==s.namespaceURI))break e;s=null;break e;case 3:if(/^\s*$/.test(s.nodeValue))break;case 4:case 6:case 12:case 10:case 11:s=null;break e}return s||null},lookupNamespaceURI:function(e,t){var i=null;if(e)if(e.lookupNamespaceURI)i=e.lookupNamespaceURI(t);else e:switch(e.nodeType){case 1:if(null!==e.namespaceURI&&e.prefix===t){i=e.namespaceURI;break e}var s=e.attributes.length;if(s)for(var a,r=0;s>r;++r){if(a=e.attributes[r],"xmlns"===a.prefix&&a.name==="xmlns:"+t){i=a.value||null;break e}if("xmlns"===a.name&&null===t){i=a.value||null;break e}}i=this.lookupNamespaceURI(e.parentNode,t);break e;case 2:i=this.lookupNamespaceURI(e.ownerElement,t);break e;case 9:i=this.lookupNamespaceURI(e.documentElement,t);break e;case 6:case 12:case 10:case 11:break e;default:i=this.lookupNamespaceURI(e.parentNode,t)}return i},getXMLDoc:function(){return OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"))),OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"}),OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3},OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype),OpenLayers.Format.XML.document=null,OpenLayers.Date={toISOString:function(){function e(e,t){for(var i=e+"";t>i.length;)i="0"+i;return i}return"toISOString"in Date.prototype?function(e){return e.toISOString()}:function(t){var i;return i=isNaN(t.getTime())?"Invalid Date":t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1,2)+"-"+e(t.getUTCDate(),2)+"T"+e(t.getUTCHours(),2)+":"+e(t.getUTCMinutes(),2)+":"+e(t.getUTCSeconds(),2)+"."+e(t.getUTCMilliseconds(),3)+"Z"}}(),parse:function(e){var t,i=e.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))?$/);if(i&&(i[1]||i[7])){var s=parseInt(i[1],10)||0,a=parseInt(i[2],10)-1||0,r=parseInt(i[3],10)||1;t=new Date(Date.UTC(s,a,r));var n=i[7];if(n){var o=parseInt(i[4],10),l=parseInt(i[5],10),h=parseFloat(i[6]),u=0|h,p=Math.round(1e3*(h-u));if(t.setUTCHours(o,l,u,p),"Z"!==n){var c=parseInt(n,10),d=parseInt(i[8],10)||0,m=-1e3*(60*60*c+60*d);t=new Date(t.getTime()+m)}}}else t=new Date("invalid");return t}},OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null,this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(e){e&&(this.bounds=e.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(e){var t=this.getBounds();t?this.bounds.extend(e):this.setBounds(e)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(){},getVertices:function(){},atPoint:function(e,t,i){var s=!1,a=this.getBounds();if(null!=a&&null!=e){var r=null!=t?t:0,n=null!=i?i:0,o=new OpenLayers.Bounds(this.bounds.left-r,this.bounds.bottom-n,this.bounds.right+r,this.bounds.top+n);s=o.containsLonLat(e)}return s},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this))},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(e){var t=arguments.callee.format;t||(t=new OpenLayers.Format.WKT,arguments.callee.format=t);var i,s=t.read(e);if(s instanceof OpenLayers.Feature.Vector)i=s.geometry;else if(OpenLayers.Util.isArray(s)){for(var a=s.length,r=Array(a),n=0;a>n;++n)r[n]=s[n].geometry;i=new OpenLayers.Geometry.Collection(r)}return i},OpenLayers.Geometry.segmentsIntersect=function(e,t,i){var s=i&&i.point,a=i&&i.tolerance,r=!1,n=e.x1-t.x1,o=e.y1-t.y1,l=e.x2-e.x1,h=e.y2-e.y1,u=t.y2-t.y1,p=t.x2-t.x1,c=u*l-p*h,d=p*o-u*n,m=l*o-h*n;if(0==c)0==d&&0==m&&(r=!0);else{var y=d/c,f=m/c;if(y>=0&&1>=y&&f>=0&&1>=f)if(s){var g=e.x1+y*l,v=e.y1+y*h;r=new OpenLayers.Geometry.Point(g,v)}else r=!0}if(a){var L;if(r){if(s){var b,g,v,O=[e,t];e:for(var S=0;2>S;++S){b=O[S];for(var w=1;3>w;++w)if(g=b["x"+w],v=b["y"+w],L=Math.sqrt(Math.pow(g-r.x,2)+Math.pow(v-r.y,2)),a>L){r.x=g,r.y=v;break e}}}}else{var _,x,g,v,k,C,O=[e,t];e:for(var S=0;2>S;++S){_=O[S],x=O[(S+1)%2];for(var w=1;3>w;++w)if(k={x:_["x"+w],y:_["y"+w]},C=OpenLayers.Geometry.distanceToSegment(k,x),a>C.distance){r=s?new OpenLayers.Geometry.Point(k.x,k.y):!0;break e}}}}return r},OpenLayers.Geometry.distanceToSegment=function(e,t){var i,s,a=e.x,r=e.y,n=t.x1,o=t.y1,l=t.x2,h=t.y2,u=l-n,p=h-o,c=(u*(a-n)+p*(r-o))/(Math.pow(u,2)+Math.pow(p,2));return 0>=c?(i=n,s=o):c>=1?(i=l,s=h):(i=n+c*u,s=o+c*p),{distance:Math.sqrt(Math.pow(i-a,2)+Math.pow(s-r,2)),x:i,y:s}},OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(e,t){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(e),this.y=parseFloat(t)},clone:function(e){return null==e&&(e=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(e,this),e},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(e,t){var i,s,a,r,n,o,l=!(t&&t.edge===!1),h=l&&t&&t.details;return e instanceof OpenLayers.Geometry.Point?(s=this.x,a=this.y,r=e.x,n=e.y,i=Math.sqrt(Math.pow(s-r,2)+Math.pow(a-n,2)),o=h?{x0:s,y0:a,x1:r,y1:n,distance:i}:i):(o=e.distanceTo(this,t),h&&(o={x0:o.x1,y0:o.y1,x1:o.x0,y1:o.y0,distance:o.distance})),o},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},toShortString:function(){return this.x+", "+this.y},move:function(e,t){this.x=this.x+e,this.y=this.y+t,this.clearBounds()},rotate:function(e,t){e*=Math.PI/180;var i=this.distanceTo(t),s=e+Math.atan2(this.y-t.y,this.x-t.x);this.x=t.x+i*Math.cos(s),this.y=t.y+i*Math.sin(s),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,t,i){return i=void 0==i?1:i,this.x=t.x+e*i*(this.x-t.x),this.y=t.y+e*(this.y-t.y),this.clearBounds(),this},intersects:function(e){var t=!1;return t="OpenLayers.Geometry.Point"==e.CLASS_NAME?this.equals(e):e.intersects(this)},transform:function(e,t){return e&&t&&(OpenLayers.Projection.transform(this,e,t),this.bounds=null),this},getVertices:function(){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(e){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=e&&this.addComponents(e)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;len>i;i++)geometry.addComponent(this.components[i].clone());return OpenLayers.Util.applyDefaults(geometry,this),geometry},getComponentsString:function(){for(var e=[],t=0,i=this.components.length;i>t;t++)e.push(this.components[t].toShortString());return e.join(",")},calculateBounds:function(){this.bounds=null;var e=new OpenLayers.Bounds,t=this.components;if(t)for(var i=0,s=t.length;s>i;i++)e.extend(t[i].getBounds());null!=e.left&&null!=e.bottom&&null!=e.right&&null!=e.top&&this.setBounds(e)},addComponents:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;i>t;t++)this.addComponent(e[t])},addComponent:function(e,t){var i=!1;if(e&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,e.CLASS_NAME)>-1)){if(null!=t&&this.components.length>t){var s=this.components.slice(0,t),a=this.components.slice(t,this.components.length);s.push(e),this.components=s.concat(a)}else this.components.push(e);e.parent=this,this.clearBounds(),i=!0}return i},removeComponents:function(e){var t=!1;OpenLayers.Util.isArray(e)||(e=[e]);for(var i=e.length-1;i>=0;--i)t=this.removeComponent(e[i])||t;return t},removeComponent:function(e){return OpenLayers.Util.removeItem(this.components,e),this.clearBounds(),!0},getLength:function(){for(var e=0,t=0,i=this.components.length;i>t;t++)e+=this.components[t].getLength();return e},getArea:function(){for(var e=0,t=0,i=this.components.length;i>t;t++)e+=this.components[t].getArea();return e},getGeodesicArea:function(e){for(var t=0,i=0,s=this.components.length;s>i;i++)t+=this.components[i].getGeodesicArea(e);return t},getCentroid:function(e){if(!e)return this.components.length&&this.components[0].getCentroid();var t=this.components.length;if(!t)return!1;for(var i,s=[],a=[],r=0,n=Number.MAX_VALUE,o=0;t>o;++o){i=this.components[o];var l=i.getArea(),h=i.getCentroid(!0);isNaN(l)||isNaN(h.x)||isNaN(h.y)||(s.push(l),r+=l,n=n>l&&l>0?l:n,a.push(h))}if(t=s.length,0===r){for(var o=0;t>o;++o)s[o]=1;r=s.length}else{for(var o=0;t>o;++o)s[o]/=n;r/=n}for(var h,l,u=0,p=0,o=0;t>o;++o)h=a[o],l=s[o],u+=h.x*l,p+=h.y*l;return new OpenLayers.Geometry.Point(u/r,p/r)},getGeodesicLength:function(e){for(var t=0,i=0,s=this.components.length;s>i;i++)t+=this.components[i].getGeodesicLength(e);return t},move:function(e,t){for(var i=0,s=this.components.length;s>i;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,s=this.components.length;s>i;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var s=0;this.components.length>s;++s)this.components[s].resize(e,t,i);return this},distanceTo:function(e,t){for(var i,s,a,r=!(t&&t.edge===!1),n=r&&t&&t.details,o=Number.POSITIVE_INFINITY,l=0,h=this.components.length;h>l&&(i=this.components[l].distanceTo(e,t),a=n?i.distance:i,!(o>a&&(o=a,s=i,0==o)));++l);return s},equals:function(e){var t=!0;if(e&&e.CLASS_NAME&&this.CLASS_NAME==e.CLASS_NAME)if(OpenLayers.Util.isArray(e.components)&&e.components.length==this.components.length){for(var i=0,s=this.components.length;s>i;++i)if(!this.components[i].equals(e.components[i])){t=!1;break}}else t=!1;else t=!1;return t},transform:function(e,t){if(e&&t){for(var i=0,s=this.components.length;s>i;i++){var a=this.components[i];a.transform(e,t)}this.bounds=null}return this},intersects:function(e){for(var t=!1,i=0,s=this.components.length;s>i&&!(t=e.intersects(this.components[i]));++i);return t},getVertices:function(e){for(var t=[],i=0,s=this.components.length;s>i;++i)Array.prototype.push.apply(t,this.components[i].getVertices(e));return t},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},addPoint:function(e,t){this.addComponent(e,t)},removePoint:function(e){this.removeComponent(e)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(){OpenLayers.Geometry.MultiPoint.prototype.initialize.apply(this,arguments)},getLength:function(){var e=0;if(this.components&&this.components.length>1)for(var t=1,i=this.components.length;i>t;t++)e+=this.components[t-1].distanceTo(this.components[t]);return e},getGeodesicLength:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}var s=0;if(t.components&&t.components.length>1)for(var a,r,n=1,o=t.components.length;o>n;n++)a=t.components[n-1],r=t.components[n],s+=OpenLayers.Util.distVincenty({lon:a.x,lat:a.y},{lon:r.x,lat:r.y});return 1e3*s},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{initialize:function(){OpenLayers.Geometry.Curve.prototype.initialize.apply(this,arguments)},removeComponent:function(){var e=this.components&&this.components.length>2;return e&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),e},intersects:function(e){var t=!1,i=e.CLASS_NAME;if("OpenLayers.Geometry.LineString"==i||"OpenLayers.Geometry.LinearRing"==i||"OpenLayers.Geometry.Point"==i){var s,a=this.getSortedSegments();s="OpenLayers.Geometry.Point"==i?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();var r,n,o,l,h,u,p,c;e:for(var d=0,m=a.length;m>d;++d){r=a[d],n=r.x1,o=r.x2,l=r.y1,h=r.y2;for(var y=0,f=s.length;f>y&&(u=s[y],!(u.x1>o));++y)if(!(n>u.x2||(p=u.y1,c=u.y2,Math.min(p,c)>Math.max(l,h)||Math.max(p,c)<Math.min(l,h)||!OpenLayers.Geometry.segmentsIntersect(r,u)))){t=!0;break e}}}else t=e.intersects(this);return t},getSortedSegments:function(){function e(e,t){return e.x1-t.x1}for(var t,i,s=this.components.length-1,a=Array(s),r=0;s>r;++r)t=this.components[r],i=this.components[r+1],a[r]=t.x<i.x?{x1:t.x,y1:t.y,x2:i.x,y2:i.y}:{x1:i.x,y1:i.y,x2:t.x,y2:t.y};return a.sort(e)},splitWithSegment:function(e,t){for(var i,s,a,r,n,o=!(t&&t.edge===!1),l=t&&t.tolerance,h=[],u=this.getVertices(),p=[],c=[],d=!1,m={point:!0,tolerance:l},y=null,f=0,g=u.length-2;g>=f;++f)if(i=u[f],p.push(i.clone()),s=u[f+1],n={x1:i.x,y1:i.y,x2:s.x,y2:s.y},a=OpenLayers.Geometry.segmentsIntersect(e,n,m),a instanceof OpenLayers.Geometry.Point&&(r=a.x===e.x1&&a.y===e.y1||a.x===e.x2&&a.y===e.y2||a.equals(i)||a.equals(s)?!0:!1,r||o)){if(a.equals(c[c.length-1])||c.push(a.clone()),0===f&&a.equals(i))continue;if(a.equals(s))continue;d=!0,a.equals(i)||p.push(a),h.push(new OpenLayers.Geometry.LineString(p)),p=[a.clone()]}if(d&&(p.push(s.clone()),h.push(new OpenLayers.Geometry.LineString(p))),c.length>0){var v=e.x1<e.x2?1:-1,L=e.y1<e.y2?1:-1;y={lines:h,points:c.sort(function(e,t){return v*e.x-v*t.x||L*e.y-L*t.y})}}return y},split:function(e,t){var i,s,a,r,n=null,o=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){var l,h,u,p,c,d,m=this.getVertices(),y=[];a=[];for(var f=0,g=m.length-2;g>=f;++f){l=m[f],h=m[f+1],u={x1:l.x,y1:l.y,x2:h.x,y2:h.y},r=r||[e],o&&y.push(l.clone());for(var v=0;r.length>v;++v)if(p=r[v].splitWithSegment(u,t),p&&(c=p.lines,c.length>0&&(c.unshift(v,1),Array.prototype.splice.apply(r,c),v+=c.length-2),o))for(var L=0,b=p.points.length;b>L;++L)d=p.points[L],d.equals(l)||(y.push(d),a.push(new OpenLayers.Geometry.LineString(y)),y=d.equals(h)?[]:[d.clone()])}o&&a.length>0&&y.length>0&&(y.push(h.clone()),a.push(new OpenLayers.Geometry.LineString(y)))}else n=e.splitWith(this,t);return r&&r.length>1?s=!0:r=[],a&&a.length>1?i=!0:a=[],(s||i)&&(n=o?[a,r]:r),n},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){var t;return t=e===!0?[this.components[0],this.components[this.components.length-1]]:e===!1?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(e,t){var i,s=!(t&&t.edge===!1),a=s&&t&&t.details,r={},n=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point){for(var o,l=this.getSortedSegments(),h=e.x,u=e.y,p=0,c=l.length;c>p;++p)if(o=l[p],i=OpenLayers.Geometry.distanceToSegment(e,o),n>i.distance){if(n=i.distance,r=i,0===n)break}else if(o.x2>h&&(u>o.y1&&o.y2>u||o.y1>u&&u>o.y2))break;r=a?{distance:r.distance,x0:r.x,y0:r.y,x1:h,y1:u}:r.distance}else if(e instanceof OpenLayers.Geometry.LineString){var d,m,y,f,g,v=this.getSortedSegments(),L=e.getSortedSegments(),b=L.length,O={point:!0};e:for(var p=0,c=v.length;c>p;++p){d=v[p],f=d.x1,g=d.y1;for(var S=0;b>S;++S){if(m=L[S],y=OpenLayers.Geometry.segmentsIntersect(d,m,O)){n=0,r={distance:0,x0:y.x,y0:y.y,x1:y.x,y1:y.y};break e}i=OpenLayers.Geometry.distanceToSegment({x:f,y:g},m),n>i.distance&&(n=i.distance,r={distance:n,x0:f,y0:g,x1:i.x,y1:i.y})}}if(a||(r=r.distance),0!==n&&d){i=e.distanceTo(new OpenLayers.Geometry.Point(d.x2,d.y2),t);var w=a?i.distance:i;n>w&&(r=a?{distance:n,x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0}:w)}}else r=e.distanceTo(this,t),a&&(r={distance:r.distance,x0:r.x1,y0:r.y1,x1:r.x0,y1:r.y0});return r},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(3>t.length)return this;var i=function(e,t){return e-t},s=function(e,t,i,r){for(var n,l=0,h=0,u=t;i>u;u++)n=a(e[t],e[i],e[u]),n>l&&(l=n,h=u);l>r&&h!=t&&(o.push(h),s(e,t,h,r),s(e,h,i,r))},a=function(e,t,i){var s=Math.abs(.5*(e.x*t.y+t.x*i.y+i.x*e.y-t.x*e.y-i.x*t.y-e.x*i.y)),a=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),r=2*(s/a);return r},r=0,n=t.length-1,o=[];for(o.push(r),o.push(n);t[r].equals(t[n]);)n--,o.push(n);s(t,r,n,e);var l=[];o.sort(i);for(var h=0;o.length>h;h++)l.push(t[o[h]]);return new OpenLayers.Geometry.LineString(l)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(){OpenLayers.Geometry.LineString.prototype.initialize.apply(this,arguments)},addComponent:function(e,t){var i=!1,s=this.components.pop();null==t&&e.equals(s)||(i=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));var a=this.components[0];return OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[a]),i},removeComponent:function(){var e=this.components&&this.components.length>3;if(e){this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var t=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[t])}return e},move:function(e,t){for(var i=0,s=this.components.length;s-1>i;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,s=this.components.length;s-1>i;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var s=0,a=this.components.length;a-1>s;++s)this.components[s].resize(e,t,i);return this},transform:function(e,t){if(e&&t){for(var i=0,s=this.components.length;s-1>i;i++){var a=this.components[i];a.transform(e,t)}this.bounds=null}return this},getCentroid:function(){if(this.components&&this.components.length>2){for(var e=0,t=0,i=0;this.components.length-1>i;i++){var s=this.components[i],a=this.components[i+1];e+=(s.x+a.x)*(s.x*a.y-a.x*s.y),t+=(s.y+a.y)*(s.x*a.y-a.x*s.y)}var r=-1*this.getArea(),n=e/(6*r),o=t/(6*r);return new OpenLayers.Geometry.Point(n,o)}return null},getArea:function(){var e=0;if(this.components&&this.components.length>2){for(var t=0,i=0,s=this.components.length;s-1>i;i++){var a=this.components[i],r=this.components[i+1];t+=(a.x+r.x)*(r.y-a.y)}e=-t/2}return e},getGeodesicArea:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}var s=0,a=t.components&&t.components.length;if(a>2){for(var r,n,o=0;a-1>o;o++)r=t.components[o],n=t.components[o+1],s+=OpenLayers.Util.rad(n.x-r.x)*(2+Math.sin(OpenLayers.Util.rad(r.y))+Math.sin(OpenLayers.Util.rad(n.y)));s=6378137*6378137*s/2}return s},containsPoint:function(e){function t(e,t,i,s,a){return((t-s)*e+(s*i-t*a))/(i-a)}for(var i,s,a,r,n,o,l,h=OpenLayers.Number.limitSigDigs,u=14,p=h(e.x,u),c=h(e.y,u),d=this.components.length-1,m=0,y=0;d>y;++y)if(i=this.components[y],a=h(i.x,u),r=h(i.y,u),s=this.components[y+1],n=h(s.x,u),o=h(s.y,u),r!=o){if(l=h(t(c,a,r,n,o),u),l==p&&(o>r&&c>=r&&o>=c||r>o&&r>=c&&c>=o)){m=-1;break}p>=l||a!=n&&(Math.min(a,n)>l||l>Math.max(a,n))||(o>r&&c>=r&&o>c||r>o&&r>c&&c>=o)&&++m}else if(c==r&&(n>=a&&p>=a&&n>=p||a>=n&&a>=p&&p>=n)){m=-1;break}var f=-1==m?1:!!(1&m);return f},intersects:function(e){var t=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)t=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=e.intersects(this);else if("OpenLayers.Geometry.LinearRing"==e.CLASS_NAME)t=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var i=0,s=e.components.length;s>i&&!(t=e.components[i].intersects(this));++i);return t},getVertices:function(e){return e===!0?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],initialize:function(){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},getArea:function(){var e=0;if(this.components&&this.components.length>0){e+=Math.abs(this.components[0].getArea());for(var t=1,i=this.components.length;i>t;t++)e-=Math.abs(this.components[t].getArea())}return e},getGeodesicArea:function(e){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getGeodesicArea(e));for(var i=1,s=this.components.length;s>i;i++)t-=Math.abs(this.components[i].getGeodesicArea(e))}return t},containsPoint:function(e){var t=this.components.length,i=!1;if(t>0&&(i=this.components[0].containsPoint(e),1!==i&&i&&t>1))for(var s,a=1;t>a;++a)if(s=this.components[a].containsPoint(e)){i=1===s?1:!1;break}return i},intersects:function(e){var t,i,s=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)s=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==e.CLASS_NAME){for(t=0,i=this.components.length;i>t&&!(s=e.intersects(this.components[t]));++t);if(!s)for(t=0,i=e.components.length;i>t&&!(s=this.containsPoint(e.components[t]));++t);}else for(t=0,i=e.components.length;i>t&&!(s=this.intersects(e.components[t]));++t);if(!s&&"OpenLayers.Geometry.Polygon"==e.CLASS_NAME){var a=this.components[0];for(t=0,i=a.components.length;i>t&&!(s=e.containsPoint(a.components[t]));++t);}return s},distanceTo:function(e,t){var i,s=!(t&&t.edge===!1);return i=!s&&this.intersects(e)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[e,t])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(e,t,i,s){var a=Math.PI*(1/i-.5);s&&(a+=s/180*Math.PI);for(var r,n,o,l=[],h=0;i>h;++h)r=a+2*h*Math.PI/i,n=e.x+t*Math.cos(r),o=e.y+t*Math.sin(r),l.push(new OpenLayers.Geometry.Point(n,o));var u=new OpenLayers.Geometry.LinearRing(l);return new OpenLayers.Geometry.Polygon([u])},OpenLayers.Event={observers:!1,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isSingleTouch:function(e){return e.touches&&1==e.touches.length},isMultiTouch:function(e){return e.touches&&e.touches.length>1},isLeftClick:function(e){return e.which&&1==e.which||e.button&&1==e.button},isRightClick:function(e){return e.which&&3==e.which||e.button&&2==e.button},stop:function(e,t){t||(e.preventDefault?e.preventDefault():e.returnValue=!1),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},findElement:function(e,t){for(var i=OpenLayers.Event.element(e);i.parentNode&&(!i.tagName||i.tagName.toUpperCase()!=t.toUpperCase());)i=i.parentNode;return i},observe:function(e,t,i,s){var a=OpenLayers.Util.getElement(e);if(s=s||!1,"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.attachEvent)&&(t="keydown"),this.observers||(this.observers={}),!a._eventCacheID){var r="eventCacheID_";a.id&&(r=a.id+"_"+r),a._eventCacheID=OpenLayers.Util.createUniqueID(r)}var n=a._eventCacheID;this.observers[n]||(this.observers[n]=[]),this.observers[n].push({element:a,name:t,observer:i,useCapture:s}),a.addEventListener?a.addEventListener(t,i,s):a.attachEvent&&a.attachEvent("on"+t,i)
},stopObservingElement:function(e){var t=OpenLayers.Util.getElement(e),i=t._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[i])},_removeElementObservers:function(e){if(e)for(var t=e.length-1;t>=0;t--){var i=e[t],s=Array(i.element,i.name,i.observer,i.useCapture);OpenLayers.Event.stopObserving.apply(this,s)}},stopObserving:function(e,t,i,s){s=s||!1;var a=OpenLayers.Util.getElement(e),r=a._eventCacheID;"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.detachEvent)&&(t="keydown");var n=!1,o=OpenLayers.Event.observers[r];if(o)for(var l=0;!n&&o.length>l;){var h=o[l];if(h.name==t&&h.observer==i&&h.useCapture==s){o.splice(l,1),0==o.length&&delete OpenLayers.Event.observers[r],n=!0;break}l++}return n&&(a.removeEventListener?a.removeEventListener(t,i,s):a&&a.detachEvent&&a.detachEvent("on"+t,i)),n},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var e in OpenLayers.Event.observers){var t=OpenLayers.Event.observers[e];OpenLayers.Event._removeElementObservers.apply(this,[t])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),window.Event)OpenLayers.Util.applyDefaults(window.Event,OpenLayers.Event);else var Event=OpenLayers.Event;OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend"],listeners:null,object:null,element:null,eventTypes:null,eventHandler:null,fallThrough:null,includeXY:!1,clearMouseListener:null,initialize:function(e,t,i,s,a){if(OpenLayers.Util.extend(this,a),this.object=e,this.fallThrough=s,this.listeners={},this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this),this.eventTypes=[],null!=i)for(var r=0,n=i.length;n>r;r++)this.addEventType(i[r]);null!=t&&this.attachToElement(t)},destroy:function(){this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.eventTypes=null,this.fallThrough=null,this.eventHandler=null},addEventType:function(e){this.listeners[e]||(this.eventTypes.push(e),this.listeners[e]=[])},attachToElement:function(e){this.element&&OpenLayers.Event.stopObservingElement(this.element),this.element=e;for(var t=0,i=this.BROWSER_EVENTS.length;i>t;t++){var s=this.BROWSER_EVENTS[t];this.addEventType(s),OpenLayers.Event.observe(e,s,this.eventHandler)}OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(e){for(var t in e)"scope"!=t&&this.register(t,e.scope,e[t])},register:function(e,t,i){if(null!=i&&-1!=OpenLayers.Util.indexOf(this.eventTypes,e)){null==t&&(t=this.object);var s=this.listeners[e];s.push({obj:t,func:i})}},registerPriority:function(e,t,i){if(null!=i){null==t&&(t=this.object);var s=this.listeners[e];null!=s&&s.unshift({obj:t,func:i})}},un:function(e){for(var t in e)"scope"!=t&&this.unregister(t,e.scope,e[t])},unregister:function(e,t,i){null==t&&(t=this.object);var s=this.listeners[e];if(null!=s)for(var a=0,r=s.length;r>a;a++)if(s[a].obj==t&&s[a].func==i){s.splice(a,1);break}},remove:function(e){null!=this.listeners[e]&&(this.listeners[e]=[])},triggerEvent:function(e,t){var i=this.listeners[e];if(!i||0==i.length)return void 0;null==t&&(t={}),t.object=this.object,t.element=this.element,t.type||(t.type=e),i=i.slice();for(var s,a=0,r=i.length;r>a;a++){var n=i[a];if(s=n.func.apply(n.obj,[t]),void 0!=s&&0==s)break}return this.fallThrough||OpenLayers.Event.stop(t,!0),s},handleBrowserEvent:function(e){var t=e.type,i=this.listeners[t];if(i&&0!=i.length){var s=e.touches;if(s&&s[0]){for(var a,r=0,n=0,o=s.length,l=0;o>l;++l)a=s[l],r+=a.clientX,n+=a.clientY;e.clientX=r/o,e.clientY=n/o}this.includeXY&&(e.xy=this.getMousePosition(e)),this.triggerEvent(t,e)}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null;var e=document.body;e&&(0==e.scrollTop&&0==e.scrollLeft||!navigator.userAgent.match(/iPhone/i))&&(this.element.offsets=null)},getMousePosition:function(e){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var t=OpenLayers.Util.getViewportElement();this.element.scrolls=[t.scrollLeft,t.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(e.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],e.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this,null,["complete","success","failure"]),issue:function(e){var t=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});e=OpenLayers.Util.applyDefaults(e,t);var i=new OpenLayers.Request.XMLHttpRequest,s=OpenLayers.Util.urlAppend(e.url,OpenLayers.Util.getParameterString(e.params||{})),a=!(0==s.indexOf("http")),r=!a&&s.match(this.URL_SPLIT_REGEX);if(r){var n=window.location;a=r[1]==n.protocol&&r[3]==n.hostname;var o=r[4],l=n.port;(80!=o&&""!=o||"80"!=l&&""!=l)&&(a=a&&o==l)}a||(e.proxy?s="function"==typeof e.proxy?e.proxy(s):e.proxy+encodeURIComponent(s):OpenLayers.Console.warn(OpenLayers.i18n("proxyNeeded"),{url:s})),i.open(e.method,s,e.async,e.user,e.password);for(var h in e.headers)i.setRequestHeader(h,e.headers[h]);var u=this.events,p=this;return i.onreadystatechange=function(){if(i.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var t=u.triggerEvent("complete",{request:i,config:e,requestUrl:s});t!==!1&&p.runCallbacks({request:i,config:e,requestUrl:s})}},e.async===!1?i.send(e.data):window.setTimeout(function(){0!==i.readyState&&i.send(e.data)},0),i},runCallbacks:function(e){var t,i=e.request,s=e.config,a=s.scope?OpenLayers.Function.bind(s.callback,s.scope):s.callback;s.success&&(t=s.scope?OpenLayers.Function.bind(s.success,s.scope):s.success);var r;s.failure&&(r=s.scope?OpenLayers.Function.bind(s.failure,s.scope):s.failure),"file:"==OpenLayers.Util.createUrlObject(s.url).protocol&&i.responseText&&(i.status=200),a(i),(!i.status||i.status>=200&&300>i.status)&&(this.events.triggerEvent("success",e),t&&t(i)),i.status&&(200>i.status||i.status>=300)&&(this.events.triggerEvent("failure",e),r&&r(i))},GET:function(e){return e=OpenLayers.Util.extend(e,{method:"GET"}),OpenLayers.Request.issue(e)},POST:function(e){return e=OpenLayers.Util.extend(e,{method:"POST"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},PUT:function(e){return e=OpenLayers.Util.extend(e,{method:"PUT"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},DELETE:function(e){return e=OpenLayers.Util.extend(e,{method:"DELETE"}),OpenLayers.Request.issue(e)},HEAD:function(e){return e=OpenLayers.Util.extend(e,{method:"HEAD"}),OpenLayers.Request.issue(e)},OPTIONS:function(e){return e=OpenLayers.Util.extend(e,{method:"OPTIONS"}),OpenLayers.Request.issue(e)}},function(){function e(){this._object=o&&!u?new o:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function t(){return new e}function i(e){if(e._object.send(e._data),l&&!e._async)for(e.readyState=t.OPENED,r(e);e.readyState<t.DONE;)if(e.readyState++,s(e),e._aborted)return}function s(e){t.onreadystatechange&&t.onreadystatechange.apply(e),e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function a(e){var t=e.responseXML,i=e.responseText;return h&&i&&t&&!t.documentElement&&e.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.validateOnParse=!1,t.loadXML(i)),t&&(h&&0!=t.parseError||!t.documentElement||t.documentElement&&"parsererror"==t.documentElement.tagName)?null:t}function r(e){try{e.responseText=e._object.responseText}catch(t){}try{e.responseXML=a(e._object)}catch(t){}try{e.status=e._object.status}catch(t){}try{e.statusText=e._object.statusText}catch(t){}}function n(e){e._object.onreadystatechange=new window.Function}var o=window.XMLHttpRequest,l=!!window.controllers,h=window.document.all&&!window.opera,u=h&&window.navigator.userAgent.match(/MSIE 7.0/);t.prototype=e.prototype,l&&o.wrapped&&(t.wrapped=o.wrapped),t.UNSENT=0,t.OPENED=1,t.HEADERS_RECEIVED=2,t.LOADING=3,t.DONE=4,t.prototype.readyState=t.UNSENT,t.prototype.responseText="",t.prototype.responseXML=null,t.prototype.status=0,t.prototype.statusText="",t.prototype.priority="NORMAL",t.prototype.onreadystatechange=null,t.onreadystatechange=null,t.onopen=null,t.onsend=null,t.onabort=null,t.prototype.open=function(e,i,a,o,u){delete this._headers,3>arguments.length&&(a=!0),this._async=a;var p,c=this,d=this.readyState;h&&a&&(p=function(){d!=t.DONE&&(n(c),c.abort())},window.attachEvent("onunload",p)),t.onopen&&t.onopen.apply(this,arguments),arguments.length>4?this._object.open(e,i,a,o,u):arguments.length>3?this._object.open(e,i,a,o):this._object.open(e,i,a),this.readyState=t.OPENED,s(this),this._object.onreadystatechange=function(){if(!l||a){if(c.readyState=c._object.readyState,r(c),c._aborted)return c.readyState=t.UNSENT,void 0;c.readyState==t.DONE&&(delete c._data,n(c),h&&a&&window.detachEvent("onunload",p)),d!=c.readyState&&s(c),d=c.readyState}}},t.prototype.send=function(e){t.onsend&&t.onsend.apply(this,arguments),arguments.length||(e=null),e&&e.nodeType&&(e=window.XMLSerializer?(new window.XMLSerializer).serializeToString(e):e.xml,oRequest._headers["Content-Type"]||oRequest._object.setRequestHeader("Content-Type","application/xml")),this._data=e,i(this)},t.prototype.abort=function(){t.onabort&&t.onabort.apply(this,arguments),this.readyState>t.UNSENT&&(this._aborted=!0),this._object.abort(),n(this),this.readyState=t.UNSENT,delete this._data},t.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},t.prototype.getResponseHeader=function(e){return this._object.getResponseHeader(e)},t.prototype.setRequestHeader=function(e,t){return this._headers||(this._headers={}),this._headers[e]=t,this._object.setRequestHeader(e,t)},t.prototype.addEventListener=function(e,t,i){for(var s,a=0;s=this._listeners[a];a++)if(s[0]==e&&s[1]==t&&s[2]==i)return;this._listeners.push([e,t,i])},t.prototype.removeEventListener=function(e,t,i){for(var s,a=0;(s=this._listeners[a])&&(s[0]!=e||s[1]!=t||s[2]!=i);a++);s&&this._listeners.splice(a,1)},t.prototype.dispatchEvent=function(e){var t={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==t.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[t]);for(var i,s=0;i=this._listeners[s];s++)i[0]!=t.type||i[2]||(i[1].handleEvent||i[1]).apply(this,[t])},t.prototype.toString=function(){return"[object XMLHttpRequest]"},t.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(e,t){t||(t=[]),e.__func=this,e.__func(t[0],t[1],t[2],t[3],t[4]),delete e.__func}),OpenLayers.Request.XMLHttpRequest=t}(),OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.projCode=e,window.Proj4js&&(this.proj=new Proj4js.Proj(e))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(e){var t=e,i=!1;if(t)if(window.Proj4js&&this.proj.defData&&t.proj.defData)i=this.proj.defData.replace(this.titleRegEx,"")==t.proj.defData.replace(this.titleRegEx,"");else if(t.getCode){var s=this.getCode(),a=t.getCode();i=s==a||!!OpenLayers.Projection.transforms[s]&&OpenLayers.Projection.transforms[s][a]===OpenLayers.Projection.nullTransform}return i},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.addTransform=function(e,t,i){OpenLayers.Projection.transforms[e]||(OpenLayers.Projection.transforms[e]={}),OpenLayers.Projection.transforms[e][t]=i},OpenLayers.Projection.transform=function(e,t,i){return t.proj&&i.proj?e=Proj4js.transform(t.proj,i.proj,e):t&&i&&OpenLayers.Projection.transforms[t.getCode()]&&OpenLayers.Projection.transforms[t.getCode()][i.getCode()]&&OpenLayers.Projection.transforms[t.getCode()][i.getCode()](e),e},OpenLayers.Projection.nullTransform=function(e){return e},OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g},this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){this.features=[],this.styles={},this.fetched={};var t={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(e,t)},parseData:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var i=["Link","NetworkLink","Style","StyleMap","Placemark"],s=0,a=i.length;a>s;++s){var r=i[s],n=this.getElementsByTagNameNS(e,"*",r);if(0!=n.length)switch(r.toLowerCase()){case"link":case"networklink":this.parseLinks(n,t);break;case"style":this.extractStyles&&this.parseStyles(n,t);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(n,t);break;case"placemark":this.parseFeatures(n,t)}}return this.features},parseLinks:function(e,t){if(t.depth>=this.maxDepth)return!1;var i=OpenLayers.Util.extend({},t);i.depth++;for(var s=0,a=e.length;a>s;s++){var r=this.parseProperty(e[s],"*","href");if(r&&!this.fetched[r]){this.fetched[r]=!0;var n=this.fetchLink(r);n&&this.parseData(n,i)}}},fetchLink:function(e){var t=OpenLayers.Request.GET({url:e,async:!1});return t?t.responseText:void 0},parseStyles:function(e,t){for(var i=0,s=e.length;s>i;i++){var a=this.parseStyle(e[i]);if(a){var r=(t.styleBaseUrl||"")+"#"+a.id;this.styles[r]=a}}},parseKmlColor:function(e){var t=null;if(e){var i=e.match(this.regExes.kmlColor);i&&(t={color:"#"+i[4]+i[3]+i[2],opacity:parseInt(i[1],16)/255})}return t},parseStyle:function(e){for(var t,i,s={},a=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],r=0,n=a.length;n>r;++r)if(t=a[r],i=this.getElementsByTagNameNS(e,"*",t)[0])switch(t.toLowerCase()){case"linestyle":var o=this.parseProperty(i,"*","color"),l=this.parseKmlColor(o);l&&(s.strokeColor=l.color,s.strokeOpacity=l.opacity);var h=this.parseProperty(i,"*","width");h&&(s.strokeWidth=h);break;case"polystyle":var o=this.parseProperty(i,"*","color"),l=this.parseKmlColor(o);l&&(s.fillOpacity=l.opacity,s.fillColor=l.color);var u=this.parseProperty(i,"*","fill");"0"==u&&(s.fillColor="none");var p=this.parseProperty(i,"*","outline");"0"==p&&(s.strokeWidth="0");break;case"iconstyle":var c=parseFloat(this.parseProperty(i,"*","scale")||1),h=32*c,d=32*c,m=this.getElementsByTagNameNS(i,"*","Icon")[0];if(m){var y=this.parseProperty(m,"*","href");if(y){var f=this.parseProperty(m,"*","w"),g=this.parseProperty(m,"*","h"),v="http://maps.google.com/mapfiles/kml";!OpenLayers.String.startsWith(y,v)||f||g||(f=64,g=64,c/=2),f=f||g,g=g||f,f&&(h=parseInt(f)*c),g&&(d=parseInt(g)*c);var L=y.match(this.regExes.kmlIconPalette);if(L){var b=L[1],O=L[2],S=this.parseProperty(m,"*","x"),w=this.parseProperty(m,"*","y"),_=S?S/32:0,x=w?7-w/32:7,k=8*x+_;y="http://maps.google.com/mapfiles/kml/pal"+b+"/icon"+k+O}s.graphicOpacity=1,s.externalGraphic=y}}var C=this.getElementsByTagNameNS(i,"*","hotSpot")[0];if(C){var S=parseFloat(C.getAttribute("x")),w=parseFloat(C.getAttribute("y")),M=C.getAttribute("xunits");"pixels"==M?s.graphicXOffset=-S*c:"insetPixels"==M?s.graphicXOffset=-h+S*c:"fraction"==M&&(s.graphicXOffset=-h*S);var E=C.getAttribute("yunits");"pixels"==E?s.graphicYOffset=-d+w*c+1:"insetPixels"==E?s.graphicYOffset=-(w*c)+1:"fraction"==E&&(s.graphicYOffset=-d*(1-w)+1)}s.graphicWidth=h,s.graphicHeight=d;break;case"balloonstyle":var P=OpenLayers.Util.getXmlNodeValue(i);P&&(s.balloonStyle=P.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":var o=this.parseProperty(i,"*","color"),l=this.parseKmlColor(o);l&&(s.fontColor=l.color,s.fontOpacity=l.opacity);break;default:}!s.strokeColor&&s.fillColor&&(s.strokeColor=s.fillColor);var N=e.getAttribute("id");return N&&s&&(s.id=N),s},parseStyleMaps:function(e,t){for(var i=0,s=e.length;s>i;i++)for(var a=e[i],r=this.getElementsByTagNameNS(a,"*","Pair"),n=a.getAttribute("id"),o=0,l=r.length;l>o;o++){var h=r[o],u=this.parseProperty(h,"*","key"),p=this.parseProperty(h,"*","styleUrl");p&&"normal"==u&&(this.styles[(t.styleBaseUrl||"")+"#"+n]=this.styles[(t.styleBaseUrl||"")+p])}},parseFeatures:function(e,t){for(var i=[],s=0,a=e.length;a>s;s++){var r=e[s],n=this.parseFeature.apply(this,[r]);if(!n)throw"Bad Placemark: "+s;if(this.extractStyles&&n.attributes&&n.attributes.styleUrl&&(n.style=this.getStyle(n.attributes.styleUrl,t)),this.extractStyles){var o=this.getElementsByTagNameNS(r,"*","Style")[0];if(o){var l=this.parseStyle(o);l&&(n.style=OpenLayers.Util.extend(n.style,l))}}if(this.extractTracks){var h=this.getElementsByTagNameNS(r,this.namespaces.gx,"Track");if(h&&h.length>0){var u=h[0],p={features:[],feature:n};this.readNode(u,p),p.features.length>0&&i.push.apply(i,p.features)}}else i.push(n)}this.features=this.features.concat(i)},readers:{kml:{when:function(e,t){t.whens.push(OpenLayers.Date.parse(this.getChildValue(e)))},_trackPointAttribute:function(e,t){var i=e.nodeName.split(":").pop();t.attributes[i].push(this.getChildValue(e))}},gx:{Track:function(e,t){var i={whens:[],points:[],angles:[]};if(this.trackAttributes){var s;i.attributes={};for(var a=0,r=this.trackAttributes.length;r>a;++a)s=this.trackAttributes[a],i.attributes[s]=[],s in this.readers.kml||(this.readers.kml[s]=this.readers.kml._trackPointAttribute)}if(this.readChildNodes(e,i),i.whens.length!==i.points.length)throw Error("gx:Track with unequal number of when ("+i.whens.length+") and gx:coord ("+i.points.length+") elements.");var n=i.angles.length>0;if(n&&i.whens.length!==i.angles.length)throw Error("gx:Track with unequal number of when ("+i.whens.length+") and gx:angles ("+i.angles.length+") elements.");for(var o,l,h,a=0,r=i.whens.length;r>a;++a){if(o=t.feature.clone(),o.fid=t.feature.fid||t.feature.id,l=i.points[a],o.geometry=l,"z"in l&&(o.attributes.altitude=l.z),this.internalProjection&&this.externalProjection&&o.geometry.transform(this.externalProjection,this.internalProjection),this.trackAttributes)for(var u=0,p=this.trackAttributes.length;p>u;++u)o.attributes[s]=i.attributes[this.trackAttributes[u]][a];o.attributes.when=i.whens[a],o.attributes.trackId=t.feature.id,n&&(h=i.angles[a],o.attributes.heading=parseFloat(h[0]),o.attributes.tilt=parseFloat(h[1]),o.attributes.roll=parseFloat(h[2])),t.features.push(o)}},coord:function(e,t){var i=this.getChildValue(e),s=i.replace(this.regExes.trimSpace,"").split(/\s+/),a=new OpenLayers.Geometry.Point(s[0],s[1]);s.length>2&&(a.z=parseFloat(s[2])),t.points.push(a)},angles:function(e,t){var i=this.getChildValue(e),s=i.replace(this.regExes.trimSpace,"").split(/\s+/);t.angles.push(s)}}},parseFeature:function(e){for(var t,i,s,a,r=["MultiGeometry","Polygon","LineString","Point"],n=0,o=r.length;o>n;++n)if(t=r[n],this.internalns=e.namespaceURI?e.namespaceURI:this.kmlns,i=this.getElementsByTagNameNS(e,this.internalns,t),i.length>0){var a=this.parseGeometry[t.toLowerCase()];a?(s=a.apply(this,[i[0]]),this.internalProjection&&this.externalProjection&&s.transform(this.externalProjection,this.internalProjection)):OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:t}));break}var l;this.extractAttributes&&(l=this.parseAttributes(e));var h=new OpenLayers.Feature.Vector(s,l),u=e.getAttribute("id")||e.getAttribute("name");return null!=u&&(h.fid=u),h},getStyle:function(e,t){var i=OpenLayers.Util.removeTail(e),s=OpenLayers.Util.extend({},t);if(s.depth++,s.styleBaseUrl=i,!this.styles[e]&&!OpenLayers.String.startsWith(e,"#")&&s.depth<=this.maxDepth&&!this.fetched[i]){var a=this.fetchLink(i);a&&this.parseData(a,s)}var r=OpenLayers.Util.extend({},this.styles[e]);return r},parseGeometry:{point:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),i=[];if(t.length>0){var s=t[0].firstChild.nodeValue;s=s.replace(this.regExes.removeSpace,""),i=s.split(",")}var a=null;if(!(i.length>1))throw"Bad coordinate string: "+s;return 2==i.length&&(i[2]=null),a=new OpenLayers.Geometry.Point(i[0],i[1],i[2])},linestring:function(e,t){var i=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),s=null;if(i.length>0){var a=this.getChildValue(i[0]);a=a.replace(this.regExes.trimSpace,""),a=a.replace(this.regExes.trimComma,",");for(var r,n,o=a.split(this.regExes.splitSpace),l=o.length,h=Array(l),u=0;l>u;++u){if(r=o[u].split(","),n=r.length,!(n>1))throw"Bad LineString point coordinates: "+o[u];2==r.length&&(r[2]=null),h[u]=new OpenLayers.Geometry.Point(r[0],r[1],r[2])}if(!l)throw"Bad LineString coordinates: "+a;s=t?new OpenLayers.Geometry.LinearRing(h):new OpenLayers.Geometry.LineString(h)}return s},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"LinearRing"),i=t.length,s=Array(i);if(i>0)for(var a,r=0,n=t.length;n>r;++r){if(a=this.parseGeometry.linestring.apply(this,[t[r],!0]),!a)throw"Bad LinearRing geometry: "+r;s[r]=a}return new OpenLayers.Geometry.Polygon(s)},multigeometry:function(e){for(var t,i,s=[],a=e.childNodes,r=0,n=a.length;n>r;++r)if(t=a[r],1==t.nodeType){var o=t.prefix?t.nodeName.split(":")[1]:t.nodeName,i=this.parseGeometry[o.toLowerCase()];i&&s.push(i.apply(this,[t]))}return new OpenLayers.Geometry.Collection(s)}},parseAttributes:function(e){var t={},i=e.getElementsByTagName("ExtendedData");i.length&&(t=this.parseExtendedData(i[0]));for(var s,a,r,n=e.childNodes,o=0,l=n.length;l>o;++o)if(s=n[o],1==s.nodeType&&(a=s.childNodes,a.length>=1&&3>=a.length)){var r;switch(a.length){case 1:r=a[0];break;case 2:var h=a[0],u=a[1];r=3==h.nodeType||4==h.nodeType?h:u;break;case 3:default:r=a[1]}if(3==r.nodeType||4==r.nodeType){var p=s.prefix?s.nodeName.split(":")[1]:s.nodeName,c=OpenLayers.Util.getXmlNodeValue(r);c&&(c=c.replace(this.regExes.trimSpace,""),t[p]=c)}}return t},parseExtendedData:function(e){var t,i,s,a,r={},n=e.getElementsByTagName("Data");for(t=0,i=n.length;i>t;t++){s=n[t],a=s.getAttribute("name");var o={},l=s.getElementsByTagName("value");l.length&&(o.value=this.getChildValue(l[0]));var h=s.getElementsByTagName("displayName");h.length&&(o.displayName=this.getChildValue(h[0])),r[a]=o}var u=e.getElementsByTagName("SimpleData");for(t=0,i=u.length;i>t;t++){var o={};s=u[t],a=s.getAttribute("name"),o.value=this.getChildValue(s),o.displayName=a,r[a]=o}return r},parseProperty:function(e,t,i){var s,a=this.getElementsByTagNameNS(e,t,i);try{s=OpenLayers.Util.getXmlNodeValue(a[0])}catch(r){s=null}return s},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS(this.kmlns,"kml"),i=this.createFolderXML(),s=0,a=e.length;a>s;++s)i.appendChild(this.createPlacemarkXML(e[s]));return t.appendChild(i),OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFolderXML:function(){var e=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var t=this.createElementNS(this.kmlns,"name"),i=this.createTextNode(this.foldersName);t.appendChild(i),e.appendChild(t)}if(this.foldersDesc){var s=this.createElementNS(this.kmlns,"description"),a=this.createTextNode(this.foldersDesc);s.appendChild(a),e.appendChild(s)}return e},createPlacemarkXML:function(e){var t=this.createElementNS(this.kmlns,"name"),i=e.style&&e.style.label?e.style.label:e.attributes.name||e.id;t.appendChild(this.createTextNode(i));var s=this.createElementNS(this.kmlns,"description"),a=e.attributes.description||this.placemarksDesc;s.appendChild(this.createTextNode(a));var r=this.createElementNS(this.kmlns,"Placemark");null!=e.fid&&r.setAttribute("id",e.fid),r.appendChild(t),r.appendChild(s);var n=this.buildGeometryNode(e.geometry);return r.appendChild(n),r},buildGeometryNode:function(e){var t=e.CLASS_NAME,i=t.substring(t.lastIndexOf(".")+1),s=this.buildGeometry[i.toLowerCase()],a=null;return s&&(a=s.apply(this,[e])),a},buildGeometry:{point:function(e){var t=this.createElementNS(this.kmlns,"Point");return t.appendChild(this.buildCoordinatesNode(e)),t},multipoint:function(e){return this.buildGeometry.collection.apply(this,[e])},linestring:function(e){var t=this.createElementNS(this.kmlns,"LineString");return t.appendChild(this.buildCoordinatesNode(e)),t},multilinestring:function(e){return this.buildGeometry.collection.apply(this,[e])},linearring:function(e){var t=this.createElementNS(this.kmlns,"LinearRing");return t.appendChild(this.buildCoordinatesNode(e)),t},polygon:function(e){for(var t,i,s,a=this.createElementNS(this.kmlns,"Polygon"),r=e.components,n=0,o=r.length;o>n;++n)s=0==n?"outerBoundaryIs":"innerBoundaryIs",t=this.createElementNS(this.kmlns,s),i=this.buildGeometry.linearring.apply(this,[r[n]]),t.appendChild(i),a.appendChild(t);return a},multipolygon:function(e){return this.buildGeometry.collection.apply(this,[e])},collection:function(e){for(var t,i=this.createElementNS(this.kmlns,"MultiGeometry"),s=0,a=e.components.length;a>s;++s)t=this.buildGeometryNode.apply(this,[e.components[s]]),t&&i.appendChild(t);return i}},buildCoordinatesNode:function(e){var t,i=this.createElementNS(this.kmlns,"coordinates"),s=e.components;if(s){for(var a,r=s.length,n=Array(r),o=0;r>o;++o)a=s[o],n[o]=this.buildCoordinates(a);t=n.join(" ")}else t=this.buildCoordinates(e);var l=this.createTextNode(t);return i.appendChild(l),i},buildCoordinates:function(e){return this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection)),e.x+","+e.y},CLASS_NAME:"OpenLayers.Format.KML"}),OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],initialize:function(){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},split:function(e,t){for(var i,s,a,r,n,o=null,l=t&&t.mutual,h=[],u=[e],p=0,c=this.components.length;c>p;++p){s=this.components[p],r=!1;for(var d=0;u.length>d;++d)if(i=s.split(u[d],t)){if(l){a=i[0];for(var m=0,y=a.length;y>m;++m)0===m&&h.length?h[h.length-1].addComponent(a[m]):h.push(new OpenLayers.Geometry.MultiLineString([a[m]]));r=!0,i=i[1]}if(i.length){i.unshift(d,1),Array.prototype.splice.apply(u,i);break}}r||(h.length?h[h.length-1].addComponent(s.clone()):h=[new OpenLayers.Geometry.MultiLineString(s.clone())])}return h&&h.length>1?r=!0:h=[],u&&u.length>1?n=!0:u=[],(r||n)&&(o=l?[h,u]:u),o},splitWith:function(e,t){var i,s,a,r,n,o,l,h=null,u=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){l=[],o=[e];for(var p=0,c=this.components.length;c>p;++p){n=!1,s=this.components[p];for(var d=0;o.length>d;++d)if(i=o[d].split(s,t)){u&&(a=i[0],a.length&&(a.unshift(d,1),Array.prototype.splice.apply(o,a),d+=a.length-2),i=i[1],0===i.length&&(i=[s.clone()]));for(var m=0,y=i.length;y>m;++m)0===m&&l.length?l[l.length-1].addComponent(i[m]):l.push(new OpenLayers.Geometry.MultiLineString([i[m]]));n=!0}n||(l.length?l[l.length-1].addComponent(s.clone()):l=[new OpenLayers.Geometry.MultiLineString([s.clone()])])}}else h=e.split(this);return o&&o.length>1?r=!0:o=[],l&&l.length>1?n=!0:l=[],(r||n)&&(h=u?[o,l]:l),h},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"}),OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],initialize:function(){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var t=this.getElementsByTagNameNS(e.documentElement,this.gmlns,this.featureName),i=[],s=0;t.length>s;s++){var a=this.parseFeature(t[s]);a&&i.push(a)}return i},parseFeature:function(e){for(var t,i,s,a,r=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],n=0;r.length>n;++n)if(t=r[n],i=this.getElementsByTagNameNS(e,this.gmlns,t),i.length>0){a=this.parseGeometry[t.toLowerCase()],a?(s=a.apply(this,[i[0]]),this.internalProjection&&this.externalProjection&&s.transform(this.externalProjection,this.internalProjection)):OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:t}));break}var o,l=this.getElementsByTagNameNS(e,this.gmlns,"Box");for(n=0;l.length>n;++n){var h=l[n],u=this.parseGeometry.box.apply(this,[h]),p=h.parentNode,c=p.localName||p.nodeName.split(":").pop();"boundedBy"===c?o=u:s=u.toGeometry()}var d;this.extractAttributes&&(d=this.parseAttributes(e));var m=new OpenLayers.Feature.Vector(s,d);m.bounds=o,m.gml={featureType:e.firstChild.nodeName.split(":")[1],featureNS:e.firstChild.namespaceURI,featureNSPrefix:e.firstChild.prefix};for(var y,f=e.firstChild;f&&(1!=f.nodeType||!(y=f.getAttribute("fid")||f.getAttribute("id")));)f=f.nextSibling;return m.fid=y,m},parseGeometry:{point:function(e){var t,i,s=[],t=this.getElementsByTagNameNS(e,this.gmlns,"pos");if(t.length>0&&(i=t[0].firstChild.nodeValue,i=i.replace(this.regExes.trimSpace,""),s=i.split(this.regExes.splitSpace)),0==s.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),t.length>0&&(i=t[0].firstChild.nodeValue,i=i.replace(this.regExes.removeSpace,""),s=i.split(","))),0==s.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coord"),t.length>0)){var a=this.getElementsByTagNameNS(t[0],this.gmlns,"X"),r=this.getElementsByTagNameNS(t[0],this.gmlns,"Y");a.length>0&&r.length>0&&(s=[a[0].firstChild.nodeValue,r[0].firstChild.nodeValue])}return 2==s.length&&(s[2]=null),this.xy?new OpenLayers.Geometry.Point(s[0],s[1],s[2]):new OpenLayers.Geometry.Point(s[1],s[0],s[2])},multipoint:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Point"),i=[];if(t.length>0)for(var s,a=0;t.length>a;++a)s=this.parseGeometry.point.apply(this,[t[a]]),s&&i.push(s);return new OpenLayers.Geometry.MultiPoint(i)},linestring:function(e,t){var i,s,a=[],r=[];
if(i=this.getElementsByTagNameNS(e,this.gmlns,"posList"),i.length>0){s=this.getChildValue(i[0]),s=s.replace(this.regExes.trimSpace,""),a=s.split(this.regExes.splitSpace);for(var n,o,l,h,u=parseInt(i[0].getAttribute("dimension")),p=0;a.length/u>p;++p)n=p*u,o=a[n],l=a[n+1],h=2==u?null:a[n+2],this.xy?r.push(new OpenLayers.Geometry.Point(o,l,h)):r.push(new OpenLayers.Geometry.Point(l,o,h))}if(0==a.length&&(i=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),i.length>0)){s=this.getChildValue(i[0]),s=s.replace(this.regExes.trimSpace,""),s=s.replace(this.regExes.trimComma,",");for(var c=s.split(this.regExes.splitSpace),p=0;c.length>p;++p)a=c[p].split(","),2==a.length&&(a[2]=null),this.xy?r.push(new OpenLayers.Geometry.Point(a[0],a[1],a[2])):r.push(new OpenLayers.Geometry.Point(a[1],a[0],a[2]))}var d=null;return 0!=r.length&&(d=t?new OpenLayers.Geometry.LinearRing(r):new OpenLayers.Geometry.LineString(r)),d},multilinestring:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LineString"),i=[];if(t.length>0)for(var s,a=0;t.length>a;++a)s=this.parseGeometry.linestring.apply(this,[t[a]]),s&&i.push(s);return new OpenLayers.Geometry.MultiLineString(i)},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LinearRing"),i=[];if(t.length>0)for(var s,a=0;t.length>a;++a)s=this.parseGeometry.linestring.apply(this,[t[a],!0]),s&&i.push(s);return new OpenLayers.Geometry.Polygon(i)},multipolygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Polygon"),i=[];if(t.length>0)for(var s,a=0;t.length>a;++a)s=this.parseGeometry.polygon.apply(this,[t[a]]),s&&i.push(s);return new OpenLayers.Geometry.MultiPolygon(i)},envelope:function(e){var t,i,s=[],a=this.getElementsByTagNameNS(e,this.gmlns,"lowerCorner");if(a.length>0){var r=[];if(a.length>0&&(t=a[0].firstChild.nodeValue,t=t.replace(this.regExes.trimSpace,""),r=t.split(this.regExes.splitSpace)),2==r.length&&(r[2]=null),this.xy)var n=new OpenLayers.Geometry.Point(r[0],r[1],r[2]);else var n=new OpenLayers.Geometry.Point(r[1],r[0],r[2])}var o=this.getElementsByTagNameNS(e,this.gmlns,"upperCorner");if(o.length>0){var r=[];if(o.length>0&&(t=o[0].firstChild.nodeValue,t=t.replace(this.regExes.trimSpace,""),r=t.split(this.regExes.splitSpace)),2==r.length&&(r[2]=null),this.xy)var l=new OpenLayers.Geometry.Point(r[0],r[1],r[2]);else var l=new OpenLayers.Geometry.Point(r[1],r[0],r[2])}if(n&&l){s.push(new OpenLayers.Geometry.Point(n.x,n.y)),s.push(new OpenLayers.Geometry.Point(l.x,n.y)),s.push(new OpenLayers.Geometry.Point(l.x,l.y)),s.push(new OpenLayers.Geometry.Point(n.x,l.y)),s.push(new OpenLayers.Geometry.Point(n.x,n.y));var h=new OpenLayers.Geometry.LinearRing(s);i=new OpenLayers.Geometry.Polygon([h])}return i},box:function(e){var t,i,s=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),a=null,r=null;return s.length>0&&(t=s[0].firstChild.nodeValue,i=t.split(" "),2==i.length&&(a=i[0].split(","),r=i[1].split(","))),null!==a&&null!==r?new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(r[0]),parseFloat(r[1])):void 0}},parseAttributes:function(e){for(var t,i,s,a,r,n,o,l={},h=e.firstChild;h;){if(1==h.nodeType){for(t=h.childNodes,i=0;t.length>i;++i)s=t[i],1==s.nodeType&&(a=s.childNodes,1==a.length?(r=a[0],(3==r.nodeType||4==r.nodeType)&&(n=s.prefix?s.nodeName.split(":")[1]:s.nodeName,o=r.nodeValue.replace(this.regExes.trimSpace,""),l[n]=o)):l[s.nodeName.split(":").pop()]=null);break}h=h.nextSibling}return l},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),i=0;e.length>i;i++)t.appendChild(this.createFeatureXML(e[i]));return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=e.geometry,i=this.buildGeometryNode(t),s=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);s.appendChild(i);var a=this.createElementNS(this.gmlns,"gml:"+this.featureName),r=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),n=e.fid||e.id;r.setAttribute("fid",n),r.appendChild(s);for(var o in e.attributes){var l=this.createTextNode(e.attributes[o]),h=o.substring(o.lastIndexOf(":")+1),u=this.createElementNS(this.featureNS,this.featurePrefix+":"+h);u.appendChild(l),r.appendChild(u)}return a.appendChild(r),a},buildGeometryNode:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t=e.CLASS_NAME,i=t.substring(t.lastIndexOf(".")+1),s=this.buildGeometry[i.toLowerCase()];return s.apply(this,[e])},buildGeometry:{point:function(e){var t=this.createElementNS(this.gmlns,"gml:Point");return t.appendChild(this.buildCoordinatesNode(e)),t},multipoint:function(e){for(var t,i,s=this.createElementNS(this.gmlns,"gml:MultiPoint"),a=e.components,r=0;a.length>r;r++)t=this.createElementNS(this.gmlns,"gml:pointMember"),i=this.buildGeometry.point.apply(this,[a[r]]),t.appendChild(i),s.appendChild(t);return s},linestring:function(e){var t=this.createElementNS(this.gmlns,"gml:LineString");return t.appendChild(this.buildCoordinatesNode(e)),t},multilinestring:function(e){for(var t,i,s=this.createElementNS(this.gmlns,"gml:MultiLineString"),a=e.components,r=0;a.length>r;++r)t=this.createElementNS(this.gmlns,"gml:lineStringMember"),i=this.buildGeometry.linestring.apply(this,[a[r]]),t.appendChild(i),s.appendChild(t);return s},linearring:function(e){var t=this.createElementNS(this.gmlns,"gml:LinearRing");return t.appendChild(this.buildCoordinatesNode(e)),t},polygon:function(e){for(var t,i,s,a=this.createElementNS(this.gmlns,"gml:Polygon"),r=e.components,n=0;r.length>n;++n)s=0==n?"outerBoundaryIs":"innerBoundaryIs",t=this.createElementNS(this.gmlns,"gml:"+s),i=this.buildGeometry.linearring.apply(this,[r[n]]),t.appendChild(i),a.appendChild(t);return a},multipolygon:function(e){for(var t,i,s=this.createElementNS(this.gmlns,"gml:MultiPolygon"),a=e.components,r=0;a.length>r;++r)t=this.createElementNS(this.gmlns,"gml:polygonMember"),i=this.buildGeometry.polygon.apply(this,[a[r]]),t.appendChild(i),s.appendChild(t);return s},bounds:function(e){var t=this.createElementNS(this.gmlns,"gml:Box");return t.appendChild(this.buildCoordinatesNode(e)),t}},buildCoordinatesNode:function(e){var t=this.createElementNS(this.gmlns,"gml:coordinates");t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," ");var i=[];if(e instanceof OpenLayers.Bounds)i.push(e.left+","+e.bottom),i.push(e.right+","+e.top);else for(var s=e.components?e.components:[e],a=0;s.length>a;a++)i.push(s[a].x+","+s[a].y);var r=this.createTextNode(i.join(" "));return t.appendChild(r),t},CLASS_NAME:"OpenLayers.Format.GML"}),OpenLayers.Format.GML||(OpenLayers.Format.GML={}),OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.setGeometryTypes(),e&&e.featureNS&&this.setNamespace("feature",e.featureNS),this.singleFeatureType=!e||"string"==typeof e.featureType},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t=[];if(this.readNode(e,{features:t},!0),0==t.length){var i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember");if(i.length)for(var s=0,a=i.length;a>s;++s)this.readNode(i[s],{features:t},!0);else{var i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMembers");i.length&&this.readNode(i[0],{features:t},!0)}}return t},readNode:function(e,t,i){return i===!0&&this.autoConfig===!0&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null),this.featureNS||e.prefix in this.namespaces||e.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(e.parentNode.nodeName)||(this.featureType=e.nodeName.split(":").pop(),this.setNamespace("feature",e.namespaceURI),this.featureNS=e.namespaceURI,this.autoConfig=!0),OpenLayers.Format.XML.prototype.readNode.apply(this,[e,t])},readers:{gml:{featureMember:function(e,t){this.readChildNodes(e,t)},featureMembers:function(e,t){this.readChildNodes(e,t)},name:function(e,t){t.name=this.getChildValue(e)},boundedBy:function(e,t){var i={};this.readChildNodes(e,i),i.components&&i.components.length>0&&(t.bounds=i.components[0])},Point:function(e,t){var i={points:[]};this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(i.points[0])},coordinates:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");for(var s,a=i.split(this.regExes.splitSpace),r=a.length,n=Array(r),o=0;r>o;++o)s=a[o].split(","),n[o]=this.xy?new OpenLayers.Geometry.Point(s[0],s[1],s[2]):new OpenLayers.Geometry.Point(s[1],s[0],s[2]);t.points=n},coord:function(e,t){var i={};this.readChildNodes(e,i),t.points||(t.points=[]),t.points.push(new OpenLayers.Geometry.Point(i.x,i.y,i.z))},X:function(e,t){t.x=this.getChildValue(e)},Y:function(e,t){t.y=this.getChildValue(e)},Z:function(e,t){t.z=this.getChildValue(e)},MultiPoint:function(e,t){var i={components:[]};this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiPoint(i.components)]},pointMember:function(e,t){this.readChildNodes(e,t)},LineString:function(e,t){var i={};this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.LineString(i.points))},MultiLineString:function(e,t){var i={components:[]};this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiLineString(i.components)]},lineStringMember:function(e,t){this.readChildNodes(e,t)},Polygon:function(e,t){var i={outer:null,inner:[]};this.readChildNodes(e,i),i.inner.unshift(i.outer),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.Polygon(i.inner))},LinearRing:function(e,t){var i={};this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.LinearRing(i.points)]},MultiPolygon:function(e,t){var i={components:[]};this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiPolygon(i.components)]},polygonMember:function(e,t){this.readChildNodes(e,t)},GeometryCollection:function(e,t){var i={components:[]};this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.Collection(i.components)]},geometryMember:function(e,t){this.readChildNodes(e,t)}},feature:{"*":function(e,t){var i,s=e.localName||e.nodeName.split(":").pop();t.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,s)?s===this.featureType&&(i="_typeName"):i="_typeName":0==e.childNodes.length||1==e.childNodes.length&&3==e.firstChild.nodeType?this.extractAttributes&&(i="_attribute"):i="_geometry",i&&this.readers.feature[i].apply(this,[e,t])},_typeName:function(e,t){var i={components:[],attributes:{}};this.readChildNodes(e,i),i.name&&(i.attributes.name=i.name);var s=new OpenLayers.Feature.Vector(i.components[0],i.attributes);this.singleFeatureType||(s.type=e.nodeName.split(":").pop(),s.namespace=e.namespaceURI);var a=e.getAttribute("fid")||this.getAttributeNS(e,this.namespaces.gml,"id");a&&(s.fid=a),this.internalProjection&&this.externalProjection&&s.geometry&&s.geometry.transform(this.externalProjection,this.internalProjection),i.bounds&&(s.bounds=i.bounds),t.features.push(s)},_geometry:function(e,t){this.geometryName||(this.geometryName=e.nodeName.split(":").pop()),this.readChildNodes(e,t)},_attribute:function(e,t){var i=e.localName||e.nodeName.split(":").pop(),s=this.getChildValue(e);t.attributes[i]=s}},wfs:{FeatureCollection:function(e,t){this.readChildNodes(e,t)}}},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var i=this.writeNode("gml:"+t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:{featureMember:function(e){var t=this.createElementNSPlus("gml:featureMember");return this.writeNode("feature:_typeName",e,t),t},MultiPoint:function(e){for(var t=this.createElementNSPlus("gml:MultiPoint"),i=e.components||[e],s=0,a=i.length;a>s;++s)this.writeNode("pointMember",i[s],t);return t},pointMember:function(e){var t=this.createElementNSPlus("gml:pointMember");return this.writeNode("Point",e,t),t},MultiLineString:function(e){for(var t=this.createElementNSPlus("gml:MultiLineString"),i=e.components||[e],s=0,a=i.length;a>s;++s)this.writeNode("lineStringMember",i[s],t);return t},lineStringMember:function(e){var t=this.createElementNSPlus("gml:lineStringMember");return this.writeNode("LineString",e,t),t},MultiPolygon:function(e){for(var t=this.createElementNSPlus("gml:MultiPolygon"),i=e.components||[e],s=0,a=i.length;a>s;++s)this.writeNode("polygonMember",i[s],t);return t},polygonMember:function(e){var t=this.createElementNSPlus("gml:polygonMember");return this.writeNode("Polygon",e,t),t},GeometryCollection:function(e){for(var t=this.createElementNSPlus("gml:GeometryCollection"),i=0,s=e.components.length;s>i;++i)this.writeNode("geometryMember",e.components[i],t);return t},geometryMember:function(e){var t=this.createElementNSPlus("gml:geometryMember"),i=this.writeNode("feature:_geometry",e);return t.appendChild(i.firstChild),t}},feature:{_typeName:function(e){var t=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:e.fid}});e.geometry&&this.writeNode("feature:_geometry",e.geometry,t);for(var i in e.attributes){var s=e.attributes[i];null!=s&&this.writeNode("feature:_attribute",{name:i,value:s},t)}return t},_geometry:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone().transform(this.internalProjection,this.externalProjection));var t=this.createElementNSPlus("feature:"+this.geometryName),i=this.geometryTypes[e.CLASS_NAME],s=this.writeNode("gml:"+i,e,t);return this.srsName&&s.setAttribute("srsName",this.srsName),t},_attribute:function(e){return this.createElementNSPlus("feature:"+e.name,{value:e.value})}},wfs:{FeatureCollection:function(e){for(var t=this.createElementNSPlus("wfs:FeatureCollection"),i=0,s=e.length;s>i;++i)this.writeNode("gml:featureMember",e[i],t);return t}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"}),OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.outer=i.components[0]},innerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.inner.push(i.components[0])},Box:function(e,t){var i={};this.readChildNodes(e,i),t.components||(t.components=[]);var s=i.points[0],a=i.points[1];t.components.push(new OpenLayers.Bounds(s.x,s.y,a.x,a.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"wfs:FeatureCollection":"gml:featureMember";var i=this.writeNode(t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(e){var t=this.createElementNSPlus("gml:Point");return this.writeNode("coordinates",[e],t),t},coordinates:function(e){for(var t,i=e.length,s=Array(i),a=0;i>a;++a)t=e[a],s[a]=this.xy?t.x+","+t.y:t.y+","+t.x,void 0!=t.z&&(s[a]+=","+t.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==i?s[0]:s.join(" ")})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");return this.writeNode("coordinates",e.components,t),t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",e.components[0],t);for(var i=1;e.components.length>i;++i)this.writeNode("innerBoundaryIs",e.components[i],t);return t},outerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:outerBoundaryIs");return this.writeNode("LinearRing",e,t),t},innerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:innerBoundaryIs");return this.writeNode("LinearRing",e,t),t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");return this.writeNode("coordinates",e.components,t),t},Box:function(e){var t=this.createElementNSPlus("gml:Box");return this.writeNode("coordinates",[{x:e.left,y:e.bottom},{x:e.right,y:e.top}],t),this.srsName&&t.setAttribute("srsName",this.srsName),t}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"}),OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.rules=[],t&&t.rules&&this.addRules(t.rules),this.setDefaultStyle(e||OpenLayers.Feature.Vector.style["default"]),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;t>e;e++)this.rules[e].destroy(),this.rules[e]=null;this.rules=null,this.defaultStyle=null},createSymbolizer:function(e){for(var t,i=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),e),s=this.rules,a=[],r=!1,n=0,o=s.length;o>n;n++){t=s[n];var l=t.evaluate(e);l&&(t instanceof OpenLayers.Rule&&t.elseFilter?a.push(t):(r=!0,this.applySymbolizer(t,i,e)))}if(0==r&&a.length>0){r=!0;for(var n=0,o=a.length;o>n;n++)this.applySymbolizer(a[n],i,e)}return s.length>0&&0==r&&(i.display="none"),i.label&&"string"!=typeof i.label&&(i.label=i.label+""),i},applySymbolizer:function(e,t,i){var s=i.geometry?this.getSymbolizerPrefix(i.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],a=e.symbolizer[s]||e.symbolizer;if(this.defaultsPerSymbolizer===!0){var r=this.defaultStyle;OpenLayers.Util.applyDefaults(a,{pointRadius:r.pointRadius}),(a.stroke===!0||a.graphic===!0)&&OpenLayers.Util.applyDefaults(a,{strokeWidth:r.strokeWidth,strokeColor:r.strokeColor,strokeOpacity:r.strokeOpacity,strokeDashstyle:r.strokeDashstyle,strokeLinecap:r.strokeLinecap}),(a.fill===!0||a.graphic===!0)&&OpenLayers.Util.applyDefaults(a,{fillColor:r.fillColor,fillOpacity:r.fillOpacity}),a.graphic===!0&&OpenLayers.Util.applyDefaults(a,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}return this.createLiterals(OpenLayers.Util.extend(t,a),i)},createLiterals:function(e,t){var i=OpenLayers.Util.extend({},t.attributes||t.data);OpenLayers.Util.extend(i,this.context);for(var s in this.propertyStyles)e[s]=OpenLayers.Style.createLiteral(e[s],i,t,s);return e},findPropertyStyles:function(){var e={},t=this.defaultStyle;this.addPropertyStyles(e,t);for(var i,s,a=this.rules,r=0,n=a.length;n>r;r++){i=a[r].symbolizer;for(var o in i){if(s=i[o],"object"!=typeof s){this.addPropertyStyles(e,i);break}this.addPropertyStyles(e,s)}}return e},addPropertyStyles:function(e,t){var i;for(var s in t)i=t[s],"string"==typeof i&&i.match(/\$\{\w+\}/)&&(e[s]=!0);return e},addRules:function(e){Array.prototype.push.apply(this.rules,e),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(e){this.defaultStyle=e,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(e){for(var t=OpenLayers.Style.SYMBOLIZER_PREFIXES,i=0,s=t.length;s>i;i++)if(-1!=e.CLASS_NAME.indexOf(t[i]))return t[i]},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,i=this.rules.length;i>t;++t)e.rules.push(this.rules[t].clone())}e.context=this.context&&OpenLayers.Util.extend({},this.context);var s=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(s,e)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(e,t,i,s){return"string"==typeof e&&-1!=e.indexOf("${")&&(e=OpenLayers.String.format(e,t,[i,s]),e=isNaN(e)||!e?e:parseFloat(e)),e},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(e){OpenLayers.Util.extend(this,e)},clone:function(){var Type=eval(this.CLASS_NAME);return new Type(OpenLayers.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"}),OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"}),OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"}),OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"}),OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"}),OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"}),OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(e){this.symbolizer={},OpenLayers.Util.extend(this,e),this.symbolizers&&delete this.symbolizer,this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e in this.symbolizer)this.symbolizer[e]=null;this.symbolizer=null,delete this.symbolizers},evaluate:function(e){var t=this.getContext(e),i=!0;if(this.minScaleDenominator||this.maxScaleDenominator)var s=e.layer.map.getScale();return this.minScaleDenominator&&(i=s>=OpenLayers.Style.createLiteral(this.minScaleDenominator,t)),i&&this.maxScaleDenominator&&(i=OpenLayers.Style.createLiteral(this.maxScaleDenominator,t)>s),i&&this.filter&&(i="OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?this.filter.evaluate(e):this.filter.evaluate(t)),i},getContext:function(e){var t=this.context;return t||(t=e.attributes||e.data),"function"==typeof this.context&&(t=this.context(e)),t},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.symbolizers){var t=this.symbolizers.length;e.symbolizers=Array(t);for(var i=0;t>i;++i)e.symbolizers[i]=this.symbolizers[i].clone()}else{e.symbolizer={};var s,a;for(var r in this.symbolizer)s=this.symbolizer[r],a=typeof s,"object"===a?e.symbolizer[r]=OpenLayers.Util.extend({},s):"string"===a&&(e.symbolizer[r]=s)}return e.filter=this.filter&&this.filter.clone(),e.context=this.context&&OpenLayers.Util.extend({},this.context),new OpenLayers.Rule(e)},CLASS_NAME:"OpenLayers.Rule"}),OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=e.documentElement,i={exceptionReport:null};return t&&(this.readChildNodes(e,i),null===i.exceptionReport&&(i=(new OpenLayers.Format.OWSCommon).read(e))),i},readers:{ogc:{ServiceExceptionReport:function(e,t){t.exceptionReport={exceptions:[]},this.readChildNodes(e,t.exceptionReport)},ServiceException:function(e,t){var i={code:e.getAttribute("code"),locator:e.getAttribute("locator"),text:this.getChildValue(e)};t.exceptions.push(i)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"}),OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,errorProperty:null,name:null,stringifyOutput:!1,parser:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);var t=this.CLASS_NAME;this.name=t.substring(t.lastIndexOf(".")+1)},getVersion:function(e,t){var i;return e?(i=this.version,i||(i=e.getAttribute("version"),i||(i=this.defaultVersion))):i=t&&t.version||this.version||this.defaultVersion,i},getParser:function(e){e=e||this.defaultVersion;var t=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=e){var i=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")+t];if(!i)throw"Can't find a "+this.name+" parser for version "+e+t;this.parser=new i(this.options)}return this.parser},write:function(e,t){var i=this.getVersion(null,t);this.parser=this.getParser(i);var s=this.parser.write(e,t);return this.stringifyOutput===!1?s:OpenLayers.Format.XML.prototype.write.apply(this,[s])},read:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var i=e.documentElement,s=this.getVersion(i);this.parser=this.getParser(s);var a=this.parser.read(e,t);if(null!==this.errorProperty&&void 0===a[this.errorProperty]){var r=new OpenLayers.Format.OGCExceptionReport;a.error=r.read(e)}return a.version=s,a},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"}),OpenLayers.Filter=OpenLayers.Class({initialize:function(e){OpenLayers.Util.extend(this,e)},destroy:function(){},evaluate:function(){return!0},clone:function(){return null},CLASS_NAME:"OpenLayers.Filter"}),OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(e){this.fids=[],OpenLayers.Filter.prototype.initialize.apply(this,[e])},evaluate:function(e){for(var t=0,i=this.fids.length;i>t;t++){var s=e.fid||e.id;if(s==this.fids[t])return!0}return!1},clone:function(){var e=new OpenLayers.Filter.FeatureId;return OpenLayers.Util.extend(e,this),e.fids=this.fids.slice(),e},CLASS_NAME:"OpenLayers.Filter.FeatureId"}),OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(e){this.filters=[],OpenLayers.Filter.prototype.initialize.apply(this,[e])},destroy:function(){this.filters=null,OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(e){var t,i;switch(this.type){case OpenLayers.Filter.Logical.AND:for(t=0,i=this.filters.length;i>t;t++)if(0==this.filters[t].evaluate(e))return!1;return!0;case OpenLayers.Filter.Logical.OR:for(t=0,i=this.filters.length;i>t;t++)if(1==this.filters[t].evaluate(e))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(e)}return void 0},clone:function(){for(var e=[],t=0,i=this.filters.length;i>t;++t)e.push(this.filters[t].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:e})},CLASS_NAME:"OpenLayers.Filter.Logical"}),OpenLayers.Filter.Logical.AND="&&",OpenLayers.Filter.Logical.OR="||",OpenLayers.Filter.Logical.NOT="!",OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(e){OpenLayers.Filter.prototype.initialize.apply(this,[e]),this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===e.matchCase&&(this.matchCase=null)},evaluate:function(e){e instanceof OpenLayers.Feature.Vector&&(e=e.attributes);var t,i=!1,s=e[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:t=this.value,i=this.matchCase||"string"!=typeof s||"string"!=typeof t?s==t:s.toUpperCase()==t.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:t=this.value,i=this.matchCase||"string"!=typeof s||"string"!=typeof t?s!=t:s.toUpperCase()!=t.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:i=this.value>s;break;case OpenLayers.Filter.Comparison.GREATER_THAN:i=s>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:i=this.value>=s;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:i=s>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:i=s>=this.lowerBoundary&&this.upperBoundary>=s;break;case OpenLayers.Filter.Comparison.LIKE:var a=RegExp(this.value,"gi");i=a.test(s)}return i},value2regex:function(e,t,i){if("."==e){var s="'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison";return OpenLayers.Console.error(s),null}return e=e?e:"*",t=t?t:".",i=i?i:"!",this.value=this.value.replace(RegExp("\\"+i+"(.|$)","g"),"\\$1"),this.value=this.value.replace(RegExp("\\"+t,"g"),"."),this.value=this.value.replace(RegExp("\\"+e,"g"),".*"),this.value=this.value.replace(RegExp("\\\\.\\*","g"),"\\"+e),this.value=this.value.replace(RegExp("\\\\\\.","g"),"\\"+t),this.value},regex2value:function(){var e=this.value;return e=e.replace(/!/g,"!!"),e=e.replace(/(\\)?\\\./g,function(e,t){return t?e:"!."}),e=e.replace(/(\\)?\\\*/g,function(e,t){return t?e:"!*"}),e=e.replace(/\\\\/g,"\\"),e=e.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"}),OpenLayers.Filter.Comparison.EQUAL_TO="==",OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=",OpenLayers.Filter.Comparison.LESS_THAN="<",OpenLayers.Filter.Comparison.GREATER_THAN=">",OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=",OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=",OpenLayers.Filter.Comparison.BETWEEN="..",OpenLayers.Filter.Comparison.LIKE="~",OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,initialize:function(e){OpenLayers.Filter.prototype.initialize.apply(this,[e])},evaluate:function(e){var t=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(e.geometry){var i=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(i=this.value.toGeometry()),e.geometry.intersects(i)&&(t=!0)}break;default:OpenLayers.Console.error(OpenLayers.i18n("filterEvaluateNotImplemented"))}return t},clone:function(){var e=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(e)},CLASS_NAME:"OpenLayers.Filter.Spatial"}),OpenLayers.Filter.Spatial.BBOX="BBOX",OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS",OpenLayers.Filter.Spatial.DWITHIN="DWITHIN",OpenLayers.Filter.Spatial.WITHIN="WITHIN",OpenLayers.Filter.Spatial.CONTAINS="CONTAINS",OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:"OpenLayers.Format.SLD"}),OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"}),OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,initialize:function(e){OpenLayers.Filter.prototype.initialize.apply(this,[e])},CLASS_NAME:"OpenLayers.Filter.Function"}),OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])
},read:function(e){var t={};return this.readers.ogc.Filter.apply(this,[e,t]),t.filter},readers:{ogc:{Filter:function(e,t){var i={fids:[],filters:[]};this.readChildNodes(e,i),i.fids.length>0?t.filter=new OpenLayers.Filter.FeatureId({fids:i.fids}):i.filters.length>0&&(t.filter=i.filters[0])},FeatureId:function(e,t){var i=e.getAttribute("fid");i&&t.fids.push(i)},And:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(e,i),t.filters.push(i)},Or:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(e,i),t.filters.push(i)},Not:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsBetween:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(e,i),t.filters.push(i)},Literal:function(e,t){t.value=OpenLayers.String.numericIf(this.getChildValue(e))},PropertyName:function(e,t){t.property=this.getChildValue(e)},LowerBoundary:function(e,t){t.lowerBoundary=OpenLayers.String.numericIf(this.readOgcExpression(e))},UpperBoundary:function(e,t){t.upperBoundary=OpenLayers.String.numericIf(this.readOgcExpression(e))},Intersects:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(e,t){t.distance=parseInt(this.getChildValue(e)),t.distanceUnits=e.getAttribute("units")},Function:function(){}}},readSpatial:function(e,t,i){var s=new OpenLayers.Filter.Spatial({type:i});this.readChildNodes(e,s),s.value=s.components[0],delete s.components,t.filters.push(s)},readOgcExpression:function(e){var t={};this.readChildNodes(e,t);var i=t.value;return void 0===i&&(i=this.getChildValue(e)),i},writeOgcExpression:function(e,t){if(e instanceof OpenLayers.Filter.Function){var i=this.writeNode("Function",e,t);t.appendChild(i)}else this.writeNode("Literal",e,t);return t},write:function(e){return this.writers.ogc.Filter.apply(this,[e])},writeFeatureIdNodes:function(e,t){for(var i=0,s=e.fids.length;s>i;++i)this.writeNode("FeatureId",e.fids[i],t)},writers:{ogc:{Filter:function(e){var t=this.createElementNSPlus("ogc:Filter");return"FID"===e.type?this.writeFeatureIdNodes(e,t):this.writeNode(this.getFilterType(e),e,t),t},FeatureId:function(e){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:e}})},And:function(e){for(var t,i=this.createElementNSPlus("ogc:And"),s=0,a=e.filters.length;a>s;++s)t=e.filters[s],"FID"===t.type?this.writeFeatureIdNodes(t,i):this.writeNode(this.getFilterType(t),t,i);return i},Or:function(e){for(var t,i=this.createElementNSPlus("ogc:Or"),s=0,a=e.filters.length;a>s;++s)t=e.filters[s],"FID"===t.type?this.writeFeatureIdNodes(t,i):this.writeNode(this.getFilterType(t),t,i);return i},Not:function(e){var t=this.createElementNSPlus("ogc:Not"),i=e.filters[0];return"FID"===i.type?this.writeFeatureIdNodes(i,t):this.writeNode(this.getFilterType(i),i,t),t},PropertyIsLessThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLessThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsBetween:function(e){var t=this.createElementNSPlus("ogc:PropertyIsBetween");return this.writeNode("PropertyName",e,t),this.writeNode("LowerBoundary",e,t),this.writeNode("UpperBoundary",e,t),t},PropertyName:function(e){return this.createElementNSPlus("ogc:PropertyName",{value:e.property})},Literal:function(e){return this.createElementNSPlus("ogc:Literal",{value:e})},LowerBoundary:function(e){var t=this.createElementNSPlus("ogc:LowerBoundary");return this.writeOgcExpression(e.lowerBoundary,t),t},UpperBoundary:function(e){var t=this.createElementNSPlus("ogc:UpperBoundary");return this.writeNode("Literal",e.upperBoundary,t),t},INTERSECTS:function(e){return this.writeSpatial(e,"Intersects")},WITHIN:function(e){return this.writeSpatial(e,"Within")},CONTAINS:function(e){return this.writeSpatial(e,"Contains")},DWITHIN:function(e){var t=this.writeSpatial(e,"DWithin");return this.writeNode("Distance",e,t),t},Distance:function(e){return this.createElementNSPlus("ogc:Distance",{attributes:{units:e.distanceUnits},value:e.distance})},Function:function(e){for(var t=this.createElementNSPlus("ogc:Function",{attributes:{name:e.name}}),i=e.params,s=0,a=i.length;a>s;s++)this.writeOgcExpression(i[s],t);return t}}},getFilterType:function(e){var t=this.filterMap[e.type];if(!t)throw"Filter writing not supported for rule type: "+e.type;return t},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"FeatureId"},CLASS_NAME:"OpenLayers.Format.Filter.v1"}),OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsNotEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLike:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,i);var s=e.getAttribute("wildCard"),a=e.getAttribute("singleChar"),r=e.getAttribute("escape");i.value2regex(s,a,r),t.filters.push(i)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});return this.writeNode("PropertyName",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Box",e.value,t);return e.projection&&i.setAttribute("srsName",e.projection),t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(e,t){var i=this.createElementNSPlus("ogc:"+t);if(this.writeNode("PropertyName",e,i),e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,i);else{var s;s=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Box",e.value),e.projection&&s.setAttribute("srsName",e.projection),i.appendChild(s)}return i},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"}),OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},initialize:function(e){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[e])},read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i={namedLayers:t.namedLayersAsArray===!0?[]:{}};return this.readChildNodes(e,i),i},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(e,t){t.version=e.getAttribute("version"),this.readChildNodes(e,t)},Name:function(e,t){t.name=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t.description=this.getChildValue(e)},NamedLayer:function(e,t){var i={userStyles:[],namedStyles:[]};this.readChildNodes(e,i);for(var s=0,a=i.userStyles.length;a>s;++s)i.userStyles[s].layerName=i.name;OpenLayers.Util.isArray(t.namedLayers)?t.namedLayers.push(i):t.namedLayers[i.name]=i},NamedStyle:function(e,t){t.namedStyles.push(this.getChildName(e.firstChild))},UserStyle:function(e,t){var i={defaultsPerSymbolizer:!0,rules:[]};this.featureTypeCounter=-1,this.readChildNodes(e,i);var s;this.multipleSymbolizers?(delete i.defaultsPerSymbolizer,s=new OpenLayers.Style2(i)):s=new OpenLayers.Style(this.defaultSymbolizer,i),t.userStyles.push(s)},IsDefault:function(e,t){"1"==this.getChildValue(e)&&(t.isDefault=!0)},FeatureTypeStyle:function(e,t){++this.featureTypeCounter;var i={rules:this.multipleSymbolizers?t.rules:[]};this.readChildNodes(e,i),this.multipleSymbolizers||(t.rules=i.rules)},Rule:function(e,t){var i;this.multipleSymbolizers&&(i={symbolizers:[]});var s=new OpenLayers.Rule(i);this.readChildNodes(e,s),t.rules.push(s)},ElseFilter:function(e,t){t.elseFilter=!0},MinScaleDenominator:function(e,t){t.minScaleDenominator=parseFloat(this.getChildValue(e))},MaxScaleDenominator:function(e,t){t.maxScaleDenominator=parseFloat(this.getChildValue(e))},TextSymbolizer:function(e,t){var i={};this.readChildNodes(e,i),this.multipleSymbolizers?(i.zIndex=this.featureTypeCounter,t.symbolizers.push(new OpenLayers.Symbolizer.Text(i))):t.symbolizer.Text=OpenLayers.Util.applyDefaults(i,t.symbolizer.Text)},Label:function(e,t){var i={};if(this.readChildNodes(e,i),i.property)t.label="${"+i.property+"}";else{var s=this.readOgcExpression(e);s&&(t.label=s)}},Font:function(e,t){this.readChildNodes(e,t)},Halo:function(e,t){var i={};this.readChildNodes(e,i),t.haloRadius=i.haloRadius,t.haloColor=i.fillColor,t.haloOpacity=i.fillOpacity},Radius:function(e,t){var i=this.readOgcExpression(e);null!=i&&(t.haloRadius=i)},RasterSymbolizer:function(e,t){var i={};this.readChildNodes(e,i),this.multipleSymbolizers?(i.zIndex=this.featureTypeCounter,t.symbolizers.push(new OpenLayers.Symbolizer.Raster(i))):t.symbolizer.Raster=OpenLayers.Util.applyDefaults(i,t.symbolizer.Raster)},Geometry:function(e,t){t.geometry={},this.readChildNodes(e,t.geometry)},ColorMap:function(e,t){t.colorMap=[],this.readChildNodes(e,t.colorMap)},ColorMapEntry:function(e,t){var i=e.getAttribute("quantity"),s=e.getAttribute("opacity");t.push({color:e.getAttribute("color"),quantity:null!==i?parseFloat(i):void 0,label:e.getAttribute("label")||void 0,opacity:null!==s?parseFloat(s):void 0})},LineSymbolizer:function(e,t){var i={};this.readChildNodes(e,i),this.multipleSymbolizers?(i.zIndex=this.featureTypeCounter,t.symbolizers.push(new OpenLayers.Symbolizer.Line(i))):t.symbolizer.Line=OpenLayers.Util.applyDefaults(i,t.symbolizer.Line)},PolygonSymbolizer:function(e,t){var i={fill:!1,stroke:!1};this.multipleSymbolizers||(i=t.symbolizer.Polygon||i),this.readChildNodes(e,i),this.multipleSymbolizers?(i.zIndex=this.featureTypeCounter,t.symbolizers.push(new OpenLayers.Symbolizer.Polygon(i))):t.symbolizer.Polygon=i},PointSymbolizer:function(e,t){var i={fill:!1,stroke:!1,graphic:!1};this.multipleSymbolizers||(i=t.symbolizer.Point||i),this.readChildNodes(e,i),this.multipleSymbolizers?(i.zIndex=this.featureTypeCounter,t.symbolizers.push(new OpenLayers.Symbolizer.Point(i))):t.symbolizer.Point=i},Stroke:function(e,t){t.stroke=!0,this.readChildNodes(e,t)},Fill:function(e,t){t.fill=!0,this.readChildNodes(e,t)},CssParameter:function(e,t){var i=e.getAttribute("name"),s=this.cssMap[i];if(s){var a=this.readOgcExpression(e);a&&(t[s]=a)}},Graphic:function(e,t){t.graphic=!0;var i={};this.readChildNodes(e,i);for(var s,a,r=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"],n=0,o=r.length;o>n;++n)s=r[n],a=i[s],void 0!=a&&(t[s]=a);void 0!=i.opacity&&(t.graphicOpacity=i.opacity),void 0!=i.size&&(t.pointRadius=i.size/2),void 0!=i.href&&(t.externalGraphic=i.href),void 0!=i.rotation&&(t.rotation=i.rotation)},ExternalGraphic:function(e,t){this.readChildNodes(e,t)},Mark:function(e,t){this.readChildNodes(e,t)},WellKnownName:function(e,t){t.graphicName=this.getChildValue(e)},Opacity:function(e,t){var i=this.readOgcExpression(e);i&&(t.opacity=i)},Size:function(e,t){var i=this.readOgcExpression(e);i&&(t.size=i)},Rotation:function(e,t){var i=this.readOgcExpression(e);i&&(t.rotation=i)},OnlineResource:function(e,t){t.href=this.getAttributeNS(e,this.namespaces.xlink,"href")},Format:function(e,t){t.graphicFormat=this.getChildValue(e)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(e){var t=null;for(var i in this.cssMap)if(this.cssMap[i]==e){t=i;break}return t},getGraphicFormat:function(e){var t;for(var i in this.graphicFormats)if(this.graphicFormats[i].test(e)){t=i;break}return t||this.defautlGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(e){return this.writers.sld.StyledLayerDescriptor.apply(this,[e])},writers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(e){var t=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});if(t.setAttribute("xmlns:ogc",this.namespaces.ogc),t.setAttribute("xmlns:gml",this.namespaces.gml),e.name&&this.writeNode("Name",e.name,t),e.title&&this.writeNode("Title",e.title,t),e.description&&this.writeNode("Abstract",e.description,t),OpenLayers.Util.isArray(e.namedLayers))for(var i=0,s=e.namedLayers.length;s>i;++i)this.writeNode("NamedLayer",e.namedLayers[i],t);else for(var a in e.namedLayers)this.writeNode("NamedLayer",e.namedLayers[a],t);return t},Name:function(e){return this.createElementNSPlus("sld:Name",{value:e})},Title:function(e){return this.createElementNSPlus("sld:Title",{value:e})},Abstract:function(e){return this.createElementNSPlus("sld:Abstract",{value:e})},NamedLayer:function(e){var t=this.createElementNSPlus("sld:NamedLayer");if(this.writeNode("Name",e.name,t),e.namedStyles)for(var i=0,s=e.namedStyles.length;s>i;++i)this.writeNode("NamedStyle",e.namedStyles[i],t);if(e.userStyles)for(var i=0,s=e.userStyles.length;s>i;++i)this.writeNode("UserStyle",e.userStyles[i],t);return t},NamedStyle:function(e){var t=this.createElementNSPlus("sld:NamedStyle");return this.writeNode("Name",e,t),t},UserStyle:function(e){var t=this.createElementNSPlus("sld:UserStyle");if(e.name&&this.writeNode("Name",e.name,t),e.title&&this.writeNode("Title",e.title,t),e.description&&this.writeNode("Abstract",e.description,t),e.isDefault&&this.writeNode("IsDefault",e.isDefault,t),this.multipleSymbolizers&&e.rules){for(var i,s,a,r,n,o={0:[]},l=[0],h=0,u=e.rules.length;u>h;++h)if(i=e.rules[h],i.symbolizers){s={};for(var p=0,c=i.symbolizers.length;c>p;++p)a=i.symbolizers[p],r=a.zIndex,r in s||(n=i.clone(),n.symbolizers=[],s[r]=n),s[r].symbolizers.push(a.clone());for(r in s)r in o||(l.push(r),o[r]=[]),o[r].push(s[r])}else o[0].push(i.clone());l.sort();for(var d,h=0,u=l.length;u>h;++h)d=o[l[h]],d.length>0&&(n=e.clone(),n.rules=o[l[h]],this.writeNode("FeatureTypeStyle",n,t))}else this.writeNode("FeatureTypeStyle",e,t);return t},IsDefault:function(e){return this.createElementNSPlus("sld:IsDefault",{value:e?"1":"0"})},FeatureTypeStyle:function(e){for(var t=this.createElementNSPlus("sld:FeatureTypeStyle"),i=0,s=e.rules.length;s>i;++i)this.writeNode("Rule",e.rules[i],t);return t},Rule:function(e){var t=this.createElementNSPlus("sld:Rule");e.name&&this.writeNode("Name",e.name,t),e.title&&this.writeNode("Title",e.title,t),e.description&&this.writeNode("Abstract",e.description,t),e.elseFilter?this.writeNode("ElseFilter",null,t):e.filter&&this.writeNode("ogc:Filter",e.filter,t),void 0!=e.minScaleDenominator&&this.writeNode("MinScaleDenominator",e.minScaleDenominator,t),void 0!=e.maxScaleDenominator&&this.writeNode("MaxScaleDenominator",e.maxScaleDenominator,t);var i,s;if(this.multipleSymbolizers&&e.symbolizers)for(var s,a=0,r=e.symbolizers.length;r>a;++a)s=e.symbolizers[a],i=s.CLASS_NAME.split(".").pop(),this.writeNode(i+"Symbolizer",s,t);else for(var n=OpenLayers.Style.SYMBOLIZER_PREFIXES,a=0,o=n.length;o>a;++a)i=n[a],s=e.symbolizer[i],s&&this.writeNode(i+"Symbolizer",s,t);return t},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(e){return this.createElementNSPlus("sld:MinScaleDenominator",{value:e})},MaxScaleDenominator:function(e){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:e})},LineSymbolizer:function(e){var t=this.createElementNSPlus("sld:LineSymbolizer");return this.writeNode("Stroke",e,t),t},Stroke:function(e){var t=this.createElementNSPlus("sld:Stroke");return void 0!=e.strokeColor&&this.writeNode("CssParameter",{symbolizer:e,key:"strokeColor"},t),void 0!=e.strokeOpacity&&this.writeNode("CssParameter",{symbolizer:e,key:"strokeOpacity"},t),void 0!=e.strokeWidth&&this.writeNode("CssParameter",{symbolizer:e,key:"strokeWidth"},t),void 0!=e.strokeDashstyle&&"solid"!==e.strokeDashstyle&&this.writeNode("CssParameter",{symbolizer:e,key:"strokeDashstyle"},t),void 0!=e.strokeLinecap&&this.writeNode("CssParameter",{symbolizer:e,key:"strokeLinecap"},t),t},CssParameter:function(e){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(e.key)},value:e.symbolizer[e.key]})},TextSymbolizer:function(e){var t=this.createElementNSPlus("sld:TextSymbolizer");return null!=e.label&&this.writeNode("Label",e.label,t),(null!=e.fontFamily||null!=e.fontSize||null!=e.fontWeight||null!=e.fontStyle)&&this.writeNode("Font",e,t),(null!=e.haloRadius||null!=e.haloColor||null!=e.haloOpacity)&&this.writeNode("Halo",e,t),(null!=e.fillColor||null!=e.fillOpacity)&&this.writeNode("Fill",e,t),t},Font:function(e){var t=this.createElementNSPlus("sld:Font");return e.fontFamily&&this.writeNode("CssParameter",{symbolizer:e,key:"fontFamily"},t),e.fontSize&&this.writeNode("CssParameter",{symbolizer:e,key:"fontSize"},t),e.fontWeight&&this.writeNode("CssParameter",{symbolizer:e,key:"fontWeight"},t),e.fontStyle&&this.writeNode("CssParameter",{symbolizer:e,key:"fontStyle"},t),t},Label:function(e){var t=this.createElementNSPlus("sld:Label"),i=e.split("${");t.appendChild(this.createTextNode(i[0]));for(var s,a,r=1,n=i.length;n>r;r++)s=i[r],a=s.indexOf("}"),a>0?(this.writeNode("ogc:PropertyName",{property:s.substring(0,a)},t),t.appendChild(this.createTextNode(s.substring(++a)))):t.appendChild(this.createTextNode("${"+s));return t},Halo:function(e){var t=this.createElementNSPlus("sld:Halo");return e.haloRadius&&this.writeNode("Radius",e.haloRadius,t),(e.haloColor||e.haloOpacity)&&this.writeNode("Fill",{fillColor:e.haloColor,fillOpacity:e.haloOpacity},t),t},Radius:function(e){return this.createElementNSPlus("sld:Radius",{value:e})},RasterSymbolizer:function(e){var t=this.createElementNSPlus("sld:RasterSymbolizer");return e.geometry&&this.writeNode("Geometry",e.geometry,t),e.opacity&&this.writeNode("Opacity",e.opacity,t),e.colorMap&&this.writeNode("ColorMap",e.colorMap,t),t},Geometry:function(e){var t=this.createElementNSPlus("sld:Geometry");return e.property&&this.writeNode("ogc:PropertyName",e,t),t},ColorMap:function(e){for(var t=this.createElementNSPlus("sld:ColorMap"),i=0,s=e.length;s>i;++i)this.writeNode("ColorMapEntry",e[i],t);return t},ColorMapEntry:function(e){var t=this.createElementNSPlus("sld:ColorMapEntry"),i=e;return t.setAttribute("color",i.color),void 0!==i.opacity&&t.setAttribute("opacity",parseFloat(i.opacity)),void 0!==i.quantity&&t.setAttribute("quantity",parseFloat(i.quantity)),void 0!==i.label&&t.setAttribute("label",i.label),t},PolygonSymbolizer:function(e){var t=this.createElementNSPlus("sld:PolygonSymbolizer");return e.fill!==!1&&this.writeNode("Fill",e,t),e.stroke!==!1&&this.writeNode("Stroke",e,t),t},Fill:function(e){var t=this.createElementNSPlus("sld:Fill");return e.fillColor&&this.writeNode("CssParameter",{symbolizer:e,key:"fillColor"},t),null!=e.fillOpacity&&this.writeNode("CssParameter",{symbolizer:e,key:"fillOpacity"},t),t},PointSymbolizer:function(e){var t=this.createElementNSPlus("sld:PointSymbolizer");return this.writeNode("Graphic",e,t),t},Graphic:function(e){var t=this.createElementNSPlus("sld:Graphic");return void 0!=e.externalGraphic?this.writeNode("ExternalGraphic",e,t):this.writeNode("Mark",e,t),void 0!=e.graphicOpacity&&this.writeNode("Opacity",e.graphicOpacity,t),void 0!=e.pointRadius&&this.writeNode("Size",2*e.pointRadius,t),void 0!=e.rotation&&this.writeNode("Rotation",e.rotation,t),t},ExternalGraphic:function(e){var t=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",e.externalGraphic,t);var i=e.graphicFormat||this.getGraphicFormat(e.externalGraphic);return this.writeNode("Format",i,t),t},Mark:function(e){var t=this.createElementNSPlus("sld:Mark");return e.graphicName&&this.writeNode("WellKnownName",e.graphicName,t),e.fill!==!1&&this.writeNode("Fill",e,t),e.stroke!==!1&&this.writeNode("Stroke",e,t),t},WellKnownName:function(e){return this.createElementNSPlus("sld:WellKnownName",{value:e})},Opacity:function(e){return this.createElementNSPlus("sld:Opacity",{value:e})},Size:function(e){return this.createElementNSPlus("sld:Size",{value:e})},Rotation:function(e){return this.createElementNSPlus("sld:Rotation",{value:e})},OnlineResource:function(e){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":e}})},Format:function(e){return this.createElementNSPlus("sld:Format",{value:e})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"}),OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",initialize:function(e){OpenLayers.Format.SLD.v1.prototype.initialize.apply(this,[e])},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"}),OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(e,t){var i,s=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);if(t&&t.map)if(this.context=s,t.map instanceof OpenLayers.Map)i=this.mergeContextToMap(s,t.map);else{var a=t.map;(OpenLayers.Util.isElement(a)||"string"==typeof a)&&(a={div:a}),i=this.contextToMap(s,a)}else i=s;return i},getLayerFromContext:function(e){var t,i,s={queryable:e.queryable,visibility:e.visibility,maxExtent:e.maxExtent,metadata:OpenLayers.Util.applyDefaults(e.metadata,{styles:e.styles,formats:e.formats,"abstract":e["abstract"],dataURL:e.dataURL}),numZoomLevels:e.numZoomLevels,units:e.units,isBaseLayer:e.isBaseLayer,opacity:e.opacity,displayInLayerSwitcher:e.displayInLayerSwitcher,singleTile:e.singleTile,tileSize:e.tileSize?new OpenLayers.Size(e.tileSize.width,e.tileSize.height):void 0,minScale:e.minScale||e.maxScaleDenominator,maxScale:e.maxScale||e.minScaleDenominator,srs:e.srs,dimensions:e.dimensions,metadataURL:e.metadataURL};this.layerOptions&&OpenLayers.Util.applyDefaults(s,this.layerOptions);var a={layers:e.name,transparent:e.transparent,version:e.version};if(e.formats&&e.formats.length>0)for(a.format=e.formats[0].value,t=0,i=e.formats.length;i>t;t++){var r=e.formats[t];if(1==r.current){a.format=r.value;break}}if(e.styles&&e.styles.length>0)for(t=0,i=e.styles.length;i>t;t++){var n=e.styles[t];if(1==n.current){n.href?a.sld=n.href:n.body?a.sld_body=n.body:a.styles=n.name;break}}this.layerParams&&OpenLayers.Util.applyDefaults(a,this.layerParams);var o=null,l=e.service;return l==OpenLayers.Format.Context.serviceTypes.WFS?(s.strategies=[new OpenLayers.Strategy.BBOX],s.protocol=new OpenLayers.Protocol.WFS({url:e.url,featurePrefix:e.name.split(":")[0],featureType:e.name.split(":").pop()}),o=new OpenLayers.Layer.Vector(e.title||e.name,s)):l==OpenLayers.Format.Context.serviceTypes.KML?(s.strategies=[new OpenLayers.Strategy.Fixed],s.protocol=new OpenLayers.Protocol.HTTP({url:e.url,format:new OpenLayers.Format.KML}),o=new OpenLayers.Layer.Vector(e.title||e.name,s)):l==OpenLayers.Format.Context.serviceTypes.GML?(s.strategies=[new OpenLayers.Strategy.Fixed],s.protocol=new OpenLayers.Protocol.HTTP({url:e.url,format:new OpenLayers.Format.GML}),o=new OpenLayers.Layer.Vector(e.title||e.name,s)):e.features?(o=new OpenLayers.Layer.Vector(e.title||e.name,s),o.addFeatures(e.features)):e.categoryLayer!==!0&&(o=new OpenLayers.Layer.WMS(e.title||e.name,e.url,a,s)),o},getLayersFromContext:function(e){for(var t=[],i=0,s=e.length;s>i;i++){var a=this.getLayerFromContext(e[i]);null!==a&&t.push(a)}return t},contextToMap:function(e,t){t=OpenLayers.Util.applyDefaults({maxExtent:e.maxExtent,projection:e.projection,units:e.units},t),t.maxExtent&&(t.maxResolution=t.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH);var i={contactInformation:e.contactInformation,"abstract":e["abstract"],keywords:e.keywords,logo:e.logo,descriptionURL:e.descriptionURL};t.metadata=i;var s=new OpenLayers.Map(t);return s.addLayers(this.getLayersFromContext(e.layersContext)),s.setCenter(e.bounds.getCenterLonLat(),s.getZoomForExtent(e.bounds,!0)),s},mergeContextToMap:function(e,t){return t.addLayers(this.getLayersFromContext(e.layersContext)),t},write:function(e){return e=this.toContext(e),OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:"OpenLayers.Format.Context"}),OpenLayers.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"},OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"0.3.1",getVersion:function(){var e=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);return"0.3.0"===e&&(e=this.defaultVersion),e},toContext:function(e){var t={};return"OpenLayers.Map"==e.CLASS_NAME&&(t.bounds=e.getExtent(),t.maxExtent=e.maxExtent,t.projection=e.projection,t.size=e.getSize(),t.layers=e.layers),t},CLASS_NAME:"OpenLayers.Format.OWSContext"}),OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(e){var t=this.version;if(!t){var i=e.getAttribute("xmlns:ows");i&&"1.1"===i.substring(i.lastIndexOf("/")+1)&&(t="1.1.0"),t||(t=this.defaultVersion)}return t},CLASS_NAME:"OpenLayers.Format.OWSCommon"}),OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i={};return this.readChildNodes(e,i),i},readers:{ows:{Exception:function(e,t){var i={code:e.getAttribute("exceptionCode"),locator:e.getAttribute("locator"),texts:[]};t.exceptions.push(i),this.readChildNodes(e,i)},ExceptionText:function(e,t){var i=this.getChildValue(e);t.texts.push(i)},ServiceIdentification:function(e,t){t.serviceIdentification={},this.readChildNodes(e,t.serviceIdentification)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},Keywords:function(e,t){t.keywords={},this.readChildNodes(e,t.keywords)},Keyword:function(e,t){t[this.getChildValue(e)]=!0},ServiceType:function(e,t){t.serviceType={codeSpace:e.getAttribute("codeSpace"),value:this.getChildValue(e)}},ServiceTypeVersion:function(e,t){t.serviceTypeVersion=this.getChildValue(e)},Fees:function(e,t){t.fees=this.getChildValue(e)},AccessConstraints:function(e,t){t.accessConstraints=this.getChildValue(e)},ServiceProvider:function(e,t){t.serviceProvider={},this.readChildNodes(e,t.serviceProvider)},ProviderName:function(e,t){t.providerName=this.getChildValue(e)},ProviderSite:function(e,t){t.providerSite=this.getAttributeNS(e,this.namespaces.xlink,"href")},ServiceContact:function(e,t){t.serviceContact={},this.readChildNodes(e,t.serviceContact)},IndividualName:function(e,t){t.individualName=this.getChildValue(e)},PositionName:function(e,t){t.positionName=this.getChildValue(e)},ContactInfo:function(e,t){t.contactInfo={},this.readChildNodes(e,t.contactInfo)},Phone:function(e,t){t.phone={},this.readChildNodes(e,t.phone)},Voice:function(e,t){t.voice=this.getChildValue(e)},Address:function(e,t){t.address={},this.readChildNodes(e,t.address)},DeliveryPoint:function(e,t){t.deliveryPoint=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},AdministrativeArea:function(e,t){t.administrativeArea=this.getChildValue(e)},PostalCode:function(e,t){t.postalCode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ElectronicMailAddress:function(e,t){t.electronicMailAddress=this.getChildValue(e)},Role:function(e,t){t.role=this.getChildValue(e)},OperationsMetadata:function(e,t){t.operationsMetadata={},this.readChildNodes(e,t.operationsMetadata)},Operation:function(e,t){var i=e.getAttribute("name");t[i]={},this.readChildNodes(e,t[i])},DCP:function(e,t){t.dcp={},this.readChildNodes(e,t.dcp)},HTTP:function(e,t){t.http={},this.readChildNodes(e,t.http)},Get:function(e,t){t.get=this.getAttributeNS(e,this.namespaces.xlink,"href")},Post:function(e,t){t.post=this.getAttributeNS(e,this.namespaces.xlink,"href")},Parameter:function(e,t){t.parameters||(t.parameters={});var i=e.getAttribute("name");t.parameters[i]={},this.readChildNodes(e,t.parameters[i])},Value:function(e,t){t[this.getChildValue(e)]=!0},OutputFormat:function(e,t){t.formats.push({value:this.getChildValue(e)}),this.readChildNodes(e,t)},WGS84BoundingBox:function(e,t){var i={};i.crs=e.getAttribute("crs"),t.BoundingBox?t.BoundingBox.push(i):(t.projection=i.crs,i=t),this.readChildNodes(e,i)
},BoundingBox:function(e,t){this.readers.ows.WGS84BoundingBox.apply(this,[e,t])},LowerCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");var s=i.split(this.regExes.splitSpace);t.left=s[0],t.bottom=s[1]},UpperCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");var s=i.split(this.regExes.splitSpace);t.right=s[0],t.top=s[1],t.bounds=new OpenLayers.Bounds(t.left,t.bottom,t.right,t.top),delete t.left,delete t.bottom,delete t.right,delete t.top},Language:function(e,t){t.language=this.getChildValue(e)}}},writers:{ows:{BoundingBox:function(e){var t=this.createElementNSPlus("ows:BoundingBox",{attributes:{crs:e.projection}});return this.writeNode("ows:LowerCorner",e,t),this.writeNode("ows:UpperCorner",e,t),t},LowerCorner:function(e){var t=this.createElementNSPlus("ows:LowerCorner",{value:e.bounds.left+" "+e.bounds.bottom});return t},UpperCorner:function(e){var t=this.createElementNSPlus("ows:UpperCorner",{value:e.bounds.right+" "+e.bounds.top});return t},Identifier:function(e){var t=this.createElementNSPlus("ows:Identifier",{value:e});return t},Title:function(e){var t=this.createElementNSPlus("ows:Title",{value:e});return t},Abstract:function(e){var t=this.createElementNSPlus("ows:Abstract",{value:e});return t},OutputFormat:function(e){var t=this.createElementNSPlus("ows:OutputFormat",{value:e});return t}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"}),OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.success=!1,t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("language"),exceptions:[]},this.readChildNodes(e,t.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"}),OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:!0,xy:!0,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(e){if(e.layersContext)for(var t=0,i=e.layersContext.length;i>t;t++){var s=e.layersContext[t],a=[],r=e.title||"";e.metadata&&e.metadata.nestingPath&&(a=e.metadata.nestingPath.slice()),""!=r&&a.push(r),s.metadata.nestingPath=a,s.layersContext&&this.setNestingPath(s)}},decomposeNestingPath:function(e){var t=[];if(OpenLayers.Util.isArray(e)){for(var i=e.slice();i.length>0;)t.push(i.slice()),i.pop();t.reverse()}return t},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};this.readNode(e,t),this.setNestingPath({layersContext:t.layersContext});var i=[];return this.processLayer(i,t),delete t.layersContext,t.layersContext=i,t},processLayer:function(e,t){if(t.layersContext)for(var i=0,s=t.layersContext.length;s>i;i++){var a=t.layersContext[i];e.push(a),a.layersContext&&this.processLayer(e,a)}},write:function(e,t){var i="OWSContext";this.nestingLayerLookup={},t=t||{},OpenLayers.Util.applyDefaults(t,e);var s=this.writeNode(i,t);return this.nestingLayerLookup=null,this.setAttributeNS(s,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[s])},readers:{kml:{Document:function(e,t){t.features=new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:!0}).read(e)}},owc:{OWSContext:function(e,t){this.readChildNodes(e,t)},General:function(e,t){this.readChildNodes(e,t)},ResourceList:function(e,t){this.readChildNodes(e,t)},Layer:function(e,t){var i={metadata:{},visibility:"1"!=e.getAttribute("hidden"),queryable:"1"==e.getAttribute("queryable"),opacity:null!=e.getAttribute("opacity")?parseFloat(e.getAttribute("opacity")):null,name:e.getAttribute("name"),categoryLayer:null==e.getAttribute("name"),formats:[],styles:[]};t.layersContext||(t.layersContext=[]),t.layersContext.push(i),this.readChildNodes(e,i)},InlineGeometry:function(e,t){t.features=[];var i,s=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember");if(s.length>=1&&(i=s[0]),i&&i.firstChild){var a=i.firstChild.nextSibling?i.firstChild.nextSibling:i.firstChild;this.setNamespace("feature",a.namespaceURI),this.featureType=a.localName||a.nodeName.split(":").pop(),this.readChildNodes(e,t)}},Server:function(e,t){(!t.service&&!t.version||t.service!=OpenLayers.Format.Context.serviceTypes.WMS)&&(t.service=e.getAttribute("service"),t.version=e.getAttribute("version"),this.readChildNodes(e,t))},Name:function(e,t){t.name=this.getChildValue(e),this.readChildNodes(e,t)},Title:function(e,t){t.title=this.getChildValue(e),this.readChildNodes(e,t)},StyleList:function(e,t){this.readChildNodes(e,t.styles)},Style:function(e,t){var i={};t.push(i),this.readChildNodes(e,i)},LegendURL:function(e,t){var i={};t.legend=i,this.readChildNodes(e,i)},OnlineResource:function(e,t){t.url=this.getAttributeNS(e,this.namespaces.xlink,"href"),this.readChildNodes(e,t)}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(e){var t=this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:e.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")}});return this.writeNode("General",e,t),this.writeNode("ResourceList",e,t),t},General:function(e){var t=this.createElementNSPlus("General");return this.writeNode("ows:BoundingBox",e,t),this.writeNode("ows:Title",e.title||"OpenLayers OWSContext",t),t},ResourceList:function(e){for(var t=this.createElementNSPlus("ResourceList"),i=0,s=e.layers.length;s>i;i++){var a=e.layers[i],r=this.decomposeNestingPath(a.metadata.nestingPath);this.writeNode("_Layer",{layer:a,subPaths:r},t)}return t},Server:function(e){var t=this.createElementNSPlus("Server",{attributes:{version:e.version,service:e.service}});return this.writeNode("OnlineResource",e,t),t},OnlineResource:function(e){var t=this.createElementNSPlus("OnlineResource",{attributes:{"xlink:href":e.url}});return t},InlineGeometry:function(e){var t=this.createElementNSPlus("InlineGeometry");this.writeNode("gml:boundedBy",e.getDataExtent(),t);for(var i=0,s=e.features.length;s>i;i++)this.writeNode("gml:featureMember",e.features[i],t);return t},StyleList:function(e){for(var t=this.createElementNSPlus("StyleList"),i=0,s=e.length;s>i;i++)this.writeNode("Style",e[i],t);return t},Style:function(e){var t=this.createElementNSPlus("Style");return this.writeNode("Name",e,t),this.writeNode("Title",e,t),e.legend&&this.writeNode("LegendURL",e,t),t},Name:function(e){var t=this.createElementNSPlus("Name",{value:e.name});return t},Title:function(e){var t=this.createElementNSPlus("Title",{value:e.title});return t},LegendURL:function(e){var t=this.createElementNSPlus("LegendURL");return this.writeNode("OnlineResource",e.legend,t),t},_WMS:function(e){var t=this.createElementNSPlus("Layer",{attributes:{name:e.params.LAYERS,queryable:e.queryable?"1":"0",hidden:e.visibility?"0":"1",opacity:e.opacity?e.opacity:null}});return this.writeNode("ows:Title",e.name,t),this.writeNode("ows:OutputFormat",e.params.FORMAT,t),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WMS,version:e.params.VERSION,url:e.url},t),e.metadata.styles&&e.metadata.styles.length>0&&this.writeNode("StyleList",e.metadata.styles,t),t},_Layer:function(e){var t,i,s,a;if(t=e.layer,i=e.subPaths,s=null,a=null,i.length>0){var r=i[0].join("/"),n=r.lastIndexOf("/");return s=this.nestingLayerLookup[r],a=n>0?r.substring(n+1,r.length):r,s||(s=this.createElementNSPlus("Layer"),this.writeNode("ows:Title",a,s),this.nestingLayerLookup[r]=s),e.subPaths.shift(),this.writeNode("_Layer",e,s),s}return t instanceof OpenLayers.Layer.WMS?s=this.writeNode("_WMS",t):t instanceof OpenLayers.Layer.Vector&&(t.protocol instanceof OpenLayers.Protocol.WFS.v1?s=this.writeNode("_WFS",t):t.protocol instanceof OpenLayers.Protocol.HTTP?t.protocol.format instanceof OpenLayers.Format.GML?(t.protocol.format.version="2.1.2",s=this.writeNode("_GML",t)):t.protocol.format instanceof OpenLayers.Format.KML&&(t.protocol.format.version="2.2",s=this.writeNode("_KML",t)):(this.setNamespace("feature",this.featureNS),s=this.writeNode("_InlineGeometry",t))),t.options.maxScale&&this.writeNode("sld:MinScaleDenominator",t.options.maxScale,s),t.options.minScale&&this.writeNode("sld:MaxScaleDenominator",t.options.minScale,s),this.nestingLayerLookup[t.name]=s,s},_WFS:function(e){var t=this.createElementNSPlus("Layer",{attributes:{name:e.protocol.featurePrefix+":"+e.protocol.featureType,hidden:e.visibility?"0":"1"}});return this.writeNode("ows:Title",e.name,t),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:e.protocol.version,url:e.protocol.url},t),t},_InlineGeometry:function(e){var t=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:e.visibility?"0":"1"}});return this.writeNode("ows:Title",e.name,t),this.writeNode("InlineGeometry",e,t),t},_GML:function(e){var t=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",e.name,t),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.GML,url:e.protocol.url,version:e.protocol.format.version},t),t},_KML:function(e){var t=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",e.name,t),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.KML,version:e.protocol.format.version,url:e.protocol.url},t),t}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(e){var t=this.createElementNSPlus("gml:boundedBy");return this.writeNode("gml:Box",e,t),t}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"}),OpenLayers.Format.CSWGetRecords=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.CSWGetRecords.DEFAULTS);var t=OpenLayers.Format.CSWGetRecords["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported CSWGetRecords version: "+e.version;return new t(e)},OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"},OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handler:null,eventListeners:null,events:null,EVENT_TYPES:["activate","deactivate"],initialize:function(e){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,e),this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var e in this.handlers)this.handlers.hasOwnProperty(e)&&"function"==typeof this.handlers[e].destroy&&this.handlers[e].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null),this.div=null},setMap:function(e){this.map=e,this.handler&&this.handler.setMap(e)},draw:function(e){return null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title&&(this.div.title=this.title)),null!=e&&(this.position=e.clone()),this.moveTo(this.position),this.div},moveTo:function(e){null!=e&&null!=this.div&&(this.div.style.left=e.x+"px",this.div.style.top=e.y+"px")},activate:function(){return this.active?!1:(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0):!1},CLASS_NAME:"OpenLayers.Control"}),OpenLayers.Control.TYPE_BUTTON=1,OpenLayers.Control.TYPE_TOGGLE=2,OpenLayers.Control.TYPE_TOOL=3,OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:new OpenLayers.Size(180,90),layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,initialize:function(e){this.layers=[],this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,[e])},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.eventsDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(OpenLayers.Event.stopObservingElement(this.maximizeDiv),this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(OpenLayers.Event.stopObservingElement(this.minimizeDiv),this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!(this.layers.length>0)){if(!this.map.baseLayer)return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;var e=this.map.baseLayer.clone();this.layers=[e]}if(this.element=document.createElement("div"),this.element.className=this.displayClass+"Element",this.element.style.display="none",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.size.w+"px",this.mapDiv.style.height=this.size.h+"px",this.mapDiv.style.position="relative",this.mapDiv.style.overflow="hidden",this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap"),this.extentRectangle=document.createElement("div"),this.extentRectangle.style.position="absolute",this.extentRectangle.style.zIndex=1e3,this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.element.appendChild(this.mapDiv),this.div.appendChild(this.element),this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";var t=OpenLayers.Util.getImagesLocation(),i=t+"layer-switcher-maximize.png";this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,new OpenLayers.Size(18,18),i,"absolute"),this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton",OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this)),this.div.appendChild(this.maximizeDiv);var i=t+"layer-switcher-minimize.png";this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,new OpenLayers.Size(18,18),i,"absolute"),this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton",OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this)),this.div.appendChild(this.minimizeDiv);for(var s=["dblclick","mousedown"],a=0,r=s.length;r>a;a++)OpenLayers.Event.observe(this.maximizeDiv,s[a],OpenLayers.Event.stop),OpenLayers.Event.observe(this.minimizeDiv,s[a],OpenLayers.Event.stop);this.minimizeControl()}return this.map.getExtent()&&this.update(),this.map.events.register("moveend",this,this.update),this.maximized&&this.maximizeControl(),this.div},baseLayerDraw:function(){this.draw(),this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(e){var t=this.handlers.drag.last.x-e.x,i=this.handlers.drag.last.y-e.y;if(0!=t||0!=i){var s=this.rectPxBounds.top,a=this.rectPxBounds.left,r=Math.abs(this.rectPxBounds.getHeight()),n=this.rectPxBounds.getWidth(),o=Math.max(0,s-i);o=Math.min(o,this.ovmap.size.h-this.hComp-r);var l=Math.max(0,a-t);l=Math.min(l,this.ovmap.size.w-this.wComp-n),this.setRectPxBounds(new OpenLayers.Bounds(l,o+r,l+n,o))}},mapDivClick:function(e){var t=this.rectPxBounds.getCenterPixel(),i=e.xy.x-t.x,s=e.xy.y-t.y,a=this.rectPxBounds.top,r=this.rectPxBounds.left,n=Math.abs(this.rectPxBounds.getHeight()),o=this.rectPxBounds.getWidth(),l=Math.max(0,a+s);l=Math.min(l,this.ovmap.size.h-n);var h=Math.max(0,r+i);h=Math.min(h,this.ovmap.size.w-o),this.setRectPxBounds(new OpenLayers.Bounds(h,l+n,h+o,l)),this.updateMapToRect()},maximizeControl:function(e){this.element.style.display="",this.showToggle(!1),null!=e&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.element.style.display="none",this.showToggle(!0),null!=e&&OpenLayers.Event.stop(e)},showToggle:function(e){this.maximizeDiv.style.display=e?"":"none",this.minimizeDiv.style.display=e?"none":""},update:function(){null==this.ovmap&&this.createMap(),(this.autoPan||!this.isSuitableOverview())&&this.updateOverview(),this.updateRectToMap()},isSuitableOverview:function(){var e=this.map.getExtent(),t=this.map.maxExtent,i=new OpenLayers.Bounds(Math.max(e.left,t.left),Math.max(e.bottom,t.bottom),Math.min(e.right,t.right),Math.min(e.top,t.top));this.ovmap.getProjection()!=this.map.getProjection()&&(i=i.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));var s=this.ovmap.getResolution()/this.map.getResolution();return s>this.minRatio&&this.maxRatio>=s&&this.ovmap.getExtent().containsBounds(i)},updateOverview:function(){var e=this.map.getResolution(),t=this.ovmap.getResolution(),i=t/e;i>this.maxRatio?t=this.minRatio*e:this.minRatio>=i&&(t=this.maxRatio*e);var s;this.ovmap.getProjection()!=this.map.getProjection()?(s=this.map.center.clone(),s.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):s=this.map.center,this.ovmap.setCenter(s,this.ovmap.getZoomForResolution(t*this.resolutionFactor)),this.updateRectToMap()},createMap:function(){var e=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);if(this.ovmap=new OpenLayers.Map(this.mapDiv,e),this.ovmap.eventsDiv.appendChild(this.extentRectangle),OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy),this.ovmap.addLayers(this.layers),this.ovmap.zoomToMaxExtent(),this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")),this.wComp=this.wComp?this.wComp:2,this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")),this.hComp=this.hComp?this.hComp:2,this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap}),this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap}),this.handlers.click.activate(),this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0),this.rectEvents.register("mouseover",this,function(){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()}),this.rectEvents.register("mouseout",this,function(){this.handlers.drag.dragging||this.handlers.drag.deactivate()}),this.ovmap.getProjection()!=this.map.getProjection()){var t=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,i=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=t&&i?OpenLayers.INCHES_PER_UNIT[t]/OpenLayers.INCHES_PER_UNIT[i]:1}},updateRectToMap:function(){var e;e=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();var t=this.getRectBoundsFromMapBounds(e);t&&this.setRectPxBounds(t)},updateMapToRect:function(){var e=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(e=e.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())),this.map.panTo(e.getCenterLonLat())},setRectPxBounds:function(e){var t=Math.max(e.top,0),i=Math.max(e.left,0),s=Math.min(e.top+Math.abs(e.getHeight()),this.ovmap.size.h-this.hComp),a=Math.min(e.left+e.getWidth(),this.ovmap.size.w-this.wComp),r=Math.max(a-i,0),n=Math.max(s-t,0);if(this.minRectSize>r||this.minRectSize>n){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var o=i+r/2-this.minRectSize/2,l=t+n/2-this.minRectSize/2;this.extentRectangle.style.top=Math.round(l)+"px",this.extentRectangle.style.left=Math.round(o)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"}else this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(t)+"px",this.extentRectangle.style.left=Math.round(i)+"px",this.extentRectangle.style.height=Math.round(n)+"px",this.extentRectangle.style.width=Math.round(r)+"px";this.rectPxBounds=new OpenLayers.Bounds(Math.round(i),Math.round(s),Math.round(a),Math.round(t))},getRectBoundsFromMapBounds:function(e){var t=new OpenLayers.LonLat(e.left,e.bottom),i=new OpenLayers.LonLat(e.right,e.top),s=this.getOverviewPxFromLonLat(t),a=this.getOverviewPxFromLonLat(i),r=null;return s&&a&&(r=new OpenLayers.Bounds(s.x,s.y,a.x,a.y)),r},getMapBoundsFromRectBounds:function(e){var t=new OpenLayers.Pixel(e.left,e.bottom),i=new OpenLayers.Pixel(e.right,e.top),s=this.getLonLatFromOverviewPx(t),a=this.getLonLatFromOverviewPx(i);return new OpenLayers.Bounds(s.lon,s.lat,a.lon,a.lat)},getLonLatFromOverviewPx:function(e){var t=this.ovmap.size,i=this.ovmap.getResolution(),s=this.ovmap.getExtent().getCenterLonLat(),a=e.x-t.w/2,r=e.y-t.h/2;return new OpenLayers.LonLat(s.lon+a*i,s.lat-r*i)},getOverviewPxFromLonLat:function(e){var t=this.ovmap.getResolution(),i=this.ovmap.getExtent(),s=null;return i&&(s=new OpenLayers.Pixel(Math.round(1/t*(e.lon-i.left)),Math.round(1/t*(i.top-e.lat)))),s},CLASS_NAME:"OpenLayers.Control.OverviewMap"}),OpenLayers.Tween=OpenLayers.Class({INTERVAL:10,easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,interval:null,playing:!1,initialize:function(e){this.easing=e?e:OpenLayers.Easing.Expo.easeOut},start:function(e,t,i,s){this.playing=!0,this.begin=e,this.finish=t,this.duration=i,this.callbacks=s.callbacks,this.time=0,this.interval&&(window.clearInterval(this.interval),this.interval=null),this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.interval=window.setInterval(OpenLayers.Function.bind(this.play,this),this.INTERVAL)},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),window.clearInterval(this.interval),this.interval=null,this.playing=!1)},play:function(){var e={};for(var t in this.begin){var i=this.begin[t],s=this.finish[t];(null==i||null==s||isNaN(i)||isNaN(s))&&OpenLayers.Console.error("invalid value for Tween");var a=s-i;e[t]=this.easing.apply(this,[this.time,i,a,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&this.callbacks.eachStep.call(this,e),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(e,t,i,s){return i*e/s+t},easeOut:function(e,t,i,s){return i*e/s+t},easeInOut:function(e,t,i,s){return i*e/s+t},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(e,t,i,s){return 0==e?t:i*Math.pow(2,10*(e/s-1))+t},easeOut:function(e,t,i,s){return e==s?t+i:i*(-Math.pow(2,-10*e/s)+1)+t},easeInOut:function(e,t,i,s){return 0==e?t:e==s?t+i:1>(e/=s/2)?i/2*Math.pow(2,10*(e-1))+t:i/2*(-Math.pow(2,-10*--e)+2)+t},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(e,t,i,s){return i*(e/=s)*e+t},easeOut:function(e,t,i,s){return-i*(e/=s)*(e-2)+t},easeInOut:function(e,t,i,s){return 1>(e/=s/2)?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},EVENT_TYPES:["preaddlayer","addlayer","preremovelayer","removelayer","changelayer","movestart","move","moveend","zoomend","popupopen","popupclose","addmarker","removemarker","clearmarkers","mouseover","mouseout","mousemove","dragstart","drag","dragend","changebaselayer"],id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,viewRequestID:0,tileSize:null,projection:"EPSG:4326",units:"degrees",resolutions:null,maxResolution:1.40625,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!0,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,minPx:null,maxPx:null,initialize:function(e,t){1===arguments.length&&"object"==typeof e&&(t=e,e=t&&t.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.maxExtent=new OpenLayers.Bounds(-180,-90,180,90),this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15),this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css",OpenLayers.Util.extend(this,t),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(e),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap");var i=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(i,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv);var s=document.createElement("div");if(s.id=this.id+"_events",s.style.position="absolute",s.style.width="100%",s.style.height="100%",s.style.zIndex=this.Z_INDEX_BASE.Control-1,this.viewPortDiv.appendChild(s),this.eventsDiv=s,this.events=new OpenLayers.Events(this,this.eventsDiv,this.EVENT_TYPES,this.fallThrough,{includeXY:!0}),i=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(i),this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1,this.eventsDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),this.events.register("movestart",this,this.updateSize),OpenLayers.String.contains(navigator.appName,"Microsoft")?this.events.register("resize",this,this.updateSize):(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var a=!0,r=document.getElementsByTagName("link"),n=0,o=r.length;o>n;++n)if(OpenLayers.Util.isEquivalentUrl(r.item(n).href,this.theme)){a=!1;break}if(a){var l=document.createElement("link");l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),l.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(l)}}null==this.controls&&(this.controls=null!=OpenLayers.Control?[new OpenLayers.Control.Navigation,new OpenLayers.Control.PanZoom,new OpenLayers.Control.ArgParser,new OpenLayers.Control.Attribution]:[]);for(var n=0,o=this.controls.length;o>n;n++)this.addControlToMap(this.controls[n]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),t&&t.layers&&(delete this.center,this.addLayers(t.layers),t.center&&this.setCenter(t.center,t.zoom))},render:function(e){this.div=OpenLayers.Util.getElement(e),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy?OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy):this.events.unregister("resize",this,this.updateSize),this.paddingForPopups=null,null!=this.controls){for(var e=this.controls.length-1;e>=0;--e)this.controls[e].destroy();this.controls=null}if(null!=this.layers){for(var e=this.layers.length-1;e>=0;--e)this.layers[e].destroy(!1);this.layers=null}this.viewPortDiv&&this.div.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.events=null},setOptions:function(e){var t=this.minPx&&e.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,e),t&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(e,t,i){var s="function"==typeof i.test,a=OpenLayers.Array.filter(this[e],function(e){return e[t]==i||s&&i.test(e[t])});return a},getLayersBy:function(e,t){return this.getBy("layers",e,t)},getLayersByName:function(e){return this.getLayersBy("name",e)},getLayersByClass:function(e){return this.getLayersBy("CLASS_NAME",e)},getControlsBy:function(e,t){return this.getBy("controls",e,t)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},getLayer:function(e){for(var t=null,i=0,s=this.layers.length;s>i;i++){var a=this.layers[i];if(a.id==e){t=a;break}}return t},setLayerZIndex:function(e,t){e.setZIndex(this.Z_INDEX_BASE[e.isBaseLayer?"BaseLayer":"Overlay"]+5*t)},resetLayersZIndex:function(){for(var e=0,t=this.layers.length;t>e;e++){var i=this.layers[e];this.setLayerZIndex(i,e)}},addLayer:function(e){for(var t=0,i=this.layers.length;i>t;t++)if(this.layers[t]==e){var s=OpenLayers.i18n("layerAlreadyAdded",{layerName:e.name});return OpenLayers.Console.warn(s),!1}this.events.triggerEvent("preaddlayer",{layer:e})!==!1&&(this.allOverlays&&(e.isBaseLayer=!1),e.div.className="olLayerDiv",e.div.style.overflow="",this.setLayerZIndex(e,this.layers.length),e.isFixed?this.viewPortDiv.appendChild(e.div):this.layerContainerDiv.appendChild(e.div),this.layers.push(e),e.setMap(this),e.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(e):e.setVisibility(!1):e.redraw(),this.events.triggerEvent("addlayer",{layer:e}),e.events.triggerEvent("added",{map:this,layer:e}),e.afterAdd())
},addLayers:function(e){for(var t=0,i=e.length;i>t;t++)this.addLayer(e[t])},removeLayer:function(e,t){if(this.events.triggerEvent("preremovelayer",{layer:e})!==!1){if(null==t&&(t=!0),e.isFixed?this.viewPortDiv.removeChild(e.div):this.layerContainerDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.layers,e),e.removeMap(this),e.map=null,this.baseLayer==e&&(this.baseLayer=null,t))for(var i=0,s=this.layers.length;s>i;i++){var a=this.layers[i];if(a.isBaseLayer||this.allOverlays){this.setBaseLayer(a);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:e}),e.events.triggerEvent("removed",{map:this,layer:e})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(e){return OpenLayers.Util.indexOf(this.layers,e)},setLayerIndex:function(e,t){var i=this.getLayerIndex(e);if(0>t?t=0:t>this.layers.length&&(t=this.layers.length),i!=t){this.layers.splice(i,1),this.layers.splice(t,0,e);for(var s=0,a=this.layers.length;a>s;s++)this.setLayerZIndex(this.layers[s],s);this.events.triggerEvent("changelayer",{layer:e,property:"order"}),this.allOverlays&&(0===t?this.setBaseLayer(e):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(e,t){var i=this.getLayerIndex(e)+t;this.setLayerIndex(e,i)},setBaseLayer:function(e){if(e!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,e)){var t=this.getCachedCenter(),i=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);if(null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1),this.baseLayer=e,this.viewRequestID++,(!this.allOverlays||this.baseLayer.visibility)&&this.baseLayer.setVisibility(!0),null!=t){var s=this.getZoomForResolution(i||this.resolution,!0);this.setCenter(t,s,!1,!0)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(e,t){this.controls.push(e),this.addControlToMap(e,t)},addControls:function(e,t){for(var i=1===arguments.length?[]:t,s=0,a=e.length;a>s;s++){var r=e[s],n=i[s]?i[s]:null;this.addControl(r,n)}},addControlToMap:function(e,t){e.outsideViewport=null!=e.div,this.displayProjection&&!e.displayProjection&&(e.displayProjection=this.displayProjection),e.setMap(this);var i=e.draw(t);i&&(e.outsideViewport||(i.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(i))),e.autoActivate&&e.activate()},getControl:function(e){for(var t=null,i=0,s=this.controls.length;s>i;i++){var a=this.controls[i];if(a.id==e){t=a;break}}return t},removeControl:function(e){e&&e==this.getControl(e.id)&&(e.div&&e.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.controls,e))},addPopup:function(e,t){if(t)for(var i=this.popups.length-1;i>=0;--i)this.removePopup(this.popups[i]);e.map=this,this.popups.push(e);var s=e.draw();s&&(s.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(s))},removePopup:function(e){if(OpenLayers.Util.removeItem(this.popups,e),e.div)try{this.layerContainerDiv.removeChild(e.div)}catch(t){}e.map=null},getSize:function(){var e=null;return null!=this.size&&(e=this.size.clone()),e},updateSize:function(){var e=this.getCurrentSize();if(e&&!isNaN(e.h)&&!isNaN(e.w)){this.events.clearMouseCache();var t=this.getSize();if(null==t&&(this.size=t=e),!e.equals(t)){this.size=e;for(var i=0,s=this.layers.length;s>i;i++)this.layers[i].onMapResize();var a=this.getCachedCenter();if(null!=this.baseLayer&&null!=a){var r=this.getZoom();this.zoom=null,this.setCenter(a,r)}}}},getCurrentSize:function(){var e=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=this.div.offsetWidth,e.h=this.div.offsetHeight),(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=parseInt(this.div.style.width),e.h=parseInt(this.div.style.height)),e},calculateBounds:function(e,t){var i=null;if(null==e&&(e=this.getCachedCenter()),null==t&&(t=this.getResolution()),null!=e&&null!=t){var s=this.getSize(),a=s.w*t,r=s.h*t;i=new OpenLayers.Bounds(e.lon-a/2,e.lat-r/2,e.lon+a/2,e.lat+r/2)}return i},getCenter:function(){var e=null,t=this.getCachedCenter();return t&&(e=t.clone()),e},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx(new OpenLayers.Pixel(this.size.w/2,this.size.h/2))),this.center},getZoom:function(){return this.zoom},pan:function(e,t,i){if(i=OpenLayers.Util.applyDefaults(i,{animate:!0,dragging:!1}),i.dragging)(0!=e||0!=t)&&this.moveByPx(e,t);else{var s=this.getViewPortPxFromLonLat(this.getCachedCenter()),a=s.add(e,t);if(this.dragging||!a.equals(s)){var r=this.getLonLatFromViewPortPx(a);i.animate?this.panTo(r):(this.moveTo(r),this.dragging=!1,this.events.triggerEvent("moveend"))}}},panTo:function(e){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(e)){this.panTween||(this.panTween=new OpenLayers.Tween(this.panMethod));var t=this.getCachedCenter();if(e.equals(t))return;var i=this.getPixelFromLonLat(t),s=this.getPixelFromLonLat(e),a={x:s.x-i.x,y:s.y-i.y},r={x:0,y:0};this.panTween.start({x:0,y:0},a,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(e){var t=e.x-r.x,i=e.y-r.y;this.moveByPx(t,i),r.x=Math.round(e.x),r.y=Math.round(e.y)},this),done:OpenLayers.Function.bind(function(){this.moveTo(e),this.dragging=!1,this.events.triggerEvent("moveend")},this)}})}else this.setCenter(e)},setCenter:function(e,t,i,s){this.panTween&&this.panTween.stop(),this.moveTo(e,t,{dragging:i,forceZoomChange:s})},moveByPx:function(e,t){var i=this.size.w/2,s=this.size.h/2,a=i+e,r=s+t,n=this.baseLayer.wrapDateLine,o=0,l=0;this.restrictedExtent&&(o=i,l=s,n=!1),e=n||this.maxPx.x-o>=a&&a>=this.minPx.x+o?Math.round(e):0,t=this.maxPx.y-l>=r&&r>=this.minPx.y+l?Math.round(t):0;var h=this.minPx.x,u=this.maxPx.x;if(e||t){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,e&&(this.layerContainerDiv.style.left=parseInt(this.layerContainerDiv.style.left)-e+"px",this.minPx.x-=e,this.maxPx.x-=e,n&&(this.maxPx.x>u&&(this.maxPx.x-=u-h),h>this.minPx.x&&(this.minPx.x+=u-h))),t&&(this.layerContainerDiv.style.top=parseInt(this.layerContainerDiv.style.top)-t+"px",this.minPx.y-=t,this.maxPx.y-=t);var p,c,d;for(c=0,d=this.layers.length;d>c;++c)p=this.layers[c],p.visibility&&(p===this.baseLayer||p.inRange)&&(p.moveByPx(e,t),p.events.triggerEvent("move"));this.events.triggerEvent("move")}},moveTo:function(e,t,i){i||(i={}),null!=t&&(t=parseFloat(t),this.fractionalZoom||(t=Math.round(t)));var s=i.dragging||this.dragging,a=i.forceZoomChange;if(this.getCachedCenter()||this.isValidLonLat(e)||(e=this.maxExtent.getCenterLonLat(),this.center=e.clone()),null!=this.restrictedExtent){null==e&&(e=this.center),null==t&&(t=this.getZoom());var r=this.getResolutionForZoom(t),n=this.calculateBounds(e,r);if(!this.restrictedExtent.containsBounds(n)){var o=this.restrictedExtent.getCenterLonLat();n.getWidth()>this.restrictedExtent.getWidth()?e=new OpenLayers.LonLat(o.lon,e.lat):n.left<this.restrictedExtent.left?e=e.add(this.restrictedExtent.left-n.left,0):n.right>this.restrictedExtent.right&&(e=e.add(this.restrictedExtent.right-n.right,0)),n.getHeight()>this.restrictedExtent.getHeight()?e=new OpenLayers.LonLat(e.lon,o.lat):n.bottom<this.restrictedExtent.bottom?e=e.add(0,this.restrictedExtent.bottom-n.bottom):n.top>this.restrictedExtent.top&&(e=e.add(0,this.restrictedExtent.top-n.top))}}var l=a||this.isValidZoomLevel(t)&&t!=this.getZoom(),h=this.isValidLonLat(e)&&!e.equals(this.center);if(l||h||s){s||this.events.triggerEvent("movestart"),h&&(!l&&this.center&&this.centerLayerContainer(e),this.center=e.clone());var u=l?this.getResolutionForZoom(t):this.getResolution();if(l||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter(),this.layerContainerDiv.style.left="0px",this.layerContainerDiv.style.top="0px";var p=this.getMaxExtent({restricted:!0}),c=p.getCenterLonLat(),d=this.center.lon-c.lon,m=c.lat-this.center.lat,y=Math.round(p.getWidth()/u),f=Math.round(p.getHeight()/u),g=(this.size.w-y)/2-d/u,v=(this.size.h-f)/2-m/u;this.minPx=new OpenLayers.Pixel(g,v),this.maxPx=new OpenLayers.Pixel(g+y,v+f)}l&&(this.zoom=t,this.resolution=u,this.viewRequestID++);var L=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(L,l,i.dragging),i.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:l})),L=this.baseLayer.getExtent();for(var b=this.layers.length-1;b>=0;--b){var O=this.layers[b];if(O!==this.baseLayer&&!O.isBaseLayer){var S=O.calculateInRange();O.inRange!=S&&(O.inRange=S,S||O.display(!1),this.events.triggerEvent("changelayer",{layer:O,property:"visibility"})),S&&O.visibility&&(O.moveTo(L,l,i.dragging),i.dragging||O.events.triggerEvent("moveend",{zoomChanged:l}))}}if(this.events.triggerEvent("move"),s||this.events.triggerEvent("moveend"),l){for(var b=0,w=this.popups.length;w>b;b++)this.popups[b].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(e){var t=this.getViewPortPxFromLonLat(this.layerContainerOrigin),i=this.getViewPortPxFromLonLat(e);if(null!=t&&null!=i){var s=parseInt(this.layerContainerDiv.style.left),a=parseInt(this.layerContainerDiv.style.top),r=Math.round(t.x-i.x),n=Math.round(t.y-i.y);this.layerContainerDiv.style.left=r+"px",this.layerContainerDiv.style.top=n+"px";var o=s-r,l=a-n;this.minPx.x-=o,this.maxPx.x-=o,this.minPx.y-=l,this.maxPx.y-=l}},isValidZoomLevel:function(e){return null!=e&&e>=0&&this.getNumZoomLevels()>e},isValidLonLat:function(e){var t=!1;if(null!=e){var i=this.getMaxExtent();t=i.containsLonLat(e)}return t},getProjection:function(){var e=this.getProjectionObject();return e?e.getCode():null},getProjectionObject:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.projection),e},getMaxResolution:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.maxResolution),e},getMaxExtent:function(e){var t=null;return e&&e.restricted&&this.restrictedExtent?t=this.restrictedExtent:null!=this.baseLayer&&(t=this.baseLayer.maxExtent),t},getNumZoomLevels:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.numZoomLevels),e},getExtent:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.getExtent()),e},getResolution:function(){var e=null;return null!=this.baseLayer?e=this.baseLayer.getResolution():this.allOverlays===!0&&this.layers.length>0&&(e=this.layers[0].getResolution()),e},getUnits:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.units),e},getScale:function(){var e=null;if(null!=this.baseLayer){var t=this.getResolution(),i=this.baseLayer.units;e=OpenLayers.Util.getScaleFromResolution(t,i)}return e},getZoomForExtent:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForExtent(e,t)),i},getResolutionForZoom:function(e){var t=null;return this.baseLayer&&(t=this.baseLayer.getResolutionForZoom(e)),t},getZoomForResolution:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForResolution(e,t)),i},zoomTo:function(e){this.isValidZoomLevel(e)&&this.setCenter(null,e)},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,t){var i=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){var s=this.getMaxExtent();for(e=e.clone();e.right<e.left;)e.right+=s.getWidth();i=e.getCenterLonLat().wrapDateLine(s)}this.setCenter(i,this.getZoomForExtent(e,t))},zoomToMaxExtent:function(e){var t=e?e.restricted:!0,i=this.getMaxExtent({restricted:t});this.zoomToExtent(i)},zoomToScale:function(e,t){var i=OpenLayers.Util.getResolutionFromScale(e,this.baseLayer.units),s=this.getSize(),a=s.w*i,r=s.h*i,n=this.getCachedCenter(),o=new OpenLayers.Bounds(n.lon-a/2,n.lat-r/2,n.lon+a/2,n.lat+r/2);this.zoomToExtent(o,t)},getLonLatFromViewPortPx:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getLonLatFromViewPortPx(e)),t},getViewPortPxFromLonLat:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getViewPortPxFromLonLat(e)),t},getLonLatFromPixel:function(e){return this.getLonLatFromViewPortPx(e)},getPixelFromLonLat:function(e){var t=this.getViewPortPxFromLonLat(e);return t.x=Math.round(t.x),t.y=Math.round(t.y),t},getGeodesicPixelSize:function(e){var t=e?this.getLonLatFromPixel(e):this.getCachedCenter()||new OpenLayers.LonLat(0,0),i=this.getResolution(),s=t.add(-i/2,0),a=t.add(i/2,0),r=t.add(0,-i/2),n=t.add(0,i/2),o=new OpenLayers.Projection("EPSG:4326"),l=this.getProjectionObject()||o;return l.equals(o)||(s.transform(l,o),a.transform(l,o),r.transform(l,o),n.transform(l,o)),new OpenLayers.Size(OpenLayers.Util.distVincenty(s,a),OpenLayers.Util.distVincenty(r,n))},getViewPortPxFromLayerPx:function(e){var t=null;if(null!=e){var i=parseInt(this.layerContainerDiv.style.left),s=parseInt(this.layerContainerDiv.style.top);t=e.add(i,s)}return t},getLayerPxFromViewPortPx:function(e){var t=null;if(null!=e){var i=-parseInt(this.layerContainerDiv.style.left),s=-parseInt(this.layerContainerDiv.style.top);t=e.add(i,s),(isNaN(t.x)||isNaN(t.y))&&(t=null)}return t},getLonLatFromLayerPx:function(e){return e=this.getViewPortPxFromLayerPx(e),this.getLonLatFromViewPortPx(e)},getLayerPxFromLonLat:function(e){var t=this.getPixelFromLonLat(e);return this.getLayerPxFromViewPortPx(t)},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:null,alwaysInRange:null,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","move","moveend","added","removed"],RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,imageOffset:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,transitionEffect:null,SUPPORTED_TRANSITIONS:["resize"],metadata:{},initialize:function(e,t){this.addOptions(t),this.name=e,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)),this.wrapDateLine&&(this.displayOutsideMaxExtent=!0)},destroy:function(e){null==e&&(e=!0),null!=this.map&&this.map.removeLayer(this,e),this.projection=null,this.map=null,this.name=null,this.div=null,this.options=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.eventListeners=null,this.events=null},clone:function(e){return null==e&&(e=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(e,this),e.map=null,e},getOptions:function(){var e={};for(var t in this.options)e[t]=this[t];return e},setName:function(e){e!=this.name&&(this.name=e,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(e,t){if(null==this.options&&(this.options={}),OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e),"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var i=this.map.getResolution(),s=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var a in e)if(e.hasOwnProperty(a)&&OpenLayers.Util.indexOf(s,a)>=0){this.initResolutions(),t&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(i),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var e=!1;if(this.map){this.inRange=this.calculateInRange();var t=this.getExtent();if(t&&this.inRange&&this.visibility){var i=!0;this.moveTo(t,i,!1),this.events.triggerEvent("moveend",{zoomChanged:i}),e=!0}}return e},moveTo:function(){var e=this.visibility;this.isBaseLayer||(e=e&&this.inRange),this.display(e)},moveByPx:function(){},setMap:function(e){if(null==this.map){if(this.map=e,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),!this.isBaseLayer){this.inRange=this.calculateInRange();var t=this.visibility&&this.inRange;this.div.style.display=t?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(){},getImageSize:function(){return this.imageSize||this.tileSize},setTileSize:function(e){var t=e?e:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=t,this.gutter&&(this.imageOffset=new OpenLayers.Pixel(-this.gutter,-this.gutter),this.imageSize=new OpenLayers.Size(t.w+2*this.gutter,t.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(e){e!=this.visibility&&(this.visibility=e,this.display(e),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(e){e!=("none"!=this.div.style.display)&&(this.div.style.display=e&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var e=!1;if(this.alwaysInRange)e=!0;else if(this.map){var t=this.map.getResolution();e=t>=this.minResolution&&this.maxResolution>=t}return e},setIsBaseLayer:function(e){e!=this.isBaseLayer&&(this.isBaseLayer=e,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var e,t,i,s={},a=!0;for(e=0,t=this.RESOLUTION_PROPERTIES.length;t>e;e++)i=this.RESOLUTION_PROPERTIES[e],s[i]=this.options[i],a&&this.options[i]&&(a=!1);if(null==this.alwaysInRange&&(this.alwaysInRange=a),null==s.resolutions&&(s.resolutions=this.resolutionsFromScales(s.scales)),null==s.resolutions&&(s.resolutions=this.calculateResolutions(s)),null==s.resolutions){for(e=0,t=this.RESOLUTION_PROPERTIES.length;t>e;e++)i=this.RESOLUTION_PROPERTIES[e],s[i]=null!=this.options[i]?this.options[i]:this.map[i];null==s.resolutions&&(s.resolutions=this.resolutionsFromScales(s.scales)),null==s.resolutions&&(s.resolutions=this.calculateResolutions(s))}var r;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(r=this.options.maxResolution),this.options.minScale&&(r=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var n;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(n=this.options.minResolution),this.options.maxScale&&(n=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),s.resolutions&&(s.resolutions.sort(function(e,t){return t-e}),r||(r=s.resolutions[0]),!n)){var o=s.resolutions.length-1;n=s.resolutions[o]}if(this.resolutions=s.resolutions,this.resolutions){for(t=this.resolutions.length,this.scales=Array(t),e=0;t>e;e++)this.scales[e]=OpenLayers.Util.getScaleFromResolution(this.resolutions[e],this.units);this.numZoomLevels=t}this.minResolution=n,n&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(n,this.units)),this.maxResolution=r,r&&(this.minScale=OpenLayers.Util.getScaleFromResolution(r,this.units))},resolutionsFromScales:function(e){if(null!=e){var t,i,s;for(s=e.length,t=Array(s),i=0;s>i;i++)t[i]=OpenLayers.Util.getResolutionFromScale(e[i],this.units);return t}},calculateResolutions:function(e){var t,i,s,a=e.maxResolution;null!=e.minScale?a=OpenLayers.Util.getResolutionFromScale(e.minScale,this.units):"auto"==a&&null!=this.maxExtent&&(t=this.map.getSize(),i=this.maxExtent.getWidth()/t.w,s=this.maxExtent.getHeight()/t.h,a=Math.max(i,s));var r=e.minResolution;null!=e.maxScale?r=OpenLayers.Util.getResolutionFromScale(e.maxScale,this.units):"auto"==e.minResolution&&null!=this.minExtent&&(t=this.map.getSize(),i=this.minExtent.getWidth()/t.w,s=this.minExtent.getHeight()/t.h,r=Math.max(i,s));var n=e.maxZoomLevel,o=e.numZoomLevels;if("number"==typeof r&&"number"==typeof a&&void 0===o){var l=a/r;o=Math.floor(Math.log(l)/Math.log(2))+1}else void 0===o&&null!=n&&(o=n+1);if(!("number"!=typeof o||0>=o||"number"!=typeof a&&"number"!=typeof r)){var h=Array(o),u=2;"number"==typeof r&&"number"==typeof a&&(u=Math.pow(a/r,1/(o-1)));var p;if("number"==typeof a)for(p=0;o>p;p++)h[p]=a/Math.pow(u,p);else for(p=0;o>p;p++)h[o-1-p]=r*Math.pow(u,p);return h}},getResolution:function(){var e=this.map.getZoom();return this.getResolutionForZoom(e)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,t){var i=this.map.getSize(),s=Math.max(e.getWidth()/i.w,e.getHeight()/i.h);return this.getZoomForResolution(s,t)},getDataExtent:function(){},getResolutionForZoom:function(e){e=Math.max(0,Math.min(e,this.resolutions.length-1));var t;if(this.map.fractionalZoom){var i=Math.floor(e),s=Math.ceil(e);t=this.resolutions[i]-(e-i)*(this.resolutions[i]-this.resolutions[s])}else t=this.resolutions[Math.round(e)];return t},getZoomForResolution:function(e,t){var i,s,a;if(this.map.fractionalZoom){var r,n=0,o=this.resolutions.length-1,l=this.resolutions[n],h=this.resolutions[o];for(s=0,a=this.resolutions.length;a>s;++s)if(r=this.resolutions[s],r>=e&&(l=r,n=s),e>=r){h=r,o=s;break}var u=l-h;i=u>0?n+(l-e)/u:n}else{var p,c=Number.POSITIVE_INFINITY;for(s=0,a=this.resolutions.length;a>s;s++)if(t){if(p=Math.abs(this.resolutions[s]-e),p>c)break;c=p}else if(e>this.resolutions[s])break;i=Math.max(0,s-1)}return i},getLonLatFromViewPortPx:function(e){var t=null,i=this.map;if(null!=e&&i.minPx){var s=i.getResolution(),a=i.getMaxExtent({restricted:!0}),r=(e.x-i.minPx.x)*s+a.left,n=(i.minPx.y-e.y)*s+a.top;t=new OpenLayers.LonLat(r,n),this.wrapDateLine&&(t=t.wrapDateLine(this.maxExtent))}return t},getViewPortPxFromLonLat:function(e){var t=null;if(null!=e){var i=this.map.getResolution(),s=this.map.getExtent();t=new OpenLayers.Pixel(1/i*(e.lon-s.left),1/i*(s.top-e.lat))}return t},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=0,i=this.div.childNodes.length;i>t;++t){var s=this.div.childNodes[t].firstChild;OpenLayers.Util.modifyDOMElement(s,null,null,null,null,null,null,e)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(e){this.div.style.zIndex=e},adjustBounds:function(e){if(this.gutter){var t=this.gutter*this.map.getResolution();e=new OpenLayers.Bounds(e.left-t,e.bottom-t,e.right+t,e.top+t)}if(this.wrapDateLine){var i={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};e=e.wrapDateLine(this.maxExtent,i)}return e},CLASS_NAME:"OpenLayers.Layer"}),OpenLayers.Layer.SphericalMercator={getExtent:function(){var e=null;return e=this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},getLonLatFromViewPortPx:function(){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];for(var e=156543.03390625,t=0;this.MAX_ZOOM_LEVEL>=t;++t)this.RESOLUTIONS[t]=e/Math.pow(2,t);this.units="m",this.projection=this.projection||"EPSG:900913"},forwardMercator:function(e,t){var i=20037508.34*e/180,s=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return s=20037508.34*s/180,new OpenLayers.LonLat(i,s)},inverseMercator:function(e,t){var i=180*(e/20037508.34),s=180*(t/20037508.34);return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),new OpenLayers.LonLat(i,s)},projectForward:function(e){var t=OpenLayers.Layer.SphericalMercator.forwardMercator(e.x,e.y);return e.x=t.lon,e.y=t.lat,e},projectInverse:function(e){var t=OpenLayers.Layer.SphericalMercator.inverseMercator(e.x,e.y);return e.x=t.lon,e.y=t.lat,e}},function(){var e,t,i,s,a,r=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],n=OpenLayers.Projection.addTransform,o=OpenLayers.Layer.SphericalMercator,l=OpenLayers.Projection.nullTransform;for(e=0,t=r.length;t>e;++e)for(i=r[e],n("EPSG:4326",i,o.projectForward),n(i,"EPSG:4326",o.projectInverse),a=e+1;t>a;++a)s=r[a],n(i,s,l),n(s,i,l)}(),OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:!0,isBaseLayer:!0,isFixed:!0,pane:null,mapObject:null,initialize:function(){OpenLayers.Layer.prototype.initialize.apply(this,arguments),null==this.pane&&(this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane"))},destroy:function(){this.mapObject=null,this.pane=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1,this.pane.style.display=this.div.style.display,this.pane.style.width="100%",this.pane.style.height="100%","msie"==OpenLayers.BROWSER_NAME&&(this.pane.style.background="url("+OpenLayers.Util.getImagesLocation()+"blank.gif)"),this.isFixed?this.map.eventsDiv.appendChild(this.pane):this.map.layerContainerDiv.appendChild(this.pane),this.loadMapObject(),null==this.mapObject&&this.loadWarningMessage()},removeMap:function(){this.pane&&this.pane.parentNode&&this.pane.parentNode.removeChild(this.pane),OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var e=this.map.getSize(),t=Math.min(e.w,300),i=Math.min(e.h,200),s=new OpenLayers.Size(t,i),a=new OpenLayers.Pixel(e.w/2,e.h/2),r=a.add(-s.w/2,-s.h/2),n=OpenLayers.Util.createDiv(this.name+"_warning",r,s,null,null,null,"auto");n.style.padding="7px",n.style.backgroundColor="yellow",n.innerHTML=this.getWarningHTML(),this.div.appendChild(n)},getWarningHTML:function(){return""},display:function(){OpenLayers.Layer.prototype.display.apply(this,arguments),this.pane.style.display=this.div.style.display},setZIndex:function(){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(e,t){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments),this.dragPanMapObject?this.dragPanMapObject(e,-t):this.moveTo(this.map.getCachedCenter())},moveTo:function(e,t,i){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),null!=this.mapObject){var s=this.map.getCenter(),a=this.map.getZoom();if(null!=s){var r=this.getMapObjectCenter(),n=this.getOLLonLatFromMapObjectLonLat(r),o=this.getMapObjectZoom(),l=this.getOLZoomFromMapObjectZoom(o);if(!s.equals(n)||a!=l)if(!t&&n&&this.dragPanMapObject&&this.smoothDragPan){var h=this.map.getViewPortPxFromLonLat(n),u=this.map.getViewPortPxFromLonLat(s);this.dragPanMapObject(u.x-h.x,h.y-u.y)}else{var p=this.getMapObjectLonLatFromOLLonLat(s),c=this.getMapObjectZoomFromOLZoom(a);this.setMapObjectCenter(p,c,i)}}}},getLonLatFromViewPortPx:function(e){var t=null;if(null!=this.mapObject&&null!=this.getMapObjectCenter()){var i=this.getMapObjectPixelFromOLPixel(e),s=this.getMapObjectLonLatFromMapObjectPixel(i);t=this.getOLLonLatFromMapObjectLonLat(s)}return t},getViewPortPxFromLonLat:function(e){var t=null;if(null!=this.mapObject&&null!=this.getMapObjectCenter()){var i=this.getMapObjectLonLatFromOLLonLat(e),s=this.getMapObjectPixelFromMapObjectLonLat(i);t=this.getOLPixelFromMapObjectPixel(s)}return t},getOLLonLatFromMapObjectLonLat:function(e){var t=null;if(null!=e){var i=this.getLongitudeFromMapObjectLonLat(e),s=this.getLatitudeFromMapObjectLonLat(e);t=new OpenLayers.LonLat(i,s)}return t},getMapObjectLonLatFromOLLonLat:function(e){var t=null;return null!=e&&(t=this.getMapObjectLonLatFromLonLat(e.lon,e.lat)),t},getOLPixelFromMapObjectPixel:function(e){var t=null;if(null!=e){var i=this.getXFromMapObjectPixel(e),s=this.getYFromMapObjectPixel(e);t=new OpenLayers.Pixel(i,s)}return t},getMapObjectPixelFromOLPixel:function(e){var t=null;return null!=e&&(t=this.getMapObjectPixelFromXY(e.x,e.y)),t},CLASS_NAME:"OpenLayers.Layer.EventPane"}),OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){for(var e=Array("minZoomLevel","maxZoomLevel","numZoomLevels"),t=0,i=e.length;i>t;t++){var s=e[t];this[s]=null!=this.options[s]?this.options[s]:this.map[s]}(null==this.minZoomLevel||this.minZoomLevel<this.MIN_ZOOM_LEVEL)&&(this.minZoomLevel=this.MIN_ZOOM_LEVEL);var a,r=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;if(a=null==this.options.numZoomLevels&&null!=this.options.maxZoomLevel||null==this.numZoomLevels&&null!=this.maxZoomLevel?this.maxZoomLevel-this.minZoomLevel+1:this.numZoomLevels,this.numZoomLevels=null!=a?Math.min(a,r):r,this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1,null!=this.RESOLUTIONS){var n=0;this.resolutions=[];for(var t=this.minZoomLevel;this.maxZoomLevel>=t;t++)this.resolutions[n++]=this.RESOLUTIONS[t];this.maxResolution=this.resolutions[0],this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getResolution.apply(this,arguments);var e=null,t=this.map.getSize(),i=this.getExtent();return null!=t&&null!=i&&(e=Math.max(i.getWidth()/t.w,i.getHeight()/t.h)),e},getExtent:function(){var e=null,t=this.map.getSize(),i=new OpenLayers.Pixel(0,0),s=this.getLonLatFromViewPortPx(i),a=new OpenLayers.Pixel(t.w,t.h),r=this.getLonLatFromViewPortPx(a);return null!=s&&null!=r&&(e=new OpenLayers.Bounds(s.lon,r.lat,r.lon,s.lat)),e},getZoomForResolution:function(){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments);var e=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(e)},getOLZoomFromMapObjectZoom:function(e){var t=null;return null!=e&&(t=e-this.minZoomLevel,this.map.baseLayer!==this&&(t=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(t)))),t},getMapObjectZoomFromOLZoom:function(e){var t=null;return null!=e&&(t=e+this.minZoomLevel,this.map.baseLayer!==this&&(t=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(t)))),t},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"}),OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20,1072883605957031e-20,536441802978515e-20,268220901489257e-20,1341104507446289e-21,6.705522537231445e-7],type:null,wrapDateLine:!0,sphericalMercator:!1,version:null,initialize:function(e,t){t=t||{},t.version||(t.version="function"==typeof GMap2?"2":"3");var i=OpenLayers.Layer.Google["v"+t.version.replace(/\./g,"_")];if(!i)throw"Unsupported Google Maps API version: "+t.version;OpenLayers.Util.applyDefaults(t,i),OpenLayers.Util.applyDefaults(t,i.DEFAULTS),t.maxExtent&&(t.maxExtent=t.maxExtent.clone()),OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[e,t]),OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[e,t]),this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(){var e=null==this.opacity?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments),this.setOpacity(e)},display:function(e){this._dragging||this.setGMapVisibility(e),OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(e,t,i){this._dragging=i,OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments),delete this._dragging
},setOpacity:function(e){if(e!==this.opacity&&(null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"}),this.opacity=e),this.getVisibility()){var t=this.getMapContainer();OpenLayers.Util.modifyDOMElement(t,null,null,null,null,null,null,e)}},destroy:function(){if(this.map){this.setGMapVisibility(!1);var e=OpenLayers.Layer.Google.cache[this.map.id];e&&1>=e.count&&this.removeGMapElements()}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var e=OpenLayers.Layer.Google.cache[this.map.id];if(e){var t=this.mapObject&&this.getMapContainer();t&&t.parentNode&&t.parentNode.removeChild(t);var i=e.termsOfUse;i&&i.parentNode&&i.parentNode.removeChild(i);var s=e.poweredBy;s&&s.parentNode&&s.parentNode.removeChild(s)}},removeMap:function(e){this.visibility&&this.mapObject&&this.setGMapVisibility(!1);var t=OpenLayers.Layer.Google.cache[e.id];t&&(1>=t.count?(this.removeGMapElements(),delete OpenLayers.Layer.Google.cache[e.id]):--t.count),delete this.termsOfUse,delete this.poweredBy,delete this.mapObject,delete this.dragObject,OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(e){var t=null;if(null!=e){var i=e.getSouthWest(),s=e.getNorthEast();this.sphericalMercator?(i=this.forwardMercator(i.lng(),i.lat()),s=this.forwardMercator(s.lng(),s.lat())):(i=new OpenLayers.LonLat(i.lng(),i.lat()),s=new OpenLayers.LonLat(s.lng(),s.lat())),t=new OpenLayers.Bounds(i.lon,i.lat,s.lon,s.lat)}return t},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(e){return this.sphericalMercator?this.forwardMercator(e.lng(),e.lat()).lon:e.lng()},getLatitudeFromMapObjectLonLat:function(e){var t=this.sphericalMercator?this.forwardMercator(e.lng(),e.lat()).lat:e.lat();return t},getXFromMapObjectPixel:function(e){return e.x},getYFromMapObjectPixel:function(e){return e.y},CLASS_NAME:"OpenLayers.Layer.Google"}),OpenLayers.Layer.Google.cache={},OpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){this.type||(this.type=G_NORMAL_MAP);var e,t,i,s=OpenLayers.Layer.Google.cache[this.map.id];if(s)e=s.mapObject,t=s.termsOfUse,i=s.poweredBy,++s.count;else{var a=this.map.viewPortDiv,r=document.createElement("div");r.id=this.map.id+"_GMap2Container",r.style.position="absolute",r.style.width="100%",r.style.height="100%",a.appendChild(r);try{e=new GMap2(r),t=r.lastChild,a.appendChild(t),t.style.zIndex="1100",t.style.right="",t.style.bottom="",t.className="olLayerGoogleCopyright",i=r.lastChild,a.appendChild(i),i.style.zIndex="1100",i.style.right="",i.style.bottom="",i.className="olLayerGooglePoweredBy gmnoprint"}catch(n){throw n}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:e,termsOfUse:t,poweredBy:i,count:1}}this.mapObject=e,this.termsOfUse=t,this.poweredBy=i,-1===OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)&&this.mapObject.addMapType(this.type),"function"==typeof e.getDragObject?this.dragObject=e.getDragObject():this.dragPanMapObject=null,this.isBaseLayer===!1&&this.setGMapVisibility("none"!==this.div.style.display)},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded())this.mapObject.checkResize();else{if(!this._resized)var e=this,t=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(t),delete e._resized,e.mapObject.checkResize(),e.moveTo(e.map.getCenter(),e.map.getZoom())});this._resized=!0}},setGMapVisibility:function(e){var t=OpenLayers.Layer.Google.cache[this.map.id];if(t){var i=this.mapObject.getContainer();e===!0?(this.mapObject.setMapType(this.type),i.style.display="",this.termsOfUse.style.left="",this.termsOfUse.style.display="",this.poweredBy.style.display="",t.displayed=this.id):(t.displayed===this.id&&delete t.displayed,t.displayed||(i.style.display="none",this.termsOfUse.style.display="none",this.termsOfUse.style.left="-9999px",this.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(e){var t=null;if(null!=e){var i=this.sphericalMercator?this.inverseMercator(e.bottom,e.left):new OpenLayers.LonLat(e.bottom,e.left),s=this.sphericalMercator?this.inverseMercator(e.top,e.right):new OpenLayers.LonLat(e.top,e.right);t=new GLatLngBounds(new GLatLng(i.lat,i.lon),new GLatLng(s.lat,s.lon))}return t},setMapObjectCenter:function(e,t){this.mapObject.setCenter(e,t)},dragPanMapObject:function(e,t){this.dragObject.moveBy(new GSize(-e,t))},getMapObjectLonLatFromMapObjectPixel:function(e){return this.mapObject.fromContainerPixelToLatLng(e)},getMapObjectPixelFromMapObjectLonLat:function(e){return this.mapObject.fromLatLngToContainerPixel(e)},getMapObjectZoomFromMapObjectBounds:function(e){return this.mapObject.getBoundsZoomLevel(e)},getMapObjectLonLatFromLonLat:function(e,t){var i;if(this.sphericalMercator){var s=this.inverseMercator(e,t);i=new GLatLng(s.lat,s.lon)}else i=new GLatLng(t,e);return i},getMapObjectPixelFromXY:function(e,t){return new GPoint(e,t)}},OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,initialize:function(e,t,i){OpenLayers.Util.extend(this,i),this.control=e,this.callbacks=t;var s=this.map||e.map;s&&this.setMap(s),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(e){this.map=e},checkModifiers:function(e){if(null==this.keyMask)return!0;var t=(e.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(e.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(e.altKey?OpenLayers.Handler.MOD_ALT:0);return t==this.keyMask},activate:function(){if(this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,i=e.length;i>t;t++)this[e[t]]&&this.register(e[t],this[e[t]]);return this.active=!0,!0},deactivate:function(){if(!this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,i=e.length;i>t;t++)this[e[t]]&&this.unregister(e[t],this[e[t]]);return this.active=!1,!0},callback:function(e,t){e&&this.callbacks[e]&&this.callbacks[e].apply(this.control,t)},register:function(e,t){this.map.events.registerPriority(e,this,t),this.map.events.registerPriority(e,this,this.setEvent)},unregister:function(e,t){this.map.events.unregister(e,this,t),this.map.events.unregister(e,this,this.setEvent)},setEvent:function(e){return this.evt=e,!0},destroy:function(){this.deactivate(),this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"}),OpenLayers.Handler.MOD_NONE=0,OpenLayers.Handler.MOD_SHIFT=1,OpenLayers.Handler.MOD_CTRL=2,OpenLayers.Handler.MOD_ALT=4,OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},touchstart:function(e){var t=!0;return this.pinching=!1,OpenLayers.Event.isMultiTouch(e)?(this.started=!0,this.last=this.start={distance:this.getDistance(e.touches),delta:0,scale:1},this.callback("start",[e,this.start]),t=!this.stopDown):(this.started=!1,this.start=null,this.last=null),OpenLayers.Event.stop(e),t},touchmove:function(e){if(this.started&&OpenLayers.Event.isMultiTouch(e)){this.pinching=!0;var t=this.getPinchData(e);this.callback("move",[e,t]),this.last=t,OpenLayers.Event.stop(e)}return!0},touchend:function(e){return this.started&&(this.started=!1,this.pinching=!1,this.callback("done",[e,this.start,this.last]),this.start=null,this.last=null),!0},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.pinching=!1,this.start=null,this.last=null,e=!0),e},getDistance:function(e){var t=e[0],i=e[1];return Math.sqrt(Math.pow(t.clientX-i.clientX,2)+Math.pow(t.clientY-i.clientY,2))},getPinchData:function(e){var t=this.getDistance(e.touches),i=t/this.start.distance;return{distance:t,delta:this.last.distance-t,scale:i}},CLASS_NAME:"OpenLayers.Handler.Pinch"}),OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,containerOrigin:null,pinchOrigin:null,currentCenter:null,autoActivate:!0,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},activate:function(){var e=OpenLayers.Control.prototype.activate.apply(this,arguments);return e&&(this.map.events.on({moveend:this.updateContainerOrigin,scope:this}),this.updateContainerOrigin()),e},deactivate:function(){var e=OpenLayers.Control.prototype.deactivate.apply(this,arguments);return this.map&&this.map.events&&this.map.events.un({moveend:this.updateContainerOrigin,scope:this}),e},updateContainerOrigin:function(){var e=this.map.layerContainerDiv;this.containerOrigin={x:parseInt(e.style.left,10),y:parseInt(e.style.top,10)}},pinchStart:function(e){this.pinchOrigin=e.xy,this.currentCenter=e.xy},pinchMove:function(e,t){var i=t.scale,s=this.containerOrigin,a=this.pinchOrigin,r=e.xy,n=Math.round(r.x-a.x+(i-1)*(s.x-a.x)),o=Math.round(r.y-a.y+(i-1)*(s.y-a.y));this.applyTransform("translate("+n+"px, "+o+"px) scale("+i+")"),this.currentCenter=r},applyTransform:function(e){var t=this.map.layerContainerDiv.style;t["-webkit-transform"]=e,t["-moz-transform"]=e},pinchDone:function(e,t,i){this.applyTransform("");var s=this.map.getZoomForResolution(this.map.getResolution()/i.scale,!0);if(s!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var a=this.map.getResolutionForZoom(s),r=this.map.getLonLatFromPixel(this.pinchOrigin),n=this.currentCenter,o=this.map.getSize();r.lon+=a*(o.w/2-n.x),r.lat-=a*(o.h/2-n.y),this.map.setCenter(r,s)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"}),OpenLayers.Format.WFST=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.WFST.DEFAULTS);var t=OpenLayers.Format.WFST["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFST version: "+e.version;return new t(e)},OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"},OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(e){this.stateName={},this.stateName[OpenLayers.State.INSERT]="wfs:Insert",this.stateName[OpenLayers.State.UPDATE]="wfs:Update",this.stateName[OpenLayers.State.DELETE]="wfs:Delete",OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},getSrsName:function(e,t){var i=t&&t.srsName;return i||(i=e&&e.layer?e.layer.projection.getCode():this.srsName),i},read:function(e,t){t=t||{},OpenLayers.Util.applyDefaults(t,{output:"features"}),"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var i={};return e&&this.readNode(e,i,!0),i.features&&"features"===t.output&&(i=i.features),i},readers:{wfs:{FeatureCollection:function(e,t){t.features=[],this.readChildNodes(e,t)}}},write:function(e,t){var i=this.writeNode("wfs:Transaction",{features:e,options:t}),s=this.schemaLocationAttr();return s&&this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",s),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{wfs:{GetFeature:function(e){var t=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:e&&e.handle,outputFormat:e&&e.outputFormat,maxFeatures:e&&e.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(e)}});if("string"==typeof this.featureType)this.writeNode("Query",e,t);else for(var i=0,s=this.featureType.length;s>i;i++)e.featureType=this.featureType[i],this.writeNode("Query",e,t);return t},Transaction:function(e){e=e||{};var t,i,s=e.options||{},a=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:s.handle}}),r=e.features;if(r){s.multi===!0&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":this.multiCurve===!0?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":this.multiSurface===!0?"MultiSurface":"MultiPolygon"});var n,o;for(t=0,i=r.length;i>t;++t)o=r[t],n=this.stateName[o.state],n&&this.writeNode(n,{feature:o,options:s},a);s.multi===!0&&this.setGeometryTypes()}if(s.nativeElements)for(t=0,i=s.nativeElements.length;i>t;++t)this.writeNode("wfs:Native",s.nativeElements[t],a);return a},Native:function(e){var t=this.createElementNSPlus("wfs:Native",{attributes:{vendorId:e.vendorId,safeToIgnore:e.safeToIgnore},value:e.value});return t},Insert:function(e){var t=e.feature,i=e.options,s=this.createElementNSPlus("wfs:Insert",{attributes:{handle:i&&i.handle}});return this.srsName=this.getSrsName(t),this.writeNode("feature:_typeName",t,s),s},Update:function(e){var t=e.feature,i=e.options,s=this.createElementNSPlus("wfs:Update",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&s.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var a=t.modified;null===this.geometryName||a&&void 0===a.geometry||(this.srsName=this.getSrsName(t),this.writeNode("Property",{name:this.geometryName,value:t.geometry},s));for(var r in t.attributes)void 0===t.attributes[r]||a&&a.attributes&&(!a.attributes||void 0===a.attributes[r])||this.writeNode("Property",{name:r,value:t.attributes[r]},s);return this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),s),s},Property:function(e){var t=this.createElementNSPlus("wfs:Property");return this.writeNode("Name",e.name,t),null!==e.value&&this.writeNode("Value",e.value,t),t},Name:function(e){return this.createElementNSPlus("wfs:Name",{value:e})},Value:function(e){var t;if(e instanceof OpenLayers.Geometry){t=this.createElementNSPlus("wfs:Value");var i=this.writeNode("feature:_geometry",e).firstChild;t.appendChild(i)}else t=this.createElementNSPlus("wfs:Value",{value:e});return t},Delete:function(e){var t=e.feature,i=e.options,s=this.createElementNSPlus("wfs:Delete",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&s.setAttribute("xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),s),s}}},schemaLocationAttr:function(e){e=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},e);var t=OpenLayers.Util.extend({},this.schemaLocations);e.schema&&(t[e.featurePrefix]=e.schema);var i,s=[];for(var a in t)i=this.namespaces[a],i&&s.push(i+" "+t[a]);var r=s.join(" ")||void 0;return r},setFilterProperty:function(e){if(e.filters)for(var t=0,i=e.filters.length;i>t;++t)this.setFilterProperty(e.filters[t]);else e instanceof OpenLayers.Filter.Spatial&&(e.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"}),OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(e,t){this.readChildNodes(e,t)},Curve:function(e,t){var i={points:[]};this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.LineString(i.points))},segments:function(e,t){this.readChildNodes(e,t)},LineStringSegment:function(e,t){var i={};this.readChildNodes(e,i),i.points&&Array.prototype.push.apply(t.points,i.points)},pos:function(e,t){var i,s=this.getChildValue(e).replace(this.regExes.trimSpace,""),a=s.split(this.regExes.splitSpace);i=this.xy?new OpenLayers.Geometry.Point(a[0],a[1],a[2]):new OpenLayers.Geometry.Point(a[1],a[0],a[2]),t.points=[i]},posList:function(e,t){for(var i,s,a,r=this.getChildValue(e).replace(this.regExes.trimSpace,""),n=r.split(this.regExes.splitSpace),o=parseInt(e.getAttribute("dimension"))||2,l=n.length/o,h=Array(l),u=0,p=n.length;p>u;u+=o)i=n[u],s=n[u+1],a=2==o?void 0:n[u+2],h[u/o]=this.xy?new OpenLayers.Geometry.Point(i,s,a):new OpenLayers.Geometry.Point(s,i,a);t.points=h},Surface:function(e,t){this.readChildNodes(e,t)},patches:function(e,t){this.readChildNodes(e,t)},PolygonPatch:function(e,t){this.readers.gml.Polygon.apply(this,[e,t])},exterior:function(e,t){var i={};this.readChildNodes(e,i),t.outer=i.components[0]},interior:function(e,t){var i={};this.readChildNodes(e,i),t.inner.push(i.components[0])},MultiCurve:function(e,t){var i={components:[]};this.readChildNodes(e,i),i.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiLineString(i.components)])},curveMember:function(e,t){this.readChildNodes(e,t)},MultiSurface:function(e,t){var i={components:[]};this.readChildNodes(e,i),i.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiPolygon(i.components)])},surfaceMember:function(e,t){this.readChildNodes(e,t)},surfaceMembers:function(e,t){this.readChildNodes(e,t)},pointMembers:function(e,t){this.readChildNodes(e,t)},lineStringMembers:function(e,t){this.readChildNodes(e,t)},polygonMembers:function(e,t){this.readChildNodes(e,t)},geometryMembers:function(e,t){this.readChildNodes(e,t)},Envelope:function(e,t){var i={points:Array(2)};this.readChildNodes(e,i),t.components||(t.components=[]);var s=i.points[0],a=i.points[1];t.components.push(new OpenLayers.Bounds(s.x,s.y,a.x,a.y))},lowerCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]),t.points[0]=i.points[0]},upperCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]),t.points[1]=i.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var i=this.writeNode("gml:"+t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(e){for(var t=this.createElementNSPlus("gml:featureMembers"),i=0,s=e.length;s>i;++i)this.writeNode("feature:_typeName",e[i],t);return t},Point:function(e){var t=this.createElementNSPlus("gml:Point");return this.writeNode("pos",e,t),t},pos:function(e){var t=this.xy?e.x+" "+e.y:e.y+" "+e.x;return this.createElementNSPlus("gml:pos",{value:t})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");return this.writeNode("posList",e.components,t),t},Curve:function(e){var t=this.createElementNSPlus("gml:Curve");return this.writeNode("segments",e,t),t},segments:function(e){var t=this.createElementNSPlus("gml:segments");return this.writeNode("LineStringSegment",e,t),t},LineStringSegment:function(e){var t=this.createElementNSPlus("gml:LineStringSegment");return this.writeNode("posList",e.components,t),t},posList:function(e){for(var t,i=e.length,s=Array(i),a=0;i>a;++a)t=e[a],s[a]=this.xy?t.x+" "+t.y:t.y+" "+t.x;return this.createElementNSPlus("gml:posList",{value:s.join(" ")})},Surface:function(e){var t=this.createElementNSPlus("gml:Surface");return this.writeNode("patches",e,t),t},patches:function(e){var t=this.createElementNSPlus("gml:patches");return this.writeNode("PolygonPatch",e,t),t},PolygonPatch:function(e){var t=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",e.components[0],t);for(var i=1,s=e.components.length;s>i;++i)this.writeNode("interior",e.components[i],t);return t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",e.components[0],t);for(var i=1,s=e.components.length;s>i;++i)this.writeNode("interior",e.components[i],t);return t},exterior:function(e){var t=this.createElementNSPlus("gml:exterior");return this.writeNode("LinearRing",e,t),t},interior:function(e){var t=this.createElementNSPlus("gml:interior");return this.writeNode("LinearRing",e,t),t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");return this.writeNode("posList",e.components,t),t},MultiCurve:function(e){for(var t=this.createElementNSPlus("gml:MultiCurve"),i=e.components||[e],s=0,a=i.length;a>s;++s)this.writeNode("curveMember",i[s],t);return t},curveMember:function(e){var t=this.createElementNSPlus("gml:curveMember");return this.curve?this.writeNode("Curve",e,t):this.writeNode("LineString",e,t),t},MultiSurface:function(e){for(var t=this.createElementNSPlus("gml:MultiSurface"),i=e.components||[e],s=0,a=i.length;a>s;++s)this.writeNode("surfaceMember",i[s],t);return t},surfaceMember:function(e){var t=this.createElementNSPlus("gml:surfaceMember");return this.surface?this.writeNode("Surface",e,t):this.writeNode("Polygon",e,t),t},Envelope:function(e){var t=this.createElementNSPlus("gml:Envelope");return this.writeNode("lowerCorner",e,t),this.writeNode("upperCorner",e,t),this.srsName&&t.setAttribute("srsName",this.srsName),t},lowerCorner:function(e){var t=this.xy?e.left+" "+e.bottom:e.bottom+" "+e.left;return this.createElementNSPlus("gml:lowerCorner",{value:t})},upperCorner:function(e){var t=this.xy?e.right+" "+e.top:e.top+" "+e.right;return this.createElementNSPlus("gml:upperCorner",{value:t})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":this.curve===!0?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":this.multiCurve===!1?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":this.surface===!0?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":this.multiSurface===!1?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"}),OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=e.getAttribute("matchCase"),s=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,s),t.filters.push(s)},PropertyIsNotEqualTo:function(e,t){var i=e.getAttribute("matchCase"),s=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,s),t.filters.push(s)},PropertyIsLike:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,i);var s=e.getAttribute("wildCard"),a=e.getAttribute("singleChar"),r=e.getAttribute("escapeChar");i.value2regex(s,a,r),t.filters.push(i)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:e.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});return this.writeNode("PropertyName",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Envelope",e.value);return e.projection&&i.setAttribute("srsName",e.projection),t.appendChild(i),t},SortBy:function(e){for(var t=this.createElementNSPlus("ogc:SortBy"),i=0,s=e.length;s>i;i++)this.writeNode("ogc:SortProperty",e[i],t);return t},SortProperty:function(e){var t=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",e,t),this.writeNode("ogc:SortOrder","DESC"==e.order?"DESC":"ASC",t),t},SortOrder:function(e){var t=this.createElementNSPlus("ogc:SortOrder",{value:e});return t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(e,t){var i=this.createElementNSPlus("ogc:"+t);if(this.writeNode("PropertyName",e,i),e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,i);else{var s;s=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Envelope",e.value),e.projection&&s.setAttribute("srsName",e.projection),i.appendChild(s)}return i},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"}),OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[e]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,[e,t])},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(e,t){t.numberOfFeatures=parseInt(e.getAttribute("numberOfFeatures")),OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},TransactionSummary:function(e,t){t.success=!0},InsertResults:function(e,t){this.readChildNodes(e,t)},Feature:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds.push(i.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(e){var t=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);return e&&this.setAttributes(t,{resultType:e.resultType,startIndex:e.startIndex,count:e.count}),t},Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},e);var t=e.featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType,srsName:e.srsName}});if(e.featureNS&&i.setAttribute("xmlns:"+t,e.featureNS),e.propertyNames)for(var s=0,a=e.propertyNames.length;a>s;s++)this.writeNode("wfs:PropertyName",{property:e.propertyNames[s]},i);return e.filter&&(this.setFilterProperty(e.filter),this.writeNode("ogc:Filter",e.filter,i)),i},PropertyName:function(e){return this.createElementNSPlus("wfs:PropertyName",{value:e.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"}),OpenLayers.Lang.is=OpenLayers.Util.applyDefaults({Permalink:"Varanlegur tengill",Overlays:"Þekjur","Base Layer":"Grunnlag",readNotImplemented:"Skrifun er óútfærð.",writeNotImplemented:"Lestur er óútfærður.",errorLoadingGML:"Villa kom upp við að hlaða inn GML skránni ${url}","Scale = 1 : ${scaleDenom}":"Skali = 1 : ${scaleDenom}",layerAlreadyAdded:"Þú reyndir að bæta laginu ${layerName} á kortið en það er þegar búið að bæta því við",methodDeprecated:"Þetta fall hefur verið úrelt og verður fjarlægt í 3.0. Notaðu ${newMethod} í staðin."}),OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",errorProperty:"service",CLASS_NAME:"OpenLayers.Format.WFSCapabilities"}),OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.WFSCapabilities,{initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.options=e},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t={},i=e.documentElement;return this.runChildNodes(t,i),t},runChildNodes:function(e,t){for(var i,s,a=t.childNodes,r=0;a.length>r;++r)i=a[r],1==i.nodeType&&(s=this["read_cap_"+i.nodeName],s&&s.apply(this,[e,i]))},read_cap_FeatureTypeList:function(e,t){var i={featureTypes:[]};this.runChildNodes(i,t),e.featureTypeList=i},read_cap_FeatureType:function(e,t){var i={};this.runChildNodes(i,t),e.featureTypes.push(i)},read_cap_Name:function(e,t){var i=this.getChildValue(t);if(i){var s=i.split(":");e.name=s.pop(),s.length>0&&(e.featureNS=this.lookupNamespaceURI(t,s[0]))}},read_cap_Title:function(e,t){var i=this.getChildValue(t);i&&(e.title=i)},read_cap_Abstract:function(e,t){var i=this.getChildValue(t);i&&(e["abstract"]=i)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"}),OpenLayers.Layer.VirtualEarth=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:1,MAX_ZOOM_LEVEL:19,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20,1072883605957031e-20,536441802978515e-20],type:null,wrapDateLine:!0,sphericalMercator:!1,animationEnabled:!0,initialize:function(){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments),OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments),this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},loadMapObject:function(){var e=OpenLayers.Util.createDiv(this.name),t=this.map.getSize();e.style.width=t.w+"px",e.style.height=t.h+"px",this.div.appendChild(e);try{this.mapObject=new VEMap(this.name)}catch(i){}if(null!=this.mapObject){try{this.mapObject.LoadMap(null,null,this.type,!0),this.mapObject.AttachEvent("onmousedown",OpenLayers.Function.True)}catch(i){}this.mapObject.HideDashboard(),"function"==typeof this.mapObject.SetAnimationEnabled&&this.mapObject.SetAnimationEnabled(this.animationEnabled)}this.mapObject&&this.mapObject.vemapcontrol&&this.mapObject.vemapcontrol.PanMap&&"function"==typeof this.mapObject.vemapcontrol.PanMap||(this.dragPanMapObject=null)},onMapResize:function(){this.mapObject.Resize(this.map.size.w,this.map.size.h)},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"VE",layerLib:"VirtualEarth"})},setMapObjectCenter:function(e,t){this.mapObject.SetCenterAndZoom(e,t)},getMapObjectCenter:function(){return this.mapObject.GetCenter()},dragPanMapObject:function(e,t){this.mapObject.vemapcontrol.PanMap(e,-t)},getMapObjectZoom:function(){return this.mapObject.GetZoomLevel()},getMapObjectLonLatFromMapObjectPixel:function(e){return"undefined"!=typeof VEPixel?this.mapObject.PixelToLatLong(e):this.mapObject.PixelToLatLong(e.x,e.y)},getMapObjectPixelFromMapObjectLonLat:function(e){return this.mapObject.LatLongToPixel(e)},getLongitudeFromMapObjectLonLat:function(e){return this.sphericalMercator?this.forwardMercator(e.Longitude,e.Latitude).lon:e.Longitude
},getLatitudeFromMapObjectLonLat:function(e){return this.sphericalMercator?this.forwardMercator(e.Longitude,e.Latitude).lat:e.Latitude},getMapObjectLonLatFromLonLat:function(e,t){var i;if(this.sphericalMercator){var s=this.inverseMercator(e,t);i=new VELatLong(s.lat,s.lon)}else i=new VELatLong(t,e);return i},getXFromMapObjectPixel:function(e){return e.x},getYFromMapObjectPixel:function(e){return e.y},getMapObjectPixelFromXY:function(e,t){return"undefined"!=typeof VEPixel?new VEPixel(e,t):new Msn.VE.Pixel(e,t)},CLASS_NAME:"OpenLayers.Layer.VirtualEarth"}),OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),this.controls=[],this.activeState={}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var e,t=this.controls.length-1;t>=0;t--)e=this.controls[t],e.events&&e.events.un({activate:this.iconOn,deactivate:this.iconOff}),OpenLayers.Event.stopObservingElement(e.panel_div),e.panel_div=null;this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var e,t=0,i=this.controls.length;i>t;t++)e=this.controls[t],(e===this.defaultControl||this.saveState&&this.activeState[e.id])&&e.activate();return this.saveState===!0&&(this.defaultControl=null),this.redraw(),!0}return!1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var e,t=0,i=this.controls.length;i>t;t++)e=this.controls[t],this.activeState[e.id]=e.deactivate();return this.redraw(),!0}return!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.addControlsToMap(this.controls),this.div},redraw:function(){for(var e=this.div.childNodes.length,t=e-1;t>=0;t--)this.div.removeChild(this.div.childNodes[t]);if(this.div.innerHTML="",this.active)for(var t=0,i=this.controls.length;i>t;t++)this.div.appendChild(this.controls[t].panel_div)},activateControl:function(e){if(!this.active)return!1;if(e.type==OpenLayers.Control.TYPE_BUTTON)return e.trigger(),void 0;if(e.type==OpenLayers.Control.TYPE_TOGGLE)return e.active?e.deactivate():e.activate(),void 0;if(this.allowDepress&&e.active)e.deactivate();else{for(var t,i=0,s=this.controls.length;s>i;i++)t=this.controls[i],t==e||t.type!==OpenLayers.Control.TYPE_TOOL&&null!=t.type||t.deactivate();e.activate()}},addControls:function(e){OpenLayers.Util.isArray(e)||(e=[e]),this.controls=this.controls.concat(e);for(var t=0,i=e.length;i>t;t++){var s=document.createElement("div");s.className=e[t].displayClass+"ItemInactive",e[t].panel_div=s,""!=e[t].title&&(e[t].panel_div.title=e[t].title),OpenLayers.Event.observe(e[t].panel_div,"click",OpenLayers.Function.bind(this.onClick,this,e[t])),OpenLayers.Event.observe(e[t].panel_div,"dblclick",OpenLayers.Function.bind(this.onDoubleClick,this,e[t])),OpenLayers.Event.observe(e[t].panel_div,"mousedown",OpenLayers.Function.bindAsEventListener(OpenLayers.Event.stop))}this.map&&(this.addControlsToMap(e),this.redraw())},addControlsToMap:function(e){for(var t,i=0,s=e.length;s>i;i++)t=e[i],t.autoActivate===!0?(t.autoActivate=!1,this.map.addControl(t),t.autoActivate=!0):(this.map.addControl(t),t.deactivate()),t.events.on({activate:this.iconOn,deactivate:this.iconOff})},iconOn:function(){var e=this.panel_div;e.className=e.className.replace(/ItemInactive$/,"ItemActive")},iconOff:function(){var e=this.panel_div;e.className=e.className.replace(/ItemActive$/,"ItemInactive")},onClick:function(e,t){OpenLayers.Event.stop(t?t:window.event),this.activateControl(e)},onDoubleClick:function(e,t){OpenLayers.Event.stop(t?t:window.event)},getControlsBy:function(e,t){var i="function"==typeof t.test,s=OpenLayers.Array.filter(this.controls,function(s){return s[e]==t||i&&t.test(s[e])});return s},getControlsByName:function(e){return this.getControlsBy("name",e)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},CLASS_NAME:"OpenLayers.Control.Panel"}),OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"}),OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"}),OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"}),OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]),this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(e,t,i,s){OpenLayers.Layer.prototype.initialize.apply(this,[e,s]),this.url=t,this.params=OpenLayers.Util.extend({},i)},destroy:function(){this.url=null,this.params=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e])},setUrl:function(e){this.url=e},mergeNewParams:function(e){this.params=OpenLayers.Util.extend(this.params,e);var t=this.redraw();return null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),t},redraw:function(e){return e?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(e,t){for(var i=1,s=0,a=e.length;a>s;s++)i*=e.charCodeAt(s)*this.URL_HASH_FACTOR,i-=Math.floor(i);return t[Math.floor(i*t.length)]},getFullRequestString:function(e,t){var i=t||this.url,s=OpenLayers.Util.extend({},this.params);s=OpenLayers.Util.extend(s,e);var a=OpenLayers.Util.getParameterString(s);OpenLayers.Util.isArray(i)&&(i=this.selectUrl(a,i));var r=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i));for(var n in s)n.toUpperCase()in r&&delete s[n];return a=OpenLayers.Util.getParameterString(s),OpenLayers.Util.urlAppend(i,a)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,grid:null,singleTile:!1,ratio:1.5,buffer:0,numLoadingTiles:0,tileLoadingDelay:100,timerId:null,initialize:function(){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.events.addEventType("tileloaded"),this.grid=[],this._moveGriddedTiles=OpenLayers.Function.bind(this.moveGriddedTiles,this)},removeMap:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},destroy:function(){this.clearGrid(),this.grid=null,this.tileSize=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;t>e;e++)for(var i=this.grid[e],s=0,a=i.length;a>s;s++){var r=i[s];this.removeTileMonitoringHooks(r),r.destroy()}this.grid=[]}},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e},moveTo:function(e,t,i){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),e=e||this.map.getExtent(),null!=e){var s=!this.grid.length||t,a=this.getTilesBounds();this.singleTile?(s||!i&&!a.containsBounds(e))&&this.initSingleTile(e):s||!a.containsBounds(e,!0)?this.initGriddedTiles(e):this.scheduleMoveGriddedTiles()}},moveByPx:function(){this.singleTile||this.scheduleMoveGriddedTiles()},scheduleMoveGriddedTiles:function(){null!=this.timerId&&window.clearTimeout(this.timerId),this.timerId=window.setTimeout(this._moveGriddedTiles,this.tileLoadingDelay)},setTileSize:function(e){this.singleTile&&(e=this.map.getSize(),e.h=parseInt(e.h*this.ratio),e.w=parseInt(e.w*this.ratio)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[e])},getGridBounds:function(){var e="The getGridBounds() function is deprecated. It will be removed in 3.0. Please use getTilesBounds() instead.";return OpenLayers.Console.warn(e),this.getTilesBounds()},getTilesBounds:function(){var e=null;if(this.grid.length){var t=this.grid.length-1,i=this.grid[t][0],s=this.grid[0].length-1,a=this.grid[0][s];e=new OpenLayers.Bounds(i.bounds.left,i.bounds.bottom,a.bounds.right,a.bounds.top)}return e},initSingleTile:function(e){var t=e.getCenterLonLat(),i=e.getWidth()*this.ratio,s=e.getHeight()*this.ratio,a=new OpenLayers.Bounds(t.lon-i/2,t.lat-s/2,t.lon+i/2,t.lat+s/2),r=new OpenLayers.LonLat(a.left,a.top),n=this.map.getLayerPxFromLonLat(r);this.grid.length||(this.grid[0]=[]);var o=this.grid[0][0];o?o.moveTo(a,n):(o=this.addTile(a,n),this.addTileMonitoringHooks(o),o.draw(),this.grid[0][0]=o),this.removeExcessTiles(1,1)},calculateGridLayout:function(e,t,i){var s=i*this.tileSize.w,a=i*this.tileSize.h,r=e.left-t.lon,n=Math.floor(r/s)-this.buffer,o=r/s-n,l=-o*this.tileSize.w,h=t.lon+n*s,u=e.top-(t.lat+a),p=Math.ceil(u/a)+this.buffer,c=p-u/a,d=-c*this.tileSize.h,m=t.lat+p*a;return{tilelon:s,tilelat:a,tileoffsetlon:h,tileoffsetlat:m,tileoffsetx:l,tileoffsety:d}},getTileOrigin:function(){var e=this.tileOrigin;if(!e){var t=this.getMaxExtent(),i={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];e=new OpenLayers.LonLat(t[i[0]],t[i[1]])}return e},initGriddedTiles:function(e){var t=this.map.getSize(),i=Math.ceil(t.h/this.tileSize.h)+Math.max(1,2*this.buffer),s=Math.ceil(t.w/this.tileSize.w)+Math.max(1,2*this.buffer),a=this.getTileOrigin(),r=this.map.getResolution(),n=this.calculateGridLayout(e,a,r),o=Math.round(n.tileoffsetx),l=Math.round(n.tileoffsety),h=n.tileoffsetlon,u=n.tileoffsetlat,p=n.tilelon,c=n.tilelat;this.origin=new OpenLayers.Pixel(o,l);var d=o,m=h,y=0,f=parseInt(this.map.layerContainerDiv.style.left),g=parseInt(this.map.layerContainerDiv.style.top);do{var v=this.grid[y++];v||(v=[],this.grid.push(v)),h=m,o=d;var L=0;do{var b=new OpenLayers.Bounds(h,u,h+p,u+c),O=o;O-=f;var S=l;S-=g;var w=new OpenLayers.Pixel(O,S),_=v[L++];_?_.moveTo(b,w,!1):(_=this.addTile(b,w),this.addTileMonitoringHooks(_),v.push(_)),h+=p,o+=this.tileSize.w}while(e.right+p*this.buffer>=h||s>L);u-=c,l+=this.tileSize.h}while(u>=e.bottom-c*this.buffer||i>y);this.removeExcessTiles(y,L),this.spiralTileLoad()},getMaxExtent:function(){return this.maxExtent},spiralTileLoad:function(){for(var e=[],t=["right","down","left","up"],i=0,s=-1,a=OpenLayers.Util.indexOf(t,"right"),r=0;t.length>r;){var n=i,o=s;switch(t[a]){case"right":o++;break;case"down":n++;break;case"left":o--;break;case"up":n--}var l=null;this.grid.length>n&&n>=0&&this.grid[0].length>o&&o>=0&&(l=this.grid[n][o]),null==l||l.queued?(a=(a+1)%4,r++):(e.unshift(l),l.queued=!0,r=0,i=n,s=o)}for(var h=0,u=e.length;u>h;h++){var l=e[h];l.draw(),l.queued=!1}},addTile:function(e,t){return new OpenLayers.Tile.Image(this,t,e,null,this.tileSize,this.tileOptions)},addTileMonitoringHooks:function(e){e.onLoadStart=function(){0==this.numLoadingTiles&&this.events.triggerEvent("loadstart"),this.numLoadingTiles++},e.events.register("loadstart",this,e.onLoadStart),e.onLoadEnd=function(){this.numLoadingTiles--,this.events.triggerEvent("tileloaded"),0==this.numLoadingTiles&&this.events.triggerEvent("loadend")},e.events.register("loadend",this,e.onLoadEnd),e.events.register("unload",this,e.onLoadEnd)},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,scope:this})},moveGriddedTiles:function(){var e=!0,t=this.buffer||1,i=this.grid[0][0].position,s=parseInt(this.map.layerContainerDiv.style.left),a=parseInt(this.map.layerContainerDiv.style.top),r=i.add(s,a);r.x>-this.tileSize.w*(t-1)?this.shiftColumn(!0):r.x<-this.tileSize.w*t?this.shiftColumn(!1):r.y>-this.tileSize.h*(t-1)?this.shiftRow(!0):r.y<-this.tileSize.h*t?this.shiftRow(!1):e=!1,e&&(this.timerId=window.setTimeout(this._moveGriddedTiles,0))},shiftRow:function(e){for(var t=e?0:this.grid.length-1,i=this.grid,s=i[t],a=this.map.getResolution(),r=e?-this.tileSize.h:this.tileSize.h,n=a*-r,o=e?i.pop():i.shift(),l=0,h=s.length;h>l;l++){var u=s[l],p=u.bounds.clone(),c=u.position.clone();p.bottom=p.bottom+n,p.top=p.top+n,c.y=c.y+r,o[l].moveTo(p,c)}e?i.unshift(o):i.push(o)},shiftColumn:function(e){for(var t=e?-this.tileSize.w:this.tileSize.w,i=this.map.getResolution(),s=i*t,a=0,r=this.grid.length;r>a;a++){var n=this.grid[a],o=e?0:n.length-1,l=n[o],h=l.bounds.clone(),u=l.position.clone();h.left=h.left+s,h.right=h.right+s,u.x=u.x+t;var p=e?this.grid[a].pop():this.grid[a].shift();p.moveTo(h,u),e?n.unshift(p):n.push(p)}},removeExcessTiles:function(e,t){for(;this.grid.length>e;)for(var i=this.grid.pop(),s=0,a=i.length;a>s;s++){var r=i[s];this.removeTileMonitoringHooks(r),r.destroy()}for(;this.grid[0].length>t;)for(var s=0,a=this.grid.length;a>s;s++){var i=this.grid[s],r=i.pop();this.removeTileMonitoringHooks(r),r.destroy()}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(e){var t=this.maxExtent,i=this.getResolution(),s=i*this.tileSize.w,a=i*this.tileSize.h,r=this.getLonLatFromViewPortPx(e),n=t.left+s*Math.floor((r.lon-t.left)/s),o=t.bottom+a*Math.floor((r.lat-t.bottom)/a);return new OpenLayers.Bounds(n,o,n+s,o+a)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.Tile=OpenLayers.Class({EVENT_TYPES:["loadstart","loadend","reload","unload"],events:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(e,t,i,s,a,r){this.layer=e,this.position=t.clone(),this.bounds=i.clone(),this.url=s,a&&(this.size=a.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES),OpenLayers.Util.extend(this,r)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.layer=null,this.bounds=null,this.size=null,this.position=null,this.events.destroy(),this.events=null},clone:function(e){return null==e&&(e=new OpenLayers.Tile(this.layer,this.position,this.bounds,this.url,this.size)),OpenLayers.Util.applyDefaults(e,this),e},draw:function(){var e=this.layer.maxExtent,t=e&&this.bounds.intersectsBounds(e,!1);return this.shouldDraw=t||this.layer.displayOutsideMaxExtent,this.clear(),this.shouldDraw},moveTo:function(e,t,i){null==i&&(i=!0),this.bounds=e.clone(),this.position=t.clone(),i&&this.draw()},clear:function(){},getBoundsFromBaseLayer:function(e){var t=OpenLayers.i18n("reprojectDeprecated",{layerName:this.layer.name});OpenLayers.Console.warn(t);var i=this.layer.map.getLonLatFromLayerPx(e),s=e.clone();s.x+=this.size.w,s.y+=this.size.h;var a=this.layer.map.getLonLatFromLayerPx(s);i.lon>a.lon&&(0>i.lon?i.lon=-180-(i.lon+180):a.lon=180+a.lon+180);var r=new OpenLayers.Bounds(i.lon,a.lat,a.lon,i.lat);return r},showTile:function(){this.shouldDraw&&this.show()},show:function(){},hide:function(){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,layerAlphaHack:null,isBackBuffer:!1,isFirstDraw:!0,backBufferTile:null,maxGetUrlLength:null,initialize:function(e,t,i,s){OpenLayers.Tile.prototype.initialize.apply(this,arguments),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame),this.url=s,this.frame=document.createElement("div"),this.frame.style.overflow="hidden",this.frame.style.position="absolute",this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack()},destroy:function(){null!=this.imgDiv&&this.removeImgDiv(),this.imgDiv=null,null!=this.frame&&this.frame.parentNode==this.layer.div&&this.layer.div.removeChild(this.frame),this.frame=null,this.backBufferTile&&(this.backBufferTile.destroy(),this.backBufferTile=null),this.layer.events.unregister("loadend",this,this.resetBackBuffer),OpenLayers.Tile.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Tile.Image(this.layer,this.position,this.bounds,this.url,this.size)),e=OpenLayers.Tile.prototype.clone.apply(this,[e]),e.imgDiv=null,e},draw:function(){this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position));var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);return-1!=OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)||this.layer.singleTile?e?(this.backBufferTile||(this.backBufferTile=this.clone(),this.backBufferTile.hide(),this.backBufferTile.isBackBuffer=!0,this.events.register("loadend",this,this.resetBackBuffer),this.layer.events.register("loadend",this,this.resetBackBuffer)),this.startTransition()):this.backBufferTile&&this.backBufferTile.clear():e&&this.isFirstDraw&&(this.events.register("loadend",this,this.showTile),this.isFirstDraw=!1),e?(this.isLoading?this.events.triggerEvent("reload"):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.renderTile()):!1},resetBackBuffer:function(){if(this.showTile(),this.backBufferTile&&(this.isFirstDraw||!this.layer.numLoadingTiles)){this.isFirstDraw=!1;var e=this.layer.maxExtent,t=e&&this.bounds.intersectsBounds(e,!1);t&&(this.backBufferTile.position=this.position,this.backBufferTile.bounds=this.bounds,this.backBufferTile.size=this.size,this.backBufferTile.imageSize=this.layer.getImageSize(this.bounds)||this.size,this.backBufferTile.imageOffset=this.layer.imageOffset,this.backBufferTile.resolution=this.layer.getResolution(),this.backBufferTile.renderTile()),this.backBufferTile.hide()}},renderTile:function(){return this.layer.async?(this.initImgDiv(),this.layer.getURLasync(this.bounds,this,"url",this.positionImage)):(this.url=this.layer.getURL(this.bounds),this.initImgDiv(),this.positionImage()),!0},positionImage:function(){if(null!==this.layer){OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size);var e=this.layer.getImageSize(this.bounds);this.layerAlphaHack?OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,null,null,e,this.url):(OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,e),this.imgDiv.src=this.url)}},clear:function(){this.imgDiv&&(this.hide(),OpenLayers.Tile.Image.useBlankTile&&(this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"))},initImgDiv:function(){if(null==this.imgDiv){var e=this.layer.imageOffset,t=this.layer.getImageSize(this.bounds);this.imgDiv=this.layerAlphaHack?OpenLayers.Util.createAlphaImageDiv(null,e,t,null,"relative",null,null,null,!0):OpenLayers.Util.createImage(null,e,t,null,"relative",null,null,!0),OpenLayers.Util.isArray(this.layer.url)&&(this.imgDiv.urls=this.layer.url.slice()),this.imgDiv.className="olTileImage",this.frame.style.zIndex=this.isBackBuffer?0:1,this.frame.appendChild(this.imgDiv),this.layer.div.appendChild(this.frame),null!=this.layer.opacity&&OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity),this.imgDiv.map=this.layer.map;var i=function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("loadend"))};this.layerAlphaHack?OpenLayers.Event.observe(this.imgDiv.childNodes[0],"load",OpenLayers.Function.bind(i,this)):OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(i,this));var s=function(){this.imgDiv._attempts>OpenLayers.IMAGE_RELOAD_ATTEMPTS&&i.call(this)};OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(s,this))}this.imgDiv.viewRequestID=this.layer.map.viewRequestID},removeImgDiv:function(){OpenLayers.Event.stopObservingElement(this.imgDiv),this.imgDiv.parentNode==this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv.map=null),this.imgDiv.urls=null;var e=this.imgDiv.firstChild;e?(OpenLayers.Event.stopObservingElement(e),this.imgDiv.removeChild(e),delete e):this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"},checkImgURL:function(){if(this.layer){var e=this.layerAlphaHack?this.imgDiv.firstChild.src:this.imgDiv.src;OpenLayers.Util.isEquivalentUrl(e,this.url)||this.hide()}},startTransition:function(){if(this.backBufferTile&&this.backBufferTile.imgDiv){var e=1;if(this.backBufferTile.resolution&&(e=this.backBufferTile.resolution/this.layer.getResolution()),1!=e){if("resize"==this.layer.transitionEffect){var t=new OpenLayers.LonLat(this.backBufferTile.bounds.left,this.backBufferTile.bounds.top),i=new OpenLayers.Size(this.backBufferTile.size.w*e,this.backBufferTile.size.h*e),s=this.layer.map.getLayerPxFromLonLat(t);OpenLayers.Util.modifyDOMElement(this.backBufferTile.frame,null,s,i);var a=this.backBufferTile.imageSize;a=new OpenLayers.Size(a.w*e,a.h*e);var r=this.backBufferTile.imageOffset;r&&(r=new OpenLayers.Pixel(r.x*e,r.y*e)),OpenLayers.Util.modifyDOMElement(this.backBufferTile.imgDiv,null,r,a),this.backBufferTile.show()}}else this.layer.singleTile?this.backBufferTile.show():this.backBufferTile.hide()}},show:function(){this.frame.style.display="",-1!=OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)&&OpenLayers.IS_GECKO===!0&&(this.frame.scrollLeft=this.frame.scrollLeft)},hide:function(){this.frame.style.display="none"},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Tile.Image.useBlankTile="safari"==OpenLayers.BROWSER_NAME||"opera"==OpenLayers.BROWSER_NAME,OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:["antialiasing","blockout","font","fontcolor","fontsize","fontstyle","glowing","interval","outline","printmode","shadow","transparency"],request:null,response:null,initialize:function(e){if(this.request=new OpenLayers.Format.ArcXML.Request,this.response=new OpenLayers.Format.ArcXML.Response,e)if("feature"==e.requesttype){this.request.get_image=null;var t=this.request.get_feature.query;this.addCoordSys(t.featurecoordsys,e.featureCoordSys),this.addCoordSys(t.filtercoordsys,e.filterCoordSys),e.polygon?(t.isspatial=!0,t.spatialfilter.polygon=e.polygon):e.envelope&&(t.isspatial=!0,t.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0},this.parseEnvelope(t.spatialfilter.envelope,e.envelope))}else if("image"==e.requesttype){this.request.get_feature=null;var i=this.request.get_image.properties;this.parseEnvelope(i.envelope,e.envelope),this.addLayers(i.layerlist,e.layers),this.addImageSize(i.imagesize,e.tileSize),this.addCoordSys(i.featurecoordsys,e.featureCoordSys),this.addCoordSys(i.filtercoordsys,e.filterCoordSys)}else this.request=null;OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},parseEnvelope:function(e,t){t&&4==t.length&&(e.minx=t[0],e.miny=t[1],e.maxx=t[2],e.maxy=t[3])},addLayers:function(e,t){for(var i=0,s=t.length;s>i;i++)e.push(t[i])},addImageSize:function(e,t){null!==t&&(e.width=t.w,e.height=t.h,e.printwidth=t.w,e.printheight=t.h)},addCoordSys:function(e,t){"string"==typeof t?(e.id=parseInt(t),e.string=t):"object"==typeof t&&null!==t.proj?(e.id=t.proj.srsProjNumber,e.string=t.proj.srsCode):e=t},iserror:function(e){var t=null;if(e){e=OpenLayers.Format.XML.prototype.read.apply(this,[e]);var i=e.documentElement.getElementsByTagName("ERROR");t=null!==i&&i.length>0}else t=""!==this.response.error;return t},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=null;if(e&&e.documentElement&&(t="ARCXML"==e.documentElement.nodeName?e.documentElement:e.documentElement.getElementsByTagName("ARCXML")[0]),!t||"parsererror"===t.firstChild.nodeName){var i,s;try{i=e.firstChild.nodeValue,s=e.firstChild.childNodes[1].firstChild.nodeValue}catch(a){}throw{message:"Error parsing the ArcXML request",error:i,source:s}}var r=this.parseResponse(t);return r},write:function(e){e||(e=this.request);var t=this.createElementNS("","ARCXML");t.setAttribute("version","1.1");var i=this.createElementNS("","REQUEST");if(null!=e.get_image){var s=this.createElementNS("","GET_IMAGE");i.appendChild(s);var a=this.createElementNS("","PROPERTIES");s.appendChild(a);var r=e.get_image.properties;if(null!=r.featurecoordsys){var n=this.createElementNS("","FEATURECOORDSYS");a.appendChild(n),0===r.featurecoordsys.id?n.setAttribute("string",r.featurecoordsys.string):n.setAttribute("id",r.featurecoordsys.id)}if(null!=r.filtercoordsys){var o=this.createElementNS("","FILTERCOORDSYS");a.appendChild(o),0===r.filtercoordsys.id?o.setAttribute("string",r.filtercoordsys.string):o.setAttribute("id",r.filtercoordsys.id)}if(null!=r.envelope){var l=this.createElementNS("","ENVELOPE");a.appendChild(l),l.setAttribute("minx",r.envelope.minx),l.setAttribute("miny",r.envelope.miny),l.setAttribute("maxx",r.envelope.maxx),l.setAttribute("maxy",r.envelope.maxy)}var h=this.createElementNS("","IMAGESIZE");if(a.appendChild(h),h.setAttribute("height",r.imagesize.height),h.setAttribute("width",r.imagesize.width),(r.imagesize.height!=r.imagesize.printheight||r.imagesize.width!=r.imagesize.printwidth)&&(h.setAttribute("printheight",r.imagesize.printheight),h.setArrtibute("printwidth",r.imagesize.printwidth)),null!=r.background){var u=this.createElementNS("","BACKGROUND");a.appendChild(u),u.setAttribute("color",r.background.color.r+","+r.background.color.g+","+r.background.color.b),null!==r.background.transcolor&&u.setAttribute("transcolor",r.background.transcolor.r+","+r.background.transcolor.g+","+r.background.transcolor.b)}if(null!=r.layerlist&&r.layerlist.length>0){var p=this.createElementNS("","LAYERLIST");a.appendChild(p);for(var c=0;r.layerlist.length>c;c++){var d=this.createElementNS("","LAYERDEF");if(p.appendChild(d),d.setAttribute("id",r.layerlist[c].id),d.setAttribute("visible",r.layerlist[c].visible),"object"==typeof r.layerlist[c].query){var m=r.layerlist[c].query;if(0>m.where.length)continue;var y=null;y="boolean"==typeof m.spatialfilter&&m.spatialfilter?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),y.setAttribute("where",m.where),"number"==typeof m.accuracy&&m.accuracy>0&&y.setAttribute("accuracy",m.accuracy),"number"==typeof m.featurelimit&&2e3>m.featurelimit&&y.setAttribute("featurelimit",m.featurelimit),"string"==typeof m.subfields&&"#ALL#"!=m.subfields&&y.setAttribute("subfields",m.subfields),"string"==typeof m.joinexpression&&m.joinexpression.length>0&&y.setAttribute("joinexpression",m.joinexpression),"string"==typeof m.jointables&&m.jointables.length>0&&y.setAttribute("jointables",m.jointables),d.appendChild(y)}"object"==typeof r.layerlist[c].renderer&&this.addRenderer(d,r.layerlist[c].renderer)}}}else if(null!=e.get_feature){var s=this.createElementNS("","GET_FEATURES");if(s.setAttribute("outputmode","newxml"),s.setAttribute("checkesc","true"),e.get_feature.geometry?s.setAttribute("geometry",e.get_feature.geometry):s.setAttribute("geometry","false"),e.get_feature.compact&&s.setAttribute("compact",e.get_feature.compact),"number"==e.get_feature.featurelimit&&s.setAttribute("featurelimit",e.get_feature.featurelimit),s.setAttribute("globalenvelope","true"),i.appendChild(s),null!=e.get_feature.layer&&e.get_feature.layer.length>0){var f=this.createElementNS("","LAYER");f.setAttribute("id",e.get_feature.layer),s.appendChild(f)}var g=e.get_feature.query;if(null!=g){var v=null;if(v=g.isspatial?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),s.appendChild(v),"number"==typeof g.accuracy&&v.setAttribute("accuracy",g.accuracy),null!=g.featurecoordsys){var L=this.createElementNS("","FEATURECOORDSYS");0==g.featurecoordsys.id?L.setAttribute("string",g.featurecoordsys.string):L.setAttribute("id",g.featurecoordsys.id),v.appendChild(L)}if(null!=g.filtercoordsys){var b=this.createElementNS("","FILTERCOORDSYS");0===g.filtercoordsys.id?b.setAttribute("string",g.filtercoordsys.string):b.setAttribute("id",g.filtercoordsys.id),v.appendChild(b)}if(g.buffer>0){var O=this.createElementNS("","BUFFER");O.setAttribute("distance",g.buffer),v.appendChild(O)}if(g.isspatial){var S=this.createElementNS("","SPATIALFILTER");if(S.setAttribute("relation",g.spatialfilter.relation),v.appendChild(S),g.spatialfilter.envelope){var w=this.createElementNS("","ENVELOPE");w.setAttribute("minx",g.spatialfilter.envelope.minx),w.setAttribute("miny",g.spatialfilter.envelope.miny),w.setAttribute("maxx",g.spatialfilter.envelope.maxx),w.setAttribute("maxy",g.spatialfilter.envelope.maxy),S.appendChild(w)}else"object"==typeof g.spatialfilter.polygon&&S.appendChild(this.writePolygonGeometry(g.spatialfilter.polygon))}null!=g.where&&g.where.length>0&&v.setAttribute("where",g.where)}}return t.appendChild(i),OpenLayers.Format.XML.prototype.write.apply(this,[t])},addGroupRenderer:function(e,t){var i=this.createElementNS("","GROUPRENDERER");e.appendChild(i);for(var s=0;t.length>s;s++){var a=t[s];this.addRenderer(i,a)}},addRenderer:function(e,t){if(OpenLayers.Util.isArray(t))this.addGroupRenderer(e,t);else{var i=this.createElementNS("",t.type.toUpperCase()+"RENDERER");e.appendChild(i),"VALUEMAPRENDERER"==i.tagName?this.addValueMapRenderer(i,t):"VALUEMAPLABELRENDERER"==i.tagName?this.addValueMapLabelRenderer(i,t):"SIMPLELABELRENDERER"==i.tagName?this.addSimpleLabelRenderer(i,t):"SCALEDEPENDENTRENDERER"==i.tagName&&this.addScaleDependentRenderer(i,t)}},addScaleDependentRenderer:function(e,t){("string"==typeof t.lower||"number"==typeof t.lower)&&e.setAttribute("lower",t.lower),("string"==typeof t.upper||"number"==typeof t.upper)&&e.setAttribute("upper",t.upper),this.addRenderer(e,t.renderer)},addValueMapLabelRenderer:function(e,t){if(e.setAttribute("lookupfield",t.lookupfield),e.setAttribute("labelfield",t.labelfield),"object"==typeof t.exacts)for(var i=0,s=t.exacts.length;s>i;i++){var a=t.exacts[i],r=this.createElementNS("","EXACT");if("string"==typeof a.value&&r.setAttribute("value",a.value),"string"==typeof a.label&&r.setAttribute("label",a.label),"string"==typeof a.method&&r.setAttribute("method",a.method),e.appendChild(r),"object"==typeof a.symbol){var n=null;if("text"==a.symbol.type&&(n=this.createElementNS("","TEXTSYMBOL")),null!=n){for(var o=this.fontStyleKeys,l=0,h=o.length;h>l;l++){var u=o[l];a.symbol[u]&&n.setAttribute(u,a.symbol[u])}r.appendChild(n)}}}},addValueMapRenderer:function(e,t){if(e.setAttribute("lookupfield",t.lookupfield),"object"==typeof t.ranges)for(var i=0,s=t.ranges.length;s>i;i++){var a=t.ranges[i],r=this.createElementNS("","RANGE");if(r.setAttribute("lower",a.lower),r.setAttribute("upper",a.upper),e.appendChild(r),"object"==typeof a.symbol){var n=null;"simplepolygon"==a.symbol.type&&(n=this.createElementNS("","SIMPLEPOLYGONSYMBOL")),null!=n&&("string"==typeof a.symbol.boundarycolor&&n.setAttribute("boundarycolor",a.symbol.boundarycolor),"string"==typeof a.symbol.fillcolor&&n.setAttribute("fillcolor",a.symbol.fillcolor),"number"==typeof a.symbol.filltransparency&&n.setAttribute("filltransparency",a.symbol.filltransparency),r.appendChild(n))}}else if("object"==typeof t.exacts)for(var o=0,l=t.exacts.length;l>o;o++){var h=t.exacts[o],u=this.createElementNS("","EXACT");if("string"==typeof h.value&&u.setAttribute("value",h.value),"string"==typeof h.label&&u.setAttribute("label",h.label),"string"==typeof h.method&&u.setAttribute("method",h.method),e.appendChild(u),"object"==typeof h.symbol){var n=null;"simplemarker"==h.symbol.type&&(n=this.createElementNS("","SIMPLEMARKERSYMBOL")),null!=n&&("string"==typeof h.symbol.antialiasing&&n.setAttribute("antialiasing",h.symbol.antialiasing),"string"==typeof h.symbol.color&&n.setAttribute("color",h.symbol.color),"string"==typeof h.symbol.outline&&n.setAttribute("outline",h.symbol.outline),"string"==typeof h.symbol.overlap&&n.setAttribute("overlap",h.symbol.overlap),"string"==typeof h.symbol.shadow&&n.setAttribute("shadow",h.symbol.shadow),"number"==typeof h.symbol.transparency&&n.setAttribute("transparency",h.symbol.transparency),"string"==typeof h.symbol.usecentroid&&n.setAttribute("usecentroid",h.symbol.usecentroid),"number"==typeof h.symbol.width&&n.setAttribute("width",h.symbol.width),u.appendChild(n))
}}},addSimpleLabelRenderer:function(e,t){e.setAttribute("field",t.field);for(var i=["featureweight","howmanylabels","labelbufferratio","labelpriorities","labelweight","linelabelposition","rotationalangles"],s=0,a=i.length;a>s;s++){var r=i[s];t[r]&&e.setAttribute(r,t[r])}if("text"==t.symbol.type){var n=t.symbol,o=this.createElementNS("","TEXTSYMBOL");e.appendChild(o);for(var i=this.fontStyleKeys,s=0,a=i.length;a>s;s++){var r=i[s];n[r]&&o.setAttribute(r,t[r])}}},writePolygonGeometry:function(e){if(!(e instanceof OpenLayers.Geometry.Polygon))throw{message:"Cannot write polygon geometry to ArcXML with an "+e.CLASS_NAME+" object.",geometry:e};for(var t=this.createElementNS("","POLYGON"),i=0,s=e.components.length;s>i;i++){for(var a=e.components[i],r=this.createElementNS("","RING"),n=0,o=a.components.length;o>n;n++){var l=a.components[n],h=this.createElementNS("","POINT");h.setAttribute("x",l.x),h.setAttribute("y",l.y),r.appendChild(h)}t.appendChild(r)}return t},parseResponse:function(e){if("string"==typeof e){var t=new OpenLayers.Format.XML;e=t.read(e)}var i=new OpenLayers.Format.ArcXML.Response,s=e.getElementsByTagName("ERROR");if(null!=s&&s.length>0)i.error=this.getChildValue(s,"Unknown error.");else{var a=e.getElementsByTagName("RESPONSE");if(null==a||0==a.length)return i.error="No RESPONSE tag found in ArcXML response.",i;var r=a[0].firstChild.nodeName;if("#text"==r&&(r=a[0].firstChild.nextSibling.nodeName),"IMAGE"==r){var n=e.getElementsByTagName("ENVELOPE"),o=e.getElementsByTagName("OUTPUT");if(null==n||0==n.length)i.error="No ENVELOPE tag found in ArcXML response.";else if(null==o||0==o.length)i.error="No OUTPUT tag found in ArcXML response.";else{var l=this.parseAttributes(n[0]),h=this.parseAttributes(o[0]);i.image="string"==typeof h.type?{envelope:l,output:{type:h.type,data:this.getChildValue(o[0])}}:{envelope:l,output:h}}}else if("FEATURES"==r){var u=a[0].getElementsByTagName("FEATURES"),p=u[0].getElementsByTagName("FEATURECOUNT");if(i.features.featurecount=p[0].getAttribute("count"),i.features.featurecount>0){var c=u[0].getElementsByTagName("ENVELOPE");i.features.envelope=this.parseAttributes(c[0],"number");for(var d=u[0].getElementsByTagName("FEATURE"),m=0;d.length>m;m++){for(var y=new OpenLayers.Feature.Vector,f=d[m].getElementsByTagName("FIELD"),g=0;f.length>g;g++){var v=f[g].getAttribute("name"),L=f[g].getAttribute("value");y.attributes[v]=L}var b=d[m].getElementsByTagName("POLYGON");if(b.length>0){for(var O=b[0].getElementsByTagName("RING"),S=[],w=0;O.length>w;w++){var _=[];_.push(this.parsePointGeometry(O[w]));for(var x=O[w].getElementsByTagName("HOLE"),k=0;x.length>k;k++)_.push(this.parsePointGeometry(x[k]));x=null,S.push(new OpenLayers.Geometry.Polygon(_)),_=null}O=null,y.geometry=1==S.length?S[0]:new OpenLayers.Geometry.MultiPolygon(S)}i.features.feature.push(y)}}}else i.error="Unidentified response type."}return i},parseAttributes:function(e,t){for(var i={},s=0;e.attributes.length>s;s++)i[e.attributes[s].nodeName]="number"==t?parseFloat(e.attributes[s].nodeValue):e.attributes[s].nodeValue;return i},parsePointGeometry:function(e){var t=[],i=e.getElementsByTagName("COORDS");if(i.length>0){var s=this.getChildValue(i[0]);s=s.split(/;/);for(var a=0;s.length>a;a++){var r=s[a].split(/ /);t.push(new OpenLayers.Geometry.Point(parseFloat(r[0]),parseFloat(r[1])))}i=null}else{var n=e.getElementsByTagName("POINT");if(n.length>0)for(var o=0;n.length>o;o++)t.push(new OpenLayers.Geometry.Point(parseFloat(n[o].getAttribute("x")),parseFloat(n[o].getAttribute("y"))));n=null}return new OpenLayers.Geometry.LinearRing(t)},CLASS_NAME:"OpenLayers.Format.ArcXML"}),OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(){var e={get_image:{properties:{background:null,draw:!0,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:!1},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:!1,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]};return OpenLayers.Util.extend(this,e)},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"}),OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(){var e={image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""};return OpenLayers.Util.extend(this,e)},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"}),OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},tileSize:null,featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:!0,name:"ArcIMS",isBaseLayer:!0,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:!0,async:!0,name:"ArcIMS"},initialize:function(e,t,i){this.tileSize=new OpenLayers.Size(512,512),this.params=OpenLayers.Util.applyDefaults({ServiceName:i.serviceName},this.DEFAULT_PARAMS),this.options=OpenLayers.Util.applyDefaults(i,this.DEFAULT_OPTIONS),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e,t,this.params,i]),this.transparent&&(this.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.format&&(this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png")),null===this.options.layers&&(this.options.layers=[])},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},getURL:function(e){var t="";e=this.adjustBounds(e);var i=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:e.toArray(),tileSize:this.tileSize})),s=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:i.write(),async:!1});if(null!=s){var a=s.responseXML;a&&a.documentElement||(a=s.responseText);var r=new OpenLayers.Format.ArcXML,n=r.read(a);t=this.getUrlOrImage(n.image.output)}return t},getURLasync:function(e,t,i,s){e=this.adjustBounds(e);var a=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:e.toArray(),tileSize:this.tileSize}));OpenLayers.Request.POST({url:this.getFullRequestString(),async:!0,data:a.write(),callback:function(e){var a=e.responseXML;a&&a.documentElement||(a=e.responseText);var r=new OpenLayers.Format.ArcXML,n=r.read(a);t[i]=this.getUrlOrImage(n.image.output),s.apply(t)},scope:this})},getUrlOrImage:function(e){var t="";return e.url?t=e.url:e.data&&(t="data:image/"+e.type+";base64,"+e.data),t},setLayerQuery:function(e,t){for(var i=0;this.options.layers.length>i;i++)if(e==this.options.layers[i].id)return this.options.layers[i].query=t,void 0;this.options.layers.push({id:e,visible:!0,query:t})},getFeatureInfo:function(e,t,i){var s=i.buffer||1,a=i.callback||function(){},r=i.scope||window,n={};OpenLayers.Util.extend(n,this.options),n.requesttype="feature",e instanceof OpenLayers.LonLat?(n.polygon=null,n.envelope=[e.lon-s,e.lat-s,e.lon+s,e.lat+s]):e instanceof OpenLayers.Geometry.Polygon&&(n.envelope=null,n.polygon=e);var o=new OpenLayers.Format.ArcXML(n);if(OpenLayers.Util.extend(o.request.get_feature,i),o.request.get_feature.layer=t.id,"number"==typeof t.query.accuracy)o.request.get_feature.query.accuracy=t.query.accuracy;else{var l=this.map.getCenter(),h=this.map.getViewPortPxFromLonLat(l);h.x++;var u=this.map.getLonLatFromPixel(h);o.request.get_feature.query.accuracy=u.lon-l.lon}o.request.get_feature.query.where=t.query.where,o.request.get_feature.query.spatialfilter.relation="area_intersection",OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:o.write(),callback:function(e){var t=o.parseResponse(e.responseText);o.iserror()?a.call(r,null):a.call(r,t.features)}})},clone:function(e){return null==e&&(e=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},CLASS_NAME:"OpenLayers.Layer.ArcIMS"}),OpenLayers.Lang.te=OpenLayers.Util.applyDefaults({Permalink:"స్థిరలింకు",W:"ప",E:"తూ",N:"ఉ",S:"ద"}),OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y),OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.removeButtons(),this.buttons=null,this.position=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments),e=this.position,this.buttons=[];var t=new OpenLayers.Size(18,18),i=new OpenLayers.Pixel(e.x+t.w/2,e.y);return this._addButton("panup","north-mini.png",i,t),e.y=i.y+t.h,this._addButton("panleft","west-mini.png",e,t),this._addButton("panright","east-mini.png",e.add(t.w,0),t),this._addButton("pandown","south-mini.png",i.add(0,2*t.h),t),this._addButton("zoomin","zoom-plus-mini.png",i.add(0,3*t.h+5),t),this._addButton("zoomworld","zoom-world-mini.png",i.add(0,4*t.h+5),t),this._addButton("zoomout","zoom-minus-mini.png",i.add(0,5*t.h+5),t),this.div},_addButton:function(e,t,i,s){var a=OpenLayers.Util.getImagesLocation()+t,r=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+e,i,s,a,"absolute");if(r.style.cursor="pointer",this.div.appendChild(r),OpenLayers.Event.observe(r,"mousedown",OpenLayers.Function.bindAsEventListener(this.buttonDown,r)),OpenLayers.Event.observe(r,"dblclick",OpenLayers.Function.bindAsEventListener(this.doubleClick,r)),OpenLayers.Event.observe(r,"click",OpenLayers.Function.bindAsEventListener(this.doubleClick,r)),r.action=e,r.map=this.map,this.slideRatio)var n=this.slideRatio,o=function(e){return this.map.getSize()[e]*n};else var l=this.slideFactor,o=function(){return l};return r.getSlideFactor=o,this.buttons.push(r),r},_removeButton:function(e){OpenLayers.Event.stopObservingElement(e),e.map=null,e.getSlideFactor=null,this.div.removeChild(e),OpenLayers.Util.removeItem(this.buttons,e)},removeButtons:function(){for(var e=this.buttons.length-1;e>=0;--e)this._removeButton(this.buttons[e])},doubleClick:function(e){return OpenLayers.Event.stop(e),!1},buttonDown:function(e){if(OpenLayers.Event.isLeftClick(e)){switch(this.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent()}OpenLayers.Event.stop(e)}},CLASS_NAME:"OpenLayers.Control.PanZoom"}),OpenLayers.Control.PanZoom.X=4,OpenLayers.Control.PanZoom.Y=4,OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,divEvents:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar(),this.map.events.un({changebaselayer:this.redraw,scope:this}),OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments),delete this.mouseDragStart,delete this.zoomStart},setMap:function(){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments),this.map.events.register("changebaselayer",this,this.redraw)},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar()),this.draw()},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments),e=this.position.clone(),this.buttons=[];var t=new OpenLayers.Size(18,18);if(this.panIcons){var i=new OpenLayers.Pixel(e.x+t.w/2,e.y),s=t.w;this.zoomWorldIcon&&(i=new OpenLayers.Pixel(e.x+t.w,e.y)),this._addButton("panup","north-mini.png",i,t),e.y=i.y+t.h,this._addButton("panleft","west-mini.png",e,t),this.zoomWorldIcon&&(this._addButton("zoomworld","zoom-world-mini.png",e.add(t.w,0),t),s*=2),this._addButton("panright","east-mini.png",e.add(s,0),t),this._addButton("pandown","south-mini.png",i.add(0,2*t.h),t),this._addButton("zoomin","zoom-plus-mini.png",i.add(0,3*t.h+5),t),i=this._addZoomBar(i.add(0,4*t.h+5)),this._addButton("zoomout","zoom-minus-mini.png",i,t)}else this._addButton("zoomin","zoom-plus-mini.png",e,t),i=this._addZoomBar(e.add(0,t.h)),this._addButton("zoomout","zoom-minus-mini.png",i,t),this.zoomWorldIcon&&(i=i.add(0,t.h+3),this._addButton("zoomworld","zoom-world-mini.png",i,t));return this.div},_addZoomBar:function(e){var t=OpenLayers.Util.getImagesLocation(),i=this.id+"_"+this.map.id,s=this.map.getNumZoomLevels()-1-this.map.getZoom(),a=OpenLayers.Util.createAlphaImageDiv(i,e.add(-1,s*this.zoomStopHeight),new OpenLayers.Size(20,9),t+"slider.png","absolute");a.style.cursor="move",this.slider=a,this.sliderEvents=new OpenLayers.Events(this,a,null,!0,{includeXY:!0}),this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});var r=new OpenLayers.Size;r.h=this.zoomStopHeight*this.map.getNumZoomLevels(),r.w=this.zoomStopWidth;var n=null;if(OpenLayers.Util.alphaHack()){var i=this.id+"_"+this.map.id;n=OpenLayers.Util.createAlphaImageDiv(i,e,new OpenLayers.Size(r.w,this.zoomStopHeight),t+"zoombar.png","absolute",null,"crop"),n.style.height=r.h+"px"}else n=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,e,r,t+"zoombar.png");return n.style.cursor="pointer",this.zoombarDiv=n,this.divEvents=new OpenLayers.Events(this,n,null,!0,{includeXY:!0}),this.divEvents.on({touchmove:this.passEventToSlider,mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick}),this.div.appendChild(n),this.startTop=parseInt(n.style.top),this.div.appendChild(a),this.map.events.register("zoomend",this,this.moveZoomBar),e=e.add(0,this.zoomStopHeight*this.map.getNumZoomLevels())},_removeZoomBar:function(){this.sliderEvents.un({touchmove:this.zoomBarDrag,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick}),this.sliderEvents.destroy(),this.divEvents.un({touchmove:this.passEventToSlider,mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick}),this.divEvents.destroy(),this.div.removeChild(this.zoombarDiv),this.zoombarDiv=null,this.div.removeChild(this.slider),this.slider=null,this.map.events.unregister("zoomend",this,this.moveZoomBar)},passEventToSlider:function(e){this.sliderEvents.handleBrowserEvent(e)},divClick:function(e){if(OpenLayers.Event.isLeftClick(e)){var t=e.xy.y/this.zoomStopHeight;(this.forceFixedZoomLevel||!this.map.fractionalZoom)&&(t=Math.floor(t));var i=this.map.getNumZoomLevels()-1-t;i=Math.min(Math.max(i,0),this.map.getNumZoomLevels()-1),this.map.zoomTo(i),OpenLayers.Event.stop(e)}},zoomBarDown:function(e){(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))&&(this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=e.xy.clone(),this.zoomStart=e.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(e))},zoomBarDrag:function(e){if(null!=this.mouseDragStart){var t=this.mouseDragStart.y-e.xy.y,i=OpenLayers.Util.pagePosition(this.zoombarDiv);if(e.clientY-i[1]>0&&e.clientY-i[1]<parseInt(this.zoombarDiv.style.height)-2){var s=parseInt(this.slider.style.top)-t;this.slider.style.top=s+"px",this.mouseDragStart=e.xy.clone()}this.deltaY=this.zoomStart.y-e.xy.y,OpenLayers.Event.stop(e)}},zoomBarUp:function(e){if((OpenLayers.Event.isLeftClick(e)||"touchend"===e.type)&&this.mouseDragStart){this.div.style.cursor="",this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var t=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(t+=this.deltaY/this.zoomStopHeight,t=Math.min(Math.max(t,0),this.map.getNumZoomLevels()-1)):(t+=this.deltaY/this.zoomStopHeight,t=Math.max(Math.round(t),0)),this.map.zoomTo(t),this.mouseDragStart=null,this.zoomStart=null,this.deltaY=0,OpenLayers.Event.stop(e)}},moveZoomBar:function(){var e=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=e+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"}),OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{initialize:function(e){OpenLayers.Format.WFSCapabilities.v1.prototype.initialize.apply(this,[e])},read_cap_DefaultSRS:function(e,t){var i=this.getChildValue(t);i&&(e.srs=i)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"}),OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(e,t,i,s,a){this.url=t,this.extent=i,this.maxExtent=i,this.size=s,OpenLayers.Layer.prototype.initialize.apply(this,[e,a]),this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null),OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e])},setMap:function(){null==this.options.maxResolution&&(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w),OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(e,t){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var i=null==this.tile;if(t||i){this.setTileSize();var s=new OpenLayers.LonLat(this.extent.left,this.extent.top),a=this.map.getLayerPxFromLonLat(s);i?(this.tile=new OpenLayers.Tile.Image(this,a,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=a.clone()),this.tile.draw()}},setTileSize:function(){var e=this.extent.getWidth()/this.map.getResolution(),t=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(e,t)},addTileMonitoringHooks:function(e){e.onLoadStart=function(){this.events.triggerEvent("loadstart")},e.events.register("loadstart",this,e.onLoadStart),e.onLoadEnd=function(){this.events.triggerEvent("loadend")},e.events.register("loadend",this,e.onLoadEnd),e.events.register("unload",this,e.onLoadEnd)},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,scope:this})},setUrl:function(e){this.url=e,this.tile.draw()},getURL:function(){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"}),OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e,this.active=!1},destroy:function(){this.deactivate(),this.layer=null,this.options=null},setLayer:function(e){this.layer=e},activate:function(){return this.active?!1:(this.active=!0,!0)},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:"OpenLayers.Strategy"}),OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{EVENT_TYPES:["start","success","fail"],events:null,auto:!1,timer:null,initialize:function(e){OpenLayers.Strategy.prototype.initialize.apply(this,[e]),this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES)},activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&this.auto&&("number"==typeof this.auto?this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),1e3*this.auto):this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.auto&&("number"==typeof this.auto?window.clearInterval(this.timer):this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),e},triggerSave:function(e){var t=e.feature;(t.state===OpenLayers.State.INSERT||t.state===OpenLayers.State.UPDATE||t.state===OpenLayers.State.DELETE)&&this.save([e.feature])},save:function(e){e||(e=this.layer.features),this.events.triggerEvent("start",{features:e});var t=this.layer.projection,i=this.layer.map.getProjectionObject();if(!i.equals(t)){for(var s,a,r=e.length,n=Array(r),o=0;r>o;++o)s=e[o],a=s.clone(),a.fid=s.fid,a.state=s.state,s.url&&(a.url=s.url),a._original=s,a.geometry.transform(i,t),n[o]=a;e=n}this.layer.protocol.commit(e,{callback:this.onCommit,scope:this})},onCommit:function(e){var t={response:e};if(e.success()){for(var i,s,a=e.reqFeatures,r=[],n=e.insertIds||[],o=0,l=0,h=a.length;h>l;++l)s=a[l],s=s._original||s,i=s.state,i&&(i==OpenLayers.State.DELETE?r.push(s):i==OpenLayers.State.INSERT&&(s.fid=n[o],++o),s.state=null);r.length>0&&this.layer.destroyFeatures(r),this.events.triggerEvent("success",t)}else this.events.triggerEvent("fail",t)},CLASS_NAME:"OpenLayers.Strategy.Save"}),OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,initialize:function(e){this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=[];if(this.extractTracks)for(var i=e.getElementsByTagName("trk"),s=0,a=i.length;a>s;s++){var r={};this.extractAttributes&&(r=this.parseAttributes(i[s]));for(var n=this.getElementsByTagNameNS(i[s],i[s].namespaceURI,"trkseg"),o=0,l=n.length;l>o;o++){var h=this.extractSegment(n[o],"trkpt");t.push(new OpenLayers.Feature.Vector(h,r))}}if(this.extractRoutes)for(var u=e.getElementsByTagName("rte"),p=0,c=u.length;c>p;p++){var r={};this.extractAttributes&&(r=this.parseAttributes(u[p]));var d=this.extractSegment(u[p],"rtept");t.push(new OpenLayers.Feature.Vector(d,r))}if(this.extractWaypoints)for(var m=e.getElementsByTagName("wpt"),y=0,a=m.length;a>y;y++){var r={};this.extractAttributes&&(r=this.parseAttributes(m[y]));var f=new OpenLayers.Geometry.Point(m[y].getAttribute("lon"),m[y].getAttribute("lat"));t.push(new OpenLayers.Feature.Vector(f,r))}if(this.internalProjection&&this.externalProjection)for(var g=0,v=t.length;v>g;g++)t[g].geometry.transform(this.externalProjection,this.internalProjection);return t},extractSegment:function(e,t){for(var i=this.getElementsByTagNameNS(e,e.namespaceURI,t),s=[],a=0,r=i.length;r>a;a++)s.push(new OpenLayers.Geometry.Point(i[a].getAttribute("lon"),i[a].getAttribute("lat")));return new OpenLayers.Geometry.LineString(s)},parseAttributes:function(e){for(var t,i,s={},a=e.firstChild;a;)1==a.nodeType&&(t=a.firstChild,(3==t.nodeType||4==t.nodeType)&&(i=a.prefix?a.nodeName.split(":")[1]:a.nodeName,"trkseg"!=i&&"rtept"!=i&&(s[i]=t.nodeValue))),a=a.nextSibling;return s},CLASS_NAME:"OpenLayers.Format.GPX"}),OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(e,t){var i=[],s={},a={complexTypes:i,customTypes:s};this.readChildNodes(e,a);for(var r,n,o=e.attributes,l=0,h=o.length;h>l;++l)r=o[l],n=r.name,0==n.indexOf("xmlns")?this.setNamespace(n.split(":")[1]||"",r.value):t[n]=r.value;t.featureTypes=i,t.targetPrefix=this.namespaceAlias[t.targetNamespace];for(var u,p,l=0,h=i.length;h>l;++l)u=i[l],p=s[u.typeName],s[u.typeName]&&(u.typeName=p.name)},complexType:function(e,t){var i={typeName:e.getAttribute("name")};this.readChildNodes(e,i),t.complexTypes.push(i)},complexContent:function(e,t){this.readChildNodes(e,t)},extension:function(e,t){this.readChildNodes(e,t)},sequence:function(e,t){var i={elements:[]};this.readChildNodes(e,i),t.properties=i.elements},element:function(e,t){if(t.elements){for(var i,s={},a=e.attributes,r=0,n=a.length;n>r;++r)i=a[r],s[i.name]=i.value;var o=s.type;o||(o={},this.readChildNodes(e,o),s.restriction=o,s.type=o.base);var l=o.base||o;s.localType=l.split(":").pop(),t.elements.push(s)}if(t.complexTypes){var o=e.getAttribute("type"),h=o.split(":").pop();t.customTypes[h]={name:e.getAttribute("name"),type:o}}},simpleType:function(e,t){this.readChildNodes(e,t)},restriction:function(e,t){t.base=e.getAttribute("base"),this.readRestriction(e,t)}}},readRestriction:function(e,t){for(var i,s,a,r=e.childNodes,n=0,o=r.length;o>n;++n)i=r[n],1==i.nodeType&&(s=i.nodeName.split(":").pop(),a=i.getAttribute("value"),t[s]?("string"==typeof t[s]&&(t[s]=[t[s]]),t[s].push(a)):t[s]=a)},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"}),OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,initialize:function(e,t){this.container=OpenLayers.Util.getElement(e),OpenLayers.Util.extend(this,t)},destroy:function(){this.container=null,this.extent=null,this.size=null,this.resolution=null,this.map=null},supported:function(){return!1},setExtent:function(e,t){this.extent=e.clone(),t&&(this.resolution=null)},setSize:function(e){this.size=e.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution(),this.resolution},drawFeature:function(e,t){if(null==t&&(t=e.style),e.geometry){var i=e.geometry.getBounds();if(i){i.intersectsBounds(this.extent)||(t={display:"none"});var s=this.drawGeometry(e.geometry,t,e.id);if("none"!=t.display&&t.label&&s!==!1){var a=e.geometry.getCentroid();if(t.labelXOffset||t.labelYOffset){var r=isNaN(t.labelXOffset)?0:t.labelXOffset,n=isNaN(t.labelYOffset)?0:t.labelYOffset,o=this.getResolution();a.move(r*o,n*o)}this.drawText(e.id,t,a)}else this.removeText(e.id);return s}}},drawGeometry:function(){},drawText:function(){},removeText:function(){},clear:function(){},getFeatureIdFromEvent:function(){},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;i>t;++t){var s=e[t];this.eraseGeometry(s.geometry,s.id),this.removeText(s.id)}},eraseGeometry:function(){},moveRoot:function(){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(e){var t=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return e.stroke===!1&&(delete t.strokeWidth,delete t.strokeColor),e.fill===!1&&delete t.fillColor,OpenLayers.Util.extend(t,e),t},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0},OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,initialize:function(){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},eraseGeometry:function(e,t){this.eraseFeatures(this.features[t][0])},supported:function(){var e=document.createElement("canvas");return!!e.getContext},setSize:function(e){this.size=e.clone();var t=this.root;if(t.style.width=e.w+"px",t.style.height=e.h+"px",t.width=e.w,t.height=e.h,this.resolution=null,this.hitDetection){var i=this.hitCanvas;i.style.width=e.w+"px",i.style.height=e.h+"px",i.width=e.w,i.height=e.h}},drawFeature:function(e,t){var i;if(e.geometry){t=this.applyDefaultSymbolizer(t||e.style);var s=e.geometry.getBounds();i="none"!==t.display&&!!s&&s.intersectsBounds(this.extent),i?this.features[e.id]=[e,t]:delete this.features[e.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),i},drawGeometry:function(e,t,i){var s=e.CLASS_NAME;if("OpenLayers.Geometry.Collection"!=s&&"OpenLayers.Geometry.MultiPoint"!=s&&"OpenLayers.Geometry.MultiLineString"!=s&&"OpenLayers.Geometry.MultiPolygon"!=s)switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(e,t,i);break;case"OpenLayers.Geometry.LineString":this.drawLineString(e,t,i);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(e,t,i);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(e,t,i);break;default:}else for(var a=0;e.components.length>a;a++)this.drawGeometry(e.components[a],t,i)},drawExternalGraphic:function(e,t,i){var s=new Image;t.graphicTitle&&(s.title=t.graphicTitle);var a=t.graphicWidth||t.graphicHeight,r=t.graphicHeight||t.graphicWidth;a=a?a:2*t.pointRadius,r=r?r:2*t.pointRadius;var n=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*a),o=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*r),l=t.graphicOpacity||t.fillOpacity,h=function(){if(this.features[i]){var t=this.getLocalXY(e),h=t[0],u=t[1];if(!isNaN(h)&&!isNaN(u)){var p=0|h+n,c=0|u+o,d=this.canvas;d.globalAlpha=l;var m=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);d.drawImage(s,p*m,c*m,a*m,r*m),this.hitDetection&&(this.setHitContextStyle("fill",i),this.hitContext.fillRect(p,c,a,r))}}};s.onload=OpenLayers.Function.bind(h,this),s.src=t.externalGraphic},setCanvasStyle:function(e,t){"fill"===e?(this.canvas.globalAlpha=t.fillOpacity,this.canvas.fillStyle=t.fillColor):"stroke"===e?(this.canvas.globalAlpha=t.strokeOpacity,this.canvas.strokeStyle=t.strokeColor,this.canvas.lineWidth=t.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(e){var t=Number(e.split("_").pop())+1;t>=16777216&&(this.hitOverflow=t-16777215,t=t%16777216+1);var i="000000"+t.toString(16),s=i.length;return i="#"+i.substring(s-6,s)},setHitContextStyle:function(e,t,i){var s=this.featureIdToHex(t);"fill"==e?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=s):"stroke"==e?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=s,this.hitContext.lineWidth=i.strokeWidth+2):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(e,t,i){if(t.graphic!==!1)if(t.externalGraphic)this.drawExternalGraphic(e,t,i);else{var s=this.getLocalXY(e),a=s[0],r=s[1];if(!isNaN(a)&&!isNaN(r)){var n=2*Math.PI,o=t.pointRadius;t.fill!==!1&&(this.setCanvasStyle("fill",t),this.canvas.beginPath(),this.canvas.arc(a,r,o,0,n,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.hitContext.beginPath(),this.hitContext.arc(a,r,o,0,n,!0),this.hitContext.fill())),t.stroke!==!1&&(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),this.canvas.arc(a,r,o,0,n,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.hitContext.beginPath(),this.hitContext.arc(a,r,o,0,n,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(e,t,i){t=OpenLayers.Util.applyDefaults({fill:!1},t),this.drawLinearRing(e,t,i)},drawLinearRing:function(e,t,i){t.fill!==!1&&(this.setCanvasStyle("fill",t),this.renderPath(this.canvas,e,t,i,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.renderPath(this.hitContext,e,t,i,"fill"))),t.stroke!==!1&&(this.setCanvasStyle("stroke",t),this.renderPath(this.canvas,e,t,i,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.renderPath(this.hitContext,e,t,i,"stroke"))),this.setCanvasStyle("reset")},renderPath:function(e,t,i,s,a){var r=t.components,n=r.length;e.beginPath();
var o=this.getLocalXY(r[0]),l=o[0],h=o[1];if(!isNaN(l)&&!isNaN(h)){e.moveTo(o[0],o[1]);for(var u=1;n>u;++u){var p=this.getLocalXY(r[u]);e.lineTo(p[0],p[1])}"fill"===a?e.fill():e.stroke()}},drawPolygon:function(e,t,i){var s=e.components,a=s.length;this.drawLinearRing(s[0],t,i);for(var r=1;a>r;++r)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(s[r],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},t),i),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(s[r],OpenLayers.Util.applyDefaults({fill:!1},t),i)},drawText:function(e,t){t=OpenLayers.Util.extend({fontColor:"#000000",labelAlign:"cm"},t);var i=this.getLocalXY(e);this.setCanvasStyle("reset"),this.canvas.fillStyle=t.fontColor,this.canvas.globalAlpha=t.fontOpacity||1;var s=[t.fontStyle?t.fontStyle:"normal","normal",t.fontWeight?t.fontWeight:"normal",t.fontSize?t.fontSize:"1em",t.fontFamily?t.fontFamily:"sans-serif"].join(" "),a=t.label.split("\n"),r=a.length;if(this.canvas.fillText){this.canvas.font=s,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[1]]||"middle";var n=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==n&&(n=-.5);var o=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;i[1]+=o*n*(r-1);for(var l=0;r>l;l++)this.canvas.fillText(a[l],i[0],i[1]+o*l)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=s;var h=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[0]];null==h&&(h=-.5);var n=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==n&&(n=-.5);var o=this.canvas.mozMeasureText("xx");i[1]+=o*(1+n*r);for(var l=0;r>l;l++){var u=i[0]+h*this.canvas.mozMeasureText(a[l]),p=i[1]+l*o;this.canvas.translate(u,p),this.canvas.mozDrawText(a[l]),this.canvas.translate(-u,-p)}}this.setCanvasStyle("reset")},getLocalXY:function(e){var t=this.getResolution(),i=this.extent,s=e.x/t+-i.left/t,a=i.top/t-e.y/t;return[s,a]},clear:function(){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e),this.features={},this.hitDetection&&this.hitContext.clearRect(0,0,t,e)},getFeatureIdFromEvent:function(e){var t=null;if(this.hitDetection&&!this.map.dragging){var i=e.xy,s=0|i.x,a=0|i.y,r=this.hitContext.getImageData(s,a,1,1).data;if(255===r[3]){var n=r[2]+256*(r[1]+256*r[0]);n&&(t=this.features["OpenLayers.Feature.Vector_"+(n-1+this.hitOverflow)][0])}}return t},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0;e.length>t;++t)delete this.features[e[t].id];this.redraw()},redraw:function(){if(!this.locked){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e),this.hitDetection&&this.hitContext.clearRect(0,0,t,e);var i,s,a=[];for(var r in this.features)this.features.hasOwnProperty(r)&&(i=this.features[r][0],s=this.features[r][1],this.drawGeometry(i.geometry,s,i.id),s.label&&a.push([i,s]));for(var n,o=0,l=a.length;l>o;++o)n=a[o],this.drawText(n[0].geometry.getCentroid(),n[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:!1,interestingTagsExclude:null,areaTags:null,initialize:function(e){var t={interestingTagsExclude:["source","source_ref","source:ref","history","attribution","created_by"],areaTags:["area","building","leisure","tourism","ruins","historic","landuse","military","natural","sport"]};t=OpenLayers.Util.extend(t,e);for(var i={},s=0;t.interestingTagsExclude.length>s;s++)i[t.interestingTagsExclude[s]]=!0;t.interestingTagsExclude=i;for(var a={},s=0;t.areaTags.length>s;s++)a[t.areaTags[s]]=!0;t.areaTags=a,this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[t])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var t=this.getNodes(e),i=this.getWays(e),s=Array(i.length),a=0;i.length>a;a++){for(var r=Array(i[a].nodes.length),n=this.isWayArea(i[a])?1:0,o=0;i[a].nodes.length>o;o++){var l=t[i[a].nodes[o]],h=new OpenLayers.Geometry.Point(l.lon,l.lat);h.osm_id=parseInt(i[a].nodes[o]),r[o]=h,l.used=!0}var u=null;u=n?new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(r)):new OpenLayers.Geometry.LineString(r),this.internalProjection&&this.externalProjection&&u.transform(this.externalProjection,this.internalProjection);var p=new OpenLayers.Feature.Vector(u,i[a].tags);p.osm_id=parseInt(i[a].id),p.fid="way."+p.osm_id,s[a]=p}for(var c in t){var l=t[c];if(!l.used||this.checkTags){var d=null;if(this.checkTags){var m=this.getTags(l.node,!0);if(l.used&&!m[1])continue;d=m[0]}else d=this.getTags(l.node);var p=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(l.lon,l.lat),d);this.internalProjection&&this.externalProjection&&p.geometry.transform(this.externalProjection,this.internalProjection),p.osm_id=parseInt(c),p.fid="node."+p.osm_id,s.push(p)}l.node=null}return s},getNodes:function(e){for(var t=e.getElementsByTagName("node"),i={},s=0;t.length>s;s++){var a=t[s],r=a.getAttribute("id");i[r]={lat:a.getAttribute("lat"),lon:a.getAttribute("lon"),node:a}}return i},getWays:function(e){for(var t=e.getElementsByTagName("way"),i=[],s=0;t.length>s;s++){var a=t[s],r={id:a.getAttribute("id")};r.tags=this.getTags(a);var n=a.getElementsByTagName("nd");r.nodes=Array(n.length);for(var o=0;n.length>o;o++)r.nodes[o]=n[o].getAttribute("ref");i.push(r)}return i},getTags:function(e,t){for(var i=e.getElementsByTagName("tag"),s={},a=!1,r=0;i.length>r;r++){var n=i[r].getAttribute("k");s[n]=i[r].getAttribute("v"),t&&(this.interestingTagsExclude[n]||(a=!0))}return t?[s,a]:s},isWayArea:function(e){var t=!1,i=!1;if(e.nodes[0]==e.nodes[e.nodes.length-1]&&(t=!0),this.checkTags)for(var s in e.tags)if(this.areaTags[s]){i=!0;break}return t&&(this.checkTags?i:!0)},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]),this.osm_id=1,this.created_nodes={};var t=this.createElementNS(null,"osm");t.setAttribute("version","0.5"),t.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var i=e.length-1;i>=0;i--)for(var s=this.createFeatureNodes(e[i]),a=0;s.length>a;a++)t.appendChild(s[a]);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureNodes:function(e){var t=[],i=e.geometry.CLASS_NAME,s=i.substring(i.lastIndexOf(".")+1);s=s.toLowerCase();var a=this.createXML[s];return a&&(t=a.apply(this,[e])),t},createXML:{point:function(e){var t=null,i=e.geometry?e.geometry:e;this.internalProjection&&this.externalProjection&&(i=i.clone(),i.transform(this.internalProjection,this.externalProjection));var s=!1;if(e.osm_id?(t=e.osm_id,this.created_nodes[t]&&(s=!0)):(t=-this.osm_id,this.osm_id++),s)a=this.created_nodes[t];else var a=this.createElementNS(null,"node");return this.created_nodes[t]=a,a.setAttribute("id",t),a.setAttribute("lon",i.x),a.setAttribute("lat",i.y),e.attributes&&this.serializeTags(e,a),this.setState(e,a),s?[]:[a]},linestring:function(e){var t,i=[],s=e.geometry;e.osm_id?t=e.osm_id:(t=-this.osm_id,this.osm_id++);var a=this.createElementNS(null,"way");a.setAttribute("id",t);for(var r=0;s.components.length>r;r++){var n=this.createXML.point.apply(this,[s.components[r]]);if(n.length){n=n[0];var o=n.getAttribute("id");i.push(n)}else o=s.components[r].osm_id,n=this.created_nodes[o];this.setState(e,n);var l=this.createElementNS(null,"nd");l.setAttribute("ref",o),a.appendChild(l)}return this.serializeTags(e,a),i.push(a),i},polygon:function(e){var t=OpenLayers.Util.extend({area:"yes"},e.attributes),i=new OpenLayers.Feature.Vector(e.geometry.components[0],t);return i.osm_id=e.osm_id,this.createXML.linestring.apply(this,[i])}},serializeTags:function(e,t){for(var i in e.attributes){var s=this.createElementNS(null,"tag");s.setAttribute("k",i),s.setAttribute("v",e.attributes[i]),t.appendChild(s)}},setState:function(e,t){if(e.state){var i=null;switch(e.state){case OpenLayers.State.UPDATE:i="modify";case OpenLayers.State.DELETE:i="delete"}i&&t.setAttribute("action",i)}},CLASS_NAME:"OpenLayers.Format.OSM"}),OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,touch:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.documentDrag===!0){var e=this;this._docMove=function(t){e.mousemove({xy:{x:t.clientX,y:t.clientY},element:document})},this._docUp=function(t){e.mouseup({xy:{x:t.clientX,y:t.clientY}})}}},dragstart:function(e){var t=!0;return this.dragging=!1,this.checkModifiers(e)&&(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))?(this.started=!0,this.start=e.xy,this.last=e.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(e),this.callback("down",[e.xy]),OpenLayers.Event.stop(e),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,t=!this.stopDown):(this.started=!1,this.start=null,this.last=null),t},dragmove:function(e){return this.lastMoveEvt=e,!this.started||this.timeoutId||e.xy.x==this.last.x&&e.xy.y==this.last.y||(this.documentDrag===!0&&this.documentEvents&&(e.element===document?(this.adjustXY(e),this.setEvent(e)):this.removeDocumentEvents()),this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(e),this.callback("move",[e.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=e.xy),!0},dragend:function(e){if(this.started){this.documentDrag===!0&&this.documentEvents&&(this.adjustXY(e),this.removeDocumentEvents());var t=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.up(e),this.callback("up",[e.xy]),t&&this.callback("done",[e.xy]),document.onselectstart=this.oldOnselectstart}return!0},down:function(){},move:function(){},up:function(){},out:function(){},mousedown:function(e){return this.dragstart(e)},touchstart:function(e){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,scope:this})),this.dragstart(e)},mousemove:function(e){return this.dragmove(e)},touchmove:function(e){return this.dragmove(e)},removeTimeout:function(){this.timeoutId=null,this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(e){return this.dragend(e)},touchend:function(e){return e.xy=this.last,this.dragend(e)},mouseout:function(e){if(this.started&&OpenLayers.Util.mouseLeft(e,this.map.eventsDiv))if(this.documentDrag===!0)this.addDocumentEvents();else{var t=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(e),this.callback("out",[]),t&&this.callback("done",[e.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(){return this.start==this.last},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.touch=!1,this.started=!1,this.dragging=!1,this.start=null,this.last=null,e=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),e},adjustXY:function(e){var t=OpenLayers.Util.pagePosition(this.map.viewPortDiv);e.xy.x-=t[0],e.xy.y-=t[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown"),this.documentEvents=!0,OpenLayers.Event.observe(document,"mousemove",this._docMove),OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown"),this.documentEvents=!1,OpenLayers.Event.stopObserving(document,"mousemove",this._docMove),OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"}),OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,touch:!1,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(e,t,i,s){OpenLayers.Handler.prototype.initialize.apply(this,[e,i,s]),this.layer=t},touchstart:function(e){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),OpenLayers.Event.isMultiTouch(e)?!0:this.mousedown(e)},touchmove:function(e){OpenLayers.Event.stop(e)},mousedown:function(e){return this.down=e.xy,this.handle(e)?!this.stopDown:!0},mouseup:function(e){return this.up=e.xy,this.handle(e)?!this.stopUp:!0},click:function(e){return this.handle(e)?!this.stopClick:!0},mousemove:function(e){return this.callbacks.over||this.callbacks.out?(this.handle(e),!0):!0},dblclick:function(e){return!this.handle(e)},geometryTypeMatches:function(e){return null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)>-1},handle:function(e){this.feature&&!this.feature.layer&&(this.feature=null);var t=e.type,i=!1,s=!!this.feature,a="click"==t||"dblclick"==t||"touchstart"==t;if(this.feature=this.layer.getFeatureFromEvent(e),this.feature&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature){"touchstart"===t&&OpenLayers.Event.stop(e);var r=this.feature!=this.lastFeature;this.geometryTypeMatches(this.feature)?(s&&r?(this.lastFeature&&this.triggerCallback(t,"out",[this.lastFeature]),this.triggerCallback(t,"in",[this.feature])):(!s||a)&&this.triggerCallback(t,"in",[this.feature]),this.lastFeature=this.feature,i=!0):(this.lastFeature&&(s&&r||a)&&this.triggerCallback(t,"out",[this.lastFeature]),this.feature=null)}else this.lastFeature&&(s||a)&&this.triggerCallback(t,"out",[this.lastFeature]);return i},triggerCallback:function(e,t,i){var s=this.EVENTMAP[e][t];if(s)if("click"==e&&this.up&&this.down){var a=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));this.clickTolerance>=a&&this.callback(s,i)}else this.callback(s,i)},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.feature=null,this.lastFeature=null,this.down=null,this.up=null,this.touch=!1,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},handleMapEvents:function(e){("removelayer"==e.type||"order"==e.property)&&this.moveLayerToTop()},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;e>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(e):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"}),OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(){},onDrag:function(){},onComplete:function(){},onEnter:function(){},onLeave:function(){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.layer=e,this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(e){this.handlers.feature.touch&&!this.over&&this.overFeature(e)&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(e){this.handlers.feature.touch&&this.over&&(this.outFeature(e),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.handlers.drag.deactivate(),this.handlers.feature.deactivate(),this.feature=null,this.dragging=!1,this.lastPixel=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(e){var t=!1;return this.handlers.drag.dragging?this.over=this.feature.id==e.id?!0:!1:(this.feature=e,this.handlers.drag.activate(),t=!0,this.over=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(e)),t},downFeature:function(e){this.lastPixel=e,this.onStart(this.feature,e)},moveFeature:function(e){var t=this.map.getResolution();this.feature.geometry.move(t*(e.x-this.lastPixel.x),t*(this.lastPixel.y-e.y)),this.layer.drawFeature(this.feature),this.lastPixel=e,this.onDrag(this.feature,e)},upFeature:function(){this.over||this.handlers.drag.deactivate()},doneDragging:function(e){this.onComplete(this.feature,e)},outFeature:function(e){this.handlers.drag.dragging?this.feature.id==e.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(e),this.feature=null)},cancel:function(){this.handlers.drag.deactivate(),this.over=!1},setMap:function(e){this.handlers.drag.setMap(e),this.handlers.feature.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"}),OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(e,t){if(this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])},e instanceof OpenLayers.Style)this.styles["default"]=e,this.styles.select=e,this.styles.temporary=e,this.styles["delete"]=e;else if("object"==typeof e)for(var i in e)if(e[i]instanceof OpenLayers.Style)this.styles[i]=e[i];else{if("object"!=typeof e[i]){this.styles["default"]=new OpenLayers.Style(e),this.styles.select=new OpenLayers.Style(e),this.styles.temporary=new OpenLayers.Style(e),this.styles["delete"]=new OpenLayers.Style(e);break}this.styles[i]=new OpenLayers.Style(e[i])}OpenLayers.Util.extend(this,t)},destroy:function(){for(var e in this.styles)this.styles[e].destroy();this.styles=null},createSymbolizer:function(e,t){e||(e=new OpenLayers.Feature.Vector),this.styles[t]||(t="default"),e.renderIntent=t;var i={};return this.extendDefault&&"default"!=t&&(i=this.styles["default"].createSymbolizer(e)),OpenLayers.Util.extend(i,this.styles[t].createSymbolizer(e))},addUniqueValueRules:function(e,t,i,s){var a=[];for(var r in i)a.push(new OpenLayers.Rule({symbolizer:i[r],context:s,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:t,value:r})}));this.styles[e].addRules(a)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{EVENT_TYPES:["beforefeatureadded","beforefeaturesadded","featureadded","featuresadded","beforefeatureremoved","beforefeaturesremoved","featureremoved","featuresremoved","beforefeatureselected","featureselected","featureunselected","beforefeaturemodified","featuremodified","afterfeaturemodified","vertexmodified","vertexremoved","sketchstarted","sketchmodified","sketchcomplete","refresh"],isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,initialize:function(){if(this.EVENT_TYPES=OpenLayers.Layer.Vector.prototype.EVENT_TYPES.concat(OpenLayers.Layer.prototype.EVENT_TYPES),OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var e=0,t=this.strategies.length;t>e;e++)this.strategies[e].setLayer(this)},destroy:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;i>t;t++)e=this.strategies[t],e.autoDestroy&&e.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.features=null,this.selectedFeatures=null,this.unrenderedFeatures=null,this.renderer&&this.renderer.destroy(),this.renderer=null,this.geometryType=null,this.drawn=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.Vector(this.name,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e]);for(var t=this.features,i=t.length,s=Array(i),a=0;i>a;++a)s[a]=t[a].clone();return e.features=s,e},refresh:function(e){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",e)},assignRenderer:function(){for(var e=0,t=this.renderers.length;t>e;e++){var i=this.renderers[e],s="function"==typeof i?i:OpenLayers.Renderer[i];if(s&&s.prototype.supported()){this.renderer=new s(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(){OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer?(this.renderer.map=this.map,this.renderer.setSize(this.map.getSize())):this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;i>t;t++)e=this.strategies[t],e.autoActivate&&e.activate()}},removeMap:function(){if(this.drawn=!1,this.strategies){var e,t,i;for(t=0,i=this.strategies.length;i>t;t++)e=this.strategies[t],e.autoActivate&&e.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments),this.renderer.setSize(this.map.getSize())},moveTo:function(e,t,i){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var s=OpenLayers.Renderer.NG&&this.renderer instanceof OpenLayers.Renderer.NG;if(s)i||this.renderer.updateDimensions(t);else{var a=!0;if(!i){this.renderer.root.style.visibility="hidden",this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px",this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";var r=this.map.getExtent();if(a=this.renderer.setExtent(r,t),this.renderer.root.style.visibility="visible",OpenLayers.IS_GECKO===!0&&(this.div.scrollLeft=this.div.scrollLeft),!t&&a)for(var n in this.unrenderedFeatures){var o=this.unrenderedFeatures[n];this.drawFeature(o)}}}if(!this.drawn||!s&&(t||!a)){this.drawn=!0;for(var o,n=0,l=this.features.length;l>n;n++)this.renderer.locked=n!==l-1,o=this.features[n],this.drawFeature(o)}},redraw:function(){return OpenLayers.Renderer.NG&&this.renderer instanceof OpenLayers.Renderer.NG&&(this.drawn=!1),OpenLayers.Layer.prototype.redraw.apply(this,arguments)},display:function(){OpenLayers.Layer.prototype.display.apply(this,arguments);var e=this.div.style.display;e!=this.renderer.root.style.display&&(this.renderer.root.style.display=e)},addFeatures:function(e,t){OpenLayers.Util.isArray(e)||(e=[e]);var i=!t||!t.silent;if(i){var s={features:e},a=this.events.triggerEvent("beforefeaturesadded",s);if(a===!1)return;e=s.features}for(var r=[],n=0,o=e.length;o>n;n++){this.renderer.locked=n!=e.length-1?!0:!1;var l=e[n];if(this.geometryType&&!(l.geometry instanceof this.geometryType)){var h=OpenLayers.i18n("componentShouldBe",{geomType:this.geometryType.prototype.CLASS_NAME});throw h}if(l.layer=this,!l.style&&this.style&&(l.style=OpenLayers.Util.extend({},this.style)),i){if(this.events.triggerEvent("beforefeatureadded",{feature:l})===!1)continue;this.preFeatureInsert(l)}r.push(l),this.features.push(l),this.drawFeature(l),i&&(this.events.triggerEvent("featureadded",{feature:l}),this.onFeatureInsert(l))}i&&this.events.triggerEvent("featuresadded",{features:r})},removeFeatures:function(e,t){if(e&&0!==e.length){if(e===this.features)return this.removeAllFeatures(t);OpenLayers.Util.isArray(e)||(e=[e]),e===this.selectedFeatures&&(e=e.slice());var i=!t||!t.silent;i&&this.events.triggerEvent("beforefeaturesremoved",{features:e});for(var s=e.length-1;s>=0;s--){this.renderer.locked=0!=s&&e[s-1].geometry?!0:!1;var a=e[s];delete this.unrenderedFeatures[a.id],i&&this.events.triggerEvent("beforefeatureremoved",{feature:a}),this.features=OpenLayers.Util.removeItem(this.features,a),a.layer=null,a.geometry&&this.renderer.eraseFeatures(a),-1!=OpenLayers.Util.indexOf(this.selectedFeatures,a)&&OpenLayers.Util.removeItem(this.selectedFeatures,a),i&&this.events.triggerEvent("featureremoved",{feature:a})}i&&this.events.triggerEvent("featuresremoved",{features:e})}},removeAllFeatures:function(e){var t=!e||!e.silent,i=this.features;t&&this.events.triggerEvent("beforefeaturesremoved",{features:i});for(var s,a=i.length-1;a>=0;a--)s=i[a],t&&this.events.triggerEvent("beforefeatureremoved",{feature:s}),s.layer=null,t&&this.events.triggerEvent("featureremoved",{feature:s});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],t&&this.events.triggerEvent("featuresremoved",{features:i})},destroyFeatures:function(e,t){var i=void 0==e;if(i&&(e=this.features),e){this.removeFeatures(e,t);for(var s=e.length-1;s>=0;s--)e[s].destroy()}},drawFeature:function(e,t){if(this.drawn){if("object"!=typeof t){t||e.state!==OpenLayers.State.DELETE||(t="delete");var i=t||e.renderIntent;t=e.style||this.style,t||(t=this.styleMap.createSymbolizer(e,i))}var s=this.renderer.drawFeature(e,t);s===!1||null===s?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id]}},eraseFeatures:function(e){this.renderer.eraseFeatures(e)},getFeatureFromEvent:function(e){if(!this.renderer)return OpenLayers.Console.error(OpenLayers.i18n("getFeatureError")),null;var t=null,i=this.renderer.getFeatureIdFromEvent(e);return i&&(t="string"==typeof i?this.getFeatureById(i):i),t},getFeatureBy:function(e,t){for(var i=null,s=0,a=this.features.length;a>s;++s)if(this.features[s][e]==t){i=this.features[s];break}return i},getFeatureById:function(e){return this.getFeatureBy("id",e)},getFeatureByFid:function(e){return this.getFeatureBy("fid",e)},getFeaturesByAttribute:function(e,t){var i,s,a=this.features.length,r=[];for(i=0;a>i;i++)s=this.features[i],s&&s.attributes&&s.attributes[e]===t&&r.push(s);return r},onFeatureInsert:function(){},preFeatureInsert:function(){},getDataExtent:function(){var e=null,t=this.features;if(t&&t.length>0)for(var i=null,s=0,a=t.length;a>s;s++)i=t[s].geometry,i&&(null===e&&(e=new OpenLayers.Bounds),e.extend(i.getBounds()));return e},CLASS_NAME:"OpenLayers.Layer.Vector"}),OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,initialize:function(){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments)},display:function(){},getFeatureFromEvent:function(e){for(var t,i=this.layers,s=0;i.length>s;s++)if(t=i[s].getFeatureFromEvent(e))return t},setMap:function(e){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),this.collectRoots(),e.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(e){e.events.unregister("changelayer",this,this.handleChangeLayer),this.resetRoots(),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var e,t=0;this.map.layers.length>t;++t)e=this.map.layers[t],-1!=OpenLayers.Util.indexOf(this.layers,e)&&e.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var e,t=0;this.layers.length>t;++t)e=this.layers[t],this.renderer&&e.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(e.renderer)},handleChangeLayer:function(e){var t=e.layer;"order"==e.property&&-1!=OpenLayers.Util.indexOf(this.layers,t)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"}),OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforefeaturehighlighted","featurehighlighted","featureunhighlighted"],multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(e,t){this.EVENT_TYPES=OpenLayers.Control.SelectFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES),OpenLayers.Control.prototype.initialize.apply(this,[t]),null===this.scope&&(this.scope=this),this.initLayer(e);var i={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(i.over=this.overFeature,i.out=this.outFeature),this.callbacks=OpenLayers.Util.extend(i,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(e){OpenLayers.Util.isArray(e)?(this.layers=e,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:e})):this.layer=e},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(e){for(var t,i,s=this.layers||[this.layer],a=0;s.length>a;++a){t=s[a];for(var r=t.selectedFeatures.length-1;r>=0;--r)i=t.selectedFeatures[r],e&&e.except==i||this.unselect(i)}},clickFeature:function(e){if(!this.hover){var t=OpenLayers.Util.indexOf(e.layer.selectedFeatures,e)>-1;t?this.toggleSelect()?this.unselect(e):this.multipleSelect()||this.unselectAll({except:e}):(this.multipleSelect()||this.unselectAll({except:e}),this.select(e))}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(){!this.hover&&this.clickout&&this.unselectAll()
},overFeature:function(e){var t=e.layer;this.hover&&(this.highlightOnly?this.highlight(e):-1==OpenLayers.Util.indexOf(t.selectedFeatures,e)&&this.select(e))},outFeature:function(e){if(this.hover)if(this.highlightOnly){if(e._lastHighlighter==this.id)if(e._prevHighlighter&&e._prevHighlighter!=this.id){delete e._lastHighlighter;var t=this.map.getControl(e._prevHighlighter);t&&t.highlight(e)}else this.unhighlight(e)}else this.unselect(e)},highlight:function(e){var t=e.layer,i=this.events.triggerEvent("beforefeaturehighlighted",{feature:e});if(i!==!1){e._prevHighlighter=e._lastHighlighter,e._lastHighlighter=this.id;var s=this.selectStyle||this.renderIntent;t.drawFeature(e,s),this.events.triggerEvent("featurehighlighted",{feature:e})}},unhighlight:function(e){var t=e.layer;void 0==e._prevHighlighter?delete e._lastHighlighter:e._prevHighlighter==this.id?delete e._prevHighlighter:(e._lastHighlighter=e._prevHighlighter,delete e._prevHighlighter),t.drawFeature(e,e.style||e.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:e})},select:function(e){var t=this.onBeforeSelect.call(this.scope,e),i=e.layer;t!==!1&&(t=i.events.triggerEvent("beforefeatureselected",{feature:e}),t!==!1&&(i.selectedFeatures.push(e),this.highlight(e),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=i.selectedFeatures[0]),i.events.triggerEvent("featureselected",{feature:e}),this.onSelect.call(this.scope,e)))},unselect:function(e){var t=e.layer;this.unhighlight(e),OpenLayers.Util.removeItem(t.selectedFeatures,e),t.events.triggerEvent("featureunselected",{feature:e}),this.onUnselect.call(this.scope,e)},selectBox:function(e){if(e instanceof OpenLayers.Bounds){var t=this.map.getLonLatFromPixel(new OpenLayers.Pixel(e.left,e.bottom)),i=this.map.getLonLatFromPixel(new OpenLayers.Pixel(e.right,e.top)),s=new OpenLayers.Bounds(t.lon,t.lat,i.lon,i.lat);this.multipleSelect()||this.unselectAll();var a=this.multiple;this.multiple=!0;for(var r,n=this.layers||[this.layer],o=0;n.length>o;++o){r=n[o];for(var l=0,h=r.features.length;h>l;++l){var u=r.features[l];u.getVisibility()&&(null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,u.geometry.CLASS_NAME)>-1)&&s.toGeometry().intersects(u.geometry)&&-1==OpenLayers.Util.indexOf(r.selectedFeatures,u)&&this.select(u)}}this.multiple=a}},setMap:function(e){this.handlers.feature.setMap(e),this.box&&this.handlers.box.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(e){var t=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(e),this.handlers.feature.layer=this.layer,t&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"}),OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate(),this.eventListener=null,OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){for(var e=0,t=this.KEY_EVENTS.length;t>e;e++)OpenLayers.Event.observe(document,this.KEY_EVENTS[e],this.eventListener);return!0}return!1},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var t=0,i=this.KEY_EVENTS.length;i>t;t++)OpenLayers.Event.stopObserving(document,this.KEY_EVENTS[t],this.eventListener);e=!0}return e},handleKeyEvent:function(e){this.checkModifiers(e)&&this.callback(e.type,[e])},CLASS_NAME:"OpenLayers.Handler.Keyboard"}),OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(e,t){t=t||{},this.layer=e,this.vertices=[],this.virtualVertices=[],this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,t.vertexRenderIntent)),this.virtualStyle.fillOpacity=.3,this.virtualStyle.strokeOpacity=.3,this.deleteCodes=[46,68],this.mode=OpenLayers.Control.ModifyFeature.RESHAPE,OpenLayers.Control.prototype.initialize.apply(this,[t]),OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var i=this,s={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};this.standalone===!1&&(this.selectControl=new OpenLayers.Control.SelectFeature(e,s));var a={geometryTypes:["OpenLayers.Geometry.Point"],snappingOptions:this.snappingOptions,onStart:function(e,t){i.dragStart.apply(i,[e,t])},onDrag:function(e,t){i.dragVertex.apply(i,[e,t])},onComplete:function(e){i.dragComplete.apply(i,[e])},featureCallbacks:{over:function(e){(i.standalone!==!0||e._sketch||i.feature===e)&&i.dragControl.overFeature.apply(i.dragControl,[e])}}};this.dragControl=new OpenLayers.Control.DragFeature(e,a);var r={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,r)}},destroy:function(){this.layer=null,this.standalone||this.selectControl.destroy(),this.dragControl.destroy(),OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.standalone||this.selectControl.activate())&&this.handlers.keyboard.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var e=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.dragControl.deactivate();var t=this.feature,i=t&&t.geometry&&t.layer;this.standalone===!1?(i&&this.selectControl.unselect.apply(this.selectControl,[t]),this.selectControl.deactivate()):i&&this.unselectFeature(t),this.handlers.keyboard.deactivate(),e=!0}return e},beforeSelectFeature:function(e){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:e})},selectFeature:function(e){this.standalone&&this.beforeSelectFeature(e)===!1||(this.feature=e,this.modified=!1,this.resetVertices(),this.dragControl.activate(),this.onModificationStart(this.feature));var t=e.modified;!e.geometry||t&&t.geometry||(this._originalGeometry=e.geometry.clone())},unselectFeature:function(e){this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[],this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle),this.feature=null,this.dragControl.deactivate(),this.onModificationEnd(e),this.layer.events.triggerEvent("afterfeaturemodified",{feature:e,modified:this.modified}),this.modified=!1},dragStart:function(e,t){e==this.feature||e.geometry.parent||e==this.dragHandle||e==this.radiusHandle||(this.standalone===!1&&this.feature&&this.selectControl.clickFeature.apply(this.selectControl,[this.feature]),(null==this.geometryTypes||-1!=OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME))&&(this.standalone||this.selectControl.clickFeature.apply(this.selectControl,[e]),this.dragControl.overFeature.apply(this.dragControl,[e]),this.dragControl.lastPixel=t,this.dragControl.handlers.drag.started=!0,this.dragControl.handlers.drag.start=t,this.dragControl.handlers.drag.last=t))},dragVertex:function(e,t){this.modified=!0,"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?(this.feature!=e&&(this.feature=e),this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:t})):(e._index?(e.geometry.parent.addComponent(e.geometry,e._index),delete e._index,OpenLayers.Util.removeItem(this.virtualVertices,e),this.vertices.push(e)):e==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):e!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:t}),this.virtualVertices.length>0&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:this.selectControl.renderIntent)),this.layer.drawFeature(e)},dragComplete:function(){this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var e=this.feature;e.modified=OpenLayers.Util.extend(e.modified,{geometry:this._originalGeometry}),delete this._originalGeometry}},resetVertices:function(){this.dragControl.feature&&this.dragControl.outFeature(this.dragControl.feature),this.vertices.length>0&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]),this.virtualVertices.length>0&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null),this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(e){var t=e.keyCode;if(this.feature&&-1!=OpenLayers.Util.indexOf(this.deleteCodes,t)){var i=this.dragControl.feature;i&&-1!=OpenLayers.Util.indexOf(this.vertices,i)&&!this.dragControl.handlers.drag.dragging&&i.geometry.parent&&(i.geometry.parent.removeComponent(i.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:i.geometry,feature:this.feature,pixel:e.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:this.selectControl.renderIntent),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature}))}},collectVertices:function(){function e(i){var s,a,r,n;if("OpenLayers.Geometry.Point"==i.CLASS_NAME)a=new OpenLayers.Feature.Vector(i),a._sketch=!0,a.renderIntent=t.vertexRenderIntent,t.vertices.push(a);else{var o=i.components.length;for("OpenLayers.Geometry.LinearRing"==i.CLASS_NAME&&(o-=1),s=0;o>s;++s)r=i.components[s],"OpenLayers.Geometry.Point"==r.CLASS_NAME?(a=new OpenLayers.Feature.Vector(r),a._sketch=!0,a.renderIntent=t.vertexRenderIntent,t.vertices.push(a)):e(r);if("OpenLayers.Geometry.MultiPoint"!=i.CLASS_NAME)for(s=0,n=i.components.length;n-1>s;++s){var l=i.components[s],h=i.components[s+1];if("OpenLayers.Geometry.Point"==l.CLASS_NAME&&"OpenLayers.Geometry.Point"==h.CLASS_NAME){var u=(l.x+h.x)/2,p=(l.y+h.y)/2,c=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(u,p),null,t.virtualStyle);c.geometry.parent=i,c._index=s+1,c._sketch=!0,t.virtualVertices.push(c)}}}}this.vertices=[],this.virtualVertices=[];var t=this;e.call(this,this.feature.geometry),this.layer.addFeatures(this.virtualVertices,{silent:!0}),this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var e=this.feature.geometry,t=e.getBounds().getCenterLonLat(),i=new OpenLayers.Geometry.Point(t.lon,t.lat),s=new OpenLayers.Feature.Vector(i);i.move=function(t,i){OpenLayers.Geometry.Point.prototype.move.call(this,t,i),e.move(t,i)},s._sketch=!0,this.dragHandle=s,this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var e=this.feature.geometry,t=e.getBounds(),i=t.getCenterLonLat(),s=new OpenLayers.Geometry.Point(i.lon,i.lat),a=new OpenLayers.Geometry.Point(t.right,t.bottom),r=new OpenLayers.Feature.Vector(a),n=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,o=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,l=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;a.move=function(t,i){OpenLayers.Geometry.Point.prototype.move.call(this,t,i);var a=this.x-s.x,r=this.y-s.y,h=a-t,u=r-i;if(l){var p=Math.atan2(u,h),c=Math.atan2(r,a),d=c-p;d*=180/Math.PI,e.rotate(d,s)}if(n){var m,y;if(o)m=r/u,y=a/h/m;else{var f=Math.sqrt(h*h+u*u),g=Math.sqrt(a*a+r*r);m=g/f}e.resize(m,s,y)}},r._sketch=!0,this.radiusHandle=r,this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(e){this.standalone||this.selectControl.setMap(e),this.dragControl.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.ModifyFeature"}),OpenLayers.Control.ModifyFeature.RESHAPE=1,OpenLayers.Control.ModifyFeature.RESIZE=2,OpenLayers.Control.ModifyFeature.ROTATE=4,OpenLayers.Control.ModifyFeature.DRAG=8,OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(e,t,i){(i&&i.sphericalMercator||this.sphericalMercator)&&(i=OpenLayers.Util.extend({maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),maxResolution:156543.03390625,numZoomLevels:19,units:"m",projection:"EPSG:900913"},i)),t=t||this.url,e=e||this.name;var s=[e,t,{},i];OpenLayers.Layer.Grid.prototype.initialize.apply(this,s)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){var t=this.getXYZ(e),i=this.url;if(OpenLayers.Util.isArray(i)){var s=""+t.x+t.y+t.z;i=this.selectUrl(s,i)}return OpenLayers.String.format(i,t)},getXYZ:function(e){var t=this.map.getResolution(),i=Math.round((e.left-this.maxExtent.left)/(t*this.tileSize.w)),s=Math.round((this.maxExtent.top-e.top)/(t*this.tileSize.h)),a=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,t):this.map.getZoom()+this.zoomOffset,r=Math.pow(2,a);return this.wrapDateLine&&(i=(i%r+r)%r),{x:i,y:s,z:a}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"}),OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:!0,url:"http://tile.openstreetmap.org/${z}/${x}/${y}.png",clone:function(e){return null==e&&(e=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},wrapDateLine:!0,CLASS_NAME:"OpenLayers.Layer.OSM"}),OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677,.14929107084870338,.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,type:"Road",metadataParams:null,initialize:function(e){e=OpenLayers.Util.applyDefaults({sphericalMercator:!0},e);var t=e.name||"Bing "+(e.type||this.type),i=[t,null,e];OpenLayers.Layer.XYZ.prototype.initialize.apply(this,i),this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_"),window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var e=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),t="http://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(e),i=document.createElement("script");i.type="text/javascript",i.src=t,i.id=this._callbackId,document.getElementsByTagName("head")[0].appendChild(i)},initLayer:function(){var e=this.metadata.resourceSets[0].resources[0],t=e.imageUrl.replace("{quadkey}","${quadkey}");this.url=[];for(var i=0;e.imageUrlSubdomains.length>i;++i)this.url.push(t.replace("{subdomain}",e.imageUrlSubdomains[i]));this.addOptions({maxResolution:Math.min(this.serverResolutions[e.zoomMin],this.maxResolution),zoomOffset:e.zoomMin,numZoomLevels:Math.min(e.zoomMax+1-e.zoomMin,this.numZoomLevels)},!0)},getURL:function(e){if(!this.url)return OpenLayers.Util.getImagesLocation()+"blank.gif";for(var t=this.getXYZ(e),i=t.x,s=t.y,a=t.z,r=[],n=a;n>0;--n){var o="0",l=1<<n-1;0!=(i&l)&&o++,0!=(s&l)&&(o++,o++),r.push(o)}var h=r.join(""),u=this.selectUrl(""+i+s+a,this.url);return OpenLayers.String.format(u,{quadkey:h})},updateAttribution:function(){var e=this.metadata;if(e&&this.map&&this.map.center){var t,i,s,a,r,n,o,l=e.resourceSets[0].resources[0],h=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),u=l.imageryProviders,p=this.map.getZoom()+1,c="";for(i=0,s=u.length;s>i;++i)for(t=u[i],a=0,r=t.coverageAreas.length;r>a;++a)o=t.coverageAreas[a],n=OpenLayers.Bounds.fromArray(o.bbox),h.intersectsBounds(n)&&o.zoomMax>=p&&p>=o.zoomMin&&(c+=t.attribution+" ");this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:e.brandLogoUri,copyrights:c}),this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments),this.updateAttribution(),this.map.events.register("moveend",this,this.updateAttribution)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Bing(this.options)),e=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution),OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"}),OpenLayers.Layer.Bing.processMetadata=function(e){this.metadata=e,this.initLayer();var t=document.getElementById(this._callbackId);t.parentNode.removeChild(t),window[this._callbackId]=void 0,delete this._callbackId},OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={features:[]};this.readNode(e,t);for(var i=[],s=0,a=t.features.length;a>s;s++){var r=t.features[s];this.internalProjection&&this.externalProjection&&r.components[0]&&r.components[0].transform(this.externalProjection,this.internalProjection);var n=new OpenLayers.Feature.Vector(r.components[0],r.attributes);i.push(n)}return i},readers:{sa:{SamplingPoint:function(e,t){if(!t.attributes){var i={attributes:{}};t.features.push(i),t=i}t.attributes.id=this.getAttributeNS(e,this.namespaces.gml,"id"),this.readChildNodes(e,t)},position:function(e,t){this.readChildNodes(e,t)}},gml:OpenLayers.Util.applyDefaults({FeatureCollection:function(e,t){this.readChildNodes(e,t)},featureMember:function(e,t){var i={attributes:{}};t.features.push(i),this.readChildNodes(e,i)},name:function(e,t){t.attributes.name=this.getChildValue(e)},pos:function(e,t){this.externalProjection||(this.externalProjection=new OpenLayers.Projection(e.getAttribute("srsName"))),OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[e,t])}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetFeatureOfInterest:function(e){for(var t=this.createElementNSPlus("GetFeatureOfInterest",{attributes:{version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation}}),i=0,s=e.fois.length;s>i;i++)this.writeNode("FeatureOfInterestId",{foi:e.fois[i]},t);return t},FeatureOfInterestId:function(e){var t=this.createElementNSPlus("FeatureOfInterestId",{value:e.foi});return t}}},CLASS_NAME:"OpenLayers.Format.SOSGetFeatureOfInterest"}),OpenLayers.Format.SOSGetObservation=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml",sos:"http://www.opengis.net/sos/1.0",ogc:"http://www.opengis.net/ogc",om:"http://www.opengis.net/om/1.0",sa:"http://www.opengis.net/sampling/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd",defaultPrefix:"sos",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={measurements:[],observations:[]};return this.readNode(e,t),t},write:function(e){var t=this.writeNode("sos:GetObservation",e);return t.setAttribute("xmlns:om",this.namespaces.om),t.setAttribute("xmlns:ogc",this.namespaces.ogc),this.setAttributeNS(t,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[t])},readers:{om:{ObservationCollection:function(e,t){t.id=this.getAttributeNS(e,this.namespaces.gml,"id"),this.readChildNodes(e,t)},member:function(e,t){this.readChildNodes(e,t)},Measurement:function(e,t){var i={};t.measurements.push(i),this.readChildNodes(e,i)},Observation:function(e,t){var i={};t.observations.push(i),this.readChildNodes(e,i)},samplingTime:function(e,t){var i={};t.samplingTime=i,this.readChildNodes(e,i)},observedProperty:function(e,t){t.observedProperty=this.getAttributeNS(e,this.namespaces.xlink,"href"),this.readChildNodes(e,t)},procedure:function(e,t){t.procedure=this.getAttributeNS(e,this.namespaces.xlink,"href"),this.readChildNodes(e,t)},featureOfInterest:function(e,t){var i={features:[]};t.fois=[],t.fois.push(i),this.readChildNodes(e,i);for(var s=[],a=0,r=i.features.length;r>a;a++){var n=i.features[a];s.push(new OpenLayers.Feature.Vector(n.components[0],n.attributes))}i.features=s},result:function(e,t){var i={};t.result=i,""!==this.getChildValue(e)?(i.value=this.getChildValue(e),i.uom=e.getAttribute("uom")):this.readChildNodes(e,i)}},sa:OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.sa,gml:OpenLayers.Util.applyDefaults({TimeInstant:function(e,t){var i={};t.timeInstant=i,this.readChildNodes(e,i)},timePosition:function(e,t){t.timePosition=this.getChildValue(e)}},OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.gml)},writers:{sos:{GetObservation:function(e){var t=this.createElementNSPlus("GetObservation",{attributes:{version:this.VERSION,service:"SOS"}});this.writeNode("offering",e,t),e.eventTime&&this.writeNode("eventTime",e,t);for(var i in e.procedures)this.writeNode("procedure",e.procedures[i],t);for(var s in e.observedProperties)this.writeNode("observedProperty",e.observedProperties[s],t);return e.foi&&this.writeNode("featureOfInterest",e.foi,t),this.writeNode("responseFormat",e,t),e.resultModel&&this.writeNode("resultModel",e,t),e.responseMode&&this.writeNode("responseMode",e,t),t},featureOfInterest:function(e){var t=this.createElementNSPlus("featureOfInterest");return this.writeNode("ObjectID",e.objectId,t),t},ObjectID:function(e){return this.createElementNSPlus("ObjectID",{value:e})},responseFormat:function(e){return this.createElementNSPlus("responseFormat",{value:e.responseFormat})},procedure:function(e){return this.createElementNSPlus("procedure",{value:e})},offering:function(e){return this.createElementNSPlus("offering",{value:e.offering})},observedProperty:function(e){return this.createElementNSPlus("observedProperty",{value:e})},eventTime:function(e){var t=this.createElementNSPlus("eventTime");return"latest"===e.eventTime&&this.writeNode("ogc:TM_Equals",e,t),t},resultModel:function(e){return this.createElementNSPlus("resultModel",{value:e.resultModel})},responseMode:function(e){return this.createElementNSPlus("responseMode",{value:e.responseMode})}},ogc:{TM_Equals:function(e){var t=this.createElementNSPlus("ogc:TM_Equals");return this.writeNode("ogc:PropertyName",{property:"urn:ogc:data:time:iso8601"},t),"latest"===e.eventTime&&this.writeNode("gml:TimeInstant",{value:"latest"},t),t},PropertyName:function(e){return this.createElementNSPlus("ogc:PropertyName",{value:e.property})}},gml:{TimeInstant:function(e){var t=this.createElementNSPlus("gml:TimeInstant");return this.writeNode("gml:timePosition",e,t),t},timePosition:function(e){var t=this.createElementNSPlus("gml:timePosition",{value:e.value});return t}}},CLASS_NAME:"OpenLayers.Format.SOSGetObservation"}),OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,mousePosition:null,interval:0,delta:0,cumulative:!0,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.wheelListener=null},onWheelEvent:function(e){if(this.map&&this.checkModifiers(e)){for(var t=!1,i=!1,s=!1,a=OpenLayers.Event.element(e);null!=a&&!s&&!t;){if(!t)try{if(a.currentStyle)n=a.currentStyle.overflow;else var r=document.defaultView.getComputedStyle(a,null),n=r.getPropertyValue("overflow");t=n&&"auto"==n||"scroll"==n}catch(o){}if(!i)for(var l=0,h=this.map.layers.length;h>l;l++)if(a==this.map.layers[l].div||a==this.map.layers[l].pane){i=!0;break}s=a==this.map.div,a=a.parentNode}if(!t&&s){if(i){var u=0;e||(e=window.event),e.wheelDelta?(u=e.wheelDelta/120,window.opera&&9.2>window.opera.version()&&(u=-u)):e.detail&&(u=-e.detail/3),this.delta=this.delta+u,this.interval?(window.clearTimeout(this._timeoutId),this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(e)},this),this.interval)):this.wheelZoom(e)}OpenLayers.Event.stop(e)}}},wheelZoom:function(e){var t=this.delta;this.delta=0,t&&(this.mousePosition&&(e.xy=this.mousePosition),e.xy||(e.xy=this.map.getPixelFromLonLat(this.map.getCenter())),0>t?this.callback("down",[e,this.cumulative?t:-1]):this.callback("up",[e,this.cumulative?t:1]))},mousemove:function(e){this.mousePosition=e.xy},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var e=this.wheelListener;return OpenLayers.Event.observe(window,"DOMMouseScroll",e),OpenLayers.Event.observe(window,"mousewheel",e),OpenLayers.Event.observe(document,"mousewheel",e),!0}return!1},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var e=this.wheelListener;return OpenLayers.Event.stopObserving(window,"DOMMouseScroll",e),OpenLayers.Event.stopObserving(window,"mousewheel",e),OpenLayers.Event.stopObserving(document,"mousewheel",e),!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"}),OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[e]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,[e,t])},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},InsertResult:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds.push(i.fids[0])},TransactionResult:function(e,t){this.readChildNodes(e,t)},Status:function(e,t){this.readChildNodes(e,t)},SUCCESS:function(e,t){t.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},e);var t=e.featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType}});if(e.srsNameInQuery&&e.srsName&&i.setAttribute("srsName",e.srsName),e.featureNS&&i.setAttribute("xmlns:"+t,e.featureNS),e.propertyNames)for(var s=0,a=e.propertyNames.length;a>s;s++)this.writeNode("ogc:PropertyName",{property:e.propertyNames[s]},i);return e.filter&&(this.setFilterProperty(e.filter),this.writeNode("ogc:Filter",e.filter,i)),i}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"}),OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(e){this.compare=e?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(e){this.exists(e)&&this.remove(e);var t=e.id;this.determineZIndex(e);for(var i,s=-1,a=this.order.length;a-s>1;){i=parseInt((s+a)/2);var r=this.compare(this,e,OpenLayers.Util.getElement(this.order[i]));r>0?s=i:a=i}return this.order.splice(a,0,t),this.indices[t]=this.getZIndex(e),this.getNextElement(a)},remove:function(e){var t=e.id,i=OpenLayers.Util.indexOf(this.order,t);if(i>=0)if(this.order.splice(i,1),delete this.indices[t],this.order.length>0){var s=this.order[this.order.length-1];this.maxZIndex=this.indices[s]}else this.maxZIndex=0},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(e){return null!=this.indices[e.id]},getZIndex:function(e){return e._style.graphicZIndex},determineZIndex:function(e){var t=e._style.graphicZIndex;null==t?(t=this.maxZIndex,e._style.graphicZIndex=t):t>this.maxZIndex&&(this.maxZIndex=t)},getNextElement:function(e){var t=e+1;if(this.order.length>t){var i=OpenLayers.Util.getElement(this.order[t]);return void 0==i&&(i=this.getNextElement(t)),i}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,t,i){var s=e.getZIndex(t),a=0;if(i){var r=e.getZIndex(i);a=s-r}return a},Z_ORDER_DRAWING_ORDER:function(e,t,i){var s=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);return i&&0==s&&(s=1),s},Z_ORDER_Y_ORDER:function(e,t,i){var s=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);if(i&&0===s){var a=i._boundsBottom-t._boundsBottom;s=0===a?1:a}return s}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),t&&(t.zIndexing||t.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(t.yOrdering))
},destroy:function(){this.clear(),this.rendererRoot=null,this.root=null,this.xmlns=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var e,t=this.vectorRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);if(t=this.textRoot)for(;e=t.firstChild;)t.removeChild(e);this.indexer&&this.indexer.clear()},getNodeType:function(){},drawGeometry:function(e,t,i){var s=e.CLASS_NAME,a=!0;if("OpenLayers.Geometry.Collection"==s||"OpenLayers.Geometry.MultiPoint"==s||"OpenLayers.Geometry.MultiLineString"==s||"OpenLayers.Geometry.MultiPolygon"==s){for(var r=0,n=e.components.length;n>r;r++)a=this.drawGeometry(e.components[r],t,i)&&a;return a}a=!1;var o=!1;if("none"!=t.display&&(t.backgroundGraphic?this.redrawBackgroundNode(e.id,e,t,i):o=!0,a=this.redrawNode(e.id,e,t,i)),0==a){var l=document.getElementById(e.id);l&&(l._style.backgroundGraphic&&(o=!0),l.parentNode.removeChild(l))}if(o){var l=document.getElementById(e.id+this.BACKGROUND_ID_SUFFIX);l&&l.parentNode.removeChild(l)}return a},redrawNode:function(e,t,i,s){i=this.applyDefaultSymbolizer(i);var a=this.nodeFactory(e,this.getNodeType(t,i));a._featureId=s,a._boundsBottom=t.getBounds().bottom,a._geometryClass=t.CLASS_NAME,a._style=i;var r=this.drawGeometryNode(a,t,i);if(r===!1)return!1;if(a=r.node,this.indexer){var n=this.indexer.insert(a);n?this.vectorRoot.insertBefore(a,n):this.vectorRoot.appendChild(a)}else a.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(a);return this.postDraw(a),r.complete},redrawBackgroundNode:function(e,t,i){var s=OpenLayers.Util.extend({},i);return s.externalGraphic=s.backgroundGraphic,s.graphicXOffset=s.backgroundXOffset,s.graphicYOffset=s.backgroundYOffset,s.graphicZIndex=s.backgroundGraphicZIndex,s.graphicWidth=s.backgroundWidth||s.graphicWidth,s.graphicHeight=s.backgroundHeight||s.graphicHeight,s.backgroundGraphic=null,s.backgroundXOffset=null,s.backgroundYOffset=null,s.backgroundGraphicZIndex=null,this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,t,s,null)},drawGeometryNode:function(e,t,i){i=i||e._style;var s,a={isFilled:void 0===i.fill?!0:i.fill,isStroked:void 0===i.stroke?!!i.strokeWidth:i.stroke};switch(t.CLASS_NAME){case"OpenLayers.Geometry.Point":i.graphic===!1&&(a.isFilled=!1,a.isStroked=!1),s=this.drawPoint(e,t);break;case"OpenLayers.Geometry.LineString":a.isFilled=!1,s=this.drawLineString(e,t);break;case"OpenLayers.Geometry.LinearRing":s=this.drawLinearRing(e,t);break;case"OpenLayers.Geometry.Polygon":s=this.drawPolygon(e,t);break;case"OpenLayers.Geometry.Surface":s=this.drawSurface(e,t);break;case"OpenLayers.Geometry.Rectangle":s=this.drawRectangle(e,t);break;default:}return e._options=a,0!=s?{node:this.setStyle(e,i,a,t),complete:s}:!1},postDraw:function(){},drawPoint:function(){},drawLineString:function(){},drawLinearRing:function(){},drawPolygon:function(){},drawRectangle:function(){},drawCircle:function(){},drawSurface:function(){},removeText:function(e){var t=document.getElementById(e+this.LABEL_ID_SUFFIX);t&&this.textRoot.removeChild(t)},getFeatureIdFromEvent:function(e){var t=e.target,i=t&&t.correspondingUseElement,s=i?i:t||e.srcElement,a=s._featureId;return a},eraseGeometry:function(e,t){if("OpenLayers.Geometry.MultiPoint"==e.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==e.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==e.CLASS_NAME||"OpenLayers.Geometry.Collection"==e.CLASS_NAME)for(var i=0,s=e.components.length;s>i;i++)this.eraseGeometry(e.components[i],t);else{var a=OpenLayers.Util.getElement(e.id);if(a&&a.parentNode&&(a.geometry&&(a.geometry.destroy(),a.geometry=null),a.parentNode.removeChild(a),this.indexer&&this.indexer.remove(a),a._style.backgroundGraphic)){var r=e.id+this.BACKGROUND_ID_SUFFIX,n=OpenLayers.Util.getElement(r);n&&n.parentNode&&n.parentNode.removeChild(n)}}},nodeFactory:function(e,t){var i=OpenLayers.Util.getElement(e);return i?this.nodeTypeCompare(i,t)||(i.parentNode.removeChild(i),i=this.nodeFactory(e,t)):i=this.createNode(t,e),i},nodeTypeCompare:function(){},createNode:function(){},moveRoot:function(e){var t=this.root;e.root.parentNode==this.rendererRoot&&(t=e.root),t.parentNode.removeChild(t),e.rendererRoot.appendChild(t)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(e){return"circle"!=e&&!!e},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(e){e=e||window.location.href;var t=OpenLayers.Util.getParameters(e),i=e.indexOf("#");return i>0&&(e="?"+e.substring(i+1,e.length),OpenLayers.Util.extend(t,OpenLayers.Util.getParameters(e))),t},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var e=0,t=this.map.controls.length;t>e;e++){var i=this.map.controls[e];if(i!=this&&"OpenLayers.Control.ArgParser"==i.CLASS_NAME){i.displayProjection!=this.displayProjection&&(this.displayProjection=i.displayProjection);break}}if(e==this.map.controls.length){var s=this.getParameters();s.layers&&(this.layers=s.layers,this.map.events.register("addlayer",this,this.configureLayers),this.configureLayers()),s.lat&&s.lon&&(this.center=new OpenLayers.LonLat(parseFloat(s.lon),parseFloat(s.lat)),s.zoom&&(this.zoom=parseInt(s.zoom)),this.map.events.register("changebaselayer",this,this.setCenter),this.setCenter())}},setCenter:function(){this.map.baseLayer&&(this.map.events.unregister("changebaselayer",this,this.setCenter),this.displayProjection&&this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var e=0,t=this.layers.length;t>e;e++){var i=this.map.layers[e],s=this.layers.charAt(e);"B"==s?this.map.setBaseLayer(i):("T"==s||"F"==s)&&i.setVisibility("T"==s)}}},CLASS_NAME:"OpenLayers.Control.ArgParser"}),OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,initialize:function(e,t,i){null===e||"object"!=typeof e||OpenLayers.Util.isElement(e)?(OpenLayers.Control.prototype.initialize.apply(this,[i]),this.element=OpenLayers.Util.getElement(e),this.base=t||document.location.href):(i=e,this.base=document.location.href,OpenLayers.Control.prototype.initialize.apply(this,[i]),null!=this.element&&(this.element=OpenLayers.Util.getElement(this.element)))},destroy:function(){this.element.parentNode==this.div&&this.div.removeChild(this.element),this.element=null,this.map.events.unregister("moveend",this,this.updateLink),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var e=0,t=this.map.controls.length;t>e;e++){var i=this.map.controls[e];if(i.CLASS_NAME==this.argParserClass.CLASS_NAME){i.displayProjection!=this.displayProjection&&(this.displayProjection=i.displayProjection);break}}e==this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||this.anchor||(this.element=document.createElement("a"),this.element.innerHTML=OpenLayers.i18n("Permalink"),this.element.href="",this.div.appendChild(this.element)),this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this}),this.updateLink(),this.div},updateLink:function(){var e=this.anchor?"#":"?",t=this.base;-1!=t.indexOf(e)&&(t=t.substring(0,t.indexOf(e))),t+=e+OpenLayers.Util.getParameterString(this.createParams()),this.anchor&&!this.element?window.location.href=t:this.element.href=t},createParams:function(e,t,i){e=e||this.map.getCenter();var s=OpenLayers.Util.getParameters(this.base);if(e){s.zoom=t||this.map.getZoom();var a=e.lat,r=e.lon;if(this.displayProjection){var n=OpenLayers.Projection.transform({x:r,y:a},this.map.getProjectionObject(),this.displayProjection);r=n.x,a=n.y}s.lat=Math.round(1e5*a)/1e5,s.lon=Math.round(1e5*r)/1e5,i=i||this.map.layers,s.layers="";for(var o=0,l=i.length;l>o;o++){var h=i[o];s.layers+=h.isBaseLayer?h==this.map.baseLayer?"B":"0":h.getVisibility()?"T":"F"}}return s},CLASS_NAME:"OpenLayers.Control.Permalink"}),OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(e,t,i){var s=[];s.push(e,t,{},i),OpenLayers.Layer.Grid.prototype.initialize.apply(this,s)},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){e=this.adjustBounds(e);var t=this.map.getResolution(),i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w)),s=Math.round((e.bottom-this.tileOrigin.lat)/(t*this.tileSize.h)),a=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,t):this.map.getZoom()+this.zoomOffset,r=this.serviceVersion+"/"+this.layername+"/"+a+"/"+i+"/"+s+"."+this.type,n=this.url;return OpenLayers.Util.isArray(n)&&(n=this.selectUrl(r,n)),n+r},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"}),OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){return OpenLayers.Strategy.prototype.activate.apply(this,arguments)?(this.layer.events.on({refresh:this.load,scope:this}),1==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this}),!0):!1},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this}),e},load:function(e){var t=this.layer;t.events.triggerEvent("loadstart"),t.protocol.read(OpenLayers.Util.applyDefaults({callback:OpenLayers.Function.bind(this.merge,this,t.map.getProjectionObject()),filter:t.filter},e)),t.events.un({visibilitychanged:this.load,scope:this})},merge:function(e,t){var i=this.layer;i.destroyFeatures();var s=t.features;if(s&&s.length>0){if(!e.equals(i.projection))for(var a,r=0,n=s.length;n>r;++r)a=s[r].geometry,a&&a.transform(i.projection,e);i.addFeatures(s)}i.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.Fixed"}),OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(){OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.markers=[]},destroy:function(){this.clearMarkers(),this.markers=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=0,i=this.markers.length;i>t;t++)this.markers[t].setOpacity(this.opacity)}},moveTo:function(e,t){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),t||!this.drawn){for(var i=0,s=this.markers.length;s>i;i++)this.drawMarker(this.markers[i]);this.drawn=!0}},addMarker:function(e){this.markers.push(e),null!=this.opacity&&e.setOpacity(this.opacity),this.map&&this.map.getExtent()&&(e.map=this.map,this.drawMarker(e))},removeMarker:function(e){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,e),e.erase())},clearMarkers:function(){if(null!=this.markers)for(;this.markers.length>0;)this.removeMarker(this.markers[0])},drawMarker:function(e){var t=this.map.getLayerPxFromLonLat(e.lonlat);if(null==t)e.display(!1);else if(e.isDrawn())e.icon&&e.icon.moveTo(t);else{var i=e.draw(t);this.div.appendChild(i)}},getDataExtent:function(){var e=null;if(this.markers&&this.markers.length>0)for(var e=new OpenLayers.Bounds,t=0,i=this.markers.length;i>t;t++){var s=this.markers[t];e.extend(s.lonlat)}return e},CLASS_NAME:"OpenLayers.Layer.Markers"}),OpenLayers.Control.MouseDefaults=OpenLayers.Class(OpenLayers.Control,{performedDrag:!1,wheelObserver:null,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.handler&&this.handler.destroy(),this.handler=null,this.map.events.un({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this}),OpenLayers.Event.stopObserving(window,"DOMMouseScroll",this.wheelObserver),OpenLayers.Event.stopObserving(window,"mousewheel",this.wheelObserver),OpenLayers.Event.stopObserving(document,"mousewheel",this.wheelObserver),this.wheelObserver=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){this.map.events.on({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this}),this.registerWheelEvents()},registerWheelEvents:function(){this.wheelObserver=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this),OpenLayers.Event.observe(window,"DOMMouseScroll",this.wheelObserver),OpenLayers.Event.observe(window,"mousewheel",this.wheelObserver),OpenLayers.Event.observe(document,"mousewheel",this.wheelObserver)},defaultClick:function(e){if(OpenLayers.Event.isLeftClick(e)){var t=!this.performedDrag;return this.performedDrag=!1,t}},defaultDblClick:function(e){var t=this.map.getLonLatFromViewPortPx(e.xy);return this.map.setCenter(t,this.map.zoom+1),OpenLayers.Event.stop(e),!1},defaultMouseDown:function(e){OpenLayers.Event.isLeftClick(e)&&(this.mouseDragStart=e.xy.clone(),this.performedDrag=!1,e.shiftKey&&(this.map.div.style.cursor="crosshair",this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red"),this.zoomBox.style.backgroundColor="white",this.zoomBox.style.filter="alpha(opacity=50)",this.zoomBox.style.opacity="0.50",this.zoomBox.style.fontSize="1px",this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.eventsDiv.appendChild(this.zoomBox)),document.onselectstart=OpenLayers.Function.False,OpenLayers.Event.stop(e))},defaultMouseMove:function(e){if(this.mousePosition=e.xy.clone(),null!=this.mouseDragStart){if(this.zoomBox){var t=Math.abs(this.mouseDragStart.x-e.xy.x),i=Math.abs(this.mouseDragStart.y-e.xy.y);this.zoomBox.style.width=Math.max(1,t)+"px",this.zoomBox.style.height=Math.max(1,i)+"px",e.xy.x<this.mouseDragStart.x&&(this.zoomBox.style.left=e.xy.x+"px"),e.xy.y<this.mouseDragStart.y&&(this.zoomBox.style.top=e.xy.y+"px")}else{var t=this.mouseDragStart.x-e.xy.x,i=this.mouseDragStart.y-e.xy.y,s=this.map.getSize(),a=new OpenLayers.Pixel(s.w/2+t,s.h/2+i),r=this.map.getLonLatFromViewPortPx(a);this.map.setCenter(r,null,!0),this.mouseDragStart=e.xy.clone(),this.map.div.style.cursor="move"}this.performedDrag=!0}},defaultMouseUp:function(e){OpenLayers.Event.isLeftClick(e)&&(this.zoomBox?this.zoomBoxEnd(e):this.performedDrag&&this.map.setCenter(this.map.center),document.onselectstart=null,this.mouseDragStart=null,this.map.div.style.cursor="")},defaultMouseOut:function(e){null!=this.mouseDragStart&&OpenLayers.Util.mouseLeft(e,this.map.eventsDiv)&&(this.zoomBox&&this.removeZoomBox(),this.mouseDragStart=null)},defaultWheelUp:function(e){this.map.getZoom()<=this.map.getNumZoomLevels()&&this.map.setCenter(this.map.getLonLatFromPixel(e.xy),this.map.getZoom()+1)},defaultWheelDown:function(e){this.map.getZoom()>0&&this.map.setCenter(this.map.getLonLatFromPixel(e.xy),this.map.getZoom()-1)},zoomBoxEnd:function(e){if(null!=this.mouseDragStart){if(Math.abs(this.mouseDragStart.x-e.xy.x)>5||Math.abs(this.mouseDragStart.y-e.xy.y)>5){var t=this.map.getLonLatFromViewPortPx(this.mouseDragStart),i=this.map.getLonLatFromViewPortPx(e.xy),s=Math.max(t.lat,i.lat),a=Math.min(t.lat,i.lat),r=Math.min(t.lon,i.lon),n=Math.max(t.lon,i.lon),o=new OpenLayers.Bounds(r,a,n,s);this.map.zoomToExtent(o)}else{var i=this.map.getLonLatFromViewPortPx(e.xy);this.map.setCenter(new OpenLayers.LonLat(i.lon,i.lat),this.map.getZoom()+1)}this.removeZoomBox()}},removeZoomBox:function(){this.map.eventsDiv.removeChild(this.zoomBox),this.zoomBox=null},onWheelEvent:function(e){for(var t=!1,i=OpenLayers.Event.element(e);null!=i;){if(this.map&&i==this.map.div){t=!0;break}i=i.parentNode}if(t){var s=0;e||(e=window.event),e.wheelDelta?(s=e.wheelDelta/120,window.opera&&9.2>window.opera.version()&&(s=-s)):e.detail&&(s=-e.detail/3),s&&(e.xy=this.mousePosition,0>s?this.defaultWheelDown(e):this.defaultWheelUp(e)),OpenLayers.Event.stop(e)}},CLASS_NAME:"OpenLayers.Control.MouseDefaults"}),OpenLayers.Control.MouseToolbar=OpenLayers.Class(OpenLayers.Control.MouseDefaults,{mode:null,buttons:null,direction:"vertical",buttonClicked:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.position=new OpenLayers.Pixel(OpenLayers.Control.MouseToolbar.X,OpenLayers.Control.MouseToolbar.Y),e&&(this.position=e),t&&(this.direction=t),this.measureDivs=[]},destroy:function(){for(var e in this.buttons){var t=this.buttons[e];t.map=null,t.events.destroy()}OpenLayers.Control.MouseDefaults.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments),OpenLayers.Control.MouseDefaults.prototype.draw.apply(this,arguments),this.buttons={};var e=new OpenLayers.Size(28,28),t=new OpenLayers.Pixel(OpenLayers.Control.MouseToolbar.X,0);return this._addButton("zoombox","drag-rectangle-off.png","drag-rectangle-on.png",t,e,"Shift->Drag to zoom to area"),t=t.add("vertical"==this.direction?0:e.w,"vertical"==this.direction?e.h:0),this._addButton("pan","panning-hand-off.png","panning-hand-on.png",t,e,"Drag the map to pan."),t=t.add("vertical"==this.direction?0:e.w,"vertical"==this.direction?e.h:0),this.switchModeTo("pan"),this.div},_addButton:function(e,t,i,s,a,r){var n=OpenLayers.Util.getImagesLocation()+t,o=OpenLayers.Util.getImagesLocation()+i,l=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MouseToolbar_"+e,s,a,n,"absolute");return this.div.appendChild(l),l.imgLocation=n,l.activeImgLocation=o,l.events=new OpenLayers.Events(this,l,null,!0),l.events.on({mousedown:this.buttonDown,mouseup:this.buttonUp,dblclick:OpenLayers.Event.stop,scope:this}),l.action=e,l.title=r,l.alt=r,l.map=this.map,this.buttons[e]=l,l},buttonDown:function(e){OpenLayers.Event.isLeftClick(e)&&(this.buttonClicked=e.element.action,OpenLayers.Event.stop(e))},buttonUp:function(e){OpenLayers.Event.isLeftClick(e)&&null!=this.buttonClicked&&(this.buttonClicked==e.element.action&&this.switchModeTo(e.element.action),OpenLayers.Event.stop(e),this.buttonClicked=null)},defaultDblClick:function(e){this.switchModeTo("pan"),this.performedDrag=!1;var t=this.map.getLonLatFromViewPortPx(e.xy);return this.map.setCenter(t,this.map.zoom+1),OpenLayers.Event.stop(e),!1},defaultMouseDown:function(e){if(OpenLayers.Event.isLeftClick(e)){switch(this.mouseDragStart=e.xy.clone(),this.performedDrag=!1,this.startViaKeyboard=!1,e.shiftKey&&"zoombox"!=this.mode?(this.switchModeTo("zoombox"),this.startViaKeyboard=!0):e.altKey&&"measure"!=this.mode?this.switchModeTo("measure"):this.mode||this.switchModeTo("pan"),this.mode){case"zoombox":this.map.div.style.cursor="crosshair",this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red"),this.zoomBox.style.backgroundColor="white",this.zoomBox.style.filter="alpha(opacity=50)",this.zoomBox.style.opacity="0.50",this.zoomBox.style.fontSize="1px",this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.eventsDiv.appendChild(this.zoomBox),this.performedDrag=!0;break;case"measure":var t="";if(this.measureStart){var i=this.map.getLonLatFromViewPortPx(this.mouseDragStart);t=OpenLayers.Util.distVincenty(this.measureStart,i),t=Math.round(100*t)/100,t+="km",this.measureStartBox=this.measureBox}this.measureStart=this.map.getLonLatFromViewPortPx(this.mouseDragStart),this.measureBox=OpenLayers.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),-2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute"),this.measureBox.style.width="4px",this.measureBox.style.height="4px",this.measureBox.style.fontSize="1px",this.measureBox.style.backgroundColor="red",this.measureBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.layerContainerDiv.appendChild(this.measureBox),t&&(this.measureBoxDistance=OpenLayers.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute"),this.measureBoxDistance.innerHTML=t,this.measureBoxDistance.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.layerContainerDiv.appendChild(this.measureBoxDistance),this.measureDivs.push(this.measureBoxDistance)),this.measureBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.layerContainerDiv.appendChild(this.measureBox),this.measureDivs.push(this.measureBox);break;default:this.map.div.style.cursor="move"}document.onselectstart=OpenLayers.Function.False,OpenLayers.Event.stop(e)}},switchModeTo:function(e){if(e!=this.mode){if(this.mode&&this.buttons[this.mode]&&OpenLayers.Util.modifyAlphaImageDiv(this.buttons[this.mode],null,null,null,this.buttons[this.mode].imgLocation),"measure"==this.mode&&"measure"!=e){for(var t=0,i=this.measureDivs.length;i>t;t++)this.measureDivs[t]&&this.map.layerContainerDiv.removeChild(this.measureDivs[t]);this.measureDivs=[],this.measureStart=null}switch(this.mode=e,this.buttons[e]&&OpenLayers.Util.modifyAlphaImageDiv(this.buttons[e],null,null,null,this.buttons[e].activeImgLocation),this.mode){case"zoombox":this.map.div.style.cursor="crosshair";break;default:this.map.div.style.cursor=""}}},leaveMode:function(){this.switchModeTo("pan")},defaultMouseMove:function(e){if(null!=this.mouseDragStart){switch(this.mode){case"zoombox":var t=Math.abs(this.mouseDragStart.x-e.xy.x),i=Math.abs(this.mouseDragStart.y-e.xy.y);this.zoomBox.style.width=Math.max(1,t)+"px",this.zoomBox.style.height=Math.max(1,i)+"px",e.xy.x<this.mouseDragStart.x&&(this.zoomBox.style.left=e.xy.x+"px"),e.xy.y<this.mouseDragStart.y&&(this.zoomBox.style.top=e.xy.y+"px");break;default:var t=this.mouseDragStart.x-e.xy.x,i=this.mouseDragStart.y-e.xy.y,s=this.map.getSize(),a=new OpenLayers.Pixel(s.w/2+t,s.h/2+i),r=this.map.getLonLatFromViewPortPx(a);this.map.setCenter(r,null,!0),this.mouseDragStart=e.xy.clone()}this.performedDrag=!0}},defaultMouseUp:function(e){if(OpenLayers.Event.isLeftClick(e)){switch(this.mode){case"zoombox":this.zoomBoxEnd(e),this.startViaKeyboard&&this.leaveMode();break;case"pan":this.performedDrag&&this.map.setCenter(this.map.center)}document.onselectstart=null,this.mouseDragStart=null,this.map.div.style.cursor="default"}},defaultMouseOut:function(e){null!=this.mouseDragStart&&OpenLayers.Util.mouseLeft(e,this.map.eventsDiv)&&(this.zoomBox&&(this.removeZoomBox(),this.startViaKeyboard&&this.leaveMode()),this.mouseDragStart=null,this.map.div.style.cursor="default")},defaultClick:function(){return this.performedDrag?(this.performedDrag=!1,!1):void 0},CLASS_NAME:"OpenLayers.Control.MouseToolbar"}),OpenLayers.Control.MouseToolbar.X=6,OpenLayers.Control.MouseToolbar.Y=300,OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,styleFrom:null,initialize:function(){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments)},addNodes:function(e,t){if(2>e.length)return OpenLayers.Console.error("At least two point features have to be added to createa line from"),void 0;for(var i,s,a,r=Array(e.length-1),n=0,o=e.length;o>n;n++){if(i=e[n],a=i.geometry){if("OpenLayers.Geometry.Point"!=a.CLASS_NAME)return OpenLayers.Console.error("Only features with point geometries are supported."),void 0}else{var l=i.lonlat;a=new OpenLayers.Geometry.Point(l.lon,l.lat)}if(n>0){var h=null!=this.dataFrom?e[n+this.dataFrom].data||e[n+this.dataFrom].attributes:null,u=null!=this.styleFrom?e[n+this.styleFrom].style:null,p=new OpenLayers.Geometry.LineString([s,a]);r[n-1]=new OpenLayers.Feature.Vector(p,h,u)}s=a}this.addFeatures(r,t)},CLASS_NAME:"OpenLayers.Layer.PointTrack"}),OpenLayers.Layer.PointTrack.SOURCE_NODE=-1,OpenLayers.Layer.PointTrack.TARGET_NODE=0,OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0},OpenLayers.Protocol.WFS=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Protocol.WFS.DEFAULTS);var t=OpenLayers.Protocol.WFS["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFS version: "+e.version;return new t(e)},OpenLayers.Protocol.WFS.fromWMSLayer=function(e,t){var i,s,a=e.params.LAYERS,r=(OpenLayers.Util.isArray(a)?a[0]:a).split(":");r.length>1&&(s=r[0]),i=r.pop();var n={url:e.url,featureType:i,featurePrefix:s,srsName:e.projection&&e.projection.getCode()||e.map&&e.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(t,n))},OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"},OpenLayers.Lang.oc=OpenLayers.Util.applyDefaults({unhandledRequest:"Requèsta pas gerida, retorna ${statusText}",Permalink:"Permaligam",Overlays:"Calques","Base Layer":"Calc de basa",readNotImplemented:"Lectura pas implementada.",writeNotImplemented:"Escritura pas implementada.",noFID:"Impossible de metre a jorn un objècte sens identificant (fid).",errorLoadingGML:"Error al cargament del fichièr GML ${url}",browserNotSupported:"Vòstre navegidor supòrta pas lo rendut vectorial. Los renderers actualament suportats son : \n${renderers}",componentShouldBe:"addFeatures : lo compausant deuriá èsser de tipe ${geomType}",getFeatureError:"getFeatureFromEvent es estat apelat sus un calc sens renderer. Aquò significa generalament qu'avètz destruch aqueste jaç, mas qu'avètz conservat un handler que li èra associat.",minZoomLevelError:"La proprietat minZoomLevel deu èsser utilizada solament per de jaces FixedZoomLevels-descendent. Lo fach qu'aqueste jaç WFS verifique la preséncia de minZoomLevel es una relica del passat. Çaquelà, la podèm suprimir sens copar d'aplicacions que ne poirián dependre. Es per aquò que la depreciam -- la verificacion del minZoomLevel serà suprimida en version 3.0. A la plaça, mercés d'utilizar los paramètres de resolucions min/max tal coma descrich sus : http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transaccion WFS : SUCCES ${response}",commitFailed:"Transaccion WFS : FRACAS ${response}",googleWarning:"Lo jaç Google es pas estat en mesura de se cargar corrèctament.<br><br>Per suprimir aqueste messatge, causissètz una BaseLayer novèla dins lo selector de jaç en naut a drecha.<br><br>Aquò es possiblament causat par la non-inclusion de la librariá Google Maps, o alara perque que la clau de l'API correspond pas a vòstre site.<br><br>Desvolopaires : per saber cossí corregir aquò, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>clicatz aicí</a>",getLayerWarning:"Lo jaç ${layerType} es pas en mesura de se cargar corrèctament.<br><br>Per suprimir aqueste messatge, causissètz una  BaseLayer novèla dins lo selector de jaç en naut a drecha.<br><br>Aquò es possiblament causat per la non-inclusion de la librariá ${layerLib}.<br><br>Desvolopaires : per saber cossí corregir aquí, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>clicatz aicí</a>","Scale = 1 : ${scaleDenom}":"Escala ~ 1 : ${scaleDenom}",W:"O",E:"È",N:"N",S:"S",layerAlreadyAdded:"Avètz ensajat d'apondre a la carta lo calc : ${layerName}, mas ja es present",reprojectDeprecated:"Utilizatz l'opcion 'reproject' sul jaç ${layerName}. Aquesta opcion es despreciada : Son usatge permetiá d'afichar de donadas al dessús de jaces raster comercials. Aquesta foncionalitat ara es suportada en utilizant lo supòrt de la projeccion Mercator Esferica. Mai d'informacion es disponibla sus http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Aqueste metòde es despreciada, e serà suprimida a la version 3.0. Mercés d'utilizar ${newMethod} a la plaça.",boundsAddError:"Vos cal passar las doas valors x e y a la foncion add.",lonlatAddError:"Vos cal passar las doas valors lon e lat a la foncion add.",pixelAddError:"Vos cal passar las doas valors x e y a la foncion add.",unsupportedGeometryType:"Tipe de geometria pas suportat : ${geomType}",filterEvaluateNotImplemented:"evaluar es pas encara estat implementat per aqueste tipe de filtre."}),OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,direction:null,type:OpenLayers.Control.TYPE_BUTTON,initialize:function(e,t){this.direction=e,this.CLASS_NAME+=this.direction,OpenLayers.Control.prototype.initialize.apply(this,[t])},trigger:function(){var e=OpenLayers.Function.bind(function(e){return this.slideRatio?this.map.getSize()[e]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-e("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,e("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-e("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(e("w"),0)}},CLASS_NAME:"OpenLayers.Control.Pan"}),OpenLayers.Control.Pan.NORTH="North",OpenLayers.Control.Pan.SOUTH="South",OpenLayers.Control.Pan.EAST="East",OpenLayers.Control.Pan.WEST="West",OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},reproject:!1,isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{"EPSG:4326":!0},initialize:function(e,t,i,s){var a=[];i=OpenLayers.Util.upperCaseObject(i),parseFloat(i.VERSION)>=1.3&&!i.EXCEPTIONS&&(i.EXCEPTIONS="INIMAGE"),a.push(e,t,i,s),OpenLayers.Layer.Grid.prototype.initialize.apply(this,a),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),!this.noMagic&&this.params.TRANSPARENT&&"true"==(""+this.params.TRANSPARENT).toLowerCase()&&(null!=s&&s.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},reverseAxisOrder:function(){return parseFloat(this.params.VERSION)>=1.3&&!!this.yx[this.map.getProjectionObject().getCode()]},getURL:function(e){e=this.adjustBounds(e);var t=this.getImageSize(),i={},s=this.reverseAxisOrder();i.BBOX=this.encodeBBOX?e.toBBOX(null,s):e.toArray(s),i.WIDTH=t.w,i.HEIGHT=t.h;var a=this.getFullRequestString(i);return a},mergeNewParams:function(e){var t=OpenLayers.Util.upperCaseObject(e),i=[t];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,i)},getFullRequestString:function(e){var t=this.map.getProjectionObject(),i=this.projection&&this.projection.equals(t)?this.projection.getCode():t.getCode(),s="none"==i?null:i;return parseFloat(this.params.VERSION)>=1.3?this.params.CRS=s:this.params.SRS=s,"boolean"==typeof this.params.TRANSPARENT&&(e.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"),OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"}),OpenLayers.Layer.WMS.Untiled=OpenLayers.Class(OpenLayers.Layer.WMS,{singleTile:!0,initialize:function(){OpenLayers.Layer.WMS.prototype.initialize.apply(this,arguments);var e="The OpenLayers.Layer.WMS.Untiled class is deprecated and will be removed in 3.0. Instead, you should use the normal OpenLayers.Layer.WMS class, passing it the option 'singleTile' as true.";
OpenLayers.Console.warn(e)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.WMS.Untiled(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.WMS.prototype.clone.apply(this,[e])},CLASS_NAME:"OpenLayers.Layer.WMS.Untiled"}),OpenLayers.Geometry.Surface=OpenLayers.Class(OpenLayers.Geometry,{initialize:function(){OpenLayers.Geometry.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Geometry.Surface"}),OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){var t=new OpenLayers.Format.ArcXML,i=t.read(e);return i.features.feature}}),OpenLayers.Lang.gsw=OpenLayers.Util.applyDefaults({unhandledRequest:"Nit behandleti Aafrogsruckmäldig ${statusText}",Permalink:"Permalink",Overlays:"Iberlagerige","Base Layer":"Grundcharte",readNotImplemented:"Läse nit implementiert.",writeNotImplemented:"Schrybe nit implementiert.",noFID:"E Feature, wu s kei FID derfir git, cha nit aktualisiert wäre.",errorLoadingGML:"Fähler bim Lade vu dr GML-Datei ${url}",browserNotSupported:"Dyy Browser unterstitzt kei Vektordarstellig. Aktuäll unterstitzti Renderer:\n${renderers}",componentShouldBe:"addFeatures : Komponänt sott dr Typ ${geomType} syy",getFeatureError:"getFeatureFromEvent isch uf eme Layer ohni Renderer ufgruefe wore. Des heisst normalerwys, ass Du e Layer kaputt gmacht hesch, aber nit dr Handler, wu derzue ghert.",minZoomLevelError:"D minZoomLevel-Eigeschaft isch nume dänk fir d Layer, wu vu dr FixedZoomLevels abstamme. Ass dää wfs-Layer minZoomLevel prieft, scih e Relikt us dr Vergangeheit. Mir chenne s aber nit ändere ohni OL_basierti Aawändige villicht kaputt gehn, wu dervu abhänge.  Us däm Grund het die Funktion d Eigeschaft 'deprecated' iberchuu. D minZoomLevel-Priefig unte wird in dr Version 3.0 usegnuu. Bitte verwänd statt däm e min/max-Uflesig wie s do bschriben isch: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS-Transaktion: ERFOLGRYCH ${response}",commitFailed:"WFS-Transaktion: FÄHLGSCHLAA ${response}",googleWarning:"Dr Google-Layer het nit korräkt chenne glade wäre.<br><br>Go die Mäldig nimi z kriege, wehl e andere Hintergrundlayer us em LayerSwitcher im rächte obere Ecke.<br><br>Dää Fähler git s seli hyfig, wel s Skript vu dr Google-Maps-Bibliothek nit yybunde woren isch oder wel s kei giltige API-Schlissel fir Dyy URL din het.<br><br>Entwickler: Fir Hilf zum korräkte Yybinde vum Google-Layer <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>doo drucke</a>",getLayerWarning:"Dr ${layerType}-Layer het nit korräkt chenne glade wäre.<br><br>Go die Mäldig nimi z kriege, wehl e andere Hintergrundlayer us em LayerSwitcher im rächte obere Ecke.<br><br>Dää Fähler git s seli hyfig, wel s Skript vu dr '${layerLib}'-Bibliothek nit yybunde woren isch oder wel s kei giltige API-Schlissel fir Dyy URL din het.<br><br>Entwickler: Fir Hilf zum korräkte Yybinde vu Layer <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>doo drucke</a>","Scale = 1 : ${scaleDenom}":"Maßstab = 1 : ${scaleDenom}",W:"W",E:"O",N:"N",S:"S",layerAlreadyAdded:"Du hesch versuecht dää Layer in d Charte yyzfiege: ${layerName}, aber är isch schoi yygfiegt",reprojectDeprecated:"Du bruchsch d 'reproject'-Option bim ${layerName}-Layer. Die Option isch nimi giltig: si isch aagleit wore go   Date iber kommerziälli Grundcharte lege, aber des sott mer jetz mache mit dr Unterstitzig vu Spherical Mercator. Meh Informatione git s uf http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Die Methode isch veraltet un wird us dr Version 3.0 usegnuu. Bitte verwäbnd statt däm ${newMethod}.",boundsAddError:"Du muesch e x-Wärt un e y-Wärt yygee bi dr Zuefieg-Funktion",lonlatAddError:"Du meusch e Lengi- un e Breiti-Grad yygee bi dr Zuefieg-Funktion.",pixelAddError:"Du muesch x- un y-Wärt aagee bi dr Zuefieg-Funktion.",unsupportedGeometryType:"Nit unterstitze Geometrii-Typ: ${geomType}",filterEvaluateNotImplemented:"evaluiere isch nit implemäntiert in däm Filtertyp."}),OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforesnap","snap","unsnap"],DEFAULTS:{tolerance:10,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(e){Array.prototype.push.apply(this.EVENT_TYPES,OpenLayers.Control.prototype.EVENT_TYPES),OpenLayers.Control.prototype.initialize.apply(this,[e]),this.options=e||{},this.options.layer&&this.setLayer(this.options.layer);var t=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(t,this.DEFAULTS),this.setTargets(this.options.targets),0===this.targets.length&&this.layer&&this.addTargetLayer(this.layer),this.geoToleranceCache={}},setLayer:function(e){this.active?(this.deactivate(),this.layer=e,this.activate()):this.layer=e},setTargets:function(e){if(this.targets=[],e&&e.length)for(var t,i=0,s=e.length;s>i;++i)t=e[i],t instanceof OpenLayers.Layer.Vector?this.addTargetLayer(t):this.addTarget(t)},addTargetLayer:function(e){this.addTarget({layer:e})},addTarget:function(e){e=OpenLayers.Util.applyDefaults(e,this.defaults),e.nodeTolerance=e.nodeTolerance||e.tolerance,e.vertexTolerance=e.vertexTolerance||e.tolerance,e.edgeTolerance=e.edgeTolerance||e.tolerance,this.targets.push(e)},removeTargetLayer:function(e){for(var t,i=this.targets.length-1;i>=0;--i)t=this.targets[i],t.layer===e&&this.removeTarget(t)},removeTarget:function(e){return OpenLayers.Util.removeItem(this.targets,e)},activate:function(){var e=OpenLayers.Control.prototype.activate.call(this);return e&&this.layer&&this.layer.events&&this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),e},deactivate:function(){var e=OpenLayers.Control.prototype.deactivate.call(this);return e&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),this.feature=null,this.point=null,e},onSketchModified:function(e){this.feature=e.feature,this.considerSnapping(e.vertex,e.vertex)},onVertexModified:function(e){this.feature=e.feature;var t=this.layer.map.getLonLatFromViewPortPx(e.pixel);this.considerSnapping(e.vertex,new OpenLayers.Geometry.Point(t.lon,t.lat))},considerSnapping:function(e,t){for(var i,s,a={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},r=!1,n=0,o=this.targets.length;o>n;++n)if(s=this.targets[n],i=this.testTarget(s,t)){if(this.greedy){a=i,a.target=s,r=!0;break}(i.rank<a.rank||i.rank===a.rank&&i.dist<a.dist)&&(a=i,a.target=s,r=!0)}if(r){var l=this.events.triggerEvent("beforesnap",{point:e,x:a.x,y:a.y,distance:a.dist,layer:a.target.layer,snapType:this.precedence[a.rank]});l!==!1?(e.x=a.x,e.y=a.y,this.point=e,this.events.triggerEvent("snap",{point:e,snapType:this.precedence[a.rank],layer:a.target.layer,distance:a.dist})):r=!1}this.point&&!r&&(e.x=t.x,e.y=t.y,this.point=null,this.events.triggerEvent("unsnap",{point:e}))},testTarget:function(e,t){var i=this.layer.map.getResolution();if("minResolution"in e&&e.minResolution>i)return null;if("maxResolution"in e&&i>=e.maxResolution)return null;for(var s,a,r,n,o,l,h,u={node:this.getGeoTolerance(e.nodeTolerance,i),vertex:this.getGeoTolerance(e.vertexTolerance,i),edge:this.getGeoTolerance(e.edgeTolerance,i)},p=Math.max(u.node,u.vertex,u.edge),c={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},d=!1,m=e.layer.features,y=this.precedence.length,f=new OpenLayers.LonLat(t.x,t.y),g=0,v=m.length;v>g;++g)if(s=m[g],s!==this.feature&&!s._sketch&&s.state!==OpenLayers.State.DELETE&&(!e.filter||e.filter.evaluate(s.attributes))&&s.atPoint(f,p,p))for(var L=0,b=Math.min(c.rank+1,y);b>L;++L)if(a=this.precedence[L],e[a])if("edge"===a){if(o=s.geometry.distanceTo(t,{details:!0}),l=o.distance,u[a]>=l&&c.dist>l){c={rank:L,dist:l,x:o.x0,y:o.y0},d=!0;break}}else{r=s.geometry.getVertices("node"===a),h=!1;for(var O=0,S=r.length;S>O;++O)n=r[O],l=n.distanceTo(t),u[a]>=l&&(c.rank>L||L===c.rank&&c.dist>l)&&(c={rank:L,dist:l,x:n.x,y:n.y},d=!0,h=!0);if(h)break}return d?c:null},getGeoTolerance:function(e,t){t!==this.resolution&&(this.resolution=t,this.geoToleranceCache={});var i=this.geoToleranceCache[e];return void 0===i&&(i=e*t,this.geoToleranceCache[e]=i),i},destroy:function(){this.active&&this.deactivate(),delete this.layer,delete this.targets,OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"}),OpenLayers.Format.CSWGetDomain=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.CSWGetDomain.DEFAULTS);var t=OpenLayers.Format.CSWGetDomain["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported CSWGetDomain version: "+e.version;return new t(e)},OpenLayers.Format.CSWGetDomain.DEFAULTS={version:"2.0.2"},OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{csw:{GetDomainResponse:function(e,t){this.readChildNodes(e,t)},DomainValues:function(e,t){OpenLayers.Util.isArray(t.DomainValues)||(t.DomainValues=[]);for(var i=e.attributes,s={},a=0,r=i.length;r>a;++a)s[i[a].name]=i[a].nodeValue;this.readChildNodes(e,s),t.DomainValues.push(s)},PropertyName:function(e,t){t.PropertyName=this.getChildValue(e)},ParameterName:function(e,t){t.ParameterName=this.getChildValue(e)},ListOfValues:function(e,t){OpenLayers.Util.isArray(t.ListOfValues)||(t.ListOfValues=[]),this.readChildNodes(e,t.ListOfValues)},Value:function(e,t){for(var i=e.attributes,s={},a=0,r=i.length;r>a;++a)s[i[a].name]=i[a].nodeValue;s.value=this.getChildValue(e),t.push({Value:s})},ConceptualScheme:function(e,t){t.ConceptualScheme={},this.readChildNodes(e,t.ConceptualScheme)},Name:function(e,t){t.Name=this.getChildValue(e)},Document:function(e,t){t.Document=this.getChildValue(e)},Authority:function(e,t){t.Authority=this.getChildValue(e)},RangeOfValues:function(e,t){t.RangeOfValues={},this.readChildNodes(e,t.RangeOfValues)},MinValue:function(e,t){for(var i=e.attributes,s={},a=0,r=i.length;r>a;++a)s[i[a].name]=i[a].nodeValue;s.value=this.getChildValue(e),t.MinValue=s},MaxValue:function(e,t){for(var i=e.attributes,s={},a=0,r=i.length;r>a;++a)s[i[a].name]=i[a].nodeValue;s.value=this.getChildValue(e),t.MaxValue=s}}},write:function(e){var t=this.writeNode("csw:GetDomain",e);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},writers:{csw:{GetDomain:function(e){var t=this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});return e.PropertyName||this.PropertyName?this.writeNode("csw:PropertyName",e.PropertyName||this.PropertyName,t):(e.ParameterName||this.ParameterName)&&this.writeNode("csw:ParameterName",e.ParameterName||this.ParameterName,t),this.readChildNodes(t,e),t},PropertyName:function(e){var t=this.createElementNSPlus("csw:PropertyName",{value:e});return t},ParameterName:function(e){var t=this.createElementNSPlus("csw:ParameterName",{value:e});return t}}},CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"}),OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("xml:lang"),exceptions:[]},this.readChildNodes(e,t.exceptionReport)},AllowedValues:function(e,t){t.allowedValues={},this.readChildNodes(e,t.allowedValues)},AnyValue:function(e,t){t.anyValue=!0},DataType:function(e,t){t.dataType=this.getChildValue(e)},Range:function(e,t){t.range={},this.readChildNodes(e,t.range)},MinimumValue:function(e,t){t.minValue=this.getChildValue(e)},MaximumValue:function(e,t){t.maxValue=this.getChildValue(e)},Identifier:function(e,t){t.identifier=this.getChildValue(e)},SupportedCRS:function(e,t){t.supportedCRS=this.getChildValue(e)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(e){var t=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":e.closure}});return this.writeNode("ows:MinimumValue",e.minValue,t),this.writeNode("ows:MaximumValue",e.maxValue,t),t},MinimumValue:function(e){var t=this.createElementNSPlus("ows:MinimumValue",{value:e});return t},MaximumValue:function(e){var t=this.createElementNSPlus("ows:MaximumValue",{value:e});return t},Value:function(e){var t=this.createElementNSPlus("ows:Value",{value:e});return t}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"}),OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(e){var t=this.writeNode("wcs:GetCoverage",e);return this.setAttributeNS(t,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[t])},writers:{wcs:{GetCoverage:function(e){var t=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:e.version||this.VERSION,service:"WCS"}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("wcs:DomainSubset",e.domainSubset,t),this.writeNode("wcs:Output",e.output,t),t},DomainSubset:function(e){var t=this.createElementNSPlus("wcs:DomainSubset",{});return this.writeNode("ows:BoundingBox",e.boundingBox,t),e.temporalSubset&&this.writeNode("wcs:TemporalSubset",e.temporalSubset,t),t},TemporalSubset:function(e){for(var t=this.createElementNSPlus("wcs:TemporalSubset",{}),i=0,s=e.timePeriods.length;s>i;++i)this.writeNode("wcs:TimePeriod",e.timePeriods[i],t);return t},TimePeriod:function(e){var t=this.createElementNSPlus("wcs:TimePeriod",{});return this.writeNode("wcs:BeginPosition",e.begin,t),this.writeNode("wcs:EndPosition",e.end,t),e.resolution&&this.writeNode("wcs:TimeResolution",e.resolution,t),t},BeginPosition:function(e){var t=this.createElementNSPlus("wcs:BeginPosition",{value:e});return t},EndPosition:function(e){var t=this.createElementNSPlus("wcs:EndPosition",{value:e});return t},TimeResolution:function(e){var t=this.createElementNSPlus("wcs:TimeResolution",{value:e});return t},Output:function(e){var t=this.createElementNSPlus("wcs:Output",{attributes:{format:e.format,store:e.store}});return e.gridCRS&&this.writeNode("wcs:GridCRS",e.gridCRS,t),t},GridCRS:function(e){var t=this.createElementNSPlus("wcs:GridCRS",{});return this.writeNode("wcs:GridBaseCRS",e.baseCRS,t),e.type&&this.writeNode("wcs:GridType",e.type,t),e.origin&&this.writeNode("wcs:GridOrigin",e.origin,t),this.writeNode("wcs:GridOffsets",e.offsets,t),e.CS&&this.writeNode("wcs:GridCS",e.CS,t),t},GridBaseCRS:function(e){return this.createElementNSPlus("wcs:GridBaseCRS",{value:e})},GridOrigin:function(e){return this.createElementNSPlus("wcs:GridOrigin",{value:e})},GridType:function(e){return this.createElementNSPlus("wcs:GridType",{value:e})},GridOffsets:function(e){return this.createElementNSPlus("wcs:GridOffsets",{value:e})},GridCS:function(e){return this.createElementNSPlus("wcs:GridCS",{value:e})}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"}),OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"}),OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=e;e&&9==e.nodeType&&(e=e.documentElement);var i={};if(this.readNode(e,i),void 0===i.service){var s=new OpenLayers.Format.OGCExceptionReport;i.error=s.read(t)}else this.postProcessLayers(i);return i},postProcessLayers:function(e){if(e.capability){e.capability.layers=[];for(var t=e.capability.nestedLayers,i=0,s=t.length;s>i;++i){var a=t[i];this.processLayer(e.capability,a)}}},processLayer:function(e,t,i){void 0===t.formats&&(t.formats=e.request.getmap.formats);var s,a;if(i){t.styles=t.styles.concat(i.styles);var r,n=["queryable","cascaded","fixedWidth","fixedHeight","opaque","noSubsets","llbbox","minScale","maxScale","attribution"],o=["srs","bbox","dimensions","authorityURLs"];for(s=0,a=n.length;a>s;s++)if(r=n[s],r in i&&(null==t[r]&&(t[r]=i[r]),null==t[r])){var l=["cascaded","fixedWidth","fixedHeight"],h=["queryable","opaque","noSubsets"];-1!=OpenLayers.Util.indexOf(l,r)&&(t[r]=0),-1!=OpenLayers.Util.indexOf(h,r)&&(t[r]=!1)}for(s=0,a=o.length;a>s;s++)r=o[s],t[r]=OpenLayers.Util.applyDefaults(t[r],i[r])}for(s=0,a=t.nestedLayers.length;a>s;s++){var u=t.nestedLayers[s];this.processLayer(e,u,t)}t.name&&e.layers.push(t)},readers:{wms:{Service:function(e,t){t.service={},this.readChildNodes(e,t.service)},Name:function(e,t){t.name=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},BoundingBox:function(e){var t={};t.bbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))];var i={x:parseFloat(e.getAttribute("resx")),y:parseFloat(e.getAttribute("resy"))};return isNaN(i.x)&&isNaN(i.y)||(t.res=i),t},OnlineResource:function(e,t){t.href=this.getAttributeNS(e,this.namespaces.xlink,"href")},ContactInformation:function(e,t){t.contactInformation={},this.readChildNodes(e,t.contactInformation)},ContactPersonPrimary:function(e,t){t.personPrimary={},this.readChildNodes(e,t.personPrimary)},ContactPerson:function(e,t){t.person=this.getChildValue(e)},ContactOrganization:function(e,t){t.organization=this.getChildValue(e)},ContactPosition:function(e,t){t.position=this.getChildValue(e)},ContactAddress:function(e,t){t.contactAddress={},this.readChildNodes(e,t.contactAddress)},AddressType:function(e,t){t.type=this.getChildValue(e)},Address:function(e,t){t.address=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},StateOrProvince:function(e,t){t.stateOrProvince=this.getChildValue(e)},PostCode:function(e,t){t.postcode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ContactVoiceTelephone:function(e,t){t.phone=this.getChildValue(e)},ContactFacsimileTelephone:function(e,t){t.fax=this.getChildValue(e)},ContactElectronicMailAddress:function(e,t){t.email=this.getChildValue(e)},Fees:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.fees=i)},AccessConstraints:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.accessConstraints=i)},Capability:function(e,t){t.capability={nestedLayers:[]},this.readChildNodes(e,t.capability)},Request:function(e,t){t.request={},this.readChildNodes(e,t.request)},GetCapabilities:function(e,t){t.getcapabilities={formats:[]},this.readChildNodes(e,t.getcapabilities)},Format:function(e,t){OpenLayers.Util.isArray(t.formats)?t.formats.push(this.getChildValue(e)):t.format=this.getChildValue(e)},DCPType:function(e,t){this.readChildNodes(e,t)},HTTP:function(e,t){this.readChildNodes(e,t)},Get:function(e,t){t.get={},this.readChildNodes(e,t.get),t.href||(t.href=t.get.href)},Post:function(e,t){t.post={},this.readChildNodes(e,t.post),t.href||(t.href=t.get.href)},GetMap:function(e,t){t.getmap={formats:[]},this.readChildNodes(e,t.getmap)},GetFeatureInfo:function(e,t){t.getfeatureinfo={formats:[]},this.readChildNodes(e,t.getfeatureinfo)},Exception:function(e,t){t.exception={formats:[]},this.readChildNodes(e,t.exception)},Layer:function(e,t){var i=e.getAttributeNode("queryable"),s=i&&i.specified?e.getAttribute("queryable"):null;i=e.getAttributeNode("cascaded");var a=i&&i.specified?e.getAttribute("cascaded"):null;i=e.getAttributeNode("opaque");var r=i&&i.specified?e.getAttribute("opaque"):null,n=e.getAttribute("noSubsets"),o=e.getAttribute("fixedWidth"),l=e.getAttribute("fixedHeight"),h={nestedLayers:[],styles:[],srs:{},metadataURLs:[],bbox:{},dimensions:{},authorityURLs:{},identifiers:{},keywords:[],queryable:s&&""!==s?"1"===s||"true"===s:null,cascaded:null!==a?parseInt(a):null,opaque:r?"1"===r||"true"===r:null,noSubsets:null!==n?"1"===n||"true"===n:null,fixedWidth:null!=o?parseInt(o):null,fixedHeight:null!=l?parseInt(l):null};if(t.nestedLayers.push(h),this.readChildNodes(e,h),h.name){var u=h.name.split(":");u.length>0&&(h.prefix=u[0])}},Attribution:function(e,t){t.attribution={},this.readChildNodes(e,t.attribution)},LogoURL:function(e,t){t.logo={width:e.getAttribute("width"),height:e.getAttribute("height")},this.readChildNodes(e,t.logo)},Style:function(e,t){var i={};t.styles.push(i),this.readChildNodes(e,i)},LegendURL:function(e,t){var i={width:e.getAttribute("width"),height:e.getAttribute("height")};t.legend=i,this.readChildNodes(e,i)},MetadataURL:function(e,t){var i={type:e.getAttribute("type")};t.metadataURLs.push(i),this.readChildNodes(e,i)},DataURL:function(e,t){t.dataURL={},this.readChildNodes(e,t.dataURL)},FeatureListURL:function(e,t){t.featureListURL={},this.readChildNodes(e,t.featureListURL)},AuthorityURL:function(e,t){var i=e.getAttribute("name"),s={};this.readChildNodes(e,s),t.authorityURLs[i]=s.href},Identifier:function(e,t){var i=e.getAttribute("authority");t.identifiers[i]=this.getChildValue(e)},KeywordList:function(e,t){this.readChildNodes(e,t)},SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"}),OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(e,t){this.readChildNodes(e,t)},Keyword:function(e,t){t.keywords&&t.keywords.push(this.getChildValue(e))},DescribeLayer:function(e,t){t.describelayer={formats:[]},this.readChildNodes(e,t.describelayer)},GetLegendGraphic:function(e,t){t.getlegendgraphic={formats:[]},this.readChildNodes(e,t.getlegendgraphic)},GetStyles:function(e,t){t.getstyles={formats:[]},this.readChildNodes(e,t.getstyles)},PutStyles:function(e,t){t.putstyles={formats:[]},this.readChildNodes(e,t.putstyles)},UserDefinedSymbolization:function(e,t){var i={supportSLD:1==parseInt(e.getAttribute("SupportSLD")),userLayer:1==parseInt(e.getAttribute("UserLayer")),userStyle:1==parseInt(e.getAttribute("UserStyle")),remoteWFS:1==parseInt(e.getAttribute("RemoteWFS"))};t.userSymbols=i},LatLonBoundingBox:function(e,t){t.llbbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))]},BoundingBox:function(e,t){var i=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);i.srs=e.getAttribute("SRS"),t.bbox[i.srs]=i},ScaleHint:function(e,t){var i=e.getAttribute("min"),s=e.getAttribute("max"),a=Math.pow(2,.5),r=OpenLayers.INCHES_PER_UNIT.m;t.maxScale=parseFloat((i/a*r*OpenLayers.DOTS_PER_INCH).toPrecision(13)),t.minScale=parseFloat((s/a*r*OpenLayers.DOTS_PER_INCH).toPrecision(13))},Dimension:function(e,t){var i=e.getAttribute("name").toLowerCase(),s={name:i,units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol")};t.dimensions[s.name]=s},Extent:function(e,t){var i=e.getAttribute("name").toLowerCase();if(i in t.dimensions){var s=t.dimensions[i];s.nearestVal="1"===e.getAttribute("nearestValue"),s.multipleVal="1"===e.getAttribute("multipleValues"),s.current="1"===e.getAttribute("current"),s["default"]=e.getAttribute("default")||"";var a=this.getChildValue(e);s.values=a.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"}),OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",initialize:function(e){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[e])},readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,t){for(var i=this.getChildValue(e),s=i.split(/ +/),a=0,r=s.length;r>a;a++)t.srs[s[a]]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"}),OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e]),e.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))),!e.geometryName&&parseFloat(this.format.version)>1&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=OpenLayers.Util.extend({},e),OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"}),i=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",e)]);return t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:i}),t},setFeatureType:function(e){this.featureType=e,this.format.featureType=e},setGeometryName:function(e){this.geometryName=e,this.format.geometryName=e},handleRead:function(e,t){if(t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options),t.callback){var i=e.priv;if(i.status>=200&&300>i.status){var s=this.parseResponse(i,t.readOptions);s&&s.success!==!1?(t.readOptions&&"object"==t.readOptions.output?OpenLayers.Util.extend(e,s):e.features=s,e.code=OpenLayers.Protocol.Response.SUCCESS):(e.code=OpenLayers.Protocol.Response.FAILURE,e.error=s)}else e.code=OpenLayers.Protocol.Response.FAILURE;t.callback.call(t.scope,e)}},parseResponse:function(e,t){var i=e.responseXML;if(i&&i.documentElement||(i=e.responseText),!i||0>=i.length)return null;var s=null!==this.readFormat?this.readFormat.read(i):this.format.read(i,t);if(!this.featureNS){var a=this.readFormat||this.format;this.featureNS=a.featureNS,a.autoConfig=!1,this.geometryName||this.setGeometryName(a.geometryName)}return s},commit:function(e,t){t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options);var i=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:e});return i.priv=OpenLayers.Request.POST({url:t.url,headers:t.headers,data:this.format.write(e,t),callback:this.createCallback(this.handleCommit,i,t)}),i},handleCommit:function(e,t){if(t.callback){var i=e.priv,s=i.responseXML;s&&s.documentElement||(s=i.responseText);var a=this.format.read(s)||{};e.insertIds=a.insertIds||[],a.success?e.code=OpenLayers.Protocol.Response.SUCCESS:(e.code=OpenLayers.Protocol.Response.FAILURE,e.error=a),t.callback.call(t.scope,e)}},filterDelete:function(e,t){t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options),new OpenLayers.Protocol.Response({requestType:"commit"});var i=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}}),s=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(t.featureNS?this.featurePrefix+":":"")+t.featureType}});t.featureNS&&s.setAttribute("xmlns:"+this.featurePrefix,t.featureNS);var a=this.format.writeNode("ogc:Filter",e);s.appendChild(a),i.appendChild(s);var r=OpenLayers.Format.XML.prototype.write.apply(this.format,[i]);return OpenLayers.Request.POST({url:this.url,callback:t.callback||function(){},data:r})},abort:function(e){e&&e.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"}),OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,touch:!1,lastTouchPx:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var e=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e),this.map.addLayer(this.layer),!0},createFeature:function(e){var t=this.map.getLonLatFromPixel(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,this.touch=!1,!0):!1},destroyFeature:function(e){!this.layer||!e&&this.persist||this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>1&&this.layer.features[0].destroy()},finalize:function(e){var t=e?"cancel":"done";this.mouseDown=!1,this.lastDown=null,this.lastUp=null,this.lastTouchPx=null,this.callback(t,[this.geometryClone()]),this.destroyFeature(e)},cancel:function(){this.finalize(!0)},click:function(e){return OpenLayers.Event.stop(e),!1},dblclick:function(e){return OpenLayers.Event.stop(e),!1},modifyFeature:function(e){this.point||this.createFeature(e);var t=this.map.getLonLatFromPixel(e);this.point.geometry.x=t.lon,this.point.geometry.y=t.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var e=this.point&&this.point.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPoint([e])),e},geometryClone:function(){var e=this.getGeometry();return e&&e.clone()},mousedown:function(e){return this.down(e)},touchstart:function(e){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e)},mousemove:function(e){return this.move(e)},touchmove:function(e){return this.lastTouchPx=e.xy,this.move(e)},mouseup:function(e){return this.up(e)},touchend:function(e){return e.xy=this.lastTouchPx,this.up(e)},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(e){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy),!0
},up:function(e){return this.mouseDown=!1,this.stoppedDown=this.stopDown,this.checkModifiers(e)?this.lastUp&&this.lastUp.equals(e.xy)?!0:this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)?(this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.finalize(),!this.stopUp):!0:!0},mouseout:function(e){OpenLayers.Util.mouseLeft(e,this.map.eventsDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(e,t,i){var s=!0;if(null!=i&&e&&t){var a=e.distanceTo(t);a>i&&(s=!1)}return s},CLASS_NAME:"OpenLayers.Handler.Point"}),OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,initialize:function(){OpenLayers.Handler.Point.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.map.getLonLatFromPixel(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(e){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,e),this.line=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(e){this.layer.removeFeatures([this.point]);var t=this.control.map.getLonLatFromPixel(e);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat)),this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length),this.layer.addFeatures([this.point]),this.callback("point",[this.point.geometry,this.getGeometry()]),this.callback("modify",[this.point.geometry,this.getSketch()]),this.drawFeature(),delete this.redoStack},insertXY:function(e,t){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(e,t),this.getCurrentPointIndex()),this.drawFeature(),delete this.redoStack},insertDeltaXY:function(e,t){var i=this.getCurrentPointIndex()-1,s=this.line.geometry.components[i];!s||isNaN(s.x)||isNaN(s.y)||this.insertXY(s.x+e,s.y+t)},insertDirectionLength:function(e,t){e*=Math.PI/180;var i=t*Math.cos(e),s=t*Math.sin(e);this.insertDeltaXY(i,s)},insertDeflectionLength:function(e,t){var i=this.getCurrentPointIndex()-1;if(i>0){var s=this.line.geometry.components[i],a=this.line.geometry.components[i-1],r=Math.atan2(s.y-a.y,s.x-a.x);this.insertDirectionLength(180*r/Math.PI+e,t)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var e=this.line.geometry,t=e.components,i=this.getCurrentPointIndex()-1,s=t[i],a=e.removeComponent(s);return a&&(this.redoStack||(this.redoStack=[]),this.redoStack.push(s),this.drawFeature()),a},redo:function(){var e=this.redoStack&&this.redoStack.pop();return e&&(this.line.geometry.addComponent(e,this.getCurrentPointIndex()),this.drawFeature()),!!e},freehandMode:function(e){return this.freehandToggle&&e[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(e,t){this.line||this.createFeature(e);var i=this.control.map.getLonLatFromPixel(e);this.point.geometry.x=i.lon,this.point.geometry.y=i.lat,this.callback("modify",[this.point.geometry,this.getSketch(),t]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var e=this.line&&this.line.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiLineString([e])),e},touchstart:function(e){return this.timerId&&this.passesTolerance(this.lastTouchPx,e.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,e))},down:function(e){var t=this.stopDown;return this.freehandMode(e)&&(t=!0),this.touch||this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)||this.modifyFeature(e.xy,!!this.lastUp),this.mouseDown=!0,this.lastDown=e.xy,this.stoppedDown=t,!t},move:function(e){return this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.addPoint(e.xy),!1):(this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy,!!this.lastUp),!0)},up:function(e){return!this.mouseDown||this.lastUp&&this.lastUp.equals(e.xy)||(this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(e.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(e.xy),this.lastUp=e.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp},finishGeometry:function(){var e=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[e]),this.removePoint(),this.finalize()},dblclick:function(e){return this.freehandMode(e)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"}),OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(e,t){OpenLayers.Format.GML.prototype.initialize.apply(this,[e]),this.layer=t,this.layer.featureNS&&(this.featureNS=this.layer.featureNS),this.layer.options.geometry_column&&(this.geometryName=this.layer.options.geometry_column),this.layer.options.typename&&(this.featureName=this.layer.options.typename)},write:function(e){var t=this.createElementNS(this.wfsns,"wfs:Transaction");t.setAttribute("version","1.0.0"),t.setAttribute("service","WFS");for(var i=0;e.length>i;i++)switch(e[i].state){case OpenLayers.State.INSERT:t.appendChild(this.insert(e[i]));break;case OpenLayers.State.UPDATE:t.appendChild(this.update(e[i]));break;case OpenLayers.State.DELETE:t.appendChild(this.remove(e[i]))}return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=this.buildGeometryNode(e.geometry),i=this.createElementNS(this.featureNS,"feature:"+this.geometryName);i.appendChild(t);var s=this.createElementNS(this.featureNS,"feature:"+this.featureName);s.appendChild(i);for(var a in e.attributes){var r=this.createTextNode(e.attributes[a]),n=a;-1!=a.search(":")&&(n=a.split(":")[1]);var o=this.createElementNS(this.featureNS,"feature:"+n);o.appendChild(r),s.appendChild(o)}return s},insert:function(e){var t=this.createElementNS(this.wfsns,"wfs:Insert");return t.appendChild(this.createFeatureXML(e)),t},update:function(e){e.fid||OpenLayers.Console.userError(OpenLayers.i18n("noFID"));var t=this.createElementNS(this.wfsns,"wfs:Update");t.setAttribute("typeName",this.featurePrefix+":"+this.featureName),t.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var i=this.createElementNS(this.wfsns,"wfs:Property"),s=this.createElementNS(this.wfsns,"wfs:Name"),a=this.createTextNode(this.geometryName);s.appendChild(a),i.appendChild(s);var r=this.createElementNS(this.wfsns,"wfs:Value"),n=this.buildGeometryNode(e.geometry);e.layer&&n.setAttribute("srsName",e.layer.projection.getCode()),r.appendChild(n),i.appendChild(r),t.appendChild(i);for(var o in e.attributes)i=this.createElementNS(this.wfsns,"wfs:Property"),s=this.createElementNS(this.wfsns,"wfs:Name"),s.appendChild(this.createTextNode(o)),i.appendChild(s),r=this.createElementNS(this.wfsns,"wfs:Value"),r.appendChild(this.createTextNode(e.attributes[o])),i.appendChild(r),t.appendChild(i);var l=this.createElementNS(this.ogcns,"ogc:Filter"),h=this.createElementNS(this.ogcns,"ogc:FeatureId");return h.setAttribute("fid",e.fid),l.appendChild(h),t.appendChild(l),t},remove:function(e){if(!e.fid)return OpenLayers.Console.userError(OpenLayers.i18n("noFID")),!1;var t=this.createElementNS(this.wfsns,"wfs:Delete");t.setAttribute("typeName",this.featurePrefix+":"+this.featureName),t.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var i=this.createElementNS(this.ogcns,"ogc:Filter"),s=this.createElementNS(this.ogcns,"ogc:FeatureId");return s.setAttribute("fid",e.fid),i.appendChild(s),t.appendChild(i),t},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"}),OpenLayers.Layer.GML=OpenLayers.Class(OpenLayers.Layer.Vector,{loaded:!1,format:null,formatOptions:null,initialize:function(e,t,i){var s=[];s.push(e,i),OpenLayers.Layer.Vector.prototype.initialize.apply(this,s),this.url=t},setVisibility:function(){OpenLayers.Layer.Vector.prototype.setVisibility.apply(this,arguments),this.visibility&&!this.loaded&&this.loadGML()},moveTo:function(){OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadGML()},loadGML:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.url,success:this.requestSuccess,failure:this.requestFailure,scope:this}),this.loaded=!0)},setUrl:function(e){this.url=e,this.destroyFeatures(),this.loaded=!1,this.loadGML()},requestSuccess:function(e){var t=e.responseXML;t&&t.documentElement||(t=e.responseText);var i={};OpenLayers.Util.extend(i,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(i.externalProjection=this.projection,i.internalProjection=this.map.getProjectionObject());var s=this.format?new this.format(i):new OpenLayers.Format.GML(i);this.addFeatures(s.read(t)),this.events.triggerEvent("loadend")},requestFailure:function(){OpenLayers.Console.userError(OpenLayers.i18n("errorLoadingGML",{url:this.url})),this.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Layer.GML"}),OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]);var e={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,e),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,e),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,e),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,e)])},CLASS_NAME:"OpenLayers.Control.PanPanel"}),OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this}),this.updateAttribution(),this.div},updateAttribution:function(){var e=[];if(this.map&&this.map.layers){for(var t=0,i=this.map.layers.length;i>t;t++){var s=this.map.layers[t];s.attribution&&s.getVisibility()&&-1===OpenLayers.Util.indexOf(e,s.attribution)&&e.push(s.attribution)}this.div.innerHTML=e.join(this.separator)}},CLASS_NAME:"OpenLayers.Control.Attribution"}),OpenLayers.Renderer.NG=OpenLayers.Class(OpenLayers.Renderer.Elements,{labelNodeType:null,updateDimensions:function(){var e=this.map.getExtent(),t=e.scale(3);this.setExtent(t,!0);var i=this.getResolution(),s=this.rendererRoot.parentNode,a=parseFloat(s.parentNode.style.left),r=parseFloat(s.parentNode.style.top);s.style.left=(t.left-e.left)/i-a+"px",s.style.top=(e.top-t.top)/i-r+"px"},setSize:function(){this.map.getExtent()&&this.updateDimensions()},drawFeature:function(e,t){if(null==t&&(t=e.style),e.geometry){var i=this.drawGeometry(e.geometry,t,e.id);if(i!==!1&&t.label){var s=e.geometry.getCentroid();this.drawText(e.id,t,s)}else this.removeText(e.id);return i}},drawText:function(e,t,i){var s;if("string"!=typeof e?s=e:(s=this.nodeFactory(e+this.LABEL_ID_SUFFIX,this.labelNodeType),s._featureId=e),s._style=t,s._x=i.x,s._y=i.y,t.labelXOffset||t.labelYOffset){var a=isNaN(t.labelXOffset)?0:t.labelXOffset,r=isNaN(t.labelYOffset)?0:t.labelYOffset,n=this.getResolution();i.move(a*n,r*n)}return s.parentNode!==this.textRoot&&this.textRoot.appendChild(s),s},CLASS_NAME:"OpenLayers.Renderer.NG"}),OpenLayers.Renderer.SVG2=OpenLayers.Class(OpenLayers.Renderer.NG,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",symbolMetrics:null,labelNodeType:"g",initialize:function(){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.symbolMetrics={})},supported:function(){var e="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(e+"SVG","1.1")||document.implementation.hasFeature(e+"BasicStructure","1.1"))},updateDimensions:function(e){OpenLayers.Renderer.NG.prototype.updateDimensions.apply(this,arguments);var t=this.getResolution(),i=this.extent.getWidth(),s=this.extent.getHeight(),a=[this.extent.left,-this.extent.top,i,s].join(" ");if(this.rendererRoot.setAttributeNS(null,"viewBox",a),this.rendererRoot.setAttributeNS(null,"width",i/t),this.rendererRoot.setAttributeNS(null,"height",s/t),e===!0){var r,n,o=this.vectorRoot.childNodes;for(r=0,n=o.length;n>r;++r)this.setStyle(o[r]);var l,h=this.textRoot.childNodes;for(r=0,n=h.length;n>r;++r)l=h[r],this.drawText(l,l._style,new OpenLayers.Geometry.Point(l._x,l._y))}},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":i=t.externalGraphic?"image":this.isComplexSymbol(t.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":i="rect";break;case"OpenLayers.Geometry.LineString":i="polyline";break;case"OpenLayers.Geometry.LinearRing":i="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":i="path";break;default:}return i},setStyle:function(e,t,i){t=t||e._style,i=i||e._options;var s=this.getResolution(),a=e._radius,r=s;if("OpenLayers.Geometry.Point"==e._geometryClass&&a){if(e.style.visibility="",t.graphic===!1)e.style.visibility="hidden";else if(t.externalGraphic){if(t.graphicTitle){e.setAttributeNS(null,"title",t.graphicTitle);var n=this.nodeFactory(null,"title");n.textContent=t.graphicTitle,e.appendChild(n)}t.graphicWidth&&t.graphicHeight&&e.setAttributeNS(null,"preserveAspectRatio","none");var o=t.graphicWidth||t.graphicHeight,l=t.graphicHeight||t.graphicWidth;o=o?o:2*t.pointRadius,l=l?l:2*t.pointRadius,o*=s,l*=s;var h=void 0!=t.graphicXOffset?t.graphicXOffset*s:-(.5*o),u=void 0!=t.graphicYOffset?t.graphicYOffset*s:-(.5*l),p=t.graphicOpacity||t.fillOpacity;e.setAttributeNS(null,"x",e._x+h),e.setAttributeNS(null,"y",e._y+u),e.setAttributeNS(null,"width",o),e.setAttributeNS(null,"height",l),e.setAttributeNS(this.xlinkns,"href",t.externalGraphic),e.setAttributeNS(null,"style","opacity: "+p),e.onclick=OpenLayers.Renderer.SVG2.preventDefault}else if(this.isComplexSymbol(t.graphicName)){var c=3*t.pointRadius*s,d=2*c,m=this.importSymbol(t.graphicName);r=3*this.symbolMetrics[m.id].size/d*s;var y=e.parentNode,f=e.nextSibling;y&&y.removeChild(e),e.firstChild&&e.removeChild(e.firstChild),e.appendChild(m.firstChild.cloneNode(!0)),e.setAttributeNS(null,"viewBox",m.getAttributeNS(null,"viewBox")),e.setAttributeNS(null,"width",d),e.setAttributeNS(null,"height",d),e.setAttributeNS(null,"x",e._x-c),e.setAttributeNS(null,"y",e._y-c),f?y.insertBefore(e,f):y&&y.appendChild(e)}else e.setAttributeNS(null,"r",t.pointRadius*s);var g=t.rotation;if(void 0!==g||void 0!==e._rotation)if(e._rotation=g,g|=0,"svg"!==e.nodeName)e.setAttributeNS(null,"transform",["rotate(",g,e._x,e._y,")"].join(" "));else{var v=this.symbolMetrics[m.id];e.firstChild.setAttributeNS(null,"transform",["rotate(",g,v.x,v.y,")"].join(" "))}}return i.isFilled?(e.setAttributeNS(null,"fill",t.fillColor),e.setAttributeNS(null,"fill-opacity",t.fillOpacity)):e.setAttributeNS(null,"fill","none"),i.isStroked?(e.setAttributeNS(null,"stroke",t.strokeColor),e.setAttributeNS(null,"stroke-opacity",t.strokeOpacity),e.setAttributeNS(null,"stroke-width",t.strokeWidth*r),e.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round"),e.setAttributeNS(null,"stroke-linejoin","round"),t.strokeDashstyle&&e.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,r))):e.setAttributeNS(null,"stroke","none"),t.pointerEvents&&e.setAttributeNS(null,"pointer-events",t.pointerEvents),null!=t.cursor&&e.setAttributeNS(null,"cursor",t.cursor),e},dashStyle:function(e,t){var i=e.strokeWidth*t,s=e.strokeDashstyle;switch(s){case"solid":return"none";case"dot":return[t,4*i].join();case"dash":return[4*i,4*i].join();case"dashdot":return[4*i,4*i,t,4*i].join();case"longdash":return[8*i,4*i].join();case"longdashdot":return[8*i,4*i,t,4*i].join();default:for(var a=OpenLayers.String.trim(s).split(/\s+/g),r=0,n=a.length;n>r;r++)a[r]=a[r]*t;return a.join()}},createNode:function(e,t){var i=document.createElementNS(this.xmlns,e);return t&&i.setAttributeNS(null,"id",t),i},nodeTypeCompare:function(e,t){return t==e.nodeName},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg")},createRoot:function(e){return this.nodeFactory(this.container.id+e,"g")},createDefs:function(){var e=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(e),e},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){var s=t.x,a=-t.y;return e.setAttributeNS(null,"cx",s),e.setAttributeNS(null,"cy",a),e._x=s,e._y=a,e._radius=i,e},drawLineString:function(e,t){var i=this.getComponentsString(t.components);return e.setAttributeNS(null,"points",i),e},drawLinearRing:function(e,t){var i=this.getComponentsString(t.components);return e.setAttributeNS(null,"points",i),e},drawPolygon:function(e,t){for(var i,s=[],a=0,r=t.components.length;r>a;a++)s.push("M"),i=this.getComponentsString(t.components[a].components," "),s.push(i);return s.push("z"),e.setAttributeNS(null,"d",s.join(" ")),e.setAttributeNS(null,"fill-rule","evenodd"),e},drawRectangle:function(e,t){return e.setAttributeNS(null,"x",t.x),e.setAttributeNS(null,"y",-t.y),e.setAttributeNS(null,"width",t.width),e.setAttributeNS(null,"height",t.height),e},drawSurface:function(e,t){for(var i=[],s=0,a=t.components.length;a>s;s++)if(0==s%3&&0==s/3){var r=this.getShortString(t.components[s]);i.push("M",r)}else if(1==s%3){var r=this.getShortString(t.components[s]);i.push("C",r)}else{var r=this.getShortString(t.components[s]);i.push(r)}return i.push("Z"),e.setAttributeNS(null,"d",i.join(" ")),e},drawText:function(e,t,i){var s=OpenLayers.Renderer.NG.prototype.drawText.apply(this,arguments),a=s.firstChild||this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_text","text"),r=this.getResolution();a.setAttributeNS(null,"x",i.x/r),a.setAttributeNS(null,"y",-i.y/r),s.setAttributeNS(null,"transform","scale("+r+")"),t.fontColor&&a.setAttributeNS(null,"fill",t.fontColor),t.fontOpacity&&a.setAttributeNS(null,"opacity",t.fontOpacity),t.fontFamily&&a.setAttributeNS(null,"font-family",t.fontFamily),t.fontSize&&a.setAttributeNS(null,"font-size",t.fontSize),t.fontWeight&&a.setAttributeNS(null,"font-weight",t.fontWeight),t.fontStyle&&a.setAttributeNS(null,"font-style",t.fontStyle),t.labelSelect===!0?(a.setAttributeNS(null,"pointer-events","visible"),a._featureId=e):a.setAttributeNS(null,"pointer-events","none");var n=t.labelAlign||"cm";a.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG2.LABEL_ALIGN[n[0]]||"middle"),OpenLayers.IS_GECKO===!0&&a.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG2.LABEL_ALIGN[n[1]]||"central");for(var o=t.label.split("\n"),l=o.length;a.childNodes.length>l;)a.removeChild(a.lastChild);for(var h=0;l>h;h++){var u=a.childNodes[h]||this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_tspan_"+h,"tspan");if(t.labelSelect===!0&&(u._featureId=e),OpenLayers.IS_GECKO===!1&&u.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG2.LABEL_VSHIFT[n[1]]||"-35%"),u.setAttribute("x",i.x/r),0==h){var p=OpenLayers.Renderer.SVG2.LABEL_VFACTOR[n[1]];null==p&&(p=-.5),u.setAttribute("dy",p*(l-1)+"em")}else u.setAttribute("dy","1em");u.textContent=""===o[h]?" ":o[h],u.parentNode||a.appendChild(u)}return a.parentNode||s.appendChild(a),s},getComponentsString:function(e,t){for(var i=e.length,s=Array(i),a=0;i>a;a++)s[a]=this.getShortString(e[a]);return s.join(t||",")},getShortString:function(e){return e.x+","+-e.y},importSymbol:function(e){this.defs||(this.defs=this.createDefs());var t=this.container.id+"-"+e,i=document.getElementById(t);if(null!=i)return i;var s=OpenLayers.Renderer.symbol[e];if(!s)throw Error(e+" is not a valid symbol name");var a=this.nodeFactory(t,"symbol"),r=this.nodeFactory(null,"polygon");a.appendChild(r);for(var n,o,l=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),h=[],u=0,p=s.length;p>u;u+=2)n=s[u],o=s[u+1],l.left=Math.min(l.left,n),l.bottom=Math.min(l.bottom,o),l.right=Math.max(l.right,n),l.top=Math.max(l.top,o),h.push(n,",",o);r.setAttributeNS(null,"points",h.join(" "));var c=l.getWidth(),d=l.getHeight(),m=[l.left-c,l.bottom-d,3*c,3*d];return a.setAttributeNS(null,"viewBox",m.join(" ")),this.symbolMetrics[t]={size:Math.max(c,d),x:l.getCenterLonLat().lon,y:l.getCenterLonLat().lat},this.defs.appendChild(a),a},getFeatureIdFromEvent:function(e){var t=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!t){var i=e.target;t=i.parentNode&&i!=this.rendererRoot&&i.parentNode._featureId}return t},CLASS_NAME:"OpenLayers.Renderer.SVG2"}),OpenLayers.Renderer.SVG2.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG2.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG2.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG2.preventDefault=function(e){e.preventDefault&&e.preventDefault()},OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,format:"image/png",serverResolutions:null,initialize:function(e,t,i,s){this.layername=i,OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e,t,{},s]),this.extension=this.format.split("/")[1].toLowerCase(),this.extension="jpg"==this.extension?"jpeg":this.extension},clone:function(e){return null==e&&(e=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){function t(e,t){e+="";for(var i=[],s=0;t>s;++s)i.push("0");return i.join("").substring(0,t-e.length)+e}var i=this.map.getResolution(),s=this.maxExtent,a=this.tileSize,r=Math.round((e.left-s.left)/(i*a.w)),n=Math.round((e.bottom-s.bottom)/(i*a.h)),o=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,i):this.map.getZoom(),l=[this.layername,t(o,2),t(parseInt(r/1e6),3),t(parseInt(r/1e3)%1e3,3),t(parseInt(r)%1e3,3),t(parseInt(n/1e6),3),t(parseInt(n/1e3)%1e3,3),t(parseInt(n)%1e3,3)+"."+this.extension],h=l.join("/"),u=this.url;return OpenLayers.Util.isArray(u)&&(u=this.selectUrl(h,u)),u="/"==u.charAt(u.length-1)?u:u+"/",u+h},CLASS_NAME:"OpenLayers.Layer.TileCache"}),OpenLayers.Kinetic=OpenLayers.Class({threshold:0,interval:10,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(e){OpenLayers.Util.extend(this,e)},begin:function(){clearInterval(this.timerId),this.timerId=void 0,this.points=[]},update:function(e){this.points.unshift({xy:e,tick:(new Date).getTime()}),this.points.length>this.nbPoints&&this.points.pop()},end:function(e){for(var t,i,s=(new Date).getTime(),a=0,r=this.points.length;r>a&&(i=this.points[a],!(s-i.tick>this.delay));a++)t=i;if(t){var n=(new Date).getTime()-t.tick,o=Math.sqrt(Math.pow(e.x-t.xy.x,2)+Math.pow(e.y-t.xy.y,2)),l=o/n;if(!(0==l||this.threshold>l)){var h=Math.asin((e.y-t.xy.y)/o);return t.xy.x<=e.x&&(h=Math.PI-h),{speed:l,theta:h}}}},move:function(e,t){var i=e.speed,s=Math.cos(e.theta),a=-Math.sin(e.theta),r=0,n=(new Date).getTime(),o=0,l=0,h=function(){if(null!=this.timerId){r+=this.interval;var e=(new Date).getTime()-n,h=(r+e)/2,u=-this.deceleration*Math.pow(h,2)/2+i*h,p=u*s,c=u*a,d={};d.end=!1;var m=-this.deceleration*h+i;0>=m&&(clearInterval(this.timerId),this.timerId=null,d.end=!0),d.x=p-o,d.y=c-l,o=p,l=c,t(d.x,d.y,d.end)}};this.timerId=window.setInterval(OpenLayers.Function.bind(h,this),this.interval)},CLASS_NAME:"OpenLayers.Kinetic"}),OpenLayers.ProxyHost="",OpenLayers.nullHandler=function(e){OpenLayers.Console.userError(OpenLayers.i18n("unhandledRequest",{statusText:e.statusText}))},OpenLayers.loadURL=function(e,t,i,s,a){"string"==typeof t&&(t=OpenLayers.Util.getParameters(t));var r=s?s:OpenLayers.nullHandler,n=a?a:OpenLayers.nullHandler;return OpenLayers.Request.GET({url:e,params:t,success:r,failure:n,scope:i})},OpenLayers.parseXMLString=function(e){var t=e.indexOf("<");t>0&&(e=e.substring(t));var i=OpenLayers.Util.Try(function(){var t=new ActiveXObject("Microsoft.XMLDOM");return t.loadXML(e),t},function(){return(new DOMParser).parseFromString(e,"text/xml")},function(){var t=new XMLHttpRequest;return t.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1),t.overrideMimeType&&t.overrideMimeType("text/xml"),t.send(null),t.responseXML});return i},OpenLayers.Ajax={emptyFunction:function(){},getTransport:function(){return OpenLayers.Util.Try(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},activeRequestCount:0},OpenLayers.Ajax.Responders={responders:[],register:function(e){for(var t=0;this.responders.length>t;t++)if(e==this.responders[t])return;this.responders.push(e)},unregister:function(e){OpenLayers.Util.removeItem(this.reponders,e)},dispatch:function(e,t,i){for(var s,a=0;this.responders.length>a;a++)if(s=this.responders[a],s[e]&&"function"==typeof s[e])try{s[e].apply(s,[t,i])}catch(r){}}},OpenLayers.Ajax.Responders.register({onCreate:function(){OpenLayers.Ajax.activeRequestCount++},onComplete:function(){OpenLayers.Ajax.activeRequestCount--}}),OpenLayers.Ajax.Base=OpenLayers.Class({initialize:function(e){this.options={method:"post",asynchronous:!0,contentType:"application/xml",parameters:""},OpenLayers.Util.extend(this.options,e||{}),this.options.method=this.options.method.toLowerCase(),"string"==typeof this.options.parameters&&(this.options.parameters=OpenLayers.Util.getParameters(this.options.parameters))}}),OpenLayers.Ajax.Request=OpenLayers.Class(OpenLayers.Ajax.Base,{_complete:!1,initialize:function(e,t){OpenLayers.Ajax.Base.prototype.initialize.apply(this,[t]),OpenLayers.ProxyHost&&OpenLayers.String.startsWith(e,"http")&&(e=OpenLayers.ProxyHost+encodeURIComponent(e)),this.transport=OpenLayers.Ajax.getTransport(),this.request(e)},request:function(e){this.url=e,this.method=this.options.method;var t=OpenLayers.Util.extend({},this.options.parameters);"get"!=this.method&&"post"!=this.method&&(t._method=this.method,this.method="post"),this.parameters=t,(t=OpenLayers.Util.getParameterString(t))&&("get"==this.method?this.url+=(this.url.indexOf("?")>-1?"&":"?")+t:/Konqueror|Safari|KHTML/.test(navigator.userAgent)&&(t+="&_="));try{var i=new OpenLayers.Ajax.Response(this);this.options.onCreate&&this.options.onCreate(i),OpenLayers.Ajax.Responders.dispatch("onCreate",this,i),this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous),this.options.asynchronous&&window.setTimeout(OpenLayers.Function.bind(this.respondToReadyState,this,1),10),this.transport.onreadystatechange=OpenLayers.Function.bind(this.onStateChange,this),this.setRequestHeaders(),this.body="post"==this.method?this.options.postBody||t:null,this.transport.send(this.body),!this.options.asynchronous&&this.transport.overrideMimeType&&this.onStateChange()}catch(s){this.dispatchException(s)}},onStateChange:function(){var e=this.transport.readyState;e>1&&(4!=e||!this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var e={"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*",OpenLayers:!0};if("post"==this.method&&(e["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:""),this.transport.overrideMimeType&&2005>(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]&&(e.Connection="close")),"object"==typeof this.options.requestHeaders){var t=this.options.requestHeaders;if("function"==typeof t.push)for(var i=0,s=t.length;s>i;i+=2)e[t[i]]=t[i+1];else for(var i in t)e[i]=t[i]}for(var a in e)this.transport.setRequestHeader(a,e[a])},success:function(){var e=this.getStatus();return!e||e>=200&&300>e},getStatus:function(){try{return this.transport.status||0}catch(e){return 0}},respondToReadyState:function(e){var t=OpenLayers.Ajax.Request.Events[e],i=new OpenLayers.Ajax.Response(this);if("Complete"==t){try{this._complete=!0,(this.options["on"+i.status]||this.options["on"+(this.success()?"Success":"Failure")]||OpenLayers.Ajax.emptyFunction)(i)}catch(s){this.dispatchException(s)}i.getHeader("Content-type")}try{(this.options["on"+t]||OpenLayers.Ajax.emptyFunction)(i),OpenLayers.Ajax.Responders.dispatch("on"+t,this,i)}catch(s){this.dispatchException(s)}"Complete"==t&&(this.transport.onreadystatechange=OpenLayers.Ajax.emptyFunction)},getHeader:function(e){try{return this.transport.getResponseHeader(e)}catch(t){return null}},dispatchException:function(e){var t=this.options.onException;if(t)t(this,e),OpenLayers.Ajax.Responders.dispatch("onException",this,e);else{for(var i=!1,s=OpenLayers.Ajax.Responders.responders,a=0;s.length>a;a++)if(s[a].onException){i=!0;break}if(!i)throw e;OpenLayers.Ajax.Responders.dispatch("onException",this,e)}}}),OpenLayers.Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"],OpenLayers.Ajax.Response=OpenLayers.Class({status:0,statusText:"",initialize:function(e){this.request=e;var t=this.transport=e.transport,i=this.readyState=t.readyState;if((i>2&&(!window.attachEvent||window.opera)||4==i)&&(this.status=this.getStatus(),this.statusText=this.getStatusText(),this.responseText=null==t.responseText?"":t.responseText+""),4==i){var s=t.responseXML;this.responseXML=void 0===s?null:s}},getStatus:OpenLayers.Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(e){return""}},getHeader:OpenLayers.Ajax.Request.prototype.getHeader,getResponseHeader:function(e){return this.transport.getResponseHeader(e)}}),OpenLayers.Ajax.getElementsByTagNameNS=function(e,t,i,s){var a=null;return a=e.getElementsByTagNameNS?e.getElementsByTagNameNS(t,s):e.getElementsByTagName(i+":"+s)},OpenLayers.Ajax.serializeXMLToString=function(e){var t=new XMLSerializer,i=t.serializeToString(e);return i},OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(){return void 0},write:function(e){var t;window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),this.xmldom=t):t=document.implementation.createDocument("","",null);var i=this.writeNode("wps:Execute",e,t);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])
},writers:{wps:{Execute:function(e){var t=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("wps:DataInputs",e.dataInputs,t),this.writeNode("wps:ResponseForm",e.responseForm,t),t},ResponseForm:function(e){var t=this.createElementNSPlus("wps:ResponseForm",{});return e.rawDataOutput&&this.writeNode("wps:RawDataOutput",e.rawDataOutput,t),e.responseDocument&&this.writeNode("wps:ResponseDocument",e.responseDocument,t),t},ResponseDocument:function(e){var t=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:e.storeExecuteResponse,lineage:e.lineage,status:e.status}});return e.output&&this.writeNode("wps:Output",e.output,t),t},Output:function(e){var t=this.createElementNSPlus("wps:Output",{attributes:{asReference:e.asReference}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("ows:Title",e.title,t),this.writeNode("ows:Abstract",e["abstract"],t),t},RawDataOutput:function(e){var t=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:e.mimeType}});return this.writeNode("ows:Identifier",e.identifier,t),t},DataInputs:function(e){for(var t=this.createElementNSPlus("wps:DataInputs",{}),i=0,s=e.length;s>i;++i)this.writeNode("wps:Input",e[i],t);return t},Input:function(e){var t=this.createElementNSPlus("wps:Input",{});return this.writeNode("ows:Identifier",e.identifier,t),e.title&&this.writeNode("ows:Title",e.title,t),e.data&&this.writeNode("wps:Data",e.data,t),e.reference&&this.writeNode("wps:Reference",e.reference,t),t},Data:function(e){var t=this.createElementNSPlus("wps:Data",{});return e.literalData?this.writeNode("wps:LiteralData",e.literalData,t):e.complexData&&this.writeNode("wps:ComplexData",e.complexData,t),t},LiteralData:function(e){var t=this.createElementNSPlus("wps:LiteralData",{attributes:{uom:e.uom},value:e.value});return t},ComplexData:function(e){var t=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}});return t.appendChild(this.getXMLDoc().createCDATASection(e.value)),t},Reference:function(e){var t=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:e.mimeType,"xlink:href":e.href,method:e.method,encoding:e.encoding,schema:e.schema}});return e.body&&this.writeNode("wps:Body",e.body,t),t},Body:function(e){var t=this.createElementNSPlus("wps:Body",{});return e.wcs?this.writeNode("wcs:GetCoverage",e.wcs,t):e.wfs?(this.featureType=e.wfs.featureType,this.version=e.wfs.version,this.writeNode("wfs:GetFeature",e.wfs,t)):this.writeNode("wps:Execute",e,t),t}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"}),OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,initialize:function(e,t,i){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[e,i]),this.location=t,this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadRSS:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this}),this.loaded=!0)},moveTo:function(){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadRSS()},parseData:function(e){var t=e.responseXML;if(t&&t.documentElement||(t=OpenLayers.Format.XML.prototype.read(e.responseText)),this.useFeedTitle){var i=null;try{i=t.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(s){i=t.getElementsByTagName("title")[0].firstChild.nodeValue}i&&this.setName(i)}var a={};OpenLayers.Util.extend(a,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(a.externalProjection=this.projection,a.internalProjection=this.map.getProjectionObject());for(var r=new OpenLayers.Format.GeoRSS(a),n=r.read(t),o=0,l=n.length;l>o;o++){var h={},u=n[o];if(u.geometry){var p=u.attributes.title?u.attributes.title:"Untitled",c=u.attributes.description?u.attributes.description:"No description.",d=u.attributes.link?u.attributes.link:"",m=u.geometry.getBounds().getCenterLonLat();if(h.icon=null==this.icon?OpenLayers.Marker.defaultIcon():this.icon.clone(),h.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120),p||c){h.title=p,h.description=c;var y='<div class="olLayerGeoRSSClose">[x]</div>';y+='<div class="olLayerGeoRSSTitle">',d&&(y+='<a class="link" href="'+d+'" target="_blank">'),y+=p,d&&(y+="</a>"),y+="</div>",y+='<div style="" class="olLayerGeoRSSDescription">',y+=c,y+="</div>",h.popupContentHTML=y}var u=new OpenLayers.Feature(this,m,h);this.features.push(u);var f=u.createMarker();f.events.register("click",u,this.markerClick),this.addMarker(f)}}this.events.triggerEvent("loadend")},markerClick:function(e){var t=this==this.layer.selectedFeature;this.layer.selectedFeature=t?null:this;for(var i=0,s=this.layer.map.popups.length;s>i;i++)this.layer.map.removePopup(this.layer.map.popups[i]);if(!t){var a=this.createPopup();OpenLayers.Event.observe(a.div,"click",OpenLayers.Function.bind(function(){for(var e=0,t=this.layer.map.popups.length;t>e;e++)this.layer.map.removePopup(this.layer.map.popups[e])},this)),this.layer.map.addPopup(a)}OpenLayers.Event.stop(e)},clearFeatures:function(){if(null!=this.features)for(;this.features.length>0;){var e=this.features[0];OpenLayers.Util.removeItem(this.features,e),e.destroy()}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"}),OpenLayers.Lang.br=OpenLayers.Util.applyDefaults({unhandledRequest:"Distro evel reked anveret ${statusText}",Permalink:"Peurliamm",Overlays:"Gwiskadoù","Base Layer":"Gwiskad diazez",readNotImplemented:"N'eo ket emplementet al lenn.",writeNotImplemented:"N'eo ket emplementet ar skrivañ.",noFID:"N'haller ket hizivaat un elfenn ma n'eus ket a niverenn-anaout (FID) eviti.",errorLoadingGML:"Fazi e-ser kargañ ar restr GML ${url}",browserNotSupported:"N'eo ket skoret an daskor vektorel gant ho merdeer. Setu aze an daskorerioù skoret evit ar poent :\n${renderers}",componentShouldBe:"addFeatures : bez' e tlefe ar parzh besañ eus ar seurt ${geomType}",getFeatureError:"Galvet eo bet getFeatureFromEvent called war ur gwiskad hep daskorer. Kement-se a dalvez ez eus bet freuzet ur gwiskad hag hoc'h eus miret un embreger bennak stag outañ.",minZoomLevelError:"Ne zleer implijout ar perzh minZoomLevel nemet evit gwiskadoù FixedZoomLevels-descendent. Ar fed ma wiria ar gwiskad WHS-se hag-eñ ez eus eus minZoomLevel zo un aspadenn gozh. Koulskoude n'omp ket evit e ziverkañ kuit da derriñ arloadoù diazezet war OL a c'hallfe bezañ stag outañ. Setu perak eo dispredet -- Lamet kuit e vo ar gwiriañ minZoomLevel a-is er stumm 3.0. Ober gant an arventennoù bihanañ/brasañ evel deskrivet amañ e plas : http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Treuzgread WFS : MAT EO ${response}",commitFailed:"Treuzgread WFS Transaction: C'HWITET ${response}",googleWarning:"N'eus ket bet gallet kargañ ar gwiskad Google ent reizh.<br><br>Evit en em zizober eus ar c'hemenn-mañ, dibabit ur BaseLayer nevez en diuzer gwiskadoù er c'horn dehoù el laez.<br><br>Sur a-walc'h eo peogwir n'eo ket bet ensoc'het levraoueg Google Maps pe neuze ne glot ket an alc'hwez API gant ho lec'hienn.<br><br>Diorroerien : Evit reizhañ an dra-se, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"N'haller ket kargañ ar gwiskad ${layerType} ent reizh.<br><br>Evit en em zizober eus ar c'hemenn-mañ, dibabit ur BaseLayer nevez en diuzer gwiskadoù er c'horn dehoù el laez.<br><br>Sur a-walc'h eo peogwir n'eo ket bet ensoc'het mat al levraoueg ${layerLib}.<br><br>Diorroerien : Evit gouzout penaos reizhañ an dra-se, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>","Scale = 1 : ${scaleDenom}":"Skeul = 1 : ${scaleDenom}",W:"K",E:"R",N:"N",S:"S",layerAlreadyAdded:"Klasket hoc'h eus ouzhpennañ ar gwiskad : ${layerName} d'ar gartenn, met ouzhpennet e oa bet c'hoazh",reprojectDeprecated:"Emaoc'h oc'h implijout an dibarzh 'reproject' war ar gwiskad ${layerName}. Dispredet eo an dibarzh-mañ : bet eo hag e talveze da ziskwel roadennoù war-c'horre kartennoù diazez kenwerzhel, un dra hag a c'haller ober bremañ gant an arc'hwel dre skor banndres boullek Mercator. Muioc'h a ditouroù a c'haller da gaout war http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Dispredet eo an daore-se ha tennet e vo kuit eus ar stumm 3.0. Grit gant ${newMethod} e plas.",boundsAddError:"Rekis eo tremen an div dalvoudenn x ha y d'an arc'hwel add.",lonlatAddError:"Rekis eo tremen an div dalvoudenn hedred ha ledred d'an arc'hwel add.",pixelAddError:"Rekis eo tremen an div dalvoudenn x ha y d'an arc'hwel add.",unsupportedGeometryType:"Seurt mentoniezh anskoret : ${geomType}",filterEvaluateNotImplemented:"N'eo ket bet emplementet ar priziañ evit seurt siloù c'hoazh."}),OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return e&&(this.cache=[],this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})),e},deactivate:function(){return this.cache=null,this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}),OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(e){if(!this.caching&&this.filter){var t=e.features;e.features=[];for(var i,s=0,a=t.length;a>s;++s)i=t[s],this.filter.evaluate(i)?e.features.push(i):this.cache.push(i)}},handleRemove:function(){this.caching||(this.cache=[])},setFilter:function(e){this.filter=e;var t=this.cache;if(this.cache=[],this.handleAdd({features:this.layer.features}),this.cache.length>0&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),this.caching=!1),t.length>0){var i={features:t};this.handleAdd(i),i.features.length>0&&(this.caching=!0,this.layer.addFeatures(i.features),this.caching=!1)}},CLASS_NAME:"OpenLayers.Strategy.Filter"}),OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.SOSCapabilities"}),OpenLayers.Lang.ia=OpenLayers.Util.applyDefaults({unhandledRequest:"Le responsa a un requesta non esseva maneate: ${statusText}",Permalink:"Permaligamine",Overlays:"Superpositiones","Base Layer":"Strato de base",readNotImplemented:"Lectura non implementate.",writeNotImplemented:"Scriptura non implementate.",noFID:"Non pote actualisar un elemento sin FID.",errorLoadingGML:"Error al cargamento del file GML ${url}",browserNotSupported:"Tu navigator non supporta le rendition de vectores. Le renditores actualmente supportate es:\n${renderers}",componentShouldBe:"addFeatures: le componente debe esser del typo ${geomType}",getFeatureError:"getFeatureFromEvent ha essite appellate in un strato sin renditor. Isto significa generalmente que tu ha destruite un strato, ma lassava un gestor associate con illo.",minZoomLevelError:"Le proprietate minZoomLevel es solmente pro uso con le stratos descendente de FixedZoomLevels. Le facto que iste strato WFS verifica minZoomLevel es un reliquia del passato. Nonobstante, si nos lo remove immediatemente, nos pote rumper applicationes a base de OL que depende de illo. Ergo nos lo declara obsolete; le verification de minZoomLevel in basso essera removite in version 3.0. Per favor usa in su loco le configuration de resolutiones min/max como describite a: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transaction WFS: SUCCESSO ${response}",commitFailed:"Transaction WFS: FALLEVA ${response}",googleWarning:"Le strato Google non poteva esser cargate correctemente.<br><br>Pro disfacer te de iste message, selige un nove BaseLayer in le selector de strato in alto a dextra.<br><br>Multo probabilemente, isto es proque le script del libreria de Google Maps non esseva includite o non contine le clave API correcte pro tu sito.<br><br>Disveloppatores: Pro adjuta de corriger isto, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>clicca hic</a",getLayerWarning:"Le strato ${layerType} non poteva esser cargate correctemente.<br><br>Pro disfacer te de iste message, selige un nove BaseLayer in le selector de strato in alto a dextra.<br><br>Multo probabilemente, isto es proque le script del libreria de ${layerLib} non esseva correctemente includite.<br><br>Disveloppatores: Pro adjuta de corriger isto, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>clicca hic</a>","Scale = 1 : ${scaleDenom}":"Scala = 1 : ${scaleDenom}",W:"W",E:"E",N:"N",S:"S",layerAlreadyAdded:"Tu tentava adder le strato: ${layerName} al carta, ma illo es ja presente",reprojectDeprecated:"Tu usa le option 'reproject' in le strato ${layerName} layer. Iste option es obsolescente: illo esseva pro poter monstrar datos super cartas de base commercial, ma iste functionalitate pote ora esser attingite con le uso de Spherical Mercator. Ulterior information es disponibile a http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Iste methodo ha essite declarate obsolescente e essera removite in version 3.0. Per favor usa ${newMethod} in su loco.",boundsAddError:"Tu debe passar le duo valores x e y al function add.",lonlatAddError:"Tu debe passar le duo valores lon e lat al function add.",pixelAddError:"Tu debe passar le duo valores x e y al function add.",unsupportedGeometryType:"Typo de geometria non supportate: ${geomType}",filterEvaluateNotImplemented:'"evaluate" non es implementate pro iste typo de filtro.'}),OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,units:null,resolution:OpenLayers.DOTS_PER_INCH,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(e,t,i,s){var a=[];a.push(e,t,i,s),OpenLayers.Layer.Grid.prototype.initialize.apply(this,a),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(e){e=this.adjustBounds(e);var t=this.map.getResolution(),i=Math.round(1e4*this.map.getScale())/1e4,s=Math.round(e.left/t),a=-Math.round(e.top/t);return this.getFullRequestString({t:a,l:s,s:i})},calculateGridLayout:function(e,t,i){var s=i*this.tileSize.w,a=i*this.tileSize.h,r=e.left,n=Math.floor(r/s)-this.buffer,o=r/s-n,l=-o*this.tileSize.w,h=n*s,u=e.top,p=Math.ceil(u/a)+this.buffer,c=p-u/a,d=-(c+1)*this.tileSize.h,m=p*a;return{tilelon:s,tilelat:a,tileoffsetlon:h,tileoffsetlat:m,tileoffsetx:l,tileoffsety:d}},clone:function(e){return null==e&&(e=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e},getTileBounds:function(e){var t=this.getResolution(),i=t*this.tileSize.w,s=t*this.tileSize.h,a=this.getLonLatFromViewPortPx(e),r=i*Math.floor(a.lon/i),n=s*Math.floor(a.lat/s);return new OpenLayers.Bounds(r,n,r+i,n+s)},CLASS_NAME:"OpenLayers.Layer.KaMap"}),OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",layerToContext:function(e){var t=this.getParser(),i={queryable:e.queryable,visibility:e.visibility,name:e.params.LAYERS,title:e.name,"abstract":e.metadata["abstract"],dataURL:e.metadata.dataURL,metadataURL:e.metadataURL,server:{version:e.params.VERSION,url:e.url},maxExtent:e.maxExtent,transparent:e.params.TRANSPARENT,numZoomLevels:e.numZoomLevels,units:e.units,isBaseLayer:e.isBaseLayer,opacity:e.opacity,displayInLayerSwitcher:e.displayInLayerSwitcher,singleTile:e.singleTile,tileSize:e.singleTile||!e.tileSize?void 0:{width:e.tileSize.w,height:e.tileSize.h},minScale:e.options.resolutions||e.options.scales||e.options.maxResolution||e.options.minScale?e.minScale:void 0,maxScale:e.options.resolutions||e.options.scales||e.options.minResolution||e.options.maxScale?e.maxScale:void 0,formats:[],styles:[],srs:e.srs,dimensions:e.dimensions};if(e.metadata.servertitle&&(i.server.title=e.metadata.servertitle),e.metadata.formats&&e.metadata.formats.length>0)for(var s=0,a=e.metadata.formats.length;a>s;s++){var r=e.metadata.formats[s];i.formats.push({value:r.value,current:r.value==e.params.FORMAT})}else i.formats.push({value:e.params.FORMAT,current:!0});if(e.metadata.styles&&e.metadata.styles.length>0)for(var s=0,a=e.metadata.styles.length;a>s;s++){var n=e.metadata.styles[s];n.current=n.href==e.params.SLD||n.body==e.params.SLD_BODY||n.name==e.params.STYLES?!0:!1,i.styles.push(n)}else i.styles.push({href:e.params.SLD,body:e.params.SLD_BODY,name:e.params.STYLES||t.defaultStyleName,title:t.defaultStyleTitle,current:!0});return i},toContext:function(e){var t={},i=e.layers;if("OpenLayers.Map"==e.CLASS_NAME){var s=e.metadata||{};t.size=e.getSize(),t.bounds=e.getExtent(),t.projection=e.projection,t.title=e.title,t.keywords=s.keywords,t["abstract"]=s["abstract"],t.logo=s.logo,t.descriptionURL=s.descriptionURL,t.contactInformation=s.contactInformation,t.maxExtent=e.maxExtent}else OpenLayers.Util.applyDefaults(t,e),void 0!=t.layers&&delete t.layers;if(void 0==t.layersContext&&(t.layersContext=[]),void 0!=i&&OpenLayers.Util.isArray(i))for(var a=0,r=i.length;r>a;a++){var n=i[a];n instanceof OpenLayers.Layer.WMS&&t.layersContext.push(this.layerToContext(n))}return t},CLASS_NAME:"OpenLayers.Format.WMC"}),OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(e){var t=null;if(null==e)t=this.namespaces[this.defaultPrefix];else for(t in this.namespaces)if(this.namespaces[t]==e)break;return t},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=e.documentElement;this.rootPrefix=t.prefix;var i={version:t.getAttribute("version")};return this.runChildNodes(i,t),i},runChildNodes:function(e,t){for(var i,s,a,r,n=t.childNodes,o=0,l=n.length;l>o;++o)i=n[o],1==i.nodeType&&(a=this.getNamespacePrefix(i.namespaceURI),r=i.nodeName.split(":").pop(),s=this["read_"+a+"_"+r],s&&s.apply(this,[e,i]))},read_wmc_General:function(e,t){this.runChildNodes(e,t)},read_wmc_BoundingBox:function(e,t){e.projection=t.getAttribute("SRS"),e.bounds=new OpenLayers.Bounds(parseFloat(t.getAttribute("minx")),parseFloat(t.getAttribute("miny")),parseFloat(t.getAttribute("maxx")),parseFloat(t.getAttribute("maxy")))},read_wmc_LayerList:function(e,t){e.layersContext=[],this.runChildNodes(e,t)},read_wmc_Layer:function(e,t){var i={visibility:"1"!=t.getAttribute("hidden"),queryable:"1"==t.getAttribute("queryable"),formats:[],styles:[],metadata:{}};this.runChildNodes(i,t),e.layersContext.push(i)},read_wmc_Extension:function(e,t){this.runChildNodes(e,t)},read_ol_units:function(e,t){e.units=this.getChildValue(t)},read_ol_maxExtent:function(e,t){var i=new OpenLayers.Bounds(t.getAttribute("minx"),t.getAttribute("miny"),t.getAttribute("maxx"),t.getAttribute("maxy"));e.maxExtent=i},read_ol_transparent:function(e,t){e.transparent=this.getChildValue(t)},read_ol_numZoomLevels:function(e,t){e.numZoomLevels=parseInt(this.getChildValue(t))},read_ol_opacity:function(e,t){e.opacity=parseFloat(this.getChildValue(t))},read_ol_singleTile:function(e,t){e.singleTile="true"==this.getChildValue(t)},read_ol_tileSize:function(e,t){var i={width:t.getAttribute("width"),height:t.getAttribute("height")};e.tileSize=i},read_ol_isBaseLayer:function(e,t){e.isBaseLayer="true"==this.getChildValue(t)},read_ol_displayInLayerSwitcher:function(e,t){e.displayInLayerSwitcher="true"==this.getChildValue(t)},read_wmc_Server:function(e,t){e.version=t.getAttribute("version"),e.url=this.getOnlineResource_href(t),e.metadata.servertitle=t.getAttribute("title")},read_wmc_FormatList:function(e,t){this.runChildNodes(e,t)},read_wmc_Format:function(e,t){var i={value:this.getChildValue(t)};"1"==t.getAttribute("current")&&(i.current=!0),e.formats.push(i)},read_wmc_StyleList:function(e,t){this.runChildNodes(e,t)},read_wmc_Style:function(e,t){var i={};this.runChildNodes(i,t),"1"==t.getAttribute("current")&&(i.current=!0),e.styles.push(i)},read_wmc_SLD:function(e,t){this.runChildNodes(e,t)},read_sld_StyledLayerDescriptor:function(e,t){var i=OpenLayers.Format.XML.prototype.write.apply(this,[t]);e.body=i},read_sld_FeatureTypeStyle:function(e,t){var i=OpenLayers.Format.XML.prototype.write.apply(this,[t]);e.body=i},read_wmc_OnlineResource:function(e,t){e.href=this.getAttributeNS(t,this.namespaces.xlink,"href")},read_wmc_Name:function(e,t){var i=this.getChildValue(t);i&&(e.name=i)},read_wmc_Title:function(e,t){var i=this.getChildValue(t);i&&(e.title=i)},read_wmc_MetadataURL:function(e,t){e.metadataURL=this.getOnlineResource_href(t)},read_wmc_KeywordList:function(e,t){e.keywords=[],this.runChildNodes(e.keywords,t)},read_wmc_Keyword:function(e,t){e.push(this.getChildValue(t))},read_wmc_Abstract:function(e,t){var i=this.getChildValue(t);i&&(e["abstract"]=i)},read_wmc_LogoURL:function(e,t){e.logo={width:t.getAttribute("width"),height:t.getAttribute("height"),format:t.getAttribute("format"),href:this.getOnlineResource_href(t)}},read_wmc_DescriptionURL:function(e,t){e.descriptionURL=this.getOnlineResource_href(t)},read_wmc_ContactInformation:function(e,t){var i={};this.runChildNodes(i,t),e.contactInformation=i},read_wmc_ContactPersonPrimary:function(e,t){var i={};this.runChildNodes(i,t),e.personPrimary=i},read_wmc_ContactPerson:function(e,t){var i=this.getChildValue(t);i&&(e.person=i)},read_wmc_ContactOrganization:function(e,t){var i=this.getChildValue(t);i&&(e.organization=i)},read_wmc_ContactPosition:function(e,t){var i=this.getChildValue(t);i&&(e.position=i)},read_wmc_ContactAddress:function(e,t){var i={};this.runChildNodes(i,t),e.contactAddress=i},read_wmc_AddressType:function(e,t){var i=this.getChildValue(t);i&&(e.type=i)},read_wmc_Address:function(e,t){var i=this.getChildValue(t);i&&(e.address=i)},read_wmc_City:function(e,t){var i=this.getChildValue(t);i&&(e.city=i)},read_wmc_StateOrProvince:function(e,t){var i=this.getChildValue(t);i&&(e.stateOrProvince=i)},read_wmc_PostCode:function(e,t){var i=this.getChildValue(t);i&&(e.postcode=i)},read_wmc_Country:function(e,t){var i=this.getChildValue(t);i&&(e.country=i)},read_wmc_ContactVoiceTelephone:function(e,t){var i=this.getChildValue(t);i&&(e.phone=i)},read_wmc_ContactFacsimileTelephone:function(e,t){var i=this.getChildValue(t);i&&(e.fax=i)},read_wmc_ContactElectronicMailAddress:function(e,t){var i=this.getChildValue(t);i&&(e.email=i)},read_wmc_DataURL:function(e,t){e.dataURL=this.getOnlineResource_href(t)},read_wmc_LegendURL:function(e,t){var i={width:t.getAttribute("width"),height:t.getAttribute("height"),format:t.getAttribute("format"),href:this.getOnlineResource_href(t)};e.legend=i},read_wmc_DimensionList:function(e,t){e.dimensions={},this.runChildNodes(e.dimensions,t)},read_wmc_Dimension:function(e,t){var i=t.getAttribute("name").toLowerCase(),s={name:i,units:t.getAttribute("units")||"",unitSymbol:t.getAttribute("unitSymbol")||"",userValue:t.getAttribute("userValue")||"",nearestValue:"1"===t.getAttribute("nearestValue"),multipleValues:"1"===t.getAttribute("multipleValues"),current:"1"===t.getAttribute("current"),"default":t.getAttribute("default")||""},a=this.getChildValue(t);s.values=a.split(","),e[s.name]=s},write:function(e,t){var i=this.createElementDefaultNS("ViewContext");return this.setAttributes(i,{version:this.VERSION,id:t&&"string"==typeof t.id?t.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")}),this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),i.appendChild(this.write_wmc_General(e)),i.appendChild(this.write_wmc_LayerList(e)),OpenLayers.Format.XML.prototype.write.apply(this,[i])},createElementDefaultNS:function(e,t,i){var s=this.createElementNS(this.namespaces[this.defaultPrefix],e);return t&&s.appendChild(this.createTextNode(t)),i&&this.setAttributes(s,i),s},setAttributes:function(e,t){var i;for(var s in t)i=""+t[s],i.match(/[A-Z]/)?this.setAttributeNS(e,null,s,i):e.setAttribute(s,i)},write_wmc_General:function(e){var t=this.createElementDefaultNS("General");e.size&&t.appendChild(this.createElementDefaultNS("Window",null,{width:e.size.w,height:e.size.h}));var i=e.bounds;return t.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:i.left.toPrecision(18),miny:i.bottom.toPrecision(18),maxx:i.right.toPrecision(18),maxy:i.top.toPrecision(18),SRS:e.projection})),t.appendChild(this.createElementDefaultNS("Title",e.title)),e.keywords&&t.appendChild(this.write_wmc_KeywordList(e.keywords)),e["abstract"]&&t.appendChild(this.createElementDefaultNS("Abstract",e["abstract"])),e.logo&&t.appendChild(this.write_wmc_URLType("LogoURL",e.logo.href,e.logo)),e.descriptionURL&&t.appendChild(this.write_wmc_URLType("DescriptionURL",e.descriptionURL)),e.contactInformation&&t.appendChild(this.write_wmc_ContactInformation(e.contactInformation)),t.appendChild(this.write_ol_MapExtension(e)),t},write_wmc_KeywordList:function(e){for(var t=this.createElementDefaultNS("KeywordList"),i=0,s=e.length;s>i;i++)t.appendChild(this.createElementDefaultNS("Keyword",e[i]));return t},write_wmc_ContactInformation:function(e){var t=this.createElementDefaultNS("ContactInformation");return e.personPrimary&&t.appendChild(this.write_wmc_ContactPersonPrimary(e.personPrimary)),e.position&&t.appendChild(this.createElementDefaultNS("ContactPosition",e.position)),e.contactAddress&&t.appendChild(this.write_wmc_ContactAddress(e.contactAddress)),e.phone&&t.appendChild(this.createElementDefaultNS("ContactVoiceTelephone",e.phone)),e.fax&&t.appendChild(this.createElementDefaultNS("ContactFacsimileTelephone",e.fax)),e.email&&t.appendChild(this.createElementDefaultNS("ContactElectronicMailAddress",e.email)),t},write_wmc_ContactPersonPrimary:function(e){var t=this.createElementDefaultNS("ContactPersonPrimary");return e.person&&t.appendChild(this.createElementDefaultNS("ContactPerson",e.person)),e.organization&&t.appendChild(this.createElementDefaultNS("ContactOrganization",e.organization)),t},write_wmc_ContactAddress:function(e){var t=this.createElementDefaultNS("ContactAddress");return e.type&&t.appendChild(this.createElementDefaultNS("AddressType",e.type)),e.address&&t.appendChild(this.createElementDefaultNS("Address",e.address)),e.city&&t.appendChild(this.createElementDefaultNS("City",e.city)),e.stateOrProvince&&t.appendChild(this.createElementDefaultNS("StateOrProvince",e.stateOrProvince)),e.postcode&&t.appendChild(this.createElementDefaultNS("PostCode",e.postcode)),e.country&&t.appendChild(this.createElementDefaultNS("Country",e.country)),t},write_ol_MapExtension:function(e){var t=this.createElementDefaultNS("Extension"),i=e.maxExtent;if(i){var s=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(s,{minx:i.left.toPrecision(18),miny:i.bottom.toPrecision(18),maxx:i.right.toPrecision(18),maxy:i.top.toPrecision(18)}),t.appendChild(s)}return t},write_wmc_LayerList:function(e){for(var t=this.createElementDefaultNS("LayerList"),i=0,s=e.layersContext.length;s>i;++i)t.appendChild(this.write_wmc_Layer(e.layersContext[i]));return t},write_wmc_Layer:function(e){var t=this.createElementDefaultNS("Layer",null,{queryable:e.queryable?"1":"0",hidden:e.visibility?"0":"1"});return t.appendChild(this.write_wmc_Server(e)),t.appendChild(this.createElementDefaultNS("Name",e.name)),t.appendChild(this.createElementDefaultNS("Title",e.title)),e["abstract"]&&t.appendChild(this.createElementDefaultNS("Abstract",e["abstract"])),e.dataURL&&t.appendChild(this.write_wmc_URLType("DataURL",e.dataURL)),e.metadataURL&&t.appendChild(this.write_wmc_URLType("MetadataURL",e.metadataURL)),t},write_wmc_LayerExtension:function(e){var t=this.createElementDefaultNS("Extension"),i=e.maxExtent,s=this.createElementNS(this.namespaces.ol,"ol:maxExtent");if(this.setAttributes(s,{minx:i.left.toPrecision(18),miny:i.bottom.toPrecision(18),maxx:i.right.toPrecision(18),maxy:i.top.toPrecision(18)}),t.appendChild(s),e.tileSize&&!e.singleTile){var a=this.createElementNS(this.namespaces.ol,"ol:tileSize");this.setAttributes(a,e.tileSize),t.appendChild(a)}for(var r,n=["transparent","numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"],o=0,l=n.length;l>o;++o)r=this.createOLPropertyNode(e,n[o]),r&&t.appendChild(r);return t},createOLPropertyNode:function(e,t){var i=null;return null!=e[t]&&(i=this.createElementNS(this.namespaces.ol,"ol:"+t),i.appendChild(this.createTextNode(""+e[t]))),i},write_wmc_Server:function(e){var t=e.server,i=this.createElementDefaultNS("Server"),s={service:"OGC:WMS",version:t.version};return t.title&&(s.title=t.title),this.setAttributes(i,s),i.appendChild(this.write_wmc_OnlineResource(t.url)),i},write_wmc_URLType:function(e,t,i){var s=this.createElementDefaultNS(e);if(s.appendChild(this.write_wmc_OnlineResource(t)),i)for(var a=["width","height","format"],r=0;a.length>r;r++)a[r]in i&&s.setAttribute(a[r],i[a[r]]);return s},write_wmc_DimensionList:function(e){var t=this.createElementDefaultNS("DimensionList");for(var i in e.dimensions){var s={},a=e.dimensions[i];for(var r in a)s[r]="boolean"==typeof a[r]?Number(a[r]):a[r];var n="";s.values&&(n=s.values.join(","),delete s.values),t.appendChild(this.createElementDefaultNS("Dimension",n,s))}return t},write_wmc_FormatList:function(e){for(var t=this.createElementDefaultNS("FormatList"),i=0,s=e.formats.length;s>i;i++){var a=e.formats[i];t.appendChild(this.createElementDefaultNS("Format",a.value,a.current&&1==a.current?{current:"1"}:null))}return t},write_wmc_StyleList:function(e){var t=this.createElementDefaultNS("StyleList"),i=e.styles;if(i&&OpenLayers.Util.isArray(i))for(var s,a=0,r=i.length;r>a;a++){var n=i[a],o=this.createElementDefaultNS("Style",null,n.current&&1==n.current?{current:"1"}:null);if(n.href){s=this.createElementDefaultNS("SLD"),n.name&&s.appendChild(this.createElementDefaultNS("Name",n.name)),n.title&&s.appendChild(this.createElementDefaultNS("Title",n.title)),n.legend&&s.appendChild(this.write_wmc_URLType("LegendURL",n.legend.href,n.legend));var l=this.write_wmc_OnlineResource(n.href);s.appendChild(l),o.appendChild(s)}else if(n.body){s=this.createElementDefaultNS("SLD"),n.name&&s.appendChild(this.createElementDefaultNS("Name",n.name)),n.title&&s.appendChild(this.createElementDefaultNS("Title",n.title)),n.legend&&s.appendChild(this.write_wmc_URLType("LegendURL",n.legend.href,n.legend));var h=OpenLayers.Format.XML.prototype.read.apply(this,[n.body]),u=h.documentElement;s.ownerDocument&&s.ownerDocument.importNode&&(u=s.ownerDocument.importNode(u,!0)),s.appendChild(u),o.appendChild(s)}else o.appendChild(this.createElementDefaultNS("Name",n.name)),o.appendChild(this.createElementDefaultNS("Title",n.title)),n["abstract"]&&o.appendChild(this.createElementDefaultNS("Abstract",n["abstract"])),n.legend&&o.appendChild(this.write_wmc_URLType("LegendURL",n.legend.href,n.legend));t.appendChild(o)}return t},write_wmc_OnlineResource:function(e){var t=this.createElementDefaultNS("OnlineResource");return this.setAttributeNS(t,this.namespaces.xlink,"xlink:type","simple"),this.setAttributeNS(t,this.namespaces.xlink,"xlink:href",e),t},getOnlineResource_href:function(e){var t={},i=e.getElementsByTagName("OnlineResource");return i.length>0&&this.read_wmc_OnlineResource(t,i[0]),t.href},CLASS_NAME:"OpenLayers.Format.WMC.v1"}),OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(e){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[e])
},read_sld_MinScaleDenominator:function(e,t){var i=parseFloat(this.getChildValue(t));i>0&&(e.maxScale=i)},read_sld_MaxScaleDenominator:function(e,t){e.minScale=parseFloat(this.getChildValue(t))},read_wmc_SRS:function(e,t){"srs"in e||(e.srs={}),e.srs[this.getChildValue(t)]=!0},write_wmc_Layer:function(e){var t=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[e]);if(e.maxScale){var i=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");i.appendChild(this.createTextNode(e.maxScale.toPrecision(16))),t.appendChild(i)}if(e.minScale){var s=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");s.appendChild(this.createTextNode(e.minScale.toPrecision(16))),t.appendChild(s)}if(e.srs)for(var a in e.srs)t.appendChild(this.createElementDefaultNS("SRS",a));return t.appendChild(this.write_wmc_FormatList(e)),t.appendChild(this.write_wmc_StyleList(e)),e.dimensions&&t.appendChild(this.write_wmc_DimensionList(e)),t.appendChild(this.write_wmc_LayerExtension(e)),t},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"}),OpenLayers.Format.XLS=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",stringifyOutput:!0,CLASS_NAME:"OpenLayers.Format.XLS"}),OpenLayers.Format.XLS.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},xy:!0,defaultPrefix:"xls",schemaLocation:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i={};return this.readChildNodes(e,i),i},readers:{xls:{XLS:function(e,t){t.version=e.getAttribute("version"),this.readChildNodes(e,t)},Response:function(e,t){this.readChildNodes(e,t)},GeocodeResponse:function(e,t){t.responseLists=[],this.readChildNodes(e,t)},GeocodeResponseList:function(e,t){var i={features:[],numberOfGeocodedAddresses:parseInt(e.getAttribute("numberOfGeocodedAddresses"))};t.responseLists.push(i),this.readChildNodes(e,i)},GeocodedAddress:function(e,t){var i=new OpenLayers.Feature.Vector;t.features.push(i),this.readChildNodes(e,i),i.geometry=i.components[0]},GeocodeMatchCode:function(e,t){t.attributes.matchCode={accuracy:parseFloat(e.getAttribute("accuracy")),matchType:e.getAttribute("matchType")}},Address:function(e,t){var i={countryCode:e.getAttribute("countryCode"),addressee:e.getAttribute("addressee"),street:[],place:[]};t.attributes.address=i,this.readChildNodes(e,i)},freeFormAddress:function(e,t){t.freeFormAddress=this.getChildValue(e)},StreetAddress:function(e,t){this.readChildNodes(e,t)},Building:function(e,t){t.building={number:e.getAttribute("number"),subdivision:e.getAttribute("subdivision"),buildingName:e.getAttribute("buildingName")}},Street:function(e,t){t.street.push(this.getChildValue(e))},Place:function(e,t){t.place[e.getAttribute("type")]=this.getChildValue(e)},PostalCode:function(e,t){t.postalCode=this.getChildValue(e)}},gml:OpenLayers.Format.GML.v3.prototype.readers.gml},write:function(e){return this.writers.xls.XLS.apply(this,[e])},writers:{xls:{XLS:function(e){var t=this.createElementNSPlus("xls:XLS",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});return this.writeNode("RequestHeader",e.header,t),this.writeNode("Request",e,t),t},RequestHeader:function(){return this.createElementNSPlus("xls:RequestHeader")},Request:function(e){var t=this.createElementNSPlus("xls:Request",{attributes:{methodName:"GeocodeRequest",requestID:e.requestID||"",version:this.VERSION}});return this.writeNode("GeocodeRequest",e.addresses,t),t},GeocodeRequest:function(e){for(var t=this.createElementNSPlus("xls:GeocodeRequest"),i=0,s=e.length;s>i;i++)this.writeNode("Address",e[i],t);return t},Address:function(e){var t=this.createElementNSPlus("xls:Address",{attributes:{countryCode:e.countryCode}});return e.freeFormAddress?this.writeNode("freeFormAddess",e.freeFormAddress,t):(e.street&&this.writeNode("StreetAddress",e,t),e.municipality&&this.writeNode("Municipality",e.municipality,t),e.countrySubdivision&&this.writeNode("CountrySubdivision",e.countrySubdivision,t),e.postalCode&&this.writeNode("PostalCode",e.postalCode,t)),t},freeFormAddress:function(e){return this.createElementNSPlus("freeFormAddress",{value:e})},StreetAddress:function(e){var t=this.createElementNSPlus("xls:StreetAddress");e.building&&this.writeNode(t,"Building",e.building);var i=e.street;OpenLayers.Util.isArray(i)||(i=[i]);for(var s=0,a=i.length;a>s;s++)this.writeNode("Street",i[s],t);return t},Building:function(e){return this.createElementNSPlus("xls:Building",{attributes:{number:e.number,subdivision:e.subdivision,buildingName:e.buildingName}})},Street:function(e){return this.createElementNSPlus("xls:Street",{value:e})},Municipality:function(e){return this.createElementNSPlus("xls:Place",{attributes:{type:"Municipality"},value:e})},CountrySubdivision:function(e){return this.createElementNSPlus("xls:Place",{attributes:{type:"CountrySubdivision"},value:e})},PostalCode:function(e){return this.createElementNSPlus("xls:PostalCode",{value:e})}}},CLASS_NAME:"OpenLayers.Format.XLS.v1"}),OpenLayers.Format.XLS.v1_1_0=OpenLayers.Class(OpenLayers.Format.XLS.v1,{VERSION:"1.1",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",initialize:function(e){OpenLayers.Format.XLS.v1.prototype.initialize.apply(this,[e])},CLASS_NAME:"OpenLayers.Format.XLS.v1_1_0"}),OpenLayers.Format.XLS.v1_1=OpenLayers.Format.XLS.v1_1_0,OpenLayers.Lang.sk=OpenLayers.Util.applyDefaults({unhandledRequest:"Neobslúžené požiadavky vracajú ${statusText}",Permalink:"Trvalý odkaz",Overlays:"Prekrytia","Base Layer":"Základná vrstva",readNotImplemented:"Čítanie nie je implementované.",writeNotImplemented:"Zápis nie je implementovaný.",noFID:"Nie je možné aktualizovať vlastnosť, pre ktorú neexistuje FID.",errorLoadingGML:"Chyba pri načítaní súboru GML ${url}",browserNotSupported:"Váš prehliadač nepodporuje vykresľovanie vektorov. Momentálne podporované vykresľovače sú:\n${renderers}",componentShouldBe:"addFeatures: komponent by mal byť ${geomType}",getFeatureError:"getFeatureFromEvent bola zavolaná na vrstve bez vykresľovača. To zvyčajne znamená, že ste odstránili vrstvu, ale nie niektorú z obslúh, ktorá je s ňou asociovaná.",minZoomLevelError:"Vlastnosť minZoomLevel je určený iba na použitie s vrstvami odvodenými od FixedZoomLevels. To, že táto wfs vrstva kontroluje minZoomLevel je pozostatok z minulosti. Nemôžeme ho však odstrániť, aby sme sa vyhli možnému porušeniu aplikácií založených na Open Layers, ktoré na tomto môže závisieť. Preto ho označujeme ako zavrhovaný - dolu uvedená kontrola minZoomLevel bude odstránená vo verzii 3.0. Použite prosím namiesto toho kontrolu min./max. rozlíšenia podľa tu uvedeného popisu: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transakcia WFS: ÚSPEŠNÁ ${response}",commitFailed:"Transakcia WFS: ZLYHALA ${response}",googleWarning:"Vrstvu Google nebolo možné správne načítať.<br><br>Aby ste sa tejto správy zbavili vyberte novú BaseLayer v prepínači vrstiev v pravom hornom rohu.<br><br>Toto sa stalo pravdepodobne preto, že skript knižnice Google Maps buď nebol načítaný alebo neobsahuje správny kľúč API pre vašu lokalitu.<br><br>Vývojári: Tu môžete získať <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>pomoc so sfunkčnením</a>",getLayerWarning:"Vrstvu ${layerType} nebolo možné správne načítať.<br><br>Aby ste sa tejto správy zbavili vyberte novú BaseLayer v prepínači vrstiev v pravom hornom rohu.<br><br>Toto sa stalo pravdepodobne preto, že skript knižnice ${layerType} buď nebol načítaný alebo neobsahuje správny kľúč API pre vašu lokalitu.<br><br>Vývojári: Tu môžete získať <a href='http://trac.openlayers.org/wiki/${layerType}' target='_blank'>pomoc so sfunkčnením</a>","Scale = 1 : ${scaleDenom}":"Mierka = 1 : ${scaleDenom}",layerAlreadyAdded:"Pokúsili ste sa do mapy pridať vrstvu ${layerName}, ale tá už bola pridaná",reprojectDeprecated:"Používate voľby „reproject“ vrstvy ${layerType}. Táto voľba je zzavrhovaná: jej použitie bolo navrhnuté na podporu zobrazovania údajov nad komerčnými základovými mapami, ale túto funkcionalitu je teraz možné dosiahnuť pomocou Spherical Mercator. Ďalšie informácie získate na stránke http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Táto metóda je zavrhovaná a bude odstránená vo verzii 3.0. Použite prosím namiesto nej metódu ${newMethod}.",boundsAddError:"Sčítacej funkcii musíte dať hodnoty x aj y.",lonlatAddError:"Sčítacej funkcii musíte dať hodnoty lon (zem. dĺžka) aj lat (zem. šírka).",pixelAddError:"Sčítacej funkcii musíte dať hodnoty x aj y.",unsupportedGeometryType:"Nepodporovaný typ geometrie: ${geomType}",filterEvaluateNotImplemented:"evaluate nie je implementovaný pre tento typ filtra"}),OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){var e="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(e+"SVG","1.1")||document.implementation.hasFeature(e+"BasicStructure","1.1"))},inValidRange:function(e,t,i){var s=e+(i?0:this.translationParameters.x),a=t+(i?0:this.translationParameters.y);return s>=-this.MAX_PIXEL&&this.MAX_PIXEL>=s&&a>=-this.MAX_PIXEL&&this.MAX_PIXEL>=a},setExtent:function(e,t){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var i=this.getResolution(),s=-e.left/i,a=e.top/i;if(t){this.left=s,this.top=a;var r="0 0 "+this.size.w+" "+this.size.h;return this.rendererRoot.setAttributeNS(null,"viewBox",r),this.translate(0,0),!0}var n=this.translate(s-this.left,a-this.top);return n||this.setExtent(e,!0),n},translate:function(e,t){if(this.inValidRange(e,t,!0)){var i="";return(e||t)&&(i="translate("+e+","+t+")"),this.root.setAttributeNS(null,"transform",i),this.translationParameters={x:e,y:t},!0}return!1},setSize:function(){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":i=t.externalGraphic?"image":this.isComplexSymbol(t.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":i="rect";break;case"OpenLayers.Geometry.LineString":i="polyline";break;case"OpenLayers.Geometry.LinearRing":i="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":i="path";break;default:}return i},setStyle:function(e,t,i){t=t||e._style,i=i||e._options;var s,a=parseFloat(e.getAttributeNS(null,"r")),r=1;if("OpenLayers.Geometry.Point"==e._geometryClass&&a){if(e.style.visibility="",t.graphic===!1)e.style.visibility="hidden";else if(t.externalGraphic){if(s=this.getPosition(e),t.graphicTitle){e.setAttributeNS(null,"title",t.graphicTitle);var n=this.nodeFactory(null,"title");n.textContent=t.graphicTitle,e.appendChild(n)}t.graphicWidth&&t.graphicHeight&&e.setAttributeNS(null,"preserveAspectRatio","none");var o=t.graphicWidth||t.graphicHeight,l=t.graphicHeight||t.graphicWidth;o=o?o:2*t.pointRadius,l=l?l:2*t.pointRadius;var h=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*o),u=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*l),p=t.graphicOpacity||t.fillOpacity;e.setAttributeNS(null,"x",(s.x+h).toFixed()),e.setAttributeNS(null,"y",(s.y+u).toFixed()),e.setAttributeNS(null,"width",o),e.setAttributeNS(null,"height",l),e.setAttributeNS(this.xlinkns,"href",t.externalGraphic),e.setAttributeNS(null,"style","opacity: "+p),e.onclick=OpenLayers.Renderer.SVG.preventDefault}else if(this.isComplexSymbol(t.graphicName)){var c=3*t.pointRadius,d=2*c,m=this.importSymbol(t.graphicName);s=this.getPosition(e),r=3*this.symbolMetrics[m.id][0]/d;var y=e.parentNode,f=e.nextSibling;y&&y.removeChild(e),e.firstChild&&e.removeChild(e.firstChild),e.appendChild(m.firstChild.cloneNode(!0)),e.setAttributeNS(null,"viewBox",m.getAttributeNS(null,"viewBox")),e.setAttributeNS(null,"width",d),e.setAttributeNS(null,"height",d),e.setAttributeNS(null,"x",s.x-c),e.setAttributeNS(null,"y",s.y-c),f?y.insertBefore(e,f):y&&y.appendChild(e)}else e.setAttributeNS(null,"r",t.pointRadius);var g=t.rotation;if((void 0!==g||void 0!==e._rotation)&&s)if(e._rotation=g,g|=0,"svg"!==e.nodeName)e.setAttributeNS(null,"transform","rotate("+g+" "+s.x+" "+s.y+")");else{var v=this.symbolMetrics[m.id];e.firstChild.setAttributeNS(null,"transform","rotate("+g+" "+v[1]+" "+v[2]+")")}}return i.isFilled?(e.setAttributeNS(null,"fill",t.fillColor),e.setAttributeNS(null,"fill-opacity",t.fillOpacity)):e.setAttributeNS(null,"fill","none"),i.isStroked?(e.setAttributeNS(null,"stroke",t.strokeColor),e.setAttributeNS(null,"stroke-opacity",t.strokeOpacity),e.setAttributeNS(null,"stroke-width",t.strokeWidth*r),e.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round"),e.setAttributeNS(null,"stroke-linejoin","round"),t.strokeDashstyle&&e.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,r))):e.setAttributeNS(null,"stroke","none"),t.pointerEvents&&e.setAttributeNS(null,"pointer-events",t.pointerEvents),null!=t.cursor&&e.setAttributeNS(null,"cursor",t.cursor),e},dashStyle:function(e,t){var i=e.strokeWidth*t,s=e.strokeDashstyle;switch(s){case"solid":return"none";case"dot":return[1,4*i].join();case"dash":return[4*i,4*i].join();case"dashdot":return[4*i,4*i,1,4*i].join();case"longdash":return[8*i,4*i].join();case"longdashdot":return[8*i,4*i,1,4*i].join();default:return OpenLayers.String.trim(s).replace(/\s+/g,",")}},createNode:function(e,t){var i=document.createElementNS(this.xmlns,e);return t&&i.setAttributeNS(null,"id",t),i},nodeTypeCompare:function(e,t){return t==e.nodeName},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg")},createRoot:function(e){return this.nodeFactory(this.container.id+e,"g")},createDefs:function(){var e=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(e),e},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){var s=this.getResolution(),a=t.x/s+this.left,r=this.top-t.y/s;return this.inValidRange(a,r)?(e.setAttributeNS(null,"cx",a),e.setAttributeNS(null,"cy",r),e.setAttributeNS(null,"r",i),e):!1},drawLineString:function(e,t){var i=this.getComponentsString(t.components);return i.path?(e.setAttributeNS(null,"points",i.path),i.complete?e:null):!1},drawLinearRing:function(e,t){var i=this.getComponentsString(t.components);return i.path?(e.setAttributeNS(null,"points",i.path),i.complete?e:null):!1},drawPolygon:function(e,t){for(var i,s,a="",r=!0,n=!0,o=0,l=t.components.length;l>o;o++)a+=" M",i=this.getComponentsString(t.components[o].components," "),s=i.path,s?(a+=" "+s,n=i.complete&&n):r=!1;return a+=" z",r?(e.setAttributeNS(null,"d",a),e.setAttributeNS(null,"fill-rule","evenodd"),n?e:null):!1},drawRectangle:function(e,t){var i=this.getResolution(),s=t.x/i+this.left,a=this.top-t.y/i;return this.inValidRange(s,a)?(e.setAttributeNS(null,"x",s),e.setAttributeNS(null,"y",a),e.setAttributeNS(null,"width",t.width/i),e.setAttributeNS(null,"height",t.height/i),e):!1},drawSurface:function(e,t){for(var i=null,s=!0,a=0,r=t.components.length;r>a;a++)if(0==a%3&&0==a/3){var n=this.getShortString(t.components[a]);n||(s=!1),i="M "+n}else if(1==a%3){var n=this.getShortString(t.components[a]);n||(s=!1),i+=" C "+n}else{var n=this.getShortString(t.components[a]);n||(s=!1),i+=" "+n}return i+=" Z",s?(e.setAttributeNS(null,"d",i),e):!1},drawText:function(e,t,i){var s=this.getResolution(),a=i.x/s+this.left,r=i.y/s-this.top,n=this.nodeFactory(e+this.LABEL_ID_SUFFIX,"text");n.setAttributeNS(null,"x",a),n.setAttributeNS(null,"y",-r),t.fontColor&&n.setAttributeNS(null,"fill",t.fontColor),t.fontOpacity&&n.setAttributeNS(null,"opacity",t.fontOpacity),t.fontFamily&&n.setAttributeNS(null,"font-family",t.fontFamily),t.fontSize&&n.setAttributeNS(null,"font-size",t.fontSize),t.fontWeight&&n.setAttributeNS(null,"font-weight",t.fontWeight),t.fontStyle&&n.setAttributeNS(null,"font-style",t.fontStyle),t.labelSelect===!0?(n.setAttributeNS(null,"pointer-events","visible"),n._featureId=e):n.setAttributeNS(null,"pointer-events","none");var o=t.labelAlign||"cm";n.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[o[0]]||"middle"),OpenLayers.IS_GECKO===!0&&n.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[o[1]]||"central");for(var l=t.label.split("\n"),h=l.length;n.childNodes.length>h;)n.removeChild(n.lastChild);for(var u=0;h>u;u++){var p=this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_tspan_"+u,"tspan");if(t.labelSelect===!0&&(p._featureId=e,p._geometry=i,p._geometryClass=i.CLASS_NAME),OpenLayers.IS_GECKO===!1&&p.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[o[1]]||"-35%"),p.setAttribute("x",a),0==u){var c=OpenLayers.Renderer.SVG.LABEL_VFACTOR[o[1]];null==c&&(c=-.5),p.setAttribute("dy",c*(h-1)+"em")}else p.setAttribute("dy","1em");p.textContent=""===l[u]?" ":l[u],p.parentNode||n.appendChild(p)}n.parentNode||this.textRoot.appendChild(n)},getComponentsString:function(e,t){for(var i,s,a=[],r=!0,n=e.length,o=[],l=0;n>l;l++)s=e[l],a.push(s),i=this.getShortString(s),i?o.push(i):(l>0&&this.getShortString(e[l-1])&&o.push(this.clipLine(e[l],e[l-1])),n-1>l&&this.getShortString(e[l+1])&&o.push(this.clipLine(e[l],e[l+1])),r=!1);return{path:o.join(t||","),complete:r}},clipLine:function(e,t){if(t.equals(e))return"";var i,s=this.getResolution(),a=this.MAX_PIXEL-this.translationParameters.x,r=this.MAX_PIXEL-this.translationParameters.y,n=t.x/s+this.left,o=this.top-t.y/s,l=e.x/s+this.left,h=this.top-e.y/s;return(-a>l||l>a)&&(i=(h-o)/(l-n),l=0>l?-a:a,h=o+(l-n)*i),(-r>h||h>r)&&(i=(l-n)/(h-o),h=0>h?-r:r,l=n+(h-o)*i),l+","+h},getShortString:function(e){var t=this.getResolution(),i=e.x/t+this.left,s=this.top-e.y/t;return this.inValidRange(i,s)?i+","+s:!1},getPosition:function(e){return{x:parseFloat(e.getAttributeNS(null,"cx")),y:parseFloat(e.getAttributeNS(null,"cy"))}},importSymbol:function(e){this.defs||(this.defs=this.createDefs());var t=this.container.id+"-"+e,i=document.getElementById(t);if(null!=i)return i;var s=OpenLayers.Renderer.symbol[e];if(!s)throw Error(e+" is not a valid symbol name");var a=this.nodeFactory(t,"symbol"),r=this.nodeFactory(null,"polygon");a.appendChild(r);for(var n,o,l=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),h=[],u=0;s.length>u;u+=2)n=s[u],o=s[u+1],l.left=Math.min(l.left,n),l.bottom=Math.min(l.bottom,o),l.right=Math.max(l.right,n),l.top=Math.max(l.top,o),h.push(n,",",o);r.setAttributeNS(null,"points",h.join(" "));var p=l.getWidth(),c=l.getHeight(),d=[l.left-p,l.bottom-c,3*p,3*c];return a.setAttributeNS(null,"viewBox",d.join(" ")),this.symbolMetrics[t]=[Math.max(p,c),l.getCenterLonLat().lon,l.getCenterLonLat().lat],this.defs.appendChild(a),a},getFeatureIdFromEvent:function(e){var t=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!t){var i=e.target;t=i.parentNode&&i!=this.rendererRoot&&i.parentNode._featureId}return t},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(e){e.preventDefault&&e.preventDefault()},OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",getVersion:function(){var e=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);return("1.1.1"==e||"1.1.0"==e)&&(e="1.1"),e},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"}),OpenLayers.Format.WMSDescribeLayer.v1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(e){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var t,i,s=e.documentElement,a=s.childNodes,r=[],n=0;a.length>n;++n)if(t=a[n],i=t.nodeName,"LayerDescription"==i){var o=t.getAttribute("name"),l="",h="",u="";t.getAttribute("owsType")?(l=t.getAttribute("owsType"),h=t.getAttribute("owsURL")):""!=t.getAttribute("wfs")?(l="WFS",h=t.getAttribute("wfs")):""!=t.getAttribute("wcs")&&(l="WCS",h=t.getAttribute("wcs"));var p=t.getElementsByTagName("Query");p.length>0&&(u=p[0].getAttribute("typeName"),u||(u=p[0].getAttribute("typename"))),r.push({layerName:o,owsType:l,owsURL:h,typeName:u})}return r},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1"}),OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(e,t,i,s,a,r){null==e&&(e=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.id=e,this.lonlat=t,this.contentSize=null!=i?i:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT),null!=s&&(this.contentHTML=s),this.backgroundColor=OpenLayers.Popup.COLOR,this.opacity=OpenLayers.Popup.OPACITY,this.border=OpenLayers.Popup.BORDER,this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden"),this.div.className=this.displayClass;var n=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(n,null,null,null,"relative",null,"hidden");var e=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(e,null,this.contentSize.clone(),null,"relative"),this.contentDiv.className=this.contentDisplayClass,this.groupDiv.appendChild(this.contentDiv),this.div.appendChild(this.groupDiv),a&&this.addCloseBox(r),this.registerEvents()},destroy:function(){this.id=null,this.lonlat=null,this.size=null,this.contentHTML=null,this.backgroundColor=null,this.opacity=null,this.border=null,this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide),this.events.destroy(),this.events=null,this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv)),this.closeDiv=null,this.div.removeChild(this.groupDiv),this.groupDiv=null,null!=this.map&&this.map.removePopup(this),this.map=null,this.div=null,this.autoSize=null,this.minSize=null,this.maxSize=null,this.padding=null,this.panMapIfOutOfView=null},draw:function(e){return null==e&&null!=this.lonlat&&null!=this.map&&(e=this.map.getLayerPxFromLonLat(this.lonlat)),this.closeOnMove&&this.map.events.register("movestart",this,this.hide),this.disableFirefoxOverflowHack||"firefox"!=OpenLayers.BROWSER_NAME||(this.map.events.register("movestart",this,function(){var e=document.defaultView.getComputedStyle(this.contentDiv,null),t=e.getPropertyValue("overflow");"hidden"!=t&&(this.contentDiv._oldOverflow=t,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var e=this.contentDiv._oldOverflow;e&&(this.contentDiv.style.overflow=e,this.contentDiv._oldOverflow=null)})),this.moveTo(e),this.autoSize||this.size||this.setSize(this.contentSize),this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var e=this.map.getLayerPxFromLonLat(this.lonlat);e&&this.moveTo(e)}},moveTo:function(e){null!=e&&null!=this.div&&(this.div.style.left=e.x+"px",this.div.style.top=e.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="",this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(e){this.size=e.clone();var t=this.getContentDivPadding(),i=t.left+t.right,s=t.top+t.bottom;if(this.fixPadding(),i+=this.padding.left+this.padding.right,s+=this.padding.top+this.padding.bottom,this.closeDiv){var a=parseInt(this.closeDiv.style.width);i+=a+t.right}this.size.w+=i,this.size.h+=s,"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=t.left+t.right,this.contentSize.h+=t.bottom+t.top),null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px"),null!=this.contentDiv&&(this.contentDiv.style.width=e.w+"px",this.contentDiv.style.height=e.h+"px")},updateSize:function(){var e="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",t=this.map?this.map.layerContainerDiv:document.body,i=OpenLayers.Util.getRenderedDimensions(e,null,{displayClass:this.displayClass,containerElement:t}),s=this.getSafeContentSize(i),a=null;if(s.equals(i))a=i;else{var r=new OpenLayers.Size;if(r.w=s.w<i.w?s.w:null,r.h=s.h<i.h?s.h:null,r.w&&r.h)a=s;else{var n=OpenLayers.Util.getRenderedDimensions(e,r,{displayClass:this.contentDisplayClass,containerElement:t}),o=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if("hidden"!=o&&n.equals(s)){var l=OpenLayers.Util.getScrollbarWidth();r.w?n.h+=l:n.w+=l}a=this.getSafeContentSize(n)}}this.setSize(a)},setBackgroundColor:function(e){void 0!=e&&(this.backgroundColor=e),null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(e){void 0!=e&&(this.opacity=e),null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(e){void 0!=e&&(this.border=e),null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(e){null!=e&&(this.contentHTML=e),null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var e=function(){this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad)},t=this.contentDiv.getElementsByTagName("img"),i=0,s=t.length;s>i;i++){var a=t[i];if(0==a.width||0==a.height){var r={popup:this,img:a};a._onImgLoad=OpenLayers.Function.bind(e,r),OpenLayers.Event.observe(a,"load",a._onImgLoad)}}},getSafeContentSize:function(e){var t=e.clone(),i=this.getContentDivPadding(),s=i.left+i.right,a=i.top+i.bottom;if(this.fixPadding(),s+=this.padding.left+this.padding.right,a+=this.padding.top+this.padding.bottom,this.closeDiv){var r=parseInt(this.closeDiv.style.width);s+=r+i.right}if(this.minSize&&(t.w=Math.max(t.w,this.minSize.w-s),t.h=Math.max(t.h,this.minSize.h-a)),this.maxSize&&(t.w=Math.min(t.w,this.maxSize.w-s),t.h=Math.min(t.h,this.maxSize.h-a)),this.map&&this.map.size){var n=0,o=0;if(this.keepInMap&&!this.panMapIfOutOfView){var l=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":n=l.x,o=this.map.size.h-l.y;break;case"tl":n=this.map.size.w-l.x,o=this.map.size.h-l.y;break;case"bl":n=this.map.size.w-l.x,o=l.y;break;case"br":n=l.x,o=l.y;break;default:n=l.x,o=this.map.size.h-l.y}}var h=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-a-o,u=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-s-n;t.w=Math.min(t.w,u),t.h=Math.min(t.h,h)}return t},getContentDivPadding:function(){var e=this._contentDivPadding;return e||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),e=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this._contentDivPadding=e,this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display="")),e},addCloseBox:function(e){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,new OpenLayers.Size(17,17)),this.closeDiv.className="olPopupCloseBox";var t=this.getContentDivPadding();this.closeDiv.style.right=t.right+"px",this.closeDiv.style.top=t.top+"px",this.groupDiv.appendChild(this.closeDiv);var i=e||function(e){this.hide(),OpenLayers.Event.stop(e)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(i,this)),OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(i,this))},panIntoView:function(){var e=this.map.getSize(),t=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),i=t.clone();t.x<this.map.paddingForPopups.left?i.x=this.map.paddingForPopups.left:t.x+this.size.w>e.w-this.map.paddingForPopups.right&&(i.x=e.w-this.map.paddingForPopups.right-this.size.w),t.y<this.map.paddingForPopups.top?i.y=this.map.paddingForPopups.top:t.y+this.size.h>e.h-this.map.paddingForPopups.bottom&&(i.y=e.h-this.map.paddingForPopups.bottom-this.size.h);var s=t.x-i.x,a=t.y-i.y;this.map.pan(s,a)},registerEvents:function(){function e(e){OpenLayers.Event.stop(e,!0)}this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:e,scope:this})},onmousedown:function(e){this.mousedown=!0,OpenLayers.Event.stop(e,!0)},onmousemove:function(e){this.mousedown&&OpenLayers.Event.stop(e,!0)},onmouseup:function(e){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(e,!0))},onclick:function(e){OpenLayers.Event.stop(e,!0)},onmouseout:function(){this.mousedown=!1},ondblclick:function(e){OpenLayers.Event.stop(e,!0)},CLASS_NAME:"OpenLayers.Popup"}),OpenLayers.Popup.WIDTH=200,OpenLayers.Popup.HEIGHT=200,OpenLayers.Popup.COLOR="white",OpenLayers.Popup.OPACITY=1,OpenLayers.Popup.BORDER="0px",OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.eTop||(this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top",this.topInUnits.length,this.div.appendChild(this.eTop),this.eTop.style.visibility=""==this.topOutUnits||""==this.topInUnits?"hidden":"visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),this.eBottom.style.visibility=""==this.bottomOutUnits||""==this.bottomInUnits?"hidden":"visible"),this.map.events.register("moveend",this,this.update),this.update(),this.div},getBarLen:function(e){var t,i=parseInt(Math.log(e)/Math.log(10)),s=Math.pow(10,i),a=parseInt(e/s);return t=a>5?5:a>2?2:1,t*s},update:function(){var e=this.map.getResolution();if(e){var t=this.map.getUnits(),i=OpenLayers.INCHES_PER_UNIT,s=this.maxWidth*e*i[t],a=1;if(this.geodesic===!0){var r=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth,n=s/i.km;a=r/n,s*=a}var o,l;s>1e5?(o=this.topOutUnits,l=this.bottomOutUnits):(o=this.topInUnits,l=this.bottomInUnits);var h=s/i[o],u=s/i[l],p=this.getBarLen(h),c=this.getBarLen(u);h=p/i[t]*i[o],u=c/i[t]*i[l];var d=h/e/a,m=u/e/a;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(m)+"px",this.eBottom.innerHTML=c+" "+l),"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(d)+"px",this.eTop.innerHTML=p+" "+o)
}},CLASS_NAME:"OpenLayers.Control.ScaleLine"}),OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(e,t,i,s){this.url=e,this.size=t?t:new OpenLayers.Size(20,20),this.offset=i?i:new OpenLayers.Pixel(-(this.size.w/2),-(this.size.h/2)),this.calculateOffset=s;var a=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(a)},destroy:function(){this.erase(),OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild),this.imageDiv.innerHTML="",this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(e){null!=e&&(this.size=e),this.draw()},setUrl:function(e){null!=e&&(this.url=e),this.draw()},draw:function(e){return OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute"),this.moveTo(e),this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(e){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,e)},moveTo:function(e){if(null!=e&&(this.px=e),null!=this.imageDiv)if(null==this.px)this.display(!1);else{this.calculateOffset&&(this.offset=this.calculateOffset(this.size));var t=this.px.offset(this.offset);OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,t)}},display:function(e){this.imageDiv.style.display=e?"":"none"},isDrawn:function(){var e=this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType;return e},CLASS_NAME:"OpenLayers.Icon"}),OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(e,t){this.lonlat=e;var i=t?t:OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=i:(this.icon.url=i.url,this.icon.size=i.size,this.icon.offset=i.offset,this.icon.calculateOffset=i.calculateOffset),this.events=new OpenLayers.Events(this,this.icon.imageDiv,null)},destroy:function(){this.erase(),this.map=null,this.events.destroy(),this.events=null,null!=this.icon&&(this.icon.destroy(),this.icon=null)},draw:function(e){return this.icon.draw(e)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(e){null!=e&&null!=this.icon&&this.icon.moveTo(e),this.lonlat=this.map.getLonLatFromLayerPx(e)},isDrawn:function(){var e=this.icon&&this.icon.isDrawn();return e},onScreen:function(){var e=!1;if(this.map){var t=this.map.getExtent();e=t.containsLonLat(this.lonlat)}return e},inflate:function(e){if(this.icon){var t=new OpenLayers.Size(this.icon.size.w*e,this.icon.size.h*e);this.icon.setSize(t)}},setOpacity:function(e){this.icon.setOpacity(e)},setUrl:function(e){this.icon.setUrl(e)},display:function(e){this.icon.display(e)},CLASS_NAME:"OpenLayers.Marker"}),OpenLayers.Marker.defaultIcon=function(){var e=OpenLayers.Util.getImagesLocation()+"marker.png",t=new OpenLayers.Size(21,25),i=function(e){return new OpenLayers.Pixel(-(e.w/2),-e.h)};return new OpenLayers.Icon(e,t,null,i)},OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(e,t,i){t=t?t:"FeatureCollection";var s=null,a=null;if(a="string"==typeof e?OpenLayers.Format.JSON.prototype.read.apply(this,[e,i]):e){if("string"!=typeof a.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+e);else if(this.isValidType(a,t))switch(t){case"Geometry":try{s=this.parseGeometry(a)}catch(r){OpenLayers.Console.error(r)}break;case"Feature":try{s=this.parseFeature(a),s.type="Feature"}catch(r){OpenLayers.Console.error(r)}break;case"FeatureCollection":switch(s=[],a.type){case"Feature":try{s.push(this.parseFeature(a))}catch(r){s=null,OpenLayers.Console.error(r)}break;case"FeatureCollection":for(var n=0,o=a.features.length;o>n;++n)try{s.push(this.parseFeature(a.features[n]))}catch(r){s=null,OpenLayers.Console.error(r)}break;default:try{var l=this.parseGeometry(a);s.push(new OpenLayers.Feature.Vector(l))}catch(r){s=null,OpenLayers.Console.error(r)}}}}else OpenLayers.Console.error("Bad JSON: "+e);return s},isValidType:function(e,t){var i=!1;switch(t){case"Geometry":-1==OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],e.type)?OpenLayers.Console.error("Unsupported geometry type: "+e.type):i=!0;break;case"FeatureCollection":i=!0;break;default:e.type==t?i=!0:OpenLayers.Console.error("Cannot convert types from "+e.type+" to "+t)}return i},parseFeature:function(e){var t,i,s,a;s=e.properties?e.properties:{},a=e.geometry&&e.geometry.bbox||e.bbox;try{i=this.parseGeometry(e.geometry)}catch(r){throw r}return t=new OpenLayers.Feature.Vector(i,s),a&&(t.bounds=OpenLayers.Bounds.fromArray(a)),e.id&&(t.fid=e.id),t},parseGeometry:function(e){if(null==e)return null;var t,i=!1;if("GeometryCollection"==e.type){if(!OpenLayers.Util.isArray(e.geometries))throw"GeometryCollection must have geometries array: "+e;for(var s=e.geometries.length,a=Array(s),r=0;s>r;++r)a[r]=this.parseGeometry.apply(this,[e.geometries[r]]);t=new OpenLayers.Geometry.Collection(a),i=!0}else{if(!OpenLayers.Util.isArray(e.coordinates))throw"Geometry must have coordinates array: "+e;if(!this.parseCoords[e.type.toLowerCase()])throw"Unsupported geometry type: "+e.type;try{t=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(n){throw n}}return this.internalProjection&&this.externalProjection&&!i&&t.transform(this.externalProjection,this.internalProjection),t},parseCoords:{point:function(e){if(0==this.ignoreExtraDims&&2!=e.length)throw"Only 2D points are supported: "+e;return new OpenLayers.Geometry.Point(e[0],e[1])},multipoint:function(e){for(var t=[],i=null,s=0,a=e.length;a>s;++s){try{i=this.parseCoords.point.apply(this,[e[s]])}catch(r){throw r}t.push(i)}return new OpenLayers.Geometry.MultiPoint(t)},linestring:function(e){for(var t=[],i=null,s=0,a=e.length;a>s;++s){try{i=this.parseCoords.point.apply(this,[e[s]])}catch(r){throw r}t.push(i)}return new OpenLayers.Geometry.LineString(t)},multilinestring:function(e){for(var t=[],i=null,s=0,a=e.length;a>s;++s){try{i=this.parseCoords.linestring.apply(this,[e[s]])}catch(r){throw r}t.push(i)}return new OpenLayers.Geometry.MultiLineString(t)},polygon:function(e){for(var t,i,s=[],a=0,r=e.length;r>a;++a){try{i=this.parseCoords.linestring.apply(this,[e[a]])}catch(n){throw n}t=new OpenLayers.Geometry.LinearRing(i.components),s.push(t)}return new OpenLayers.Geometry.Polygon(s)},multipolygon:function(e){for(var t=[],i=null,s=0,a=e.length;a>s;++s){try{i=this.parseCoords.polygon.apply(this,[e[s]])}catch(r){throw r}t.push(i)}return new OpenLayers.Geometry.MultiPolygon(t)},box:function(e){if(2!=e.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(e[0][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[0][1])])])}},write:function(e,t){var i={type:null};if(OpenLayers.Util.isArray(e)){i.type="FeatureCollection";var s=e.length;i.features=Array(s);for(var a=0;s>a;++a){var r=e[a];if(!r instanceof OpenLayers.Feature.Vector){var n="FeatureCollection only supports collections of features: "+r;throw n}i.features[a]=this.extract.feature.apply(this,[r])}}else 0==e.CLASS_NAME.indexOf("OpenLayers.Geometry")?i=this.extract.geometry.apply(this,[e]):e instanceof OpenLayers.Feature.Vector&&(i=this.extract.feature.apply(this,[e]),e.layer&&e.layer.projection&&(i.crs=this.createCRSObject(e)));return OpenLayers.Format.JSON.prototype.write.apply(this,[i,t])},createCRSObject:function(e){var t=""+e.layer.projection,i={};if(t.match(/epsg:/i)){var s=parseInt(t.substring(t.indexOf(":")+1));i=4326==s?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+s}}}return i},extract:{feature:function(e){var t=this.extract.geometry.apply(this,[e.geometry]),i={type:"Feature",properties:e.attributes,geometry:t};return null!=e.fid&&(i.id=e.fid),i},geometry:function(e){if(null==e)return null;this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t,i=e.CLASS_NAME.split(".")[2],s=this.extract[i.toLowerCase()].apply(this,[e]);return t="Collection"==i?{type:"GeometryCollection",geometries:s}:{type:i,coordinates:s}},point:function(e){return[e.x,e.y]},multipoint:function(e){for(var t=[],i=0,s=e.components.length;s>i;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},linestring:function(e){for(var t=[],i=0,s=e.components.length;s>i;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},multilinestring:function(e){for(var t=[],i=0,s=e.components.length;s>i;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},polygon:function(e){for(var t=[],i=0,s=e.components.length;s>i;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},multipolygon:function(e){for(var t=[],i=0,s=e.components.length;s>i;++i)t.push(this.extract.polygon.apply(this,[e.components[i]]));return t},collection:function(e){for(var t=e.components.length,i=Array(t),s=0;t>s;++s)i[s]=this.extract.geometry.apply(this,[e.components[s]]);return i}},CLASS_NAME:"OpenLayers.Format.GeoJSON"}),OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this}),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this})),e},cacheFeatures:function(e){this.paging||(this.clearCache(),this.features=e.features,this.pageNext(e))},clearCache:function(){if(this.features)for(var e=0;this.features.length>e;++e)this.features[e].destroy();this.features=null,this.num=null},pageCount:function(){var e=this.features?this.features.length:0;return Math.ceil(e/this.length)},pageNum:function(){return this.num},pageLength:function(e){return e&&e>0&&(this.length=e),this.length},pageNext:function(e){var t=!1;if(this.features){null===this.num&&(this.num=-1);var i=(this.num+1)*this.length;t=this.page(i,e)}return t},pagePrevious:function(){var e=!1;if(this.features){null===this.num&&(this.num=this.pageCount());var t=(this.num-1)*this.length;e=this.page(t)}return e},page:function(e,t){var i=!1;if(this.features&&e>=0&&this.features.length>e){var s=Math.floor(e/this.length);if(s!=this.num){this.paging=!0;var a=this.features.slice(e,e+this.length);this.layer.removeFeatures(this.layer.features),this.num=s,t&&t.features?t.features=a:this.layer.addFeatures(a),this.paging=!1,i=!0}}return i},CLASS_NAME:"OpenLayers.Strategy.Paging"}),OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(e,t,i,s,a,r,n){var o=[e,t,i,s,r,n];OpenLayers.Popup.prototype.initialize.apply(this,o),this.anchor=null!=a?a:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null,this.relativePosition=null,OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition(),OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(e){var t=this.relativePosition;this.relativePosition=this.calculateRelativePosition(e);var i=this.calculateNewPx(e),s=Array(i);OpenLayers.Popup.prototype.moveTo.apply(this,s),this.relativePosition!=t&&this.updateRelativePosition()},setSize:function(){if(OpenLayers.Popup.prototype.setSize.apply(this,arguments),this.lonlat&&this.map){var e=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(e)}},calculateRelativePosition:function(e){var t=this.map.getLonLatFromLayerPx(e),i=this.map.getExtent(),s=i.determineQuadrant(t);return OpenLayers.Bounds.oppositeQuadrant(s)},updateRelativePosition:function(){},calculateNewPx:function(e){var t=e.offset(this.anchor.offset),i=this.size||this.contentSize,s="t"==this.relativePosition.charAt(0);t.y+=s?-i.h:this.anchor.size.h;var a="l"==this.relativePosition.charAt(1);return t.x+=a?-i.w:this.anchor.size.w,t},CLASS_NAME:"OpenLayers.Popup.Anchored"}),OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(e,t,i,s,a,r){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments),this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(){return this.relativePosition}),this.contentDiv.style.position="absolute",this.contentDiv.style.zIndex=1,r&&(this.closeDiv.style.zIndex=1),this.groupDiv.style.position="absolute",this.groupDiv.style.top="0px",this.groupDiv.style.left="0px",this.groupDiv.style.height="100%",this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null,this.imageSize=null,this.isAlphaImage=null,this.fixedRelativePosition=!1,this.positionBlocks=null;for(var e=0;this.blocks.length>e;e++){var t=this.blocks[e];t.image&&t.div.removeChild(t.image),t.image=null,t.div&&this.groupDiv.removeChild(t.div),t.div=null}this.blocks=null,OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(){},setBorder:function(){},setOpacity:function(){},setSize:function(){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments),this.updateBlocks()},updateRelativePosition:function(){if(this.padding=this.positionBlocks[this.relativePosition].padding,this.closeDiv){var e=this.getContentDivPadding();this.closeDiv.style.right=e.right+this.padding.right+"px",this.closeDiv.style.top=e.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(){var e=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return e=e.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var e=null;for(var t in this.positionBlocks){e=t;break}for(var i=this.positionBlocks[e],s=0;i.blocks.length>s;s++){var a={};this.blocks.push(a);var r=this.id+"_FrameDecorationDiv_"+s;a.div=OpenLayers.Util.createDiv(r,null,null,null,"absolute",null,"hidden",null);var n=this.id+"_FrameDecorationImg_"+s,o=this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;a.image=o(n,null,this.imageSize,this.imageSrc,"absolute",null,null,null),a.div.appendChild(a.image),this.groupDiv.appendChild(a.div)}},updateBlocks:function(){if(this.blocks||this.createBlocks(),this.size&&this.relativePosition){for(var e=this.positionBlocks[this.relativePosition],t=0;e.blocks.length>t;t++){var i=e.blocks[t],s=this.blocks[t],a=i.anchor.left,r=i.anchor.bottom,n=i.anchor.right,o=i.anchor.top,l=isNaN(i.size.w)?this.size.w-(n+a):i.size.w,h=isNaN(i.size.h)?this.size.h-(r+o):i.size.h;s.div.style.width=(0>l?0:l)+"px",s.div.style.height=(0>h?0:h)+"px",s.div.style.left=null!=a?a+"px":"",s.div.style.bottom=null!=r?r+"px":"",s.div.style.right=null!=n?n+"px":"",s.div.style.top=null!=o?o+"px":"",s.image.style.left=i.position.x+"px",s.image.style.top=i.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px",this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"}),OpenLayers.Lang.ar=OpenLayers.Util.applyDefaults({Permalink:"وصلة دائمة","Base Layer":"الطبقة الاساسية",readNotImplemented:"القراءة غير محققة.",writeNotImplemented:"الكتابة غير محققة",errorLoadingGML:"خطأ عند تحميل الملف جي ام ال ${url}","Scale = 1 : ${scaleDenom}":"النسبة = 1 : ${scaleDenom}",W:"غ",E:"شر",N:"شم",S:"ج"}),OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(e,t,i){(i&&i.sphericalMercator||this.sphericalMercator)&&(i=OpenLayers.Util.extend({maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),maxResolution:156543.03390625,numZoomLevels:19,units:"m",projection:"EPSG:900913"},i)),t=t||this.url,e=e||this.name;var s=[e,t,{},i];OpenLayers.Layer.Grid.prototype.initialize.apply(this,s)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){var t=this.getXYZ(e),i=this.url;if(OpenLayers.Util.isArray(i)){var s=""+t.x+t.y+t.z;i=this.selectUrl(s,i)}return OpenLayers.String.format(i,t)},getXYZ:function(e){var t=this.map.getResolution(),i=Math.round((e.left-this.maxExtent.left)/(t*this.tileSize.w)),s=Math.round((this.maxExtent.top-e.top)/(t*this.tileSize.h)),a=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,t):this.map.getZoom()+this.zoomOffset,r=Math.pow(2,a);return this.wrapDateLine&&(i=(i%r+r)%r),{x:i,y:s,z:a}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"}),OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:!0,url:"http://tile.openstreetmap.org/${z}/${x}/${y}.png",clone:function(e){return null==e&&(e=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},wrapDateLine:!0,CLASS_NAME:"OpenLayers.Layer.OSM"}),OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(e){OpenLayers.Handler.prototype.setMap.apply(this,arguments),this.dragHandler&&this.dragHandler.setMap(e)},startBox:function(){this.callback("start",[]),this.zoomBox=OpenLayers.Util.createDiv("zoomBox",new OpenLayers.Pixel(-9999,-9999)),this.zoomBox.className=this.boxDivClassName,this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.eventsDiv.appendChild(this.zoomBox),OpenLayers.Element.addClass(this.map.eventsDiv,"olDrawBox")},moveBox:function(e){var t=this.dragHandler.start.x,i=this.dragHandler.start.y,s=Math.abs(t-e.x),a=Math.abs(i-e.y),r=this.getBoxOffsets();this.zoomBox.style.width=s+r.width+1+"px",this.zoomBox.style.height=a+r.height+1+"px",this.zoomBox.style.left=(t>e.x?t-s-r.left:t-r.left)+"px",this.zoomBox.style.top=(i>e.y?i-a-r.top:i-r.top)+"px"},endBox:function(e){var t;if(Math.abs(this.dragHandler.start.x-e.x)>5||Math.abs(this.dragHandler.start.y-e.y)>5){var i=this.dragHandler.start,s=Math.min(i.y,e.y),a=Math.max(i.y,e.y),r=Math.min(i.x,e.x),n=Math.max(i.x,e.x);t=new OpenLayers.Bounds(r,a,n,s)}else t=this.dragHandler.start.clone();this.removeBox(),this.callback("done",[t])},removeBox:function(){this.map.eventsDiv.removeChild(this.zoomBox),this.zoomBox=null,this.boxOffsets=null,OpenLayers.Element.removeClass(this.map.eventsDiv,"olDrawBox")},activate:function(){return OpenLayers.Handler.prototype.activate.apply(this,arguments)?(this.dragHandler.activate(),!0):!1},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0):!1},getBoxOffsets:function(){if(!this.boxOffsets){var e=document.createElement("div");e.style.position="absolute",e.style.border="1px solid black",e.style.width="3px",document.body.appendChild(e);var t=3==e.clientWidth;document.body.removeChild(e);var i=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),s=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),a=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),r=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:i,right:s,top:a,bottom:r,width:t===!1?i+s:0,height:t===!1?a+r:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"}),OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,alwaysZoom:!1,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(e){if(e instanceof OpenLayers.Bounds){var t;if(this.out){var i=Math.abs(e.right-e.left),s=Math.abs(e.top-e.bottom),a=Math.min(this.map.size.h/s,this.map.size.w/i),r=this.map.getExtent(),n=this.map.getLonLatFromPixel(e.getCenterPixel()),o=n.lon-r.getWidth()/2*a,l=n.lon+r.getWidth()/2*a,h=n.lat-r.getHeight()/2*a,u=n.lat+r.getHeight()/2*a;t=new OpenLayers.Bounds(o,h,l,u)}else{var p=this.map.getLonLatFromPixel(new OpenLayers.Pixel(e.left,e.bottom)),c=this.map.getLonLatFromPixel(new OpenLayers.Pixel(e.right,e.top));t=new OpenLayers.Bounds(p.lon,p.lat,c.lon,c.lat)}var d=this.map.getZoom();this.map.zoomToExtent(t),d==this.map.getZoom()&&1==this.alwaysZoom&&this.map.zoomTo(d+(this.out?-1:1))}else this.out?this.map.setCenter(this.map.getLonLatFromPixel(e),this.map.getZoom()-1):this.map.setCenter(this.map.getLonLatFromPixel(e),this.map.getZoom()+1)},CLASS_NAME:"OpenLayers.Control.ZoomBox"}),OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:1,documentDrag:!1,kinetic:null,enableKinetic:!1,kineticInterval:10,draw:function(){if(this.enableKinetic){var e={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(e=OpenLayers.Util.extend(e,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(e)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(e){this.kinetic&&this.kinetic.update(e),this.panned=!0,this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var t=null;if(this.kinetic&&(t=this.kinetic.end(e)),this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!!t,animate:!1}),t){var i=this;this.kinetic.move(t,function(e,t,s){i.map.pan(e,t,{dragging:!s,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"}),OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,touch:!1,down:null,last:null,first:null,rightclickTimerId:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},touchstart:function(e){return this.touch||(this.unregisterMouseListeners(),this.touch=!0),this.down=this.getEventInfo(e),this.last=this.getEventInfo(e),!0},touchmove:function(e){return this.last=this.getEventInfo(e),!0},touchend:function(e){return this.down&&(e.xy=this.last.xy,e.lastTouches=this.last.touches,this.handleSingle(e),this.down=null),!0},unregisterMouseListeners:function(){this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,click:this.click,dblclick:this.dblclick,scope:this})},mousedown:function(e){return this.down=this.getEventInfo(e),this.last=this.getEventInfo(e),!0},mouseup:function(e){var t=!0;return this.checkModifiers(e)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(e)&&(t=this.rightclick(e)),t},rightclick:function(e){if(this.passesTolerance(e)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[e]),!this.stopDouble;var t=this["double"]?OpenLayers.Util.extend({},e):this.callback("rightclick",[e]),i=OpenLayers.Function.bind(this.delayedRightCall,this,t);this.rightclickTimerId=window.setTimeout(i,this.delay)}return!this.stopSingle},delayedRightCall:function(e){this.rightclickTimerId=null,e&&this.callback("rightclick",[e])},click:function(e){return this.last||(this.last=this.getEventInfo(e)),this.handleSingle(e),!this.stopSingle},dblclick:function(e){return this.handleDouble(e),!this.stopDouble},handleDouble:function(e){this["double"]&&this.passesDblclickTolerance(e)&&this.callback("dblclick",[e])},handleSingle:function(e){if(this.passesTolerance(e))if(null!=this.timerId)this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.stop(e),this.handleDouble(e)),this.last.touches&&2===this.last.touches.length||this.clearTimer();else{this.first=this.getEventInfo(e);var t=this.single?OpenLayers.Util.extend({},e):null;this.queuePotentialClick(t)}},queuePotentialClick:function(e){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)},passesTolerance:function(e){var t=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(t=this.pixelTolerance>=this.down.xy.distanceTo(e.xy),t&&this.touch&&this.down.touches.length===this.last.touches.length))for(var i=0,s=this.down.touches.length;s>i;++i)if(this.getTouchDistance(this.down.touches[i],this.last.touches[i])>this.pixelTolerance){t=!1;break}return t},getTouchDistance:function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2))},passesDblclickTolerance:function(){var e=!0;return this.down&&this.first&&(e=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),e},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(e){this.timerId=null,e&&this.callback("click",[e])},getEventInfo:function(e){var t;if(e.touches){var i=e.touches.length;t=Array(i);for(var s,a=0;i>a;a++)s=e.touches[a],t[a]={clientX:s.clientX,clientY:s.clientY}}return{xy:e.xy,touches:t}},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.down=null,this.first=null,this.last=null,this.touch=!1,e=!0),e},CLASS_NAME:"OpenLayers.Handler.Click"}),OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.dragPan.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.dragPan.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var e={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},t={"double":!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,e,t),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw(),this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions),OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(e){e.lastTouches&&2==e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){var t=this.map.getLonLatFromViewPortPx(e.xy);this.map.setCenter(t,this.map.zoom+1)},defaultDblRightClick:function(e){var t=this.map.getLonLatFromViewPortPx(e.xy);this.map.setCenter(t,this.map.zoom-1)},wheelChange:function(e,t){var i=this.map.getZoom(),s=this.map.getZoom()+Math.round(t);if(s=Math.max(s,0),s=Math.min(s,this.map.getNumZoomLevels()),s!==i){var a=this.map.getSize(),r=a.w/2-e.xy.x,n=e.xy.y-a.h/2,o=this.map.baseLayer.getResolutionForZoom(s),l=this.map.getLonLatFromPixel(e.xy),h=new OpenLayers.LonLat(l.lon+r*o,l.lat+n*o);this.map.setCenter(h,s)}},wheelUp:function(e,t){this.wheelChange(e,t||1)},wheelDown:function(e,t){this.wheelChange(e,t||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"}),OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,EVENT_TYPES:["featureadded"],multi:!1,featureAdded:function(){},handlerOptions:null,initialize:function(e,t,i){this.EVENT_TYPES=OpenLayers.Control.DrawFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES),OpenLayers.Control.prototype.initialize.apply(this,[i]),this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(e,t){this.layer.events.triggerEvent("sketchmodified",{vertex:e,feature:t})},create:function(e,t){this.layer.events.triggerEvent("sketchstarted",{vertex:e,feature:t})}},this.callbacks),this.layer=e,this.handlerOptions=this.handlerOptions||{},"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi);var s=this.layer.styleMap&&this.layer.styleMap.styles.temporary;s&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":s})})),this.handler=new t(this,this.callbacks,this.handlerOptions)},drawFeature:function(e){var t=new OpenLayers.Feature.Vector(e),i=this.layer.events.triggerEvent("sketchcomplete",{feature:t});i!==!1&&(t.state=OpenLayers.State.INSERT,this.layer.addFeatures([t]),this.featureAdded(t),this.events.triggerEvent("featureadded",{feature:t}))},insertXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertXY(e,t)},insertDeltaXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeltaXY(e,t)},insertDirectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDirectionLength(e,t)},insertDeflectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(e,t)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"}),OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,initialize:function(){OpenLayers.Handler.Path.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.map.getLonLatFromPixel(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry])),this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.polygon,this.point],{silent:!0})
},addPoint:function(){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var e,t,i=this.point.geometry,s=this.control.layer.features,a=s.length-1;a>=0;--a)if(e=s[a].geometry,(e instanceof OpenLayers.Geometry.Polygon||e instanceof OpenLayers.Geometry.MultiPolygon)&&e.intersects(i)){t=s[a],this.control.layer.removeFeatures([t],{silent:!0}),this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology),t.geometry.addComponent(this.line.geometry),this.polygon=t,this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(e){var t=e.vertex,i=this.line.geometry.components;if(!this.polygon.geometry.intersects(t)){var s=i[i.length-3];t.x=s.x,t.y=s.y}},finishGeometry:function(){var e=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[e]),this.removePoint(),this.finalize()},finalizeInteriorRing:function(){var e=this.line.geometry,t=0!==e.getArea();if(t){for(var i=this.polygon.geometry.components,s=i.length-2;s>=0;--s)if(e.intersects(i[s])){t=!1;break}if(t)e:for(var s=i.length-2;s>0;--s)for(var a=i[s].components,r=0,n=a.length;n>r;++r)if(e.containsPoint(a[r])){t=!1;break e}}return t?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(e),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(e){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology),this.layer.removeFeatures([this.polygon],{silent:!0}),this.control.layer.addFeatures([this.polygon],{silent:!0}),this.drawingHole=!1,e||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(e){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,e),this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var e=this.polygon&&this.polygon.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPolygon([e])),e},CLASS_NAME:"OpenLayers.Handler.Polygon"}),OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(e,t){OpenLayers.Control.Panel.prototype.initialize.apply(this,[t]),this.addControls([new OpenLayers.Control.Navigation]);var i=[new OpenLayers.Control.DrawFeature(e,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint"}),new OpenLayers.Control.DrawFeature(e,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath"}),new OpenLayers.Control.DrawFeature(e,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon"})];this.addControls(i)},draw:function(){var e=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),e},CLASS_NAME:"OpenLayers.Control.EditingToolbar"}),OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(e,t,i){this.rgb={r:e,g:t,b:i}},setRed:function(e){this.rgb.r=e},setGreen:function(e){this.rgb.g=e},setBlue:function(e){this.rgb.b=e},setHue:function(e){var t=this.asHSB();t.h=e,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,t.b)},setSaturation:function(e){var t=this.asHSB();t.s=e,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,t.b)},setBrightness:function(e){var t=this.asHSB();t.b=e,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,t.b)},darken:function(e){var t=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,Math.max(t.b-e,0))},brighten:function(e){var t=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,Math.min(t.b+e,1))},blend:function(e){this.rgb.r=Math.floor((this.rgb.r+e.rgb.r)/2),this.rgb.g=Math.floor((this.rgb.g+e.rgb.g)/2),this.rgb.b=Math.floor((this.rgb.b+e.rgb.b)/2)},isBright:function(){return this.asHSB(),this.asHSB().b>.5},isDark:function(){return!this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}}),OpenLayers.Rico.Color.createFromHex=function(e){if(4==e.length)for(var t=e,e="#",i=1;4>i;i++)e+=t.charAt(i)+t.charAt(i);0==e.indexOf("#")&&(e=e.substring(1));var s=e.substring(0,2),a=e.substring(2,4),r=e.substring(4,6);return new OpenLayers.Rico.Color(parseInt(s,16),parseInt(a,16),parseInt(r,16))},OpenLayers.Rico.Color.createColorFromBackground=function(e){var t=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(e),"backgroundColor");if("transparent"==t&&e.parentNode)return OpenLayers.Rico.Color.createColorFromBackground(e.parentNode);if(null==t)return new OpenLayers.Rico.Color(255,255,255);if(0==t.indexOf("rgb(")){var i=t.substring(4,t.length-1),s=i.split(",");return new OpenLayers.Rico.Color(parseInt(s[0]),parseInt(s[1]),parseInt(s[2]))}return 0==t.indexOf("#")?OpenLayers.Rico.Color.createFromHex(t):new OpenLayers.Rico.Color(255,255,255)},OpenLayers.Rico.Color.HSBtoRGB=function(e,t,i){var s=0,a=0,r=0;if(0==t)s=parseInt(255*i+.5),a=s,r=s;else{var n=6*(e-Math.floor(e)),o=n-Math.floor(n),l=i*(1-t),h=i*(1-t*o),u=i*(1-t*(1-o));switch(parseInt(n)){case 0:s=255*i+.5,a=255*u+.5,r=255*l+.5;break;case 1:s=255*h+.5,a=255*i+.5,r=255*l+.5;break;case 2:s=255*l+.5,a=255*i+.5,r=255*u+.5;break;case 3:s=255*l+.5,a=255*h+.5,r=255*i+.5;break;case 4:s=255*u+.5,a=255*l+.5,r=255*i+.5;break;case 5:s=255*i+.5,a=255*l+.5,r=255*h+.5}}return{r:parseInt(s),g:parseInt(a),b:parseInt(r)}},OpenLayers.Rico.Color.RGBtoHSB=function(e,t,i){var s,a,r,n=e>t?e:t;i>n&&(n=i);var o=t>e?e:t;if(o>i&&(o=i),r=n/255,a=0!=n?(n-o)/n:0,0==a)s=0;else{var l=(n-e)/(n-o),h=(n-t)/(n-o),u=(n-i)/(n-o);s=e==n?u-h:t==n?2+l-u:4+h-l,s/=6,0>s&&(s+=1)}return{h:s,s:a,b:r}},OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:!1,initialize:function(){this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE),OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments)},draw:function(){return OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments),this.setContentHTML(),this.setBackgroundColor(),this.setOpacity(),this.div},updateRelativePosition:function(){this.setRicoCorners()},setSize:function(){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments),this.setRicoCorners()},setBackgroundColor:function(e){void 0!=e&&(this.backgroundColor=e),null!=this.div&&null!=this.contentDiv&&(this.div.style.background="transparent",OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor))},setOpacity:function(e){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,e),null!=this.div&&null!=this.groupDiv&&OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity)},setBorder:function(){this.border=0},setRicoCorners:function(){var e=this.getCornersToRound(this.relativePosition),t={corners:e,color:this.backgroundColor,bgColor:"transparent",blend:!1};this.rounded?(OpenLayers.Rico.Corner.reRound(this.groupDiv,t),this.setBackgroundColor(),this.setOpacity()):(OpenLayers.Rico.Corner.round(this.div,t),this.rounded=!0)},getCornersToRound:function(){var e=["tl","tr","bl","br"],t=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);return OpenLayers.Util.removeItem(e,t),e.join(" ")},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"}),OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5,OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&(this.layer.events.on({moveend:this.update,scope:this}),this.layer.events.on({refresh:this.update,scope:this}),this.layer.visibility===!0&&this.layer.inRange===!0?this.update():this.layer.events.on({visibilitychanged:this.update,scope:this})),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),e},update:function(e){var t=this.getMapBounds();null!==t&&(e&&e.force||this.invalidBounds(t))&&(this.calculateBounds(t),this.resolution=this.layer.map.getResolution(),this.triggerRead(e))},getMapBounds:function(){if(null===this.layer.map)return null;var e=this.layer.map.getExtent();return e&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(e=e.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)),e},invalidBounds:function(e){e||(e=this.getMapBounds());var t=!this.bounds||!this.bounds.containsBounds(e);if(!t&&this.resFactor){var i=this.resolution/this.layer.map.getResolution();t=i>=this.resFactor||1/this.resFactor>=i}return t},calculateBounds:function(e){e||(e=this.getMapBounds());var t=e.getCenterLonLat(),i=e.getWidth()*this.ratio,s=e.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(t.lon-i/2,t.lat-s/2,t.lon+i/2,t.lat+s/2)},triggerRead:function(e){this.response&&(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend")),this.layer.events.triggerEvent("loadstart"),this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:this.createFilter(),callback:this.merge,scope:this},e))},createFilter:function(){var e=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});return this.layer.filter&&(e=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,e]})),e},merge:function(e){this.layer.destroyFeatures();var t=e.features;if(t&&t.length>0){var i=this.layer.projection,s=this.layer.map.getProjectionObject();if(!s.equals(i))for(var a,r=0,n=t.length;n>r;++r)a=t[r].geometry,a&&a.transform(i,s);this.layer.addFeatures(t)}this.response=null,this.layer.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.BBOX"}),OpenLayers.Lang.nn=OpenLayers.Util.applyDefaults({"Scale = 1 : ${scaleDenom}":"Skala = 1 : ${scaleDenom}",layerAlreadyAdded:"Du freista å leggja til laget «${layerName}» på kartet, men det har alt vorte lagt til.",boundsAddError:"Du er nøydd til å gje både ein x- og ein y-verdi til «add»-funksjonen.",lonlatAddError:"Du er nøydd til å gje både lon- og lat-verdiar til «add»-funksjonen.",pixelAddError:"Du er nøydd til å gje både ein x- og ein y-verdi til «add»-funksjonen."}),OpenLayers.Lang.fi=OpenLayers.Util.applyDefaults({Permalink:"Ikilinkki",Overlays:"Kerrokset","Base Layer":"Peruskerros",W:"L",E:"I",N:"P",S:"E"}),OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:!0,lzd:null,zoomLevels:null,initialize:function(e,t,i,s,a,r){this.lzd=i,this.zoomLevels=s;var n=[];n.push(e,t,a,r),OpenLayers.Layer.Grid.prototype.initialize.apply(this,n),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getZoom:function(){var e=this.map.getZoom();return this.map.getMaxExtent(),e-=Math.log(this.maxResolution/(this.lzd/512))/Math.log(2)},getURL:function(e){e=this.adjustBounds(e);var t=this.getZoom(),i=this.map.getMaxExtent(),s=this.lzd/Math.pow(2,this.getZoom()),a=Math.floor((e.left-i.left)/s),r=Math.floor((e.bottom-i.bottom)/s);return this.map.getResolution()<=this.lzd/512&&this.getZoom()<=this.zoomLevels?this.getFullRequestString({L:t,X:a,Y:r}):OpenLayers.Util.getImagesLocation()+"blank.gif"},CLASS_NAME:"OpenLayers.Layer.WorldWind"}),OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",Permalink:"Permalink",Overlays:"Overlays","Base Layer":"Base Layer",readNotImplemented:"Read not implemented.",writeNotImplemented:"Write not implemented.",noFID:"Can't update a feature for which there is no FID.",errorLoadingGML:"Error in loading GML file ${url}",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",componentShouldBe:"addFeatures : component should be an ${geomType}",getFeatureError:"getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.",minZoomLevelError:"The minZoomLevel property is only intended for use with the FixedZoomLevels-descendent layers. That this wfs layer checks for minZoomLevel is a relic of thepast. We cannot, however, remove it without possibly breaking OL based applications that may depend on it. Therefore we are deprecating it -- the minZoomLevel check below will be removed at 3.0. Please instead use min/max resolution setting as described here: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the Google Maps library script was either not included, or does not contain the correct API key for your site.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the ${layerLib} library script was not correctly included.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>","Scale = 1 : ${scaleDenom}":"Scale = 1 : ${scaleDenom}",W:"W",E:"E",N:"N",S:"S",Graticule:"Graticule",layerAlreadyAdded:"You tried to add the layer: ${layerName} to the map, but it has already been added",reprojectDeprecated:"You are using the 'reproject' option on the ${layerName} layer. This option is deprecated: its use was designed to support displaying data over commercial basemaps, but that functionality should now be achieved by using Spherical Mercator support. More information is available from http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. Please use ${newMethod} instead.",boundsAddError:"You must pass both x and y values to the add function.",lonlatAddError:"You must pass both lon and lat values to the add function.",pixelAddError:"You must pass both x and y values to the add function.",unsupportedGeometryType:"Unsupported geometry type: ${geomType}",filterEvaluateNotImplemented:"evaluate is not implemented for this filter type.",proxyNeeded:"You probably need to set OpenLayers.ProxyHost to access ${url}.See http://trac.osgeo.org/openlayers/wiki/FrequentlyAskedQuestions#ProxyHost",end:""},OpenLayers.Layer.Google.v3={DEFAULTS:{maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),sphericalMercator:!0,maxResolution:156543.03390625,units:"m",projection:"EPSG:900913"},animationEnabled:!0,loadMapObject:function(){this.type||(this.type=google.maps.MapTypeId.ROADMAP);var e,t=OpenLayers.Layer.Google.cache[this.map.id];if(t)e=t.mapObject,++t.count;else{var i=this.map.viewPortDiv,s=document.createElement("div");s.id=this.map.id+"_GMapContainer",s.style.position="absolute",s.style.width="100%",s.style.height="100%",i.appendChild(s);var a=this.map.getCenter();e=new google.maps.Map(s,{center:a?new google.maps.LatLng(a.lat,a.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1}),t={mapObject:e,count:1},OpenLayers.Layer.Google.cache[this.map.id]=t,this.repositionListener=google.maps.event.addListenerOnce(e,"center_changed",OpenLayers.Function.bind(this.repositionMapElements,this))}this.mapObject=e,this.setGMapVisibility(this.visibility)},repositionMapElements:function(){google.maps.event.trigger(this.mapObject,"resize");var e=this.mapObject.getDiv().firstChild;if(!e||3>e.childNodes.length)return this.repositionTimer=window.setTimeout(OpenLayers.Function.bind(this.repositionMapElements,this),250),!1;for(var t=OpenLayers.Layer.Google.cache[this.map.id],i=this.map.viewPortDiv;"none"==e.lastChild.style.display;)i.appendChild(e.lastChild);var s=e.lastChild;i.appendChild(s),s.style.zIndex="1100",s.style.bottom="",s.className="olLayerGoogleCopyright olLayerGoogleV3",s.style.display="",t.termsOfUse=s;var a=e.lastChild;i.appendChild(a),a.style.zIndex="1100",a.style.bottom="",a.className="olLayerGooglePoweredBy olLayerGoogleV3 gmnoprint",a.style.display="",t.poweredBy=a,this.setGMapVisibility(this.visibility)},onMapResize:function(){if(this.visibility)google.maps.event.trigger(this.mapObject,"resize");else{var e=OpenLayers.Layer.Google.cache[this.map.id];if(!e.resized){var t=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){google.maps.event.trigger(t.mapObject,"resize"),t.moveTo(t.map.getCenter(),t.map.getZoom()),delete e.resized})}e.resized=!0}},setGMapVisibility:function(e){var t=OpenLayers.Layer.Google.cache[this.map.id];if(t){for(var i,s=this.type,a=this.map.layers,r=a.length-1;r>=0;--r)if(i=a[r],i instanceof OpenLayers.Layer.Google&&i.visibility===!0&&i.inRange===!0){s=i.type,e=!0;break}var n=this.mapObject.getDiv();e===!0?(this.mapObject.setMapTypeId(s),n.style.left="",t.termsOfUse&&t.termsOfUse.style&&(t.termsOfUse.style.left="",t.termsOfUse.style.display="",t.poweredBy.style.display=""),t.displayed=this.id):(delete t.displayed,n.style.left="-9999px",t.termsOfUse&&t.termsOfUse.style&&(t.termsOfUse.style.display="none",t.termsOfUse.style.left="-9999px",t.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(e){var t=null;if(null!=e){var i=this.sphericalMercator?this.inverseMercator(e.bottom,e.left):new OpenLayers.LonLat(e.bottom,e.left),s=this.sphericalMercator?this.inverseMercator(e.top,e.right):new OpenLayers.LonLat(e.top,e.right);t=new google.maps.LatLngBounds(new google.maps.LatLng(i.lat,i.lon),new google.maps.LatLng(s.lat,s.lon))}return t},getMapObjectLonLatFromMapObjectPixel:function(e){var t=this.map.getSize(),i=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),s=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),a=this.map.getResolution(),r=e.x-t.w/2,n=e.y-t.h/2,o=new OpenLayers.LonLat(i+r*a,s-n*a);return this.wrapDateLine&&(o=o.wrapDateLine(this.maxExtent)),this.getMapObjectLonLatFromLonLat(o.lon,o.lat)},getMapObjectPixelFromMapObjectLonLat:function(e){var t=this.getLongitudeFromMapObjectLonLat(e),i=this.getLatitudeFromMapObjectLonLat(e),s=this.map.getResolution(),a=this.map.getExtent(),r=new OpenLayers.Pixel(1/s*(t-a.left),1/s*(a.top-i));return this.getMapObjectPixelFromXY(r.x,r.y)},setMapObjectCenter:function(e,t){if(this.animationEnabled===!1&&t!=this.mapObject.zoom){var i=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){i.style.visibility=""}),i.style.visibility="hidden"}this.mapObject.setOptions({center:e,zoom:t})},getMapObjectZoomFromMapObjectBounds:function(e){return this.mapObject.getBoundsZoomLevel(e)},getMapObjectLonLatFromLonLat:function(e,t){var i;if(this.sphericalMercator){var s=this.inverseMercator(e,t);i=new google.maps.LatLng(s.lat,s.lon)}else i=new google.maps.LatLng(t,e);return i},getMapObjectPixelFromXY:function(e,t){return new google.maps.Point(e,t)},destroy:function(){this.repositionListener&&google.maps.event.removeListener(this.repositionListener),this.repositionTimer&&window.clearTimeout(this.repositionTimer),OpenLayers.Layer.Google.prototype.destroy.apply(this,arguments)}},OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{wps:{ProcessDescriptions:function(e,t){t.processDescriptions={},this.readChildNodes(e,t.processDescriptions)},ProcessDescription:function(e,t){var i=this.getAttributeNS(e,this.namespaces.wps,"processVersion"),s={processVersion:i,statusSupported:"true"===e.getAttribute("statusSupported"),storeSupported:"true"===e.getAttribute("storeSupported")};this.readChildNodes(e,s),t[s.identifier]=s},DataInputs:function(e,t){t.dataInputs=[],this.readChildNodes(e,t.dataInputs)},ProcessOutputs:function(e,t){t.processOutputs=[],this.readChildNodes(e,t.processOutputs)},Output:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)},ComplexOutput:function(e,t){t.complexOutput={},this.readChildNodes(e,t.complexOutput)},Input:function(e,t){var i={maxOccurs:parseInt(e.getAttribute("maxOccurs")),minOccurs:parseInt(e.getAttribute("minOccurs"))};this.readChildNodes(e,i),t.push(i)},BoundingBoxData:function(e,t){t.boundingBoxData={},this.readChildNodes(e,t.boundingBoxData)},CRS:function(e,t){t.CRSs||(t.CRSs={}),t.CRSs[this.getChildValue(e)]=!0},LiteralData:function(e,t){t.literalData={},this.readChildNodes(e,t.literalData)},ComplexData:function(e,t){t.complexData={},this.readChildNodes(e,t.complexData)},Default:function(e,t){t["default"]={},this.readChildNodes(e,t["default"])},Supported:function(e,t){t.supported={},this.readChildNodes(e,t.supported)},Format:function(e,t){var i={};this.readChildNodes(e,i),t.formats||(t.formats={}),t.formats[i.mimeType]=!0},MimeType:function(e,t){t.mimeType=this.getChildValue(e)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"}),OpenLayers.Lang.ru=OpenLayers.Util.applyDefaults({unhandledRequest:"Необработанный запрос вернул ${statusText}",Permalink:"Постоянная ссылка",Overlays:"Слои","Base Layer":"Основной слой",readNotImplemented:"Чтение не реализовано.",writeNotImplemented:"Запись не реализована.",noFID:"Невозможно обновить объект, для которого нет FID.",errorLoadingGML:"Ошибка при загрузке файла GML ${url}",browserNotSupported:"Ваш браузер не поддерживает векторную графику. На данный момент поддерживаются:\n${renderers}",componentShouldBe:"addFeatures: компонент должен быть ${geomType}",getFeatureError:"getFeatureFromEvent вызван для слоя без рендерера. Обычно это говорит о том, что вы уничтожили слой, но оставили связанный с ним обработчик.",minZoomLevelError:"Свойство minZoomLevel предназначено только для использования со слоями, являющимися потомками FixedZoomLevels. То, что этот WFS-слой проверяется на minZoomLevel — реликт прошлого. Однако мы не можем удалить эту функцию, так как, возможно, от неё зависят некоторые основанные на OpenLayers приложения. Функция объявлена устаревшей — проверка minZoomLevel будет удалена в 3.0. Пожалуйста, используйте вместо неё настройку мин/макс разрешения, описанную здесь: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Транзакция WFS: УСПЕШНО ${response}",commitFailed:"Транзакция WFS: ОШИБКА ${response}",googleWarning:"Слой Google не удалось нормально загрузить.<br><br>Чтобы избавиться от этого сообщения, выбите другой основной слой в переключателе в правом верхнем углу.<br><br>Скорее всего, причина в том, что библиотека Google Maps не была включена или не содержит корректного API-ключа для вашего сайта.<br><br>Разработчикам: чтобы узнать, как сделать, чтобы всё заработало, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>щёлкните тут</a>",getLayerWarning:"Слой ${layerType} не удалось нормально загрузить. <br><br>Чтобы избавиться от этого сообщения, выбите другой основной слой в переключателе в правом верхнем углу.<br><br>Скорее всего, причина в том, что библиотека ${layerLib} не была включена или была включена некорректно.<br><br>Разработчикам: чтобы узнать, как сделать, чтобы всё заработало, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>щёлкните тут</a>","Scale = 1 : ${scaleDenom}":"Масштаб = 1 : ${scaleDenom}",W:"З",E:"В",N:"С",S:"Ю",layerAlreadyAdded:"Вы попытались добавить слой «${layerName}» на карту, но он уже был добавлен",reprojectDeprecated:"Вы используете опцию 'reproject' для слоя ${layerName}. Эта опция является устаревшей: ее использование предполагалось для поддержки показа данных поверх коммерческих базовых карт, но теперь этот функционал несёт встроенная поддержка сферической проекции Меркатора. Больше сведений доступно на http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Этот метод считается устаревшим и будет удалён в версии 3.0. Пожалуйста, пользуйтесь ${newMethod}.",boundsAddError:"Функции add надо передавать оба значения, x и y.",lonlatAddError:"Функции add надо передавать оба значения, lon и lat.",pixelAddError:"Функции add надо передавать оба значения, x и y.",unsupportedGeometryType:"Неподдерживаемый тип геометрии: ${geomType}",filterEvaluateNotImplemented:"evaluate не реализовано для фильтра данного типа."}),OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{csw:{GetRecordsResponse:function(e,t){t.records=[],this.readChildNodes(e,t);var i=this.getAttributeNS(e,"","version");""!=i&&(t.version=i)},RequestId:function(e,t){t.RequestId=this.getChildValue(e)},SearchStatus:function(e,t){t.SearchStatus={};var i=this.getAttributeNS(e,"","timestamp");""!=i&&(t.SearchStatus.timestamp=i)},SearchResults:function(e,t){this.readChildNodes(e,t);for(var i=e.attributes,s={},a=0,r=i.length;r>a;++a)s[i[a].name]="numberOfRecordsMatched"==i[a].name||"numberOfRecordsReturned"==i[a].name||"nextRecord"==i[a].name?parseInt(i[a].nodeValue):i[a].nodeValue;t.SearchResults=s},SummaryRecord:function(e,t){var i={type:"SummaryRecord"};this.readChildNodes(e,i),t.records.push(i)},BriefRecord:function(e,t){var i={type:"BriefRecord"};this.readChildNodes(e,i),t.records.push(i)},DCMIRecord:function(e,t){var i={type:"DCMIRecord"};this.readChildNodes(e,i),t.records.push(i)},Record:function(e,t){var i={type:"Record"};this.readChildNodes(e,i),t.records.push(i)},"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();t[i]=this.getChildValue(e)}},geonet:{info:function(e,t){var i={};this.readChildNodes(e,i),t.gninfo=i}},dc:{"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();OpenLayers.Util.isArray(t[i])||(t[i]=Array());for(var s={},a=e.attributes,r=0,n=a.length;n>r;++r)s[a[r].name]=a[r].nodeValue;s.value=this.getChildValue(e),t[i].push(s)}},dct:{"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();OpenLayers.Util.isArray(t[i])||(t[i]=Array()),t[i].push(this.getChildValue(e))}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(e,t){t.bounds&&(t.BoundingBox=[{crs:t.projection,value:[t.bounds.left,t.bounds.bottom,t.bounds.right,t.bounds.top]}],delete t.projection,delete t.bounds),OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(e){var t=this.writeNode("csw:GetRecords",e);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},writers:{csw:{GetRecords:function(e){e||(e={});var t=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:e.requestId||this.requestId,resultType:e.resultType||this.resultType,outputFormat:e.outputFormat||this.outputFormat,outputSchema:e.outputSchema||this.outputSchema,startPosition:e.startPosition||this.startPosition,maxRecords:e.maxRecords||this.maxRecords}});(e.DistributedSearch||this.DistributedSearch)&&this.writeNode("csw:DistributedSearch",e.DistributedSearch||this.DistributedSearch,t);var i=e.ResponseHandler||this.ResponseHandler;if(OpenLayers.Util.isArray(i)&&i.length>0)for(var s=0,a=i.length;a>s;s++)this.writeNode("csw:ResponseHandler",i[s],t);return this.writeNode("Query",e.Query||this.Query,t),t},DistributedSearch:function(e){var t=this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:e.hopCount}});return t},ResponseHandler:function(e){var t=this.createElementNSPlus("csw:ResponseHandler",{value:e.value});return t},Query:function(e){e||(e={});var t=this.createElementNSPlus("csw:Query",{attributes:{typeNames:e.typeNames||"csw:Record"}}),i=e.ElementName;if(OpenLayers.Util.isArray(i)&&i.length>0)for(var s=0,a=i.length;a>s;s++)this.writeNode("csw:ElementName",i[s],t);else this.writeNode("csw:ElementSetName",e.ElementSetName||{value:"summary"},t);return e.Constraint&&this.writeNode("csw:Constraint",e.Constraint,t),e.SortBy&&this.writeNode("ogc:SortBy",e.SortBy,t),t},ElementName:function(e){var t=this.createElementNSPlus("csw:ElementName",{value:e.value});return t},ElementSetName:function(e){var t=this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:e.typeNames},value:e.value});return t},Constraint:function(e){var t=this.createElementNSPlus("csw:Constraint",{attributes:{version:e.version}});if(e.Filter){var i=new OpenLayers.Format.Filter({version:e.version});t.appendChild(i.write(e.Filter))}else if(e.CqlText){var s=this.createElementNSPlus("CqlText",{value:e.CqlText.value});t.appendChild(s)}return t}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"}),OpenLayers.Lang.hsb=OpenLayers.Util.applyDefaults({unhandledRequest:"Wotmołwa njewobdźěłaneho naprašowanja ${statusText}",Permalink:"Trajny wotkaz",Overlays:"Naworštowanja","Base Layer":"Zakładna runina",readNotImplemented:"Čitanje njeimplementowane.",writeNotImplemented:"Pisanje njeimplementowane.",noFID:"Funkcija, za kotruž FID njeje, njeda so aktualizować.",errorLoadingGML:"Zmylk při začitowanju dataje ${url}",browserNotSupported:"Twój wobhladowak wektorowe rysowanje njepodpěruje. Tuchwilu podpěrowane rysowaki su:\n${renderers}",componentShouldBe:"addFeatures: komponenta měła ${geomType} być",getFeatureError:"getFeatureFromEvent bu na woršće bjez rysowak zawołany. To zwjetša woznamjenja, zo sy worštu zničił, ale nic wobdźěłak, kotryž je z njej zwjazany.",minZoomLevelError:"Kajkosć minZoomLevel je jenož za wužiwanje z worštami myslena, kotrež wot FixedZoomLevels pochadźeja. Zo tuta woršta wfs za minZoomLevel přepruwuje, je relikt zańdźenosće. Njemóžemy wšak ju wotstronić, bjeztoho zo aplikacije, kotrež na OpenLayers bazěruja a snano tutu kajkosć wužiwaja, hižo njefunguja. Tohodla smy ju jako zestarjenu woznamjenili -- přepruwowanje za minZoomLevel budu so we wersiji 3.0 wotstronjeć. Prošu wužij město toho nastajenje min/max, kaž je tu wopisane: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS-Transakcija: WUSPĚŠNA ${response}",commitFailed:"WFS-Transakcija: NJEPORADŹENA ${response}",googleWarning:"Woršta Google njemóžeše so korektnje začitać.<br><br>Zo by tutu zdźělenku wotbył, wubjer nowy BaseLayer z wuběra worštow horjeka naprawo.<br><br>Najskerje so to stawa, dokelž skript biblioteki Google Maps pak njebu zapřijaty pak njewobsahuje korektny kluč API za twoje sydło.<br><br>Wuwiwarjo: Za pomoc ke korektnemu fungowanju worštow\n<a href='http://trac.openlayers.org/wiki/Google' target='_blank'>tu kliknyć</a>",getLayerWarning:"Woršta ${layerType} njemóžeše so korektnje začitać.<br><br>Zo by tutu zdźělenku wotbył, wubjer nowy BaseLayer z wuběra worštow horjeka naprawo.<br><br>Najskerje so to stawa, dokelž skript biblioteki ${layerLib} njebu korektnje zapřijaty.<br><br>Wuwiwarjo: Za pomoc ke korektnemu fungowanju worštow\n<a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>tu kliknyć</a>","Scale = 1 : ${scaleDenom}":"Měritko = 1 : ${scaleDenom}",W:"Z",E:"W",N:"S",S:"J",layerAlreadyAdded:"Sy spytał runinu ${layerName} karće dodać, ale je so hižo dodała",reprojectDeprecated:'Wužiwaš opciju "reproject" wořšty ${layerName}. Tuta opcija je zestarjena: jeje wužiwanje bě myslene, zo by zwobraznjenje datow nad komercielnymi bazowymi kartami podpěrało, ale funkcionalnosć měła so nětko z pomocu Sperical Mercator docpěć. Dalše informacije steja na http://trac.openlayers.org/wiki/SphericalMercator k dispoziciji.',methodDeprecated:"Tuta metoda je so njeschwaliła a budźe so w 3.0 wotstronjeć. Prošu wužij ${newMethod} město toho.",boundsAddError:'Dyrbiš hódnotu x kaž tež y funkciji "add" přepodać.',lonlatAddError:'Dyrbiš hódnotu lon kaž tež lat funkciji "add" přepodać.',pixelAddError:'Dyrbiš hódnotu x kaž tež y funkciji "add" přepodać.',unsupportedGeometryType:"Njepodpěrowany geometrijowy typ: ${geomType}",filterEvaluateNotImplemented:"wuhódnoćenje njeje za tutón filtrowy typ implementowany."}),OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(e,t,i){this.bounds=e,this.div=OpenLayers.Util.createDiv(),this.div.style.overflow="hidden",this.events=new OpenLayers.Events(this,this.div,null),this.setBorder(t,i)
},destroy:function(){this.bounds=null,this.div=null,OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(e,t){e||(e="red"),t||(t=2),this.div.style.border=t+"px solid "+e},draw:function(e,t){return OpenLayers.Util.modifyDOMElement(this.div,null,e,t),this.div},onScreen:function(){var e=!1;if(this.map){var t=this.map.getExtent();e=t.containsBounds(this.bounds,!0,!0)}return e},display:function(e){this.div.style.display=e?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"}),OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:!0,initialize:function(e){e=e||{},e.extractStyles!==!1&&(e.defaultStyle={externalGraphic:OpenLayers.Util.getImagesLocation()+"marker.png",graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5}),OpenLayers.Format.prototype.initialize.apply(this,[e])},read:function(e){for(var t,i=e.split("\n"),s=[],a=0;i.length-1>a;a++){var r=i[a].replace(/^\s*/,"").replace(/\s*$/,"");if("#"!=r.charAt(0))if(t){for(var n=r.split("	"),o=new OpenLayers.Geometry.Point(0,0),l={},h=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null,u=!1,p=0;n.length>p;p++)if(n[p])if("point"==t[p]){var c=n[p].split(",");o.y=parseFloat(c[0]),o.x=parseFloat(c[1]),u=!0}else if("lat"==t[p])o.y=parseFloat(n[p]),u=!0;else if("lon"==t[p])o.x=parseFloat(n[p]),u=!0;else if("title"==t[p])l.title=n[p];else if("image"==t[p]||"icon"==t[p]&&h)h.externalGraphic=n[p];else if("iconSize"==t[p]&&h){var d=n[p].split(",");h.graphicWidth=parseFloat(d[0]),h.graphicHeight=parseFloat(d[1])}else if("iconOffset"==t[p]&&h){var m=n[p].split(",");h.graphicXOffset=parseFloat(m[0]),h.graphicYOffset=parseFloat(m[1])}else"description"==t[p]?l.description=n[p]:"overflow"==t[p]?l.overflow=n[p]:l[t[p]]=n[p];if(u){this.internalProjection&&this.externalProjection&&o.transform(this.externalProjection,this.internalProjection);var y=new OpenLayers.Feature.Vector(o,l,h);s.push(y)}}else t=r.split("	")}return s},CLASS_NAME:"OpenLayers.Format.Text"}),OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments),this.features=Array()},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadText:function(){if(!this.loaded&&null!=this.location){var e=function(){this.events.triggerEvent("loadend")};this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:e,scope:this}),this.loaded=!0}},moveTo:function(){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadText()},parseData:function(e){var t=e.responseText,i={};OpenLayers.Util.extend(i,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(i.externalProjection=this.projection,i.internalProjection=this.map.getProjectionObject());for(var s=new OpenLayers.Format.Text(i),a=s.read(t),r=0,n=a.length;n>r;r++){var o,l,h,u={},p=a[r];o=new OpenLayers.LonLat(p.geometry.x,p.geometry.y),p.style.graphicWidth&&p.style.graphicHeight&&(l=new OpenLayers.Size(p.style.graphicWidth,p.style.graphicHeight)),void 0!==p.style.graphicXOffset&&void 0!==p.style.graphicYOffset&&(h=new OpenLayers.Pixel(p.style.graphicXOffset,p.style.graphicYOffset)),null!=p.style.externalGraphic?u.icon=new OpenLayers.Icon(p.style.externalGraphic,l,h):(u.icon=OpenLayers.Marker.defaultIcon(),null!=l&&u.icon.setSize(l)),null!=p.attributes.title&&null!=p.attributes.description&&(u.popupContentHTML="<h2>"+p.attributes.title+"</h2>"+"<p>"+p.attributes.description+"</p>"),u.overflow=p.attributes.overflow||"auto";var c=new OpenLayers.Feature(this,o,u);this.features.push(c);var d=c.createMarker();null!=p.attributes.title&&null!=p.attributes.description&&d.events.register("click",c,this.markerClick),this.addMarker(d)}this.events.triggerEvent("loadend")},markerClick:function(e){var t=this==this.layer.selectedFeature;this.layer.selectedFeature=t?null:this;for(var i=0,s=this.layer.map.popups.length;s>i;i++)this.layer.map.removePopup(this.layer.map.popups[i]);t||this.layer.map.addPopup(this.createPopup()),OpenLayers.Event.stop(e)},clearFeatures:function(){if(null!=this.features)for(;this.features.length>0;){var e=this.features[0];OpenLayers.Util.removeItem(this.features,e),e.destroy()}},CLASS_NAME:"OpenLayers.Layer.Text"}),OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.Drag.prototype.initialize.apply(this,[e,t,i]),this.options=i?i:{}},setOptions:function(e){OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e)},activate:function(){var e=!1;if(OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)){var t=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,t),this.map.addLayer(this.layer),e=!0}return e},deactivate:function(){var e=!1;return OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.layer=null,this.feature=null,e=!0),e},down:function(e){this.fixedRadius=!!this.radius;var t=this.map.getLonLatFromPixel(e.xy);this.origin=new OpenLayers.Geometry.Point(t.lon,t.lat),(!this.fixedRadius||this.irregular)&&(this.radius=this.map.getResolution()),this.persist&&this.clear(),this.feature=new OpenLayers.Feature.Vector,this.createGeometry(),this.callback("create",[this.origin,this.feature]),this.layer.addFeatures([this.feature],{silent:!0}),this.layer.drawFeature(this.feature,this.style)},move:function(e){var t=this.map.getLonLatFromPixel(e.xy),i=new OpenLayers.Geometry.Point(t.lon,t.lat);if(this.irregular){var s=Math.sqrt(2)*Math.abs(i.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,s)}else this.fixedRadius?this.origin=i:(this.calculateAngle(i,e),this.radius=Math.max(this.map.getResolution()/2,i.distanceTo(this.origin)));if(this.modifyGeometry(),this.irregular){var a,r=i.x-this.origin.x,n=i.y-this.origin.y;a=0==n?r/(this.radius*Math.sqrt(2)):r/n,this.feature.geometry.resize(1,this.origin,a),this.feature.geometry.move(r/2,n/2)}this.layer.drawFeature(this.feature,this.style)},up:function(e){this.finalize(),this.start==this.last&&this.callback("done",[e.xy])},out:function(){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-.5),this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180)),this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var e,t,i=this.feature.geometry.components[0];i.components.length!=this.sides+1&&(this.createGeometry(),i=this.feature.geometry.components[0]);for(var s=0;this.sides>s;++s)t=i.components[s],e=this.angle+2*s*Math.PI/this.sides,t.x=this.origin.x+this.radius*Math.cos(e),t.y=this.origin.y+this.radius*Math.sin(e),t.clearBounds()},calculateAngle:function(e,t){var i=Math.atan2(e.y-this.origin.y,e.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!t[this.snapToggle]){var s=Math.PI/180*this.snapAngle;this.angle=Math.round(i/s)*s}else this.angle=i},cancel:function(){this.callback("cancel",null),this.finalize()},finalize:function(){this.origin=null,this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(e){this.callbacks[e]&&this.callbacks[e].apply(this.control,[this.feature.geometry.clone()]),this.persist||"done"!=e&&"cancel"!=e||this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"}),OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["selected"],clearOnDeactivate:!1,layers:null,callbacks:null,selectionSymbolizer:{Polygon:{fillColor:"#FF0000",stroke:!1},Line:{strokeColor:"#FF0000",strokeWidth:2},Point:{graphicName:"square",fillColor:"#FF0000",pointRadius:5}},layerOptions:null,handlerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(e,t){this.EVENT_TYPES=OpenLayers.Control.SLDSelect.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES),OpenLayers.Control.prototype.initialize.apply(this,[t]),this.callbacks=OpenLayers.Util.extend({done:this.select,click:this.select},this.callbacks),this.handlerOptions=this.handlerOptions||{},this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:!1,tileOptions:{maxGetUrlLength:2048}}),this.sketchStyle&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":this.sketchStyle})})),this.handler=new e(this,this.callbacks,this.handlerOptions)},destroy:function(){for(var e in this.layerCache)delete this.layerCache[e];for(var e in this.wfsCache)delete this.wfsCache[e];OpenLayers.Control.prototype.destroy.apply(this,arguments)},coupleLayerVisiblity:function(e){this.setVisibility(e.object.getVisibility())},createSelectionLayer:function(e){var t;return this.layerCache[e.id]?t=this.layerCache[e.id]:(t=new OpenLayers.Layer.WMS(e.name,e.url,e.params,OpenLayers.Util.applyDefaults(this.layerOptions,e.getOptions())),this.layerCache[e.id]=t,this.layerOptions.displayInLayerSwitcher===!1&&e.events.on({visibilitychanged:this.coupleLayerVisiblity,scope:t}),this.map.addLayer(t)),t},createSLD:function(e,t,i){for(var s={version:"1.0.0",namedLayers:{}},a=[e.params.LAYERS].join(",").split(","),r=0,n=a.length;n>r;r++){var o=a[r];s.namedLayers[o]={name:o,userStyles:[]};var l=this.selectionSymbolizer,h=i[r];h.type.indexOf("Polygon")>=0?l={Polygon:this.selectionSymbolizer.Polygon}:h.type.indexOf("LineString")>=0?l={Line:this.selectionSymbolizer.Line}:h.type.indexOf("Point")>=0&&(l={Point:this.selectionSymbolizer.Point});var u=t[r];s.namedLayers[o].userStyles.push({name:"default",rules:[new OpenLayers.Rule({symbolizer:l,filter:u,maxScaleDenominator:e.options.minScale})]})}return new OpenLayers.Format.SLD({srsName:this.map.getProjection()}).write(s)},parseDescribeLayer:function(e){var t=new OpenLayers.Format.WMSDescribeLayer,i=e.responseXML;i&&i.documentElement||(i=e.responseText);for(var s=t.read(i),a=[],r=null,n=0,o=s.length;o>n;n++)"WFS"==s[n].owsType&&(a.push(s[n].typeName),r=s[n].owsURL);var l={url:r,params:{SERVICE:"WFS",TYPENAME:""+a,REQUEST:"DescribeFeatureType",VERSION:"1.0.0"},callback:function(e){var t=new OpenLayers.Format.WFSDescribeFeatureType,i=e.responseXML;i&&i.documentElement||(i=e.responseText);var s=t.read(i);this.control.wfsCache[this.layer.id]=s,this.control._queue&&this.control.applySelection()},scope:this};OpenLayers.Request.GET(l)},getGeometryAttributes:function(e){for(var t=[],i=this.wfsCache[e.id],s=0,a=i.featureTypes.length;a>s;s++)for(var r=i.featureTypes[s],n=r.properties,o=0,l=n.length;l>o;o++){var h=n[o],u=h.type;(u.indexOf("LineString")>=0||u.indexOf("GeometryAssociationType")>=0||u.indexOf("GeometryPropertyType")>=0||u.indexOf("Point")>=0||u.indexOf("Polygon")>=0)&&t.push(h)}return t},activate:function(){var e=OpenLayers.Control.prototype.activate.call(this);if(e)for(var t=0,i=this.layers.length;i>t;t++){var s=this.layers[t];if(s&&!this.wfsCache[s.id]){var a={url:s.url,params:{SERVICE:"WMS",VERSION:s.params.VERSION,LAYERS:s.params.LAYERS,REQUEST:"DescribeLayer"},callback:this.parseDescribeLayer,scope:{layer:s,control:this}};OpenLayers.Request.GET(a)}}return e},deactivate:function(){var e=OpenLayers.Control.prototype.deactivate.call(this);if(e)for(var t=0,i=this.layers.length;i>t;t++){var s=this.layers[t];if(s&&this.clearOnDeactivate===!0){var a=this.layerCache,r=a[s.id];r&&(s.events.un({visibilitychanged:this.coupleLayerVisiblity,scope:r}),r.destroy(),delete a[s.id])}}return e},setLayers:function(e){this.active?(this.deactivate(),this.layers=e,this.activate()):this.layers=e},createFilter:function(e,t){var i=null;return this.handler instanceof OpenLayers.Handler.RegularPolygon?i=this.handler.irregular===!0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:e.name,value:t.getBounds()}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:t}):this.handler instanceof OpenLayers.Handler.Polygon?i=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:t}):this.handler instanceof OpenLayers.Handler.Path?i=e.type.indexOf("Point")>=0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:e.name,distance:.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:t}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:t}):this.handler instanceof OpenLayers.Handler.Click&&(i=e.type.indexOf("Polygon")>=0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:t}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:e.name,distance:.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:t})),i},select:function(e){this._queue=function(){for(var t=0,i=this.layers.length;i>t;t++){for(var s=this.layers[t],a=this.getGeometryAttributes(s),r=[],n=0,o=a.length;o>n;n++){var l=a[n];if(null!==l){if(!(e instanceof OpenLayers.Geometry)){var h=this.map.getLonLatFromPixel(e.xy);e=new OpenLayers.Geometry.Point(h.lon,h.lat)}var u=this.createFilter(l,e);null!==u&&r.push(u)}}var p=this.createSelectionLayer(s),c=this.createSLD(s,r,a);this.events.triggerEvent("selected",{layer:s,filters:r}),p.mergeNewParams({SLD_BODY:c}),delete this._queue}},this.applySelection()},applySelection:function(){for(var e=!0,t=0,i=this.layers.length;i>t;t++)if(!this.wfsCache[this.layers[t].id]){e=!1;break}e&&this._queue.call(this)},CLASS_NAME:"OpenLayers.Control.SLDSelect"}),OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.element=OpenLayers.Util.getElement(e)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.element=document.createElement("div"),this.div.appendChild(this.element)),this.map.events.register("moveend",this,this.updateScale),this.updateScale(),this.div},updateScale:function(){var e;if(this.geodesic===!0){var t=this.map.getUnits();if(!t)return;var i=OpenLayers.INCHES_PER_UNIT;e=(this.map.getGeodesicPixelSize().w||1e-6)*i.km*OpenLayers.DOTS_PER_INCH}else e=this.map.getScale();e&&(e=e>=9500&&95e4>=e?Math.round(e/1e3)+"K":e>=95e4?Math.round(e/1e6)+"M":Math.round(e),this.element.innerHTML=OpenLayers.i18n("Scale = 1 : ${scaleDenom}",{scaleDenom:e}))},CLASS_NAME:"OpenLayers.Control.Scale"}),OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,useHttpTile:!1,singleTile:!1,useOverlay:!1,useAsyncOverlay:!0,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,300),tileOriginCorner:"tl",initialize:function(e,t,i,s){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),(null==s||null==s.isBaseLayer)&&(this.isBaseLayer="true"!=this.transparent&&1!=this.transparent),s&&null!=s.useOverlay&&(this.useOverlay=s.useOverlay),this.singleTile?this.useOverlay?(OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS),this.useAsyncOverlay||(this.params.version="1.0.0")):OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS):(this.useHttpTile?OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS):OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS),this.setTileSize(this.defaultSize))},clone:function(e){return null==e&&(e=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){var t,i=e.getCenterLonLat(),s=this.map.getSize();if(this.singleTile){var a={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:s.h*this.ratio,setdisplaywidth:s.w*this.ratio,setviewcenterx:i.lon,setviewcentery:i.lat,setviewscale:this.map.getScale()};if(this.useOverlay&&!this.useAsyncOverlay){var r={};r=OpenLayers.Util.extend(r,a),r.operation="GETVISIBLEMAPEXTENT",r.version="1.0.0",r.session=this.params.session,r.mapName=this.params.mapName,r.format="text/xml",t=this.getFullRequestString(r),OpenLayers.Request.GET({url:t,async:!1})}t=this.getFullRequestString(a)}else{var n=this.map.getResolution(),o=Math.floor((e.left-this.maxExtent.left)/n);o=Math.round(o/this.tileSize.w);var l=Math.floor((this.maxExtent.top-e.top)/n);l=Math.round(l/this.tileSize.h),t=this.useHttpTile?this.getImageFilePath({tilecol:o,tilerow:l,scaleindex:this.resolutions.length-this.map.zoom-1}):this.getFullRequestString({tilecol:o,tilerow:l,scaleindex:this.resolutions.length-this.map.zoom-1})}return t},getFullRequestString:function(e,t){var i=null==t?this.url:t;"object"==typeof i&&(i=i[Math.floor(Math.random()*i.length)]);var s=i,a=OpenLayers.Util.extend({},this.params);a=OpenLayers.Util.extend(a,e);var r=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i));for(var n in a)n.toUpperCase()in r&&delete a[n];var o=OpenLayers.Util.getParameterString(a);if(o=o.replace(/,/g,"+"),""!=o){var l=i.charAt(i.length-1);s+="&"==l||"?"==l?o:-1==i.indexOf("?")?"?"+o:"&"+o}return s},getImageFilePath:function(e,t){var i=null==t?this.url:t;"object"==typeof i&&(i=i[Math.floor(Math.random()*i.length)]);var s=i,a="",r="";0>e.tilerow&&(a="-"),a+=0==e.tilerow?"0":Math.floor(Math.abs(e.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder,0>e.tilecol&&(r="-"),r+=0==e.tilecol?"0":Math.floor(Math.abs(e.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder;var n="/S"+Math.floor(e.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+a+"/C"+r+"/"+e.tilerow%this.params.tileRowsPerFolder+"_"+e.tilecol%this.params.tileColumnsPerFolder+"."+this.params.format;return this.params.querystring&&(n+="?"+this.params.querystring),s+=n},calculateGridLayout:function(e,t,i){var s=i*this.tileSize.w,a=i*this.tileSize.h,r=e.left-t.lon,n=Math.floor(r/s)-this.buffer,o=r/s-n,l=-o*this.tileSize.w,h=t.lon+n*s,u=t.lat-e.top+a,p=Math.floor(u/a)-this.buffer,c=p-u/a,d=c*this.tileSize.h,m=t.lat-a*p;return{tilelon:s,tilelat:a,tileoffsetlon:h,tileoffsetlat:m,tileoffsetx:l,tileoffsety:d}},CLASS_NAME:"OpenLayers.Layer.MapGuide"}),OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["measure","measurepartial"],handlerOptions:null,callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(e,t){this.EVENT_TYPES=OpenLayers.Control.Measure.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES),OpenLayers.Control.prototype.initialize.apply(this,[t]);var i={done:this.measureComplete,point:this.measurePartial};this.immediate&&(i.modify=this.measureImmediate),this.callbacks=OpenLayers.Util.extend(i,this.callbacks),this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions),this.handler=new e(this,this.callbacks,this.handlerOptions)},deactivate:function(){return this.cancelDelay(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay(),this.handler.cancel()},setImmediate:function(e){this.immediate=e,this.immediate?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(e,t){var i=this.active;i&&this.deactivate(),this.handler=new e(this,this.callbacks,t),i&&this.activate()},measureComplete:function(e){this.cancelDelay(),this.measure(e,"measure")},measurePartial:function(e,t){this.cancelDelay(),t=t.clone(),this.handler.freehandMode(this.handler.evt)?this.measure(t,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null,this.measure(t,"measurepartial")},this),this.partialDelay)},measureImmediate:function(e,t,i){i&&null===this.delayedTrigger&&!this.handler.freehandMode(this.handler.evt)&&this.measure(t.geometry,"measurepartial")},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(e,t){var i,s;e.CLASS_NAME.indexOf("LineString")>-1?(i=this.getBestLength(e),s=1):(i=this.getBestArea(e),s=2),this.events.triggerEvent(t,{measure:i[0],units:i[1],order:s,geometry:e})},getBestArea:function(e){for(var t,i,s=this.displaySystemUnits[this.displaySystem],a=0,r=s.length;r>a&&(t=s[a],i=this.getArea(e,t),!(i>1));++a);return[i,t]},getArea:function(e,t){var i,s;this.geodesic?(i=e.getGeodesicArea(this.map.getProjectionObject()),s="m"):(i=e.getArea(),s=this.map.getUnits());var a=OpenLayers.INCHES_PER_UNIT[t];if(a){var r=OpenLayers.INCHES_PER_UNIT[s];i*=Math.pow(r/a,2)}return i},getBestLength:function(e){for(var t,i,s=this.displaySystemUnits[this.displaySystem],a=0,r=s.length;r>a&&(t=s[a],i=this.getLength(e,t),!(i>1));++a);return[i,t]},getLength:function(e,t){var i,s;this.geodesic?(i=e.getGeodesicLength(this.map.getProjectionObject()),s="m"):(i=e.getLength(),s=this.map.getUnits());var a=OpenLayers.INCHES_PER_UNIT[t];if(a){var r=OpenLayers.INCHES_PER_UNIT[s];i*=r/a}return i},CLASS_NAME:"OpenLayers.Control.Measure"}),OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(e){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[e])},read_wmc_SRS:function(e,t){var i=this.getChildValue(t);"object"!=typeof e.projections&&(e.projections={});for(var s=i.split(/ +/),a=0,r=s.length;r>a;a++)e.projections[s[a]]=!0},write_wmc_Layer:function(e){var t=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[e]);if(e.srs){var i=[];for(var s in e.srs)i.push(s);t.appendChild(this.createElementDefaultNS("SRS",i.join(" ")))}t.appendChild(this.write_wmc_FormatList(e)),t.appendChild(this.write_wmc_StyleList(e)),e.dimensions&&t.appendChild(this.write_wmc_DimensionList(e)),t.appendChild(this.write_wmc_LayerExtension(e))},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"}),OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(e,t){var i,s={layer:!0,matrixSet:!0};for(var a in s)if(!(a in t))throw Error("Missing property '"+a+"' in layer configuration.");var r=e.contents,n=r.tileMatrixSets[t.matrixSet];r.layers;for(var o,l=0,h=r.layers.length;h>l;++l)if(r.layers[l].identifier===t.layer){o=r.layers[l];break}if(o&&n){for(var u,l=0,h=o.styles.length;h>l&&(u=o.styles[l],!u.isDefault);++l);i=new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(t,{url:e.operationsMetadata.GetTile.dcp.http.get,name:o.title,style:u.identifier,matrixIds:n.matrixIds}))}return i},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"}),OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.options=e;var t=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(t,this.yx)},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t.version=this.version,t},readers:{wmts:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={},t.contents.layers=[],t.contents.tileMatrixSets={},this.readChildNodes(e,t.contents)},Layer:function(e,t){var i={styles:[],formats:[],tileMatrixSetLinks:[]};i.layers=[],this.readChildNodes(e,i),t.layers.push(i)},Style:function(e,t){var i={};i.isDefault="true"===e.getAttribute("isDefault"),this.readChildNodes(e,i),t.styles.push(i)},Format:function(e,t){t.formats.push(this.getChildValue(e))},TileMatrixSetLink:function(e,t){var i={};this.readChildNodes(e,i),t.tileMatrixSetLinks.push(i)},TileMatrixSet:function(e,t){if(t.layers){var i={matrixIds:[]};this.readChildNodes(e,i),t.tileMatrixSets[i.identifier]=i}else t.tileMatrixSet=this.getChildValue(e)},TileMatrix:function(e,t){var i={supportedCRS:t.supportedCRS};this.readChildNodes(e,i),t.matrixIds.push(i)},ScaleDenominator:function(e,t){t.scaleDenominator=parseFloat(this.getChildValue(e))},TopLeftCorner:function(e,t){var i,s=this.getChildValue(e),a=s.split(" ");if(t.supportedCRS){var r=t.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");i=!!this.yx[r]}t.topLeftCorner=i?new OpenLayers.LonLat(a[1],a[0]):new OpenLayers.LonLat(a[0],a[1])},TileWidth:function(e,t){t.tileWidth=parseInt(this.getChildValue(e))},TileHeight:function(e,t){t.tileHeight=parseInt(this.getChildValue(e))},MatrixWidth:function(e,t){t.matrixWidth=parseInt(this.getChildValue(e))},MatrixHeight:function(e,t){t.matrixHeight=parseInt(this.getChildValue(e))},ResourceURL:function(e,t){t.resourceUrl=t.resourceUrl||{},t.resourceUrl[e.getAttribute("resourceType")]={format:e.getAttribute("format"),template:e.getAttribute("template")}},WSDL:function(e,t){t.wsdl={},t.wsdl.href=e.getAttribute("xlink:href")},ServiceMetadataURL:function(e,t){t.serviceMetadataUrl={},t.serviceMetadataUrl.href=e.getAttribute("xlink:href")}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"}),OpenLayers.Lang.hu=OpenLayers.Util.applyDefaults({unhandledRequest:"Nem kezelt kérés visszatérése ${statusText}",Permalink:"Permalink",Overlays:"Rávetítések","Base Layer":"Alapréteg",readNotImplemented:"Olvasás nincs végrehajtva.",writeNotImplemented:"Írás nincs végrehajtva.",noFID:"Nem frissíthető olyan jellemző, amely nem rendelkezik FID-del.",errorLoadingGML:"Hiba GML-fájl betöltésekor ${url}",browserNotSupported:"A böngészője nem támogatja a vektoros renderelést. A jelenleg támogatott renderelők:\n${renderers}",componentShouldBe:"addFeatures : az összetevőnek ilyen típusúnak kell lennie: ${geomType}",getFeatureError:"getFeatureFromEvent réteget hívott meg renderelő nélkül. Ez rendszerint azt jelenti, hogy megsemmisített egy fóliát, de néhány ahhoz társított kezelőt nem.",minZoomLevelError:"A minZoomLevel tulajdonságot csak a következővel való használatra szánták: FixedZoomLevels-leszármazott fóliák. Ez azt jelenti, hogy a minZoomLevel wfs fólia jelölőnégyzetei már a múlté. Mi azonban nem távolíthatjuk el annak a veszélye nélkül, hogy az esetlegesen ettől függő OL alapú alkalmazásokat tönkretennénk. Ezért ezt érvénytelenítjük -- a minZoomLevel az alul levő jelölőnégyzet a 3.0-s verzióból el lesz távolítva. Kérjük, helyette használja a  min/max felbontás beállítást, amelyről az alábbi helyen talál leírást: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS tranzakció: SIKERES ${response}",commitFailed:"WFS tranzakció: SIKERTELEN ${response}",googleWarning:"A Google fólia betöltése sikertelen.<br><br>Ahhoz, hogy ez az üzenet eltűnjön, válasszon egy új BaseLayer fóliát a jobb felső sarokban található fóliakapcsoló segítségével.<br><br>Nagy valószínűséggel ez azért van, mert a Google Maps könyvtár parancsfájlja nem található, vagy nem tartalmazza az Ön oldalához tartozó megfelelő API-kulcsot.<br><br>Fejlesztőknek: A helyes működtetésre vonatkozó segítség az alábbi helyen érhető el, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>kattintson ide</a>",getLayerWarning:"A(z) ${layerType} fólia nem töltődött be helyesen.<br><br>Ahhoz, hogy ez az üzenet eltűnjön, válasszon egy új BaseLayer fóliát a jobb felső sarokban található fóliakapcsoló segítségével.<br><br>Nagy valószínűséggel ez azért van, mert a(z) ${layerLib} könyvtár parancsfájlja helytelen.<br><br>Fejlesztőknek: A helyes működtetésre vonatkozó segítség az alábbi helyen érhető el, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>kattintson ide</a>","Scale = 1 : ${scaleDenom}":"Lépték = 1 : ${scaleDenom}",W:"Ny",E:"K",N:"É",S:"D",layerAlreadyAdded:"Megpróbálta hozzáadni a(z) ${layerName} fóliát a térképhez, de az már hozzá van adva",reprojectDeprecated:"Ön a 'reproject' beállítást használja a(z) ${layerName} fólián. Ez a beállítás érvénytelen: használata az üzleti alaptérképek fölötti adatok megjelenítésének támogatására szolgált, de ezt a funkció ezentúl a Gömbi Mercator használatával érhető el. További információ az alábbi helyen érhető el: http://trac.openlayers.org/wiki/SphericalMercator",methodDeprecated:"Ez a módszer érvénytelenítve lett és a 3.0-s verzióból el lesz távolítva. Használja a(z) ${newMethod} módszert helyette.",boundsAddError:"Az x és y értékeknek egyaránt meg kell felelnie, hogy a funkciót hozzáadhassa.",lonlatAddError:"A hossz. és szél. értékeknek egyaránt meg kell felelnie, hogy a funkciót hozzáadhassa.",pixelAddError:"Az x és y értékeknek egyaránt meg kell felelnie, hogy a funkciót hozzáadhassa.",unsupportedGeometryType:"Nem támogatott geometriatípus: ${geomType}",filterEvaluateNotImplemented:"ennél a szűrőtípusnál kiértékelés nem hajtódik végre."}),OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(){this.imageSrc=OpenLayers.Util.getImagesLocation()+"cloud-popup-relative.png",OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments),this.contentDiv.className=this.contentDisplayClass
},destroy:function(){OpenLayers.Popup.Framed.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Popup.FramedCloud"}),OpenLayers.Lang.pt=OpenLayers.Util.applyDefaults({unhandledRequest:"Servidor devolveu erro não contemplado ${statusText}",Permalink:"Ligação permanente",Overlays:"Sobreposições","Base Layer":"Camada Base",readNotImplemented:"Leitura não implementada.",writeNotImplemented:"Escrita não implementada.",noFID:"Não é possível atualizar um elemento para a qual não há FID.",errorLoadingGML:"Erro ao carregar ficheiro GML ${url}",browserNotSupported:"O seu navegador não suporta renderização vetorial. Actualmente os renderizadores suportados são:\n${renderers}",componentShouldBe:"addFeatures: componente deve ser um(a) ${geomType}",getFeatureError:"getFeatureFromEvent foi chamado numa camada sem renderizador. Isto normalmente significa que destruiu uma camada, mas não um manipulador ''(handler)'' que lhe está associado.",minZoomLevelError:"A propriedade minZoomLevel só deve ser usada com as camadas descendentes da FixedZoomLevels. A verificação da propriedade por esta camada wfs é uma relíquia do passado. No entanto, não podemos removê-la sem correr o risco de afectar aplicações OL que dependam dela. Portanto, estamos a torná-la obsoleta -- a verificação minZoomLevel será removida na versão 3.0. Em vez dela, por favor, use as opções de resolução min/max descritas aqui: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transacção WFS: SUCESSO ${response}",commitFailed:"Transacção WFS: FALHOU ${response}",googleWarning:"A Camada Google não foi correctamente carregada.<br><br>Para deixar de receber esta mensagem, seleccione uma nova Camada-Base no ''switcher'' de camadas no canto superior direito.<br><br>Provavelmente, isto acontece porque o ''script'' da biblioteca do Google Maps não foi incluído ou não contém a chave API correcta para o seu sítio.<br><br>Programadores: Para ajuda sobre como solucionar o problema <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>clique aqui</a> .",getLayerWarning:"A camada ${layerType} não foi correctamente carregada.<br><br>Para desactivar esta mensagem, seleccione uma nova Camada-Base no ''switcher'' de camadas no canto superior direito.<br><br>Provavelmente, isto acontece porque o ''script'' da biblioteca ${layerLib} não foi incluído correctamente.<br><br>Programadores: Para ajuda sobre como solucionar o problema <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>clique aqui</a> .","Scale = 1 : ${scaleDenom}":"Escala = 1 : ${scaleDenom}",W:"O",E:"E",N:"N",S:"S",layerAlreadyAdded:"Você tentou adicionar a camada: ${layerName} ao mapa, mas ela já tinha sido adicionada antes",reprojectDeprecated:"Está usando a opção 'reproject' na camada ${layerName}. Esta opção é obsoleta: foi concebida para permitir a apresentação de dados sobre mapas-base comerciais, mas esta funcionalidade é agora suportada pelo Mercator Esférico. Mais informação está disponível em http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Este método foi declarado obsoleto e será removido na versão 3.0. Por favor, use ${newMethod} em vez disso.",boundsAddError:"Você deve passar tanto o valor x como o y à função de adição.",lonlatAddError:"Você deve passar tanto o valor lon como o lat à função de adição.",pixelAddError:"Você deve passar tanto o valor x como o y à função de adição.",unsupportedGeometryType:"Tipo de geometria não suportado: ${geomType}",filterEvaluateNotImplemented:"avaliar não está implementado para este tipo de filtro."}),OpenLayers.Lang.vi=OpenLayers.Util.applyDefaults({unhandledRequest:"Không xử lý được phản hồi ${statusText} cho yêu cầu",Permalink:"Liên kết thường trực",Overlays:"Lấp bản đồ","Base Layer":"Lớp nền",readNotImplemented:"Chưa hỗ trợ chức năng đọc.",writeNotImplemented:"Chưa hỗ trợ chức năng viết.",noFID:"Không thể cập nhật tính năng thiếu FID.",errorLoadingGML:"Lỗi tải tập tin GML tại ${url}",browserNotSupported:"Trình duyệt của bạn không hỗ trợ chức năng vẽ bằng vectơ. Hiện hỗ trợ các bộ kết xuất:\n${renderers}",componentShouldBe:"addFeatures: bộ phận cần phải là ${geomType}",getFeatureError:"getFeatureFromEvent được gọi từ lớp không có bộ kết xuất. Thường thì có lẽ lớp bị xóa nhưng một phần xử lý của nó vẫn còn.",minZoomLevelError:"Chỉ nên sử dụng thuộc tính minZoomLevel với các lớp FixedZoomLevels-descendent. Việc lớp wfs này tìm cho minZoomLevel là di tích còn lại từ xưa. Tuy nhiên, nếu chúng tôi dời nó thì sẽ vỡ các chương trình OpenLayers mà dựa trên nó. Bởi vậy chúng tôi phản đối sử dụng nó&nbsp;– bước tìm cho minZoomLevel sẽ được dời vào phiên bản 3.0. Xin sử dụng thiết lập độ phân tích tối thiểu / tối đa thay thế, theo hướng dẫn này: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Giao dịch WFS: THÀNH CÔNG ${response}",commitFailed:"Giao dịch WFS: THẤT BẠI ${response}",googleWarning:"Không thể tải lớp Google đúng đắn.<br><br>Để tránh thông báo này lần sau, hãy chọn BaseLayer mới dùng điều khiển chọn lớp ở góc trên phải.<br><br>Chắc script thư viện Google Maps hoặc không được bao gồm hoặc không chứa khóa API hợp với website của bạn.<br><br><a href='http://trac.openlayers.org/wiki/Google' target='_blank'>Trợ giúp về tính năng này</a> cho người phát triển.",getLayerWarning:"Không thể tải lớp ${layerType} đúng đắn.<br><br>Để tránh thông báo này lần sau, hãy chọn BaseLayer mới dùng điều khiển chọn lớp ở góc trên phải.<br><br>Chắc script thư viện ${layerLib} không được bao gồm đúng kiểu.<br><br><a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>Trợ giúp về tính năng này</a> cho người phát triển.","Scale = 1 : ${scaleDenom}":"Tỷ lệ = 1 : ${scaleDenom}",W:"T",E:"Đ",N:"B",S:"N",layerAlreadyAdded:"Bạn muốn thêm lớp ${layerName} vào bản đồ, nhưng lớp này đã được thêm",reprojectDeprecated:"Bạn đang áp dụng chế độ “reproject” vào lớp ${layerName}. Chế độ này đã bị phản đối: nó có mục đích hỗ trợ lấp dữ liệu trên các nền bản đồ thương mại; nên thực hiện hiệu ứng đó dùng tính năng Mercator Hình cầu. Có sẵn thêm chi tiết tại http://trac.openlayers.org/wiki/SphericalMercator .",methodDeprecated:"Phương thức này đã bị phản đối và sẽ bị dời vào phiên bản 3.0. Xin hãy sử dụng ${newMethod} thay thế.",boundsAddError:"Cần phải cho cả giá trị x và y vào hàm add.",lonlatAddError:"Cần phải cho cả giá trị lon và lat vào hàm add.",pixelAddError:"Cần phải cho cả giá trị x và y vào hàm add.",unsupportedGeometryType:"Không hỗ trợ kiểu địa lý: ${geomType}",filterEvaluateNotImplemented:"chưa hỗ trợ evaluate cho loại bộ lọc này."}),OpenLayers.Lang.gl=OpenLayers.Util.applyDefaults({unhandledRequest:"Solicitude non xerada; a resposta foi: ${statusText}",Permalink:"Ligazón permanente",Overlays:"Capas superpostas","Base Layer":"Capa base",readNotImplemented:"Lectura non implementada.",writeNotImplemented:"Escritura non implementada.",noFID:"Non se pode actualizar a funcionalidade para a que non hai FID.",errorLoadingGML:"Erro ao cargar o ficheiro GML ${url}",browserNotSupported:"O seu navegador non soporta a renderización de vectores. Os renderizadores soportados actualmente son:\n${renderers}",componentShouldBe:"addFeatures: o compoñente debera ser de tipo ${geomType}",getFeatureError:"getFeatureFromEvent ten sido chamado a unha capa sen renderizador. Isto normalmente significa que destruíu unha capa, mais non o executador que está asociado con ela.",minZoomLevelError:"A propiedade minZoomLevel é só para uso conxuntamente coas capas FixedZoomLevels-descendent. O feito de que esa capa wfs verifique o minZoomLevel é unha reliquia do pasado. Non podemos, con todo, eliminala sen a posibilidade de non romper as aplicacións baseadas en OL que poidan depender dela. Por iso a estamos deixando obsoleta (a comprobación minZoomLevel de embaixo será eliminada na versión 3.0). Por favor, no canto diso use o axuste de resolución mín/máx tal e como está descrito aquí: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transacción WFS: ÉXITO ${response}",commitFailed:"Transacción WFS: FALLIDA ${response}",googleWarning:"A capa do Google non puido cargarse correctamente.<br><br>Para evitar esta mensaxe, escolla unha nova capa base no seleccionador de capas na marxe superior dereita.<br><br>Probablemente, isto acontece porque a escritura da libraría do Google Maps ou ben non foi incluída ou ben non contén a clave API correcta para o seu sitio.<br><br>Desenvolvedores: para axudar a facer funcionar isto correctamente, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>premede aquí</a>",getLayerWarning:"A capa ${layerType} foi incapaz de cargarse correctamente.<br><br>Para evitar esta mensaxe, escolla unha nova capa base no seleccionador de capas na marxe superior dereita.<br><br>Probablemente, isto acontece porque a escritura da libraría ${layerLib} non foi ben incluída.<br><br>Desenvolvedores: para axudar a facer funcionar isto correctamente, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>premede aquí</a>","Scale = 1 : ${scaleDenom}":"Escala = 1 : ${scaleDenom}",W:"O",E:"L",N:"N",S:"S",layerAlreadyAdded:"Intentou engadir a capa: ${layerName} ao mapa, pero xa fora engadida",reprojectDeprecated:'Está usando a opción "reproject" na capa ${layerName}. Esta opción está obsoleta: o seu uso foi deseñado para a visualización de datos sobre mapas base comerciais, pero esta funcionalidade debera agora ser obtida utilizando a proxección Spherical Mercator. Hai dispoñible máis información en http://trac.openlayers.org/wiki/SphericalMercator.',methodDeprecated:"Este método está obsoleto e será eliminado na versión 3.0. Por favor, no canto deste use ${newMethod}.",boundsAddError:"Debe achegar os valores x e y á función add.",lonlatAddError:"Debe achegar tanto o valor lon coma o lat á función add.",pixelAddError:"Debe achegar os valores x e y á función add.",unsupportedGeometryType:"Tipo xeométrico non soportado: ${geomType}",filterEvaluateNotImplemented:"avaliar non está implementado para este tipo de filtro."}),OpenLayers.Geometry.Rectangle=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,width:null,height:null,initialize:function(e,t,i,s){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=e,this.y=t,this.width=i,this.height=s},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x+this.width,this.y+this.height)},getLength:function(){var e=2*this.width+2*this.height;return e},getArea:function(){var e=this.width*this.height;return e},CLASS_NAME:"OpenLayers.Geometry.Rectangle"}),OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:!1,interval:0,timer:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&(this.layer.visibility===!0&&this.start(),this.layer.events.on({visibilitychanged:this.reset,scope:this})),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.stop(),e},reset:function(){this.layer.visibility===!0?this.start():this.stop()},start:function(){this.interval&&"number"==typeof this.interval&&this.interval>0&&(this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval))},refresh:function(){this.layer&&this.layer.refresh&&"function"==typeof this.layer.refresh&&this.layer.refresh({force:this.force})},stop:function(){null!==this.timer&&(window.clearInterval(this.timer),this.timer=null)},CLASS_NAME:"OpenLayers.Strategy.Refresh"}),OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,{namespaces:{ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.options=e},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{gml:OpenLayers.Util.applyDefaults({name:function(e,t){t.name=this.getChildValue(e)},TimePeriod:function(e,t){t.timePeriod={},this.readChildNodes(e,t.timePeriod)},beginPosition:function(e,t){t.beginPosition=this.getChildValue(e)},endPosition:function(e,t){t.endPosition=this.getChildValue(e)}},OpenLayers.Format.GML.v3.prototype.readers.gml),sos:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={},this.readChildNodes(e,t.contents)},ObservationOfferingList:function(e,t){t.offeringList={},this.readChildNodes(e,t.offeringList)},ObservationOffering:function(e,t){var i=this.getAttributeNS(e,this.namespaces.gml,"id");t[i]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]},this.readChildNodes(e,t[i])},time:function(e,t){t.time={},this.readChildNodes(e,t.time)},procedure:function(e,t){t.procedures.push(this.getAttributeNS(e,this.namespaces.xlink,"href"))},observedProperty:function(e,t){t.observedProperties.push(this.getAttributeNS(e,this.namespaces.xlink,"href"))},featureOfInterest:function(e,t){t.featureOfInterestIds.push(this.getAttributeNS(e,this.namespaces.xlink,"href"))},responseFormat:function(e,t){t.responseFormats.push(this.getChildValue(e))},resultModel:function(e,t){t.resultModels.push(this.getChildValue(e))},responseMode:function(e,t){t.responseModes.push(this.getChildValue(e))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.SOSCapabilities.v1_0_0"}),OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]),this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var e=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),e},CLASS_NAME:"OpenLayers.Control.NavToolbar"}),OpenLayers.Tile.WFS=OpenLayers.Class(OpenLayers.Tile,{features:null,url:null,request:null,initialize:function(e,t,i,s){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=s,this.features=[]},destroy:function(){OpenLayers.Tile.prototype.destroy.apply(this,arguments),this.destroyAllFeatures(),this.features=null,this.url=null,this.request&&(this.request.abort(),this.request=null)},clear:function(){this.destroyAllFeatures()},draw:function(){OpenLayers.Tile.prototype.draw.apply(this,arguments)&&(this.isLoading?this.events.triggerEvent("reload"):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.loadFeaturesForRegion(this.requestSuccess))},loadFeaturesForRegion:function(e,t){this.request&&this.request.abort(),this.request=OpenLayers.Request.GET({url:this.url,success:e,failure:t,scope:this})},requestSuccess:function(e){if(this.features){var t=e.responseXML;if(t&&t.documentElement||(t=e.responseText),this.layer.vectorMode)this.layer.addFeatures(this.layer.formatObject.read(t));else{var i=new OpenLayers.Format.XML;"string"==typeof t&&(t=i.read(t));var s=i.getElementsByTagNameNS(t,"http://www.opengis.net/gml","featureMember");this.addResults(s)}}this.events&&this.events.triggerEvent("loadend"),this.request=null},addResults:function(e){for(var t=0;e.length>t;t++){var i=new this.layer.featureClass(this.layer,e[t]);this.features.push(i)}},destroyAllFeatures:function(){for(;this.features.length>0;){var e=this.features.shift();e.destroy()}},CLASS_NAME:"OpenLayers.Tile.WFS"}),OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["locationupdated","locationfailed","locationuncapable"],geolocation:navigator.geolocation,bind:!0,watch:!1,geolocationOptions:null,initialize:function(e){this.EVENT_TYPES=OpenLayers.Control.Geolocate.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES),this.geolocationOptions={},OpenLayers.Control.prototype.initialize.apply(this,[e])},destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.geolocation?OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):!1:(this.events.triggerEvent("locationuncapable"),!1)},deactivate:function(){return this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(e){var t=new OpenLayers.LonLat(e.coords.longitude,e.coords.latitude).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&this.map.setCenter(t),this.events.triggerEvent("locationupdated",{position:e,point:new OpenLayers.Geometry.Point(t.lon,t.lat)})},getCurrentLocation:function(){return!this.active||this.watch?!1:(this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions),!0)},failure:function(e){this.events.triggerEvent("locationfailed",{error:e})},CLASS_NAME:"OpenLayers.Control.Geolocate"}),OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:!0,initialize:function(e,t,i,s){var a=[];i=OpenLayers.Util.upperCaseObject(i),a.push(e,t,i,s),OpenLayers.Layer.Grid.prototype.initialize.apply(this,a),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),this.params.TRANSPARENT&&"true"==(""+this.params.TRANSPARENT).toLowerCase()&&(null!=s&&s.isBaseLayer||(this.isBaseLayer=!1),"jpg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"))},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){e=this.adjustBounds(e);var t=this.projection.getCode().split(":"),i=t[t.length-1],s=this.getImageSize(),a={BBOX:e.toBBOX(),SIZE:s.w+","+s.h,F:"image",BBOXSR:i,IMAGESR:i};if(this.layerDefs){var r,n=[];for(r in this.layerDefs)this.layerDefs.hasOwnProperty(r)&&this.layerDefs[r]&&(n.push(r),n.push(":"),n.push(this.layerDefs[r]),n.push(";"));n.length>0&&(a.LAYERDEFS=n.join(""))}var o=this.getFullRequestString(a);return o},setLayerFilter:function(e,t){this.layerDefs||(this.layerDefs={}),t?this.layerDefs[e]=t:delete this.layerDefs[e]},clearLayerFilter:function(e){e?delete this.layerDefs[e]:delete this.layerDefs},mergeNewParams:function(e){var t=OpenLayers.Util.upperCaseObject(e),i=[t];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,i)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"}),OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(e,t,i,s){var a=[];a.push(e,t,i,s),OpenLayers.Layer.Grid.prototype.initialize.apply(this,a),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS),(null==s||null==s.isBaseLayer)&&(this.isBaseLayer="true"!=this.params.transparent&&1!=this.params.transparent)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){e=this.adjustBounds(e);var t=[e.left,e.bottom,e.right,e.top],i=this.getImageSize(),s=this.getFullRequestString({mapext:t,imgext:t,map_size:[i.w,i.h],imgx:i.w/2,imgy:i.h/2,imgxy:[i.w,i.h]});return s},getFullRequestString:function(e,t){var i=null==t?this.url:t,s=OpenLayers.Util.extend({},this.params);s=OpenLayers.Util.extend(s,e);var a=OpenLayers.Util.getParameterString(s);OpenLayers.Util.isArray(i)&&(i=this.selectUrl(a,i));var r=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i));for(var n in s)n.toUpperCase()in r&&delete s[n];a=OpenLayers.Util.getParameterString(s);var o=i;if(a=a.replace(/,/g,"+"),""!=a){var l=i.charAt(i.length-1);o+="&"==l||"?"==l?a:-1==i.indexOf("?")?"?"+a:"&"+a}return o},CLASS_NAME:"OpenLayers.Layer.MapServer"}),OpenLayers.Layer.MapServer.Untiled=OpenLayers.Class(OpenLayers.Layer.MapServer,{singleTile:!0,initialize:function(){OpenLayers.Layer.MapServer.prototype.initialize.apply(this,arguments);var e="The OpenLayers.Layer.MapServer.Untiled class is deprecated and will be removed in 3.0. Instead, you should use the normal OpenLayers.Layer.MapServer class, passing it the option 'singleTile' as true.";OpenLayers.Console.warn(e)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.MapServer.Untiled(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.MapServer.prototype.clone.apply(this,[e])},CLASS_NAME:"OpenLayers.Layer.MapServer.Untiled"}),OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},mousemove:function(e){return this.passesTolerance(e.xy)&&(this.clearTimer(),this.callback("move",[e]),this.px=e.xy,e=OpenLayers.Util.extend({},e),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)),!this.stopMove},mouseout:function(e){return OpenLayers.Util.mouseLeft(e,this.map.eventsDiv)&&(this.clearTimer(),this.callback("move",[e])),!0},passesTolerance:function(e){var t=!0;if(this.pixelTolerance&&this.px){var i=Math.sqrt(Math.pow(this.px.x-e.x,2)+Math.pow(this.px.y-e.y,2));this.pixelTolerance>i&&(t=!1)}return t},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(e){this.callback("pause",[e])},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),e=!0),e},CLASS_NAME:"OpenLayers.Handler.Hover"}),OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlerOptions:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,EVENT_TYPES:["featureselected","featuresselected","featureunselected","clickout","beforefeatureselected","beforefeaturesselected","hoverfeature","outfeature"],initialize:function(e){this.EVENT_TYPES=OpenLayers.Control.GetFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES),e.handlerOptions=e.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[e]),this.features={},this.handlers={},this.click&&(this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{})),this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))),this.hover&&(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250})))},activate:function(){if(!this.active)for(var e in this.handlers)this.handlers[e].activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active)for(var e in this.handlers)this.handlers[e].deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(e){var t=this.pixelToBounds(e.xy);this.setModifiers(e),this.request(t,{single:this.single})},selectBox:function(e){var t;if(e instanceof OpenLayers.Bounds){var i=this.map.getLonLatFromPixel(new OpenLayers.Pixel(e.left,e.bottom)),s=this.map.getLonLatFromPixel(new OpenLayers.Pixel(e.right,e.top));t=new OpenLayers.Bounds(i.lon,i.lat,s.lon,s.lat)}else{if(this.click)return;t=this.pixelToBounds(e)}this.setModifiers(this.handlers.box.dragHandler.evt),this.request(t)},selectHover:function(e){var t=this.pixelToBounds(e.xy);this.request(t,{single:!0,hover:!0})},cancelHover:function(){this.hoverResponse&&(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"))},request:function(e,t){t=t||{};var i=new OpenLayers.Filter.Spatial({type:this.filterType,value:e});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");var s=this.protocol.read({maxFeatures:1==t.single?this.maxFeatures:void 0,filter:i,callback:function(i){i.success()&&(i.features.length?1==t.single?this.selectBestFeature(i.features,e.getCenterLonLat(),t):this.select(i.features):t.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&&this.unselectAll())),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});1==t.hover&&(this.hoverResponse=s)},selectBestFeature:function(e,t,i){if(i=i||{},e.length){for(var s,a,r,n=new OpenLayers.Geometry.Point(t.lon,t.lat),o=Number.MAX_VALUE,l=0;e.length>l&&(s=e[l],!(s.geometry&&(r=n.distanceTo(s.geometry,{edge:!1}),o>r&&(o=r,a=s,0==o))));++l);1==i.hover?this.hoverSelect(a):this.select(a||e)}},setModifiers:function(e){this.modifiers={multiple:this.multiple||this.multipleKey&&e[this.multipleKey],toggle:this.toggle||this.toggleKey&&e[this.toggleKey]}},select:function(e){this.modifiers.multiple||this.modifiers.toggle||this.unselectAll(),OpenLayers.Util.isArray(e)||(e=[e]);var t=this.events.triggerEvent("beforefeaturesselected",{features:e});if(t!==!1){for(var i,s=[],a=0,r=e.length;r>a;++a)i=e[a],this.features[i.fid||i.id]?this.modifiers.toggle&&this.unselect(this.features[i.fid||i.id]):(t=this.events.triggerEvent("beforefeatureselected",{feature:i}),t!==!1&&(this.features[i.fid||i.id]=i,s.push(i),this.events.triggerEvent("featureselected",{feature:i})));this.events.triggerEvent("featuresselected",{features:s})}},hoverSelect:function(e){var t=e?e.fid||e.id:null,i=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;i&&i!=t&&(this.events.triggerEvent("outfeature",{feature:this.hoverFeature}),this.hoverFeature=null),t&&t!=i&&(this.events.triggerEvent("hoverfeature",{feature:e}),this.hoverFeature=e)},unselect:function(e){delete this.features[e.fid||e.id],this.events.triggerEvent("featureunselected",{feature:e})},unselectAll:function(){for(var e in this.features)this.unselect(this.features[e])},setMap:function(e){for(var t in this.handlers)this.handlers[t].setMap(e);OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(e){var t=e.add(-this.clickTolerance/2,this.clickTolerance/2),i=e.add(this.clickTolerance/2,-this.clickTolerance/2),s=this.map.getLonLatFromPixel(t),a=this.map.getLonLatFromPixel(i);return new OpenLayers.Bounds(s.lon,s.lat,a.lon,a.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"}),OpenLayers.Format.QueryStringFilter=function(){function e(e){return e=e.replace(/%/g,"\\%"),e=e.replace(/\\\\\.(\*)?/g,function(e,t){return t?e:"\\\\_"}),e=e.replace(/\\\\\.\*/g,"\\\\%"),e=e.replace(/(\\)?\.(\*)?/g,function(e,t,i){return t||i?e:"_"}),e=e.replace(/(\\)?\.\*/g,function(e,t){return t?e:"%"}),e=e.replace(/\\\./g,"."),e=e.replace(/(\\)?\\\*/g,function(e,t){return t?e:"*"})}var t={};return t[OpenLayers.Filter.Comparison.EQUAL_TO]="eq",t[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne",t[OpenLayers.Filter.Comparison.LESS_THAN]="lt",t[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte",t[OpenLayers.Filter.Comparison.GREATER_THAN]="gt",t[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte",t[OpenLayers.Filter.Comparison.LIKE]="ilike",OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(i,s){s=s||{};var a=i.CLASS_NAME,r=a.substring(a.lastIndexOf(".")+1);switch(r){case"Spatial":switch(i.type){case OpenLayers.Filter.Spatial.BBOX:s.bbox=i.value.toArray(),this.srsInBBOX&&i.projection&&s.bbox.push(i.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:s.tolerance=i.distance;case OpenLayers.Filter.Spatial.WITHIN:s.lon=i.value.x,s.lat=i.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+i.type)}break;case"Comparison":var n=t[i.type];if(void 0!==n){var o=i.value;i.type==OpenLayers.Filter.Comparison.LIKE&&(o=e(o),this.wildcarded&&(o="%"+o+"%")),s[i.property+"__"+n]=o,s.queryable=s.queryable||[],s.queryable.push(i.property)}else OpenLayers.Console.warn("Unknown comparison filter type "+i.type);break;case"Logical":if(i.type===OpenLayers.Filter.Logical.AND)for(var l=0,h=i.filters.length;h>l;l++)s=this.write(i.filters[l],s);else OpenLayers.Console.warn("Unsupported logical filter type "+i.type);break;default:OpenLayers.Console.warn("Unknown filter type "+r)}return s},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}(),OpenLayers.Lang.fur=OpenLayers.Util.applyDefaults({Permalink:"Leam Permanent",Overlays:"Livei parsore","Base Layer":"Livel di base",browserNotSupported:"Il to sgarfadôr nol supuarte la renderizazion vetoriâl. Al moment a son supuartâts:\n${renderers}","Scale = 1 : ${scaleDenom}":"Scjale = 1 : ${scaleDenom}",W:"O",E:"E",N:"N",S:"S"}),OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0):!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.div.left="",this.div.top="",this.element=this.div),this.div},redraw:function(e){var t;if(null==e)return this.reset(),void 0;if(null==this.lastXy||Math.abs(e.xy.x-this.lastXy.x)>this.granularity||Math.abs(e.xy.y-this.lastXy.y)>this.granularity)return this.lastXy=e.xy,void 0;if(t=this.map.getLonLatFromPixel(e.xy)){this.displayProjection&&t.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=e.xy;var i=this.formatOutput(t);i!=this.element.innerHTML&&(this.element.innerHTML=i)}},reset:function(){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(e){var t=parseInt(this.numDigits),i=this.prefix+e.lon.toFixed(t)+this.separator+e.lat.toFixed(t)+this.suffix;return i},CLASS_NAME:"OpenLayers.Control.MousePosition"}),OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){var t;"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var i=e.documentElement;if(i){var s=this["read_"+i.nodeName];t=s?s.call(this,i):new OpenLayers.Format.GML(this.options?this.options:{}).read(e)}else t=e;return t},read_msGMLOutput:function(e){var t=[],i=this.getSiblingNodesByTagCriteria(e,this.layerIdentifier);if(i)for(var s=0,a=i.length;a>s;++s){var r=i[s],n=r.nodeName;r.prefix&&(n=n.split(":")[1]);var n=n.replace(this.layerIdentifier,""),o=this.getSiblingNodesByTagCriteria(r,this.featureIdentifier);if(o)for(var l=0;o.length>l;l++){var h=o[l],u=this.parseGeometry(h),p=this.parseAttributes(h),c=new OpenLayers.Feature.Vector(u.geometry,p,null);c.bounds=u.bounds,c.type=n,t.push(c)}}return t},read_FeatureInfoResponse:function(e){for(var t=[],i=this.getElementsByTagNameNS(e,"*","FIELDS"),s=0,a=i.length;a>s;s++){var r,n=i[s],o=null,l={},h=n.attributes.length;
if(h>0)for(r=0;h>r;r++){var u=n.attributes[r];l[u.nodeName]=u.nodeValue}else{var p=n.childNodes;for(r=0,h=p.length;h>r;++r){var c=p[r];3!=c.nodeType&&(l[c.getAttribute("name")]=c.getAttribute("value"))}}t.push(new OpenLayers.Feature.Vector(o,l,null))}return t},getSiblingNodesByTagCriteria:function(e,t){var i,s,a,r,n,o=[];if(e&&e.hasChildNodes()){i=e.childNodes,a=i.length;for(var l=0;a>l;l++){for(n=i[l];n&&1!=n.nodeType;)n=n.nextSibling,l++;s=n?n.nodeName:"",s.length>0&&s.indexOf(t)>-1?o.push(n):(r=this.getSiblingNodesByTagCriteria(n,t),r.length>0&&(0==o.length?o=r:o.push(r)))}}return o},parseAttributes:function(e){var t={};if(1==e.nodeType)for(var i=e.childNodes,s=i.length,a=0;s>a;++a){var r=i[a];if(1==r.nodeType){var n=r.childNodes,o=r.prefix?r.nodeName.split(":")[1]:r.nodeName;if(0==n.length)t[o]=null;else if(1==n.length){var l=n[0];if(3==l.nodeType||4==l.nodeType){var h=l.nodeValue.replace(this.regExes.trimSpace,"");t[o]=h}}}}return t},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var t,i=this.gmlFormat.parseFeature(e),s=null;return i&&(t=i.geometry&&i.geometry.clone(),s=i.bounds&&i.bounds.clone(),i.destroy()),{geometry:t,bounds:s}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"}),OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"}),OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var t={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(t,this.previousOptions),this.previous=new OpenLayers.Control.Button(t);var i={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(i,this.nextOptions),this.next=new OpenLayers.Control.Button(i),this.clear()},onPreviousChange:function(e){e&&!this.previous.active?this.previous.activate():!e&&this.previous.active&&this.previous.deactivate()},onNextChange:function(e){e&&!this.next.active?this.next.activate():!e&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this),this.previous.destroy(),this.next.destroy(),this.deactivate();for(var e in this)this[e]=null},setMap:function(e){this.map=e,this.next.setMap(e),this.previous.setMap(e)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments),this.next.draw(),this.previous.draw()},previousTrigger:function(){var e=this.previousStack.shift(),t=this.previousStack.shift();return void 0!=t?(this.nextStack.unshift(e),this.previousStack.unshift(t),this.restoring=!0,this.restore(t),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)):this.previousStack.unshift(e),t},nextTrigger:function(){var e=this.nextStack.shift();return void 0!=e&&(this.previousStack.unshift(e),this.restoring=!0,this.restore(e),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)),e},clear:function(){this.previousStack=[],this.previous.deactivate(),this.nextStack=[],this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(e){var t,i;if(this.map.getProjectionObject()==e.projection)i=this.map.getZoomForResolution(e.resolution),t=e.center;else{t=e.center.clone(),t.transform(e.projection,this.map.getProjectionObject());var s=e.units,a=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,r=s&&a?OpenLayers.INCHES_PER_UNIT[s]/OpenLayers.INCHES_PER_UNIT[a]:1;i=this.map.getZoomForResolution(r*e.resolution)}this.map.setCenter(t,i)},setListeners:function(){this.listeners={};for(var e in this.registry)this.listeners[e]=OpenLayers.Function.bind(function(){if(!this.restoring){var t=this.registry[e].apply(this,arguments);this.previousStack.unshift(t),this.previousStack.length>1&&this.onPreviousChange(this.previousStack[1],this.previousStack.length-1),this.previousStack.length>this.limit+1&&this.previousStack.pop(),this.nextStack.length>0&&(this.nextStack=[],this.onNextChange(null,0))}return!0},this)},activate:function(){var e=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var t in this.listeners)this.map.events.register(t,this,this.listeners[t]);e=!0,0==this.previousStack.length&&this.initStack()}return e},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var e=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var t in this.listeners)this.map.events.unregister(t,this,this.listeners[t]);this.clearOnDeactivate&&this.clear(),e=!0}return e},CLASS_NAME:"OpenLayers.Control.NavigationHistory"}),OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(e){if(e=e||{},this.params={},this.headers={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var t=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,i){return t.write(e,i)}}},destroy:function(){this.params=null,this.headers=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=e||{},e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params),e=OpenLayers.Util.applyDefaults(e,this.options),e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=void 0!==e.readWithPOST?e.readWithPOST:this.readWithPOST,i=new OpenLayers.Protocol.Response({requestType:"read"});return i.priv=t?OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,i,e),data:OpenLayers.Util.getParameterString(e.params),headers:{"Content-Type":"application/x-www-form-urlencoded"}}):OpenLayers.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,i,e),params:e.params,headers:e.headers}),i},handleRead:function(e,t){this.handleResponse(e,t)},create:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"create"});return i.priv=OpenLayers.Request.POST({url:t.url,callback:this.createCallback(this.handleCreate,i,t),headers:t.headers,data:this.format.write(e)}),i},handleCreate:function(e,t){this.handleResponse(e,t)},update:function(e,t){t=t||{};var i=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var s=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"update"});return s.priv=OpenLayers.Request.PUT({url:i,callback:this.createCallback(this.handleUpdate,s,t),headers:t.headers,data:this.format.write(e)}),s},handleUpdate:function(e,t){this.handleResponse(e,t)},"delete":function(e,t){t=t||{};var i=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var s=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"delete"});return s.priv=OpenLayers.Request.DELETE({url:i,callback:this.createCallback(this.handleDelete,s,t),headers:t.headers}),s},handleDelete:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){var i=e.priv;t.callback&&(i.status>=200&&300>i.status?("delete"!=e.requestType&&(e.features=this.parseFeatures(i)),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,t.callback.call(t.scope,e))},parseFeatures:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||0>=t.length?null:this.format.read(t)},commit:function(e,t){function i(e){for(var t=e.features?e.features.length:0,i=Array(t),a=0;t>a;++a)i[a]=e.features[a].fid;m.insertIds=i,s.apply(this,[e])}function s(e){this.callUserCallback(e,t),d=d&&e.success(),r++,r>=c&&t.callback&&(m.code=d?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,t.callback.apply(t.scope,[m]))}t=OpenLayers.Util.applyDefaults(t,this.options);var a=[],r=0,n={};n[OpenLayers.State.INSERT]=[],n[OpenLayers.State.UPDATE]=[],n[OpenLayers.State.DELETE]=[];for(var o,l,h=[],u=0,p=e.length;p>u;++u)o=e[u],l=n[o.state],l&&(l.push(o),h.push(o));var c=(n[OpenLayers.State.INSERT].length>0?1:0)+n[OpenLayers.State.UPDATE].length+n[OpenLayers.State.DELETE].length,d=!0,m=new OpenLayers.Protocol.Response({reqFeatures:h}),y=n[OpenLayers.State.INSERT];y.length>0&&a.push(this.create(y,OpenLayers.Util.applyDefaults({callback:i,scope:this},t.create))),y=n[OpenLayers.State.UPDATE];for(var u=y.length-1;u>=0;--u)a.push(this.update(y[u],OpenLayers.Util.applyDefaults({callback:s,scope:this},t.update)));y=n[OpenLayers.State.DELETE];for(var u=y.length-1;u>=0;--u)a.push(this["delete"](y[u],OpenLayers.Util.applyDefaults({callback:s,scope:this},t["delete"])));return a},abort:function(e){e&&e.priv.abort()},callUserCallback:function(e,t){var i=t[e.requestType];i&&i.callback&&i.callback.call(i.scope,e)},CLASS_NAME:"OpenLayers.Protocol.HTTP"}),OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this}),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})),e},cacheFeatures:function(e){var t=!0;return this.clustering||(this.clearCache(),this.features=e.features,this.cluster(),t=!1),t},clearCache:function(){this.features=null},cluster:function(e){if((!e||e.zoomChanged)&&this.features){var t=this.layer.map.getResolution();if(t!=this.resolution||!this.clustersExist()){this.resolution=t;for(var i,s,a,r=[],n=0;this.features.length>n;++n)if(i=this.features[n],i.geometry){s=!1;for(var o=r.length-1;o>=0;--o)if(a=r[o],this.shouldCluster(a,i)){this.addToCluster(a,i),s=!0;break}s||r.push(this.createCluster(this.features[n]))}if(this.layer.removeAllFeatures(),r.length>0){if(this.threshold>1){var l=r.slice();r=[];for(var h,n=0,u=l.length;u>n;++n)h=l[n],h.attributes.count<this.threshold?Array.prototype.push.apply(r,h.cluster):r.push(h)}this.clustering=!0,this.layer.addFeatures(r),this.clustering=!1}this.clusters=r}}},clustersExist:function(){var e=!1;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){e=!0;for(var t=0;this.clusters.length>t;++t)if(this.clusters[t]!=this.layer.features[t]){e=!1;break}}return e},shouldCluster:function(e,t){var i=e.geometry.getBounds().getCenterLonLat(),s=t.geometry.getBounds().getCenterLonLat(),a=Math.sqrt(Math.pow(i.lon-s.lon,2)+Math.pow(i.lat-s.lat,2))/this.resolution;return this.distance>=a},addToCluster:function(e,t){e.cluster.push(t),e.attributes.count+=1},createCluster:function(e){var t=e.geometry.getBounds().getCenterLonLat(),i=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat),{count:1});return i.cluster=[e],i},CLASS_NAME:"OpenLayers.Strategy.Cluster"}),OpenLayers.Lang.id=OpenLayers.Util.applyDefaults({unhandledRequest:"Permintaan yang tak tertangani menghasilkan ${statusText}",Permalink:"Pranala permanen",Overlays:"Hamparan","Base Layer":"Lapisan Dasar",readNotImplemented:"Membaca tidak diterapkan.",writeNotImplemented:"Menyimpan tidak diterapkan.",noFID:"Tidak dapat memperbarui fitur yang tidak memiliki FID.",errorLoadingGML:"Kesalahan dalam memuat berkas GML ${url}",browserNotSupported:"Peramban Anda tidak mendukung penggambaran vektor. Penggambar yang didukung saat ini adalah:\n${renderers}",componentShouldBe:"addFeatures : komponen harus berupa ${geomType}",getFeatureError:"getFeatureFromEvent diterapkan pada lapisan tanpa penggambar. Ini biasanya berarti Anda menghapus sebuah lapisan, tetapi tidak menghapus penangan yang terkait dengannya.",minZoomLevelError:"Properti minZoomLevel hanya ditujukan bekerja dengan lapisan FixedZoomLevels-descendent. Pengecekan minZoomLevel oleh lapisan wfs adalah peninggalan masa lalu. Kami tidak dapat menghapusnya tanpa kemungkinan merusak aplikasi berbasis OL yang mungkin bergantung padanya. Karenanya, kami menganggapnya tidak berlaku -- Cek minZoomLevel di bawah ini akan dihapus pada 3.0. Silakan gunakan penyetelan resolusi min/maks seperti dijabarkan di sini: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaksi: BERHASIL ${respon}",commitFailed:"WFS Transaksi: GAGAL ${respon}",googleWarning:"Lapisan Google tidak dapat dimuat dengan benar.<br><br>Untuk menghilangkan pesan ini, pilih suatu BaseLayer baru melalui penukar lapisan (layer switcher) di ujung kanan atas.<br><br>Kemungkinan besar ini karena pustaka skrip Google Maps tidak disertakan atau tidak mengandung kunci API yang tepat untuk situs Anda.<br><br>Pengembang: Untuk bantuan mengatasi masalah ini, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>klik di sini</a>",getLayerWarning:"Lapisan ${layerType} tidak dapat dimuat dengan benar.<br><br>Untuk menghilangkan pesan ini, pilih suatu BaseLayer baru melalui penukar lapisan (layer switcher) di ujung kanan atas.<br><br>Kemungkinan besar ini karena pustaka skrip Google Maps tidak disertakan dengan benar.<br><br>Pengembang: Untuk bantuan mengatasi masalah ini, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>klik di sini</a>","Scale = 1 : ${scaleDenom}":"Sekala = 1 : ${scaleDenom}",W:"B",E:"T",N:"U",S:"S",layerAlreadyAdded:"Anda mencoba menambahkan lapisan: ${layerName} ke dalam peta, tapi lapisan itu telah ditambahkan",reprojectDeprecated:"Anda menggunakan opsi 'reproject' pada lapisan ${layerName}. Opsi ini telah ditinggalkan: penggunaannya dirancang untuk mendukung tampilan data melalui peta dasar komersial, tapi fungsionalitas tersebut saat ini harus dilakukan dengan menggunakan dukungan Spherical Mercator. Informasi lebih lanjut tersedia di http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Metode ini telah usang dan akan dihapus di 3.0. Sebaliknya, harap gunakan ${newMethod}.",boundsAddError:"Anda harus memberikan kedua nilai x dan y ke fungsi penambah.",lonlatAddError:"Anda harus memberikan kedua nilai lon dan lat ke fungsi penambah.",pixelAddError:"Anda harus memberikan kedua nilai x dan y ke fungsi penambah.",unsupportedGeometryType:"Tipe geometri tak didukung: ${geomType}",filterEvaluateNotImplemented:"evaluasi tidak tersedia untuk tipe filter ini."}),OpenLayers.Protocol.SOS=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Protocol.SOS.DEFAULTS);var t=OpenLayers.Protocol.SOS["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported SOS version: "+e.version;return new t(e)},OpenLayers.Protocol.SOS.DEFAULTS={version:"1.0.0"},OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,createGeometryFromItem:function(e){var t=this.getElementsByTagNameNS(e,this.georssns,"point"),i=this.getElementsByTagNameNS(e,this.geons,"lat"),s=this.getElementsByTagNameNS(e,this.geons,"long"),a=this.getElementsByTagNameNS(e,this.georssns,"line"),r=this.getElementsByTagNameNS(e,this.georssns,"polygon"),n=this.getElementsByTagNameNS(e,this.georssns,"where"),o=this.getElementsByTagNameNS(e,this.georssns,"box");if(t.length>0||i.length>0&&s.length>0){var l;t.length>0?(l=OpenLayers.String.trim(t[0].firstChild.nodeValue).split(/\s+/),2!=l.length&&(l=OpenLayers.String.trim(t[0].firstChild.nodeValue).split(/\s*,\s*/))):l=[parseFloat(i[0].firstChild.nodeValue),parseFloat(s[0].firstChild.nodeValue)];var h=new OpenLayers.Geometry.Point(parseFloat(l[1]),parseFloat(l[0]))}else if(a.length>0){for(var t,u=OpenLayers.String.trim(this.concatChildValues(a[0])).split(/\s+/),p=[],c=0,d=u.length;d>c;c+=2)t=new OpenLayers.Geometry.Point(parseFloat(u[c+1]),parseFloat(u[c])),p.push(t);h=new OpenLayers.Geometry.LineString(p)}else if(r.length>0){for(var t,u=OpenLayers.String.trim(this.concatChildValues(r[0])).split(/\s+/),p=[],c=0,d=u.length;d>c;c+=2)t=new OpenLayers.Geometry.Point(parseFloat(u[c+1]),parseFloat(u[c])),p.push(t);h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(p)])}else if(n.length>0){this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy}));var m=this.gmlParser.parseFeature(n[0]);h=m.geometry}else if(o.length>0){var t,u=OpenLayers.String.trim(o[0].firstChild.nodeValue).split(/\s+/),p=[];u.length>3&&(t=new OpenLayers.Geometry.Point(parseFloat(u[1]),parseFloat(u[0])),p.push(t),t=new OpenLayers.Geometry.Point(parseFloat(u[1]),parseFloat(u[2])),p.push(t),t=new OpenLayers.Geometry.Point(parseFloat(u[3]),parseFloat(u[2])),p.push(t),t=new OpenLayers.Geometry.Point(parseFloat(u[3]),parseFloat(u[0])),p.push(t),t=new OpenLayers.Geometry.Point(parseFloat(u[1]),parseFloat(u[0])),p.push(t)),h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(p)])}return h&&this.internalProjection&&this.externalProjection&&h.transform(this.externalProjection,this.internalProjection),h},createFeatureFromItem:function(e){var t=this.createGeometryFromItem(e),i=this.getChildValue(e,"*","title",this.featureTitle),s=this.getChildValue(e,"*","description",this.getChildValue(e,"*","content",this.getChildValue(e,"*","summary",this.featureDescription))),a=this.getChildValue(e,"*","link");if(!a)try{a=this.getElementsByTagNameNS(e,"*","link")[0].getAttribute("href")}catch(r){a=null}var n=this.getChildValue(e,"*","id",null),o={title:i,description:s,link:a},l=new OpenLayers.Feature.Vector(t,o);return l.fid=n,l},getChildValue:function(e,t,i,s){var a,r=this.getElementsByTagNameNS(e,t,i);return a=r&&r[0]&&r[0].firstChild&&r[0].firstChild.nodeValue?OpenLayers.Format.XML.prototype.getChildValue(r[0]):void 0==s?"":s},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=null;t=this.getElementsByTagNameNS(e,"*","item"),0==t.length&&(t=this.getElementsByTagNameNS(e,"*","entry"));for(var i=t.length,s=Array(i),a=0;i>a;a++)s[a]=this.createFeatureFromItem(t[a]);return s},write:function(e){var t;if(OpenLayers.Util.isArray(e)){t=this.createElementNS(this.rssns,"rss");for(var i=0,s=e.length;s>i;i++)t.appendChild(this.createFeatureXML(e[i]))}else t=this.createFeatureXML(e);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=this.buildGeometryNode(e.geometry),i=this.createElementNS(this.rssns,"item"),s=this.createElementNS(this.rssns,"title");s.appendChild(this.createTextNode(e.attributes.title?e.attributes.title:""));var a=this.createElementNS(this.rssns,"description");if(a.appendChild(this.createTextNode(e.attributes.description?e.attributes.description:"")),i.appendChild(s),i.appendChild(a),e.attributes.link){var r=this.createElementNS(this.rssns,"link");r.appendChild(this.createTextNode(e.attributes.link)),i.appendChild(r)}for(var n in e.attributes)if("link"!=n&&"title"!=n&&"description"!=n){var o=this.createTextNode(e.attributes[n]),l=n;-1!=n.search(":")&&(l=n.split(":")[1]);var h=this.createElementNS(this.featureNS,"feature:"+l);h.appendChild(o),i.appendChild(h)}return i.appendChild(t),i},buildGeometryNode:function(e){this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t;if("OpenLayers.Geometry.Polygon"==e.CLASS_NAME)t=this.createElementNS(this.georssns,"georss:polygon"),t.appendChild(this.buildCoordinatesNode(e.components[0]));else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=this.createElementNS(this.georssns,"georss:line"),t.appendChild(this.buildCoordinatesNode(e));else{if("OpenLayers.Geometry.Point"!=e.CLASS_NAME)throw"Couldn't parse "+e.CLASS_NAME;t=this.createElementNS(this.georssns,"georss:point"),t.appendChild(this.buildCoordinatesNode(e))}return t},buildCoordinatesNode:function(e){var t=null;e.components&&(t=e.components);var i;if(t){for(var s=t.length,a=Array(s),r=0;s>r;r++)a[r]=t[r].y+" "+t[r].x;i=a.join(" ")}else i=e.y+" "+e.x;return this.createTextNode(i)},CLASS_NAME:"OpenLayers.Format.GeoRSS"}),OpenLayers.Lang.ksh=OpenLayers.Util.applyDefaults({unhandledRequest:"Met dä Antwoot op en Aanfrooch ham_mer nix aanjefange: ${statusText}",Permalink:"Lengk op Duuer",Overlays:"Drövver jelaat","Base Layer":"Jrund-Nivoh",readNotImplemented:'„<code lang="en">read</code>“ is em Projramm nit fürjesinn.',writeNotImplemented:'„<code lang="en">write</code>“ is em Projramm nit fürjesinn.',noFID:'En Saach, woh kein <i lang="en">FID</i> för doh es, löht sesch nit ändere.',errorLoadingGML:'Fähler beim <i lang="en">GML</i>-Datei-Laade vun <code>${url}</code>',browserNotSupported:"Dinge Brauser kann kein Väktore ußjävve. De Zoote Ußjaabe, di em Momang jon, sen:\n${renderers}",componentShouldBe:'<code lang="en">addFeatures</code>: dä Aandeil sullt vun dä Zoot „<code lang="en">${geomType}</code>“ sin.',getFeatureError:'<code lang="en">getFeatureFromEvent</code> es vun enem Nivoh opjeroofe woode, woh et kei Projramm zom Ußjävve jit. Dat bedügg för jewöhnlesch, dat De e Nivoh kapott jemaat häs, ävver nit e Projramm för domet ömzejonn, wat domet verbonge es.',minZoomLevelError:'De Eijeschaff „<code lang="en">minZoomLevel</code>“ es bloß doför jedaach, dat mer se met dä Nivvohß bruch, di vun <code lang="en">FixedZoomLevels</code> affhange don. Dat dat <i lang="en">WFS</i>-Nivvoh övverhoup de Eijeschaff „<code lang="en">minZoomLevel</code>“ pröhfe deiht, es noch övveresch vun fröhjer. Mer künne dat ävver jez nit fott lohße, oohne dat mer Jevaa loufe, dat Aanwendunge vun OpenLayers nit mieh loufe, di sesch doh velleijsch noch drop am verlohße sin. Dröm sare mer, dat mer et nit mieh han welle, un de „<code lang="en">minZoomLevel</code>“-Eijeschaff weed hee vun de Version 3.0 af nit mieh jeprööf wäde. Nemm doför de Enstellung för de hühßte un de kleinßte Oplöhsung, esu wi et en http://trac.openlayers.org/wiki/SettingZoomLevels opjeschrevve es.',commitSuccess:'Dä <i lang="en">WFS</i>-Vörjang es joot jeloufe: ${response}',commitFailed:'Dä <i lang="en">WFS</i>-Vörjang es scheif jejange: ${response}',googleWarning:'Dat Nivvoh <code lang="en">Google</code> kunnt nit reschtesch jelaade wääde.<br /><br />Öm hee di Nohreesch loß ze krijje, donn en ander Jrund-Nivvoh ußsöhke, rähß bovve en de Äk.<br /><br />Wascheinlesch es dat wiel dat <i lang="en">Google-Maps</i>-Skrepp entweeder nit reschtesch enjebonge wood, udder nit dä reschtejje <i lang="en">API</i>-Schlößel för Ding Web-ßait scheke deiht.<br /><br />För Projrammierer jidd_et Hölp do_drövver, <a href="http://trac.openlayers.org/wiki/Google" target="_blank">wi mer dat aan et Loufe brengk</a>.',getLayerWarning:'Dat Nivvoh <code>${layerType}</code> kunnt nit reschtesch jelaade wääde.<br /><br />Öm hee di Nohreesch loß ze krijje, donn en ander Jrund-Nivvoh ußsöhkre, rähß bovve en de Äk.<br /><br />Wascheinlesch es dat, wiel dat Skrepp <code>${layerLib}</code> nit reschtesch enjebonge wood.<br /><br />För Projrammierer jidd_Et Hölp do_drövver, <a href="http://trac.openlayers.org/wiki/${layerLib}" target="_blank">wi mer dat aan et Loufe brengk</a>.',"Scale = 1 : ${scaleDenom}":"Mohßshtaab = 1 : ${scaleDenom}",W:"W",E:"O",N:"N",S:"S",layerAlreadyAdded:"Do häß versöhk, dat Nivvoh <code>${layerName}</code> en di Kaat eren ze bränge, et wohr ävver ald do dren.",reprojectDeprecated:"Do bruchs de Ußwahl <code>reproject</code> op däm Nivvoh <code>${layerName}</code>. Di Ußwahl es nit mieh jähn jesinn. Se wohr doför jedaach, öm Date op jeschääfsmäßesch eruß jejovve Kaate bovve drop ze moole, wat ävver enzwesche besser met dä Öngershtözung för de ßfääresche Mäkaator Beldscher jeiht. Doh kanns De mieh drövver fenge op dä Sigg: http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Hee di Metood es nim_mih aktoäll un et weed se en dä Version 3.0 nit mieh jävve. Nemm <code>${newMethod}</code> doföör.",boundsAddError:"Do moß beeds vun de <code>x</code> un <code>y</code> Wääte aan de Fungkßjohn <code>add</code> jävve.",lonlatAddError:"Do moß beeds <code>lon</code> un <code>lat</code> aan de Fungkßjohn <code>add</code> jävve.",pixelAddError:"Do moß beeds <code>x</code> un <code>y</code> aan de Fungkßjohn <code>add</code> jävve.",unsupportedGeometryType:"De Zoot Jommetrii dom_mer nit ongershtöze: <code>${geomType}</code>",filterEvaluateNotImplemented:'„<code lang="en">evaluate</code>“ es för di Zoot Fellter nit enjereschdt.'}),OpenLayers.Format.WPSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSCapabilities"}),OpenLayers.Format.WPSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{wps:{Capabilities:function(e,t){this.readChildNodes(e,t)},ProcessOfferings:function(e,t){t.processOfferings={},this.readChildNodes(e,t.processOfferings)},Process:function(e,t){var i=this.getAttributeNS(e,this.namespaces.wps,"processVersion"),s={processVersion:i};this.readChildNodes(e,s),t[s.identifier]=s},Languages:function(e,t){t.languages=[],this.readChildNodes(e,t.languages)},Default:function(e,t){var i={isDefault:!0};this.readChildNodes(e,i),t.push(i)},Supported:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSCapabilities.v1_0_0"}),OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0):!1},draw:function(){var e={click:this.defaultClick,dblclick:this.defaultDblClick},t=OpenLayers.Util.extend({"double":!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,e,t),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.dragPan.draw(),this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(e){e.lastTouches&&2==e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){var t=this.map.getLonLatFromViewPortPx(e.xy);this.map.setCenter(t,this.map.zoom+1)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"}),OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(e){OpenLayers.Util.extend(this,e),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;t>e;e++)this.rules[e].destroy();delete this.rules},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,i=this.rules.length;i>t;++t)e.rules.push(this.rules[t].clone())}return new OpenLayers.Style2(e)},CLASS_NAME:"OpenLayers.Style2"}),OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{initialize:function(){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments)},drawMarker:function(e){var t=e.bounds,i=this.map.getLayerPxFromLonLat(new OpenLayers.LonLat(t.left,t.top)),s=this.map.getLayerPxFromLonLat(new OpenLayers.LonLat(t.right,t.bottom));if(null==s||null==i)e.display(!1);else{var a=new OpenLayers.Size(Math.max(1,s.x-i.x),Math.max(1,s.y-i.y)),r=e.draw(i,a);e.drawn||(this.div.appendChild(r),e.drawn=!0)}},removeMarker:function(e){OpenLayers.Util.removeItem(this.markers,e),null!=e.div&&e.div.parentNode==this.div&&this.div.removeChild(e.div)},CLASS_NAME:"OpenLayers.Layer.Boxes"}),OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{initialize:function(e){OpenLayers.Format.WFSCapabilities.v1.prototype.initialize.apply(this,[e])},read_cap_Service:function(e,t){var i={};this.runChildNodes(i,t),e.service=i},read_cap_Fees:function(e,t){var i=this.getChildValue(t);i&&"none"!=i.toLowerCase()&&(e.fees=i)},read_cap_AccessConstraints:function(e,t){var i=this.getChildValue(t);i&&"none"!=i.toLowerCase()&&(e.accessConstraints=i)},read_cap_OnlineResource:function(e,t){var i=this.getChildValue(t);i&&"none"!=i.toLowerCase()&&(e.onlineResource=i)},read_cap_Keywords:function(e,t){var i=this.getChildValue(t);i&&"none"!=i.toLowerCase()&&(e.keywords=i.split(", "))},read_cap_Capability:function(e,t){var i={};this.runChildNodes(i,t),e.capability=i},read_cap_Request:function(e,t){var i={};this.runChildNodes(i,t),e.request=i},read_cap_GetFeature:function(e,t){var i={href:{},formats:[]};this.runChildNodes(i,t),e.getfeature=i},read_cap_ResultFormat:function(e,t){for(var i,s=t.childNodes,a=0;s.length>a;a++)i=s[a],1==i.nodeType&&e.formats.push(i.nodeName)},read_cap_DCPType:function(e,t){this.runChildNodes(e,t)},read_cap_HTTP:function(e,t){this.runChildNodes(e.href,t)},read_cap_Get:function(e,t){e.get=t.getAttribute("onlineResource")},read_cap_Post:function(e,t){e.post=t.getAttribute("onlineResource")},read_cap_SRS:function(e,t){var i=this.getChildValue(t);i&&(e.srs=i)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"}),OpenLayers.Lang.ja=OpenLayers.Util.applyDefaults({unhandledRequest:"未処理の要求は ${statusText} を返します",Permalink:"パーマリンク",Overlays:"オーバーレイ","Base Layer":"基底レイヤー",readNotImplemented:"読み込みは実装されていません。",writeNotImplemented:"書き込みは実装されていません。",noFID:"FID のない地物は更新できません。",errorLoadingGML:"GML ファイル ${url} の読み込みエラー",browserNotSupported:"あなたのブラウザはベクターグラフィックスの描写に対応していません。現時点で対応しているソフトウェアは以下のものです。\n${renderers}",componentShouldBe:"addFeatures: 要素は ${geomType} であるべきです",getFeatureError:"getFeatureFromEvent がレンダラーのないレイヤーから呼ばれました。通常、これはあなたがレイヤーを、それに関連づけられたいくつかのハンドラを除いて、破壊してしまったことを意味します。",minZoomLevelError:"minZoomLevel プロパティは FixedZoomLevels を継承するレイヤーでの使用のみを想定しています。この minZoomLevel に対する WFS レイヤーの検査は歴史的なものです。しかしながら、この検査を除去するとそれに依存する OpenLayers ベースのアプリケーションを破壊してしまう可能性があります。よって廃止が予定されており、この minZoomLevel 検査はバージョン3.0で除去されます。代わりに、http://trac.openlayers.org/wiki/SettingZoomLevels で解説されている、最小および最大解像度設定を使用してください。",commitSuccess:"WFS トランザクション: 成功 ${response}",commitFailed:"WFS トランザクション: 失敗 ${response}",googleWarning:"Google レイヤーが正しく読み込みを行えませんでした。<br><br>このメッセージを消すには、右上の隅にあるレイヤー切り替え部分で新しい基底レイヤーを選んでください。<br><br>おそらく、これは Google マップ用ライブラリのスクリプトが組み込まれていないか、あなたのサイトに対応する正しい API キーが設定されていないためです。<br><br>開発者の方へ: 正しい動作をさせるために<a href='http://trac.openlayers.org/wiki/Google' target='_blank'>こちらのウィキ</a>を参照してください。",getLayerWarning:"${layerType} レイヤーが正しく読み込みを行えませんでした。<br><br>このメッセージを消すには、右上の隅にあるレイヤー切り替え部分で新しい基底レイヤーを選んでください。<br><br>おそらく、これは ${layerLib} ライブラリのスクリプトが正しく組み込まれていないためです。<br><br>開発者の方へ: 正しい動作をさせるために<a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>こちらのウィキ</a>を参照してください。","Scale = 1 : ${scaleDenom}":"縮尺 = 1 : ${scaleDenom}",W:"西",E:"東",N:"北",S:"南",layerAlreadyAdded:"あなたは「${layerName}」を地図に追加しようと試みましたが、そのレイヤーは既に追加されています",reprojectDeprecated:"あなたは「${layerName}」レイヤーで reproject オプションを使っています。このオプションは商用の基底地図上に情報を表示する目的で設計されましたが、現在ではその機能は Spherical Mercator サポートを利用して実現されており、このオプションの使用は非推奨です。追加の情報は http://trac.openlayers.org/wiki/SphericalMercator で入手できます。",methodDeprecated:"このメソッドは廃止が予定されており、バージョン3.0で除去されます。代わりに ${newMethod} を使用してください。",boundsAddError:"x と y 両方の値を add 関数に渡さなければなりません。",lonlatAddError:"lon と lat 両方の値を add 関数に渡さなければなりません。",pixelAddError:"x と y の値両方を add 関数に渡さなければなりません。",unsupportedGeometryType:"未対応の形状型: ${geomType}",filterEvaluateNotImplemented:"このフィルター型について evaluate は実装されていません。"}),OpenLayers.Layer.Yahoo=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:17,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20,1072883605957031e-20],type:null,wrapDateLine:!0,sphericalMercator:!1,initialize:function(){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments),OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments),this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())
},loadMapObject:function(){try{var e=this.getMapObjectSizeFromOLSize(this.map.getSize());this.mapObject=new YMap(this.div,this.type,e),this.mapObject.disableKeyControls(),this.mapObject.disableDragMap(),this.mapObject.moveByXY&&"function"==typeof this.mapObject.moveByXY||(this.dragPanMapObject=null)}catch(t){}},onMapResize:function(){try{var e=this.getMapObjectSizeFromOLSize(this.map.getSize());this.mapObject.resizeTo(e)}catch(t){}},setMap:function(){OpenLayers.Layer.EventPane.prototype.setMap.apply(this,arguments),this.map.events.register("moveend",this,this.fixYahooEventPane)},fixYahooEventPane:function(){var e=OpenLayers.Util.getElement("ygddfdiv");null!=e&&(null!=e.parentNode&&e.parentNode.removeChild(e),this.map.events.unregister("moveend",this,this.fixYahooEventPane))},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"Yahoo",layerLib:"Yahoo"})},getOLZoomFromMapObjectZoom:function(e){var t=null;return null!=e&&(t=OpenLayers.Layer.FixedZoomLevels.prototype.getOLZoomFromMapObjectZoom.apply(this,[e]),t=18-t),t},getMapObjectZoomFromOLZoom:function(e){var t=null;return null!=e&&(t=OpenLayers.Layer.FixedZoomLevels.prototype.getMapObjectZoomFromOLZoom.apply(this,[e]),t=18-t),t},setMapObjectCenter:function(e,t){this.mapObject.drawZoomAndCenter(e,t)},getMapObjectCenter:function(){return this.mapObject.getCenterLatLon()},dragPanMapObject:function(e,t){this.mapObject.moveByXY({x:-e,y:t})},getMapObjectZoom:function(){return this.mapObject.getZoomLevel()},getMapObjectLonLatFromMapObjectPixel:function(e){return this.mapObject.convertXYLatLon(e)},getMapObjectPixelFromMapObjectLonLat:function(e){return this.mapObject.convertLatLonXY(e)},getLongitudeFromMapObjectLonLat:function(e){return this.sphericalMercator?this.forwardMercator(e.Lon,e.Lat).lon:e.Lon},getLatitudeFromMapObjectLonLat:function(e){return this.sphericalMercator?this.forwardMercator(e.Lon,e.Lat).lat:e.Lat},getMapObjectLonLatFromLonLat:function(e,t){var i;if(this.sphericalMercator){var s=this.inverseMercator(e,t);i=new YGeoPoint(s.lat,s.lon)}else i=new YGeoPoint(t,e);return i},getXFromMapObjectPixel:function(e){return e.x},getYFromMapObjectPixel:function(e){return e.y},getMapObjectPixelFromXY:function(e,t){return new YCoordPoint(e,t)},getMapObjectSizeFromOLSize:function(e){return new YSize(e.w,e.h)},CLASS_NAME:"OpenLayers.Layer.Yahoo"}),OpenLayers.Lang.nds=OpenLayers.Util.applyDefaults({unhandledRequest:"Unbehannelt Trüchmellels för de Anfraag ${statusText}",Permalink:"Permalink",Overlays:"Overlays","Base Layer":"Achtergrundkoort",readNotImplemented:"Lesen is nich inricht.",writeNotImplemented:"Schrieven is nich inricht.",noFID:"En Feature, dat keen FID hett, kann nich aktuell maakt warrn.",errorLoadingGML:"Fehler bi’t Laden vun de GML-Datei ${url}",browserNotSupported:"Dien Browser ünnerstütt keen Vektorbiller. Ünnerstütt Renderers:\n${renderers}",componentShouldBe:"addFeatures : Kumponent schull man den Typ ${geomType} hebben",getFeatureError:"getFeatureFromEvent is von en Laag ahn Render opropen worrn. Dat bedüüdt normalerwies, dat en Laag wegmaakt worrn is, aver nich de Handler, de dor op verwiest.",commitSuccess:"WFS-Transakschoon: hett klappt ${response}",commitFailed:"WFS-Transakschoon: hett nich klappt ${response}","Scale = 1 : ${scaleDenom}":"Skaal = 1 : ${scaleDenom}",layerAlreadyAdded:"Du versöchst de Laag „${layerName}“ to de Koort totofögen, man de is al toföögt",methodDeprecated:"Disse Methood is oold un schall dat in 3.0 nich mehr geven. Bruuk dor man beter ${newMethod} för.",boundsAddError:"De Weert x un y, de mööt all beid an de add-Funkschoon övergeven warrn.",lonlatAddError:"De Weert lon un lat, de mööt all beid an de add-Funkschoon övergeven warrn.",pixelAddError:"De Weert x un y, de mööt all beid an de add-Funkschoon övergeven warrn.",unsupportedGeometryType:"Nich ünnerstütt Geometrie-Typ: ${geomType}"}),OpenLayers.Layer.PointGrid=OpenLayers.Class(OpenLayers.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(e){e=e||{},OpenLayers.Layer.Vector.prototype.initialize.apply(this,[e.name,e])},setMap:function(e){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),e.events.register("moveend",this,this.onMoveEnd)},removeMap:function(e){e.events.unregister("moveend",this,this.onMoveEnd),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},setRatio:function(e){this.ratio=e,this.updateGrid(!0)},setMaxFeatures:function(e){this.maxFeatures=e,this.updateGrid(!0)},setSpacing:function(e,t){this.dx=e,this.dy=t||e,this.updateGrid(!0)},setOrigin:function(e){this.origin=e,this.updateGrid(!0)},getOrigin:function(){return this.origin||(this.origin=this.map.getExtent().getCenterLonLat()),this.origin},setRotation:function(e){this.rotation=e,this.updateGrid(!0)},onMoveEnd:function(){this.updateGrid()},getViewBounds:function(){var e=this.map.getExtent();if(this.rotation){var t=this.getOrigin(),i=new OpenLayers.Geometry.Point(t.lon,t.lat),s=e.toGeometry();s.rotate(-this.rotation,i),e=s.getBounds()}return e},updateGrid:function(e){if(e||this.invalidBounds()){var t=this.getViewBounds(),i=this.getOrigin(),s=new OpenLayers.Geometry.Point(i.lon,i.lat),a=t.getWidth(),r=t.getHeight(),n=a/r,o=Math.sqrt(this.dx*this.dy*this.maxFeatures/n),l=o*n,h=Math.min(a*this.ratio,l),u=Math.min(r*this.ratio,o),p=t.getCenterLonLat();this.gridBounds=new OpenLayers.Bounds(p.lon-h/2,p.lat-u/2,p.lon+h/2,p.lat+u/2);for(var c,d,m,y=Math.floor(u/this.dy),f=Math.floor(h/this.dx),g=i.lon+this.dx*Math.ceil((this.gridBounds.left-i.lon)/this.dx),v=i.lat+this.dy*Math.ceil((this.gridBounds.bottom-i.lat)/this.dy),L=Array(y*f),b=0;f>b;++b){c=g+b*this.dx;for(var O=0;y>O;++O)d=v+O*this.dy,m=new OpenLayers.Geometry.Point(c,d),this.rotation&&m.rotate(this.rotation,s),L[b*y+O]=new OpenLayers.Feature.Vector(m)}this.destroyFeatures(this.features,{silent:!0}),this.addFeatures(L,{silent:!0})}},invalidBounds:function(){return!this.gridBounds||!this.gridBounds.containsBounds(this.getViewBounds())},CLASS_NAME:"OpenLayers.Layer.PointGrid"}),OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{url:null,size:null,isBaseLayer:!0,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:Array(),tierSizeInTiles:Array(),tierImageSize:Array(),initialize:function(e,t,i,s){this.initializeZoomify(i);var a=[];a.push(e,t,i,{},s),OpenLayers.Layer.Grid.prototype.initialize.apply(this,a)},initializeZoomify:function(e){var t=e.clone(),i=new OpenLayers.Size(Math.ceil(t.w/this.standardTileSize),Math.ceil(t.h/this.standardTileSize));for(this.tierSizeInTiles.push(i),this.tierImageSize.push(t);t.w>this.standardTileSize||t.h>this.standardTileSize;)t=new OpenLayers.Size(Math.floor(t.w/2),Math.floor(t.h/2)),i=new OpenLayers.Size(Math.ceil(t.w/this.standardTileSize),Math.ceil(t.h/this.standardTileSize)),this.tierSizeInTiles.push(i),this.tierImageSize.push(t);this.tierSizeInTiles.reverse(),this.tierImageSize.reverse(),this.numberOfTiers=this.tierSizeInTiles.length,this.tileCountUpToTier[0]=0;for(var s=1;this.numberOfTiers>s;s++)this.tileCountUpToTier.push(this.tierSizeInTiles[s-1].w*this.tierSizeInTiles[s-1].h+this.tileCountUpToTier[s-1])},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments),this.tileCountUpToTier.length=0,this.tierSizeInTiles.length=0,this.tierImageSize.length=0},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options)),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){e=this.adjustBounds(e);var t=this.map.getResolution(),i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w)),s=Math.round((this.tileOrigin.lat-e.top)/(t*this.tileSize.h)),a=this.map.getZoom(),r=i+s*this.tierSizeInTiles[a].w+this.tileCountUpToTier[a],n="TileGroup"+Math.floor(r/256)+"/"+a+"-"+i+"-"+s+".jpg",o=this.url;return OpenLayers.Util.isArray(o)&&(o=this.selectUrl(n,o)),o+n},getImageSize:function(){if(arguments.length>0){var e=this.adjustBounds(arguments[0]),t=this.map.getResolution(),i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w)),s=Math.round((this.tileOrigin.lat-e.top)/(t*this.tileSize.h)),a=this.map.getZoom(),r=this.standardTileSize,n=this.standardTileSize;if(i==this.tierSizeInTiles[a].w-1)var r=this.tierImageSize[a].w%this.standardTileSize;if(s==this.tierSizeInTiles[a].h-1)var n=this.tierImageSize[a].h%this.standardTileSize;return new OpenLayers.Size(r,n)}return this.tileSize},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},calculateGridLayout:function(e,t,i){var s=i*this.tileSize.w,a=i*this.tileSize.h,r=e.left-t.lon,n=Math.floor(r/s)-this.buffer,o=r/s-n,l=-o*this.tileSize.w,h=t.lon+n*s,u=t.lat-e.top+a,p=Math.floor(u/a)-this.buffer,c=p-u/a,d=c*this.tileSize.h,m=t.lat-a*p;return{tilelon:s,tilelat:a,tileoffsetlon:h,tileoffsetlat:m,tileoffsetx:l,tileoffsety:d}},CLASS_NAME:"OpenLayers.Layer.Zoomify"}),OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(e){var t={url:!0,layer:!0,style:!0,matrixSet:!0};for(var i in t)if(!(i in e))throw Error("Missing property '"+i+"' in layer configuration.");e.params=OpenLayers.Util.upperCaseObject(e.params);var s=[e.name,e.url,e.params,e];if(OpenLayers.Layer.Grid.prototype.initialize.apply(this,s),this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()),this.matrixIds){var a=this.matrixIds.length;if(a&&"string"==typeof this.matrixIds[0]){var r=this.matrixIds;this.matrixIds=Array(a);for(var n=0;a>n;++n)this.matrixIds[n]={identifier:r[n]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.updateMatrixProperties()},updateMatrixProperties:function(){this.matrix=this.getMatrix(),this.matrix&&(this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=this.maxExtent))},moveTo:function(e,t){return(t||!this.matrix)&&this.updateMatrixProperties(),OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.WMTS(this.options)),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getMatrix:function(){var e;if(this.matrixIds&&0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0])for(var t,i=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.map.getResolution()/28e-5,s=Number.POSITIVE_INFINITY,a=0,r=this.matrixIds.length;r>a;++a)t=Math.abs(1-this.matrixIds[a].scaleDenominator/i),s>t&&(s=t,e=this.matrixIds[a]);else e=this.matrixIds[this.map.getZoom()+this.zoomOffset];else e={identifier:this.map.getZoom()+this.zoomOffset};return e},getTileInfo:function(e){var t=this.map.getResolution(),i=(e.lon-this.tileOrigin.lon)/(t*this.tileSize.w),s=(this.tileOrigin.lat-e.lat)/(t*this.tileSize.h),a=Math.floor(i),r=Math.floor(s);return{col:a,row:r,i:Math.floor((i-a)*this.tileSize.w),j:Math.floor((s-r)*this.tileSize.h)}},getURL:function(e){e=this.adjustBounds(e);var t="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(e)){var i=e.getCenterLonLat(),s=this.getTileInfo(i);if(this.matrix.identifier,"REST"===this.requestEncoding.toUpperCase()){var a=this.version+"/"+this.layer+"/"+this.style+"/";if(this.dimensions)for(var r=0;this.dimensions.length>r;r++)this.params[this.dimensions[r]]&&(a=a+this.params[this.dimensions[r]]+"/");a=a+this.matrixSet+"/"+this.matrix.identifier+"/"+s.row+"/"+s.col+"."+this.formatSuffix,t=OpenLayers.Util.isArray(this.url)?this.selectUrl(a,this.url):this.url,t.match(/\/$/)||(t+="/"),t+=a}else if("KVP"===this.requestEncoding.toUpperCase()){var n={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:s.row,TILECOL:s.col,FORMAT:this.format};t=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[n])}}return t},mergeNewParams:function(e){return"KVP"===this.requestEncoding.toUpperCase()?OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(e)]):void 0},CLASS_NAME:"OpenLayers.Layer.WMTS"}),OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var e=document.createStyleSheet(),t=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],i=0,s=t.length;s>i;i++)e.addRule("olv\\:"+t[i],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(e,t){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var i=this.getResolution(),s=0|e.left/i,a=0|e.top/i-this.size.h;t||!this.offset?(this.offset={x:s,y:a},s=0,a=0):(s-=this.offset.x,a-=this.offset.y);var r=s+" "+a;this.root.coordorigin=r;for(var n,o=[this.root,this.vectorRoot,this.textRoot],l=0,h=o.length;h>l;++l){n=o[l];var u=this.size.w+" "+this.size.h;n.coordsize=u}return this.root.style.flip="y",!0},setSize:function(){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var e,t=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],i=this.size.w+"px",s=this.size.h+"px",a=0,r=t.length;r>a;++a)e=t[a],e.style.width=i,e.style.height=s},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":i=t.externalGraphic?"olv:rect":this.isComplexSymbol(t.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":i="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":i="olv:shape";break;default:}return i},setStyle:function(e,t,i,s){t=t||e._style,i=i||e._options;var a=t.fillColor;if("OpenLayers.Geometry.Point"===e._geometryClass)if(t.externalGraphic){i.isFilled=!0,t.graphicTitle&&(e.title=t.graphicTitle);var r=t.graphicWidth||t.graphicHeight,n=t.graphicHeight||t.graphicWidth;r=r?r:2*t.pointRadius,n=n?n:2*t.pointRadius;var o=this.getResolution(),l=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*r),h=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*n);e.style.left=(0|s.x/o-this.offset.x+l)+"px",e.style.top=(0|s.y/o-this.offset.y-(h+n))+"px",e.style.width=r+"px",e.style.height=n+"px",e.style.flip="y",a="none",i.isStroked=!1}else if(this.isComplexSymbol(t.graphicName)){var u=this.importSymbol(t.graphicName);e.path=u.path,e.coordorigin=u.left+","+u.bottom;var p=u.size;e.coordsize=p+","+p,this.drawCircle(e,s,t.pointRadius),e.style.flip="y"}else this.drawCircle(e,s,t.pointRadius);i.isFilled?e.fillcolor=a:e.filled="false";var c=e.getElementsByTagName("fill"),d=0==c.length?null:c[0];i.isFilled?(d||(d=this.createNode("olv:fill",e.id+"_fill")),d.opacity=t.fillOpacity,"OpenLayers.Geometry.Point"===e._geometryClass&&t.externalGraphic&&(t.graphicOpacity&&(d.opacity=t.graphicOpacity),d.src=t.externalGraphic,d.type="frame",t.graphicWidth&&t.graphicHeight||(d.aspect="atmost")),d.parentNode!=e&&e.appendChild(d)):d&&e.removeChild(d);var m=t.rotation;(void 0!==m||void 0!==e._rotation)&&(e._rotation=m,t.externalGraphic?(this.graphicRotate(e,l,h,t),d.opacity=0):"OpenLayers.Geometry.Point"===e._geometryClass&&(e.style.rotation=m||0));var y=e.getElementsByTagName("stroke"),f=0==y.length?null:y[0];return i.isStroked?(f||(f=this.createNode("olv:stroke",e.id+"_stroke"),e.appendChild(f)),f.on=!0,f.color=t.strokeColor,f.weight=t.strokeWidth+"px",f.opacity=t.strokeOpacity,f.endcap="butt"==t.strokeLinecap?"flat":t.strokeLinecap||"round",t.strokeDashstyle&&(f.dashstyle=this.dashStyle(t))):(e.stroked=!1,f&&(f.on=!1)),"inherit"!=t.cursor&&null!=t.cursor&&(e.style.cursor=t.cursor),e},graphicRotate:function(e,t,i,s){var a,r,s=s||e._style,n=s.rotation||0;if(!s.graphicWidth||!s.graphicHeight){var o=new Image;return o.onreadystatechange=OpenLayers.Function.bind(function(){("complete"==o.readyState||"interactive"==o.readyState)&&(a=o.width/o.height,r=Math.max(2*s.pointRadius,s.graphicWidth||0,s.graphicHeight||0),t*=a,s.graphicWidth=r*a,s.graphicHeight=r,this.graphicRotate(e,t,i,s))},this),o.src=s.externalGraphic,void 0}r=Math.max(s.graphicWidth,s.graphicHeight),a=s.graphicWidth/s.graphicHeight;var l=Math.round(s.graphicWidth||r*a),h=Math.round(s.graphicHeight||r);e.style.width=l+"px",e.style.height=h+"px";var u=document.getElementById(e.id+"_image");u||(u=this.createNode("olv:imagedata",e.id+"_image"),e.appendChild(u)),u.style.width=l+"px",u.style.height=h+"px",u.src=s.externalGraphic,u.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var p=n*Math.PI/180,c=Math.sin(p),d=Math.cos(p),m="progid:DXImageTransform.Microsoft.Matrix(M11="+d+",M12="+-c+",M21="+c+",M22="+d+",SizingMethod='auto expand')\n",y=s.graphicOpacity||s.fillOpacity;y&&1!=y&&(m+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+y+")\n"),e.style.filter=m;var f=new OpenLayers.Geometry.Point(-t,-i),g=new OpenLayers.Bounds(0,0,l,h).toGeometry();g.rotate(s.rotation,f);var v=g.getBounds();e.style.left=Math.round(parseInt(e.style.left)+v.left)+"px",e.style.top=Math.round(parseInt(e.style.top)-v.bottom)+"px"},postDraw:function(e){e.style.visibility="visible";var t=e._style.fillColor,i=e._style.strokeColor;"none"==t&&e.fillcolor!=t&&(e.fillcolor=t),"none"==i&&e.strokecolor!=i&&(e.strokecolor=i)},setNodeDimension:function(e,t){var i=t.getBounds();if(i){var s=this.getResolution(),a=new OpenLayers.Bounds(0|i.left/s-this.offset.x,0|i.bottom/s-this.offset.y,0|i.right/s-this.offset.x,0|i.top/s-this.offset.y);e.style.left=a.left+"px",e.style.top=a.top+"px",e.style.width=a.getWidth()+"px",e.style.height=a.getHeight()+"px",e.coordorigin=a.left+" "+a.top,e.coordsize=a.getWidth()+" "+a.getHeight()}},dashStyle:function(e){var t=e.strokeDashstyle;switch(t){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return t;default:var i=t.split(/[ ,]/);return 2==i.length?1*i[0]>=2*i[1]?"longdash":1==i[0]||1==i[1]?"dot":"dash":4==i.length?1*i[0]>=2*i[1]?"longdashdot":"dashdot":"solid"}},createNode:function(e,t){var i=document.createElement(e);return t&&(i.id=t),i.unselectable="on",i.onselectstart=OpenLayers.Function.False,i},nodeTypeCompare:function(e,t){var i=t,s=i.indexOf(":");-1!=s&&(i=i.substr(s+1));var a=e.nodeName;return s=a.indexOf(":"),-1!=s&&(a=a.substr(s+1)),i==a},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(e){return this.nodeFactory(this.container.id+e,"olv:group")},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){if(!isNaN(t.x)&&!isNaN(t.y)){var s=this.getResolution();e.style.left=(0|t.x/s-this.offset.x)-i+"px",e.style.top=(0|t.y/s-this.offset.y)-i+"px";var a=2*i;return e.style.width=a+"px",e.style.height=a+"px",e}return!1},drawLineString:function(e,t){return this.drawLine(e,t,!1)},drawLinearRing:function(e,t){return this.drawLine(e,t,!0)},drawLine:function(e,t,i){this.setNodeDimension(e,t);for(var s,a,r,n=this.getResolution(),o=t.components.length,l=Array(o),h=0;o>h;h++)s=t.components[h],a=0|s.x/n-this.offset.x,r=0|s.y/n-this.offset.y,l[h]=" "+a+","+r+" l ";var u=i?" x e":" e";return e.path="m"+l.join("")+u,e},drawPolygon:function(e,t){this.setNodeDimension(e,t);var i,s,a,r,n,o,l,h,u,p,c,d,m=this.getResolution(),y=[];for(i=0,s=t.components.length;s>i;i++){for(y.push("m"),a=t.components[i].components,r=0===i,n=null,o=null,l=0,h=a.length;h>l;l++)u=a[l],c=0|u.x/m-this.offset.x,d=0|u.y/m-this.offset.y,p=" "+c+","+d,y.push(p),0==l&&y.push(" l"),r||(n?n!=p&&(o?o!=p&&(r=!0):o=p):n=p);y.push(r?" x ":" ")}return y.push("e"),e.path=y.join(""),e},drawRectangle:function(e,t){var i=this.getResolution();return e.style.left=(0|t.x/i-this.offset.x)+"px",e.style.top=(0|t.y/i-this.offset.y)+"px",e.style.width=(0|t.width/i)+"px",e.style.height=(0|t.height/i)+"px",e},drawText:function(e,t,i){var s=this.nodeFactory(e+this.LABEL_ID_SUFFIX,"olv:rect"),a=this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),r=this.getResolution();s.style.left=(0|i.x/r-this.offset.x)+"px",s.style.top=(0|i.y/r-this.offset.y)+"px",s.style.flip="y",a.innerText=t.label,"inherit"!=t.cursor&&null!=t.cursor&&(a.style.cursor=t.cursor),t.fontColor&&(a.style.color=t.fontColor),t.fontOpacity&&(a.style.filter="alpha(opacity="+100*t.fontOpacity+")"),t.fontFamily&&(a.style.fontFamily=t.fontFamily),t.fontSize&&(a.style.fontSize=t.fontSize),t.fontWeight&&(a.style.fontWeight=t.fontWeight),t.fontStyle&&(a.style.fontStyle=t.fontStyle),t.labelSelect===!0&&(s._featureId=e,a._featureId=e,a._geometry=i,a._geometryClass=i.CLASS_NAME),a.style.whiteSpace="nowrap",a.inset="1px,0px,0px,0px",s.parentNode||(s.appendChild(a),this.textRoot.appendChild(s));var n=t.labelAlign||"cm";1==n.length&&(n+="m");var o=a.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[n.substr(0,1)],l=a.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[n.substr(1,1)];s.style.left=parseInt(s.style.left)-o-1+"px",s.style.top=parseInt(s.style.top)+l+"px"},drawSurface:function(e,t){this.setNodeDimension(e,t);for(var i,s,a,r=this.getResolution(),n=[],o=0,l=t.components.length;l>o;o++)i=t.components[o],s=0|i.x/r-this.offset.x,a=0|i.y/r-this.offset.y,0==o%3&&0==o/3?n.push("m"):1==o%3&&n.push(" c"),n.push(" "+s+","+a);return n.push(" x e"),e.path=n.join(""),e},moveRoot:function(e){var t=this.map.getLayer(e.container.id);t instanceof OpenLayers.Layer.Vector.RootContainer&&(t=this.map.getLayer(this.container.id)),t&&t.renderer.clear(),OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments),t&&t.redraw()},importSymbol:function(e){var t=this.container.id+"-"+e,i=this.symbolCache[t];if(i)return i;var s=OpenLayers.Renderer.symbol[e];if(!s)throw Error(e+" is not a valid symbol name");for(var a=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),r=["m"],n=0;s.length>n;n+=2){var o=s[n],l=s[n+1];a.left=Math.min(a.left,o),a.bottom=Math.min(a.bottom,l),a.right=Math.max(a.right,o),a.top=Math.max(a.top,l),r.push(o),r.push(l),0==n&&r.push("l")}r.push("x e");var h=r.join(" "),u=(a.getWidth()-a.getHeight())/2;return u>0?(a.bottom=a.bottom-u,a.top=a.top+u):(a.left=a.left+u,a.right=a.right-u),i={path:h,size:a.getWidth(),left:a.left,bottom:a.bottom},this.symbolCache[t]=i,i},CLASS_NAME:"OpenLayers.Renderer.VML"}),OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1},OpenLayers.Layer.MultiMap=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:1,MAX_ZOOM_LEVEL:17,RESOLUTIONS:[9,1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20],type:null,initialize:function(){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments),OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments),this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters(),this.RESOLUTIONS.unshift(10))},loadMapObject:function(){try{this.mapObject=new MultimapViewer(this.div)}catch(e){}},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"MM",layerLib:"MultiMap"})},setMapObjectCenter:function(e,t){this.mapObject.goToPosition(e,t)},getMapObjectCenter:function(){return this.mapObject.getCurrentPosition()},getMapObjectZoom:function(){return this.mapObject.getZoomFactor()},getMapObjectLonLatFromMapObjectPixel:function(e){return e.x=e.x-this.map.getSize().w/2,e.y=e.y-this.map.getSize().h/2,this.mapObject.getMapPositionAt(e)},getMapObjectPixelFromMapObjectLonLat:function(e){return this.mapObject.geoPosToContainerPixels(e)},getLongitudeFromMapObjectLonLat:function(e){return this.sphericalMercator?this.forwardMercator(e.lon,e.lat).lon:e.lon},getLatitudeFromMapObjectLonLat:function(e){return this.sphericalMercator?this.forwardMercator(e.lon,e.lat).lat:e.lat},getMapObjectLonLatFromLonLat:function(e,t){var i;if(this.sphericalMercator){var s=this.inverseMercator(e,t);i=new MMLatLon(s.lat,s.lon)}else i=new MMLatLon(t,e);return i},getXFromMapObjectPixel:function(e){return e.x},getYFromMapObjectPixel:function(e){return e.y},getMapObjectPixelFromXY:function(e,t){return new MMPoint(e,t)},CLASS_NAME:"OpenLayers.Layer.MultiMap"}),OpenLayers.Lang.km=OpenLayers.Util.applyDefaults({Permalink:"តំណភ្ជាប់អចិន្ត្រៃយ៍","Base Layer":"ស្រទាប់បាត​",errorLoadingGML:"កំហុសកំឡុងពេលផ្ទុកឯកសារ GML ${url}","Scale = 1 : ${scaleDenom}":"មាត្រដ្ឋាន = ១ ៖ ${scaleDenom}"}),OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"}),OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,requestEncoding:"KVP",drillDown:!1,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:!0,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,EVENT_TYPES:["beforegetfeatureinfo","getfeatureinfo","exception"],pending:0,initialize:function(e){if(this.EVENT_TYPES=OpenLayers.Control.WMTSGetFeatureInfo.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES),e=e||{},e.handlerOptions=e.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[e]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions)),this.drillDown===!0&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var t={};t[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,t,this.handlerOptions.click||{})}},getInfoForClick:function(e){this.request(e.xy,{})},getInfoForHover:function(e){this.request(e.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(--this.pending,0>=this.pending&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var e,t=this.layers||this.map.layers,i=[],s=t.length-1;s>=0&&(e=t[s],!(e instanceof OpenLayers.Layer.WMTS&&e.requestEncoding===this.requestEncoding)||this.queryVisible&&!e.getVisibility()||(i.push(e),this.drillDown&&!this.hover));--s);return i},buildRequestOptions:function(e,t){var i=this.map.getLonLatFromPixel(t),s=e.getURL(new OpenLayers.Bounds(i.lon,i.lat,i.lon,i.lat)),a=OpenLayers.Util.getParameters(s),r=e.getTileInfo(i);return OpenLayers.Util.extend(a,{service:"WMTS",version:e.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:r.i,j:r.j}),OpenLayers.Util.applyDefaults(a,this.vendorParams),{url:OpenLayers.Util.isArray(e.url)?e.url[0]:e.url,params:OpenLayers.Util.upperCaseObject(a),callback:function(i){this.handleResponse(t,i,e)},scope:this}},request:function(e,t){t=t||{};var i=this.findLayers();if(i.length>0){for(var s,a,r=0,n=i.length;n>r;r++)if(a=i[r],s=this.events.triggerEvent("beforegetfeatureinfo",{xy:e,layer:a}),s!==!1){++this.pending;var o=this.buildRequestOptions(a,e),l=OpenLayers.Request.GET(o);t.hover===!0&&(this.hoverRequest=l)}this.pending>0&&OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")}},handleResponse:function(e,t,i){if(--this.pending,0>=this.pending&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),t.status&&(200>t.status||t.status>=300))this.events.triggerEvent("exception",{xy:e,request:t,layer:i});else{var s=t.responseXML;s&&s.documentElement||(s=t.responseText);var a,r;try{a=this.format.read(s)}catch(n){r=!0,this.events.triggerEvent("exception",{xy:e,request:t,error:n,layer:i})}r||this.events.triggerEvent("getfeatureinfo",{text:t.responseText,features:a,request:t,xy:e,layer:i})}},CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"}),OpenLayers.Lang.bg=OpenLayers.Util.applyDefaults({Permalink:"Постоянна препратка","Base Layer":"Основен слой",errorLoadingGML:"Грешка при зареждане на GML файл ${url}","Scale = 1 : ${scaleDenom}":"Мащаб = 1 : ${scaleDenom}",layerAlreadyAdded:"Опитахте да добавите слой ${layerName} в картата, но той вече е добавен",methodDeprecated:"Този метод е остарял и ще бъде премахват в 3.0. Вместо него използвайте ${newMethod}."}),OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,intervals:[45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001],displayInLayerSwitcher:!0,visible:!0,numPoints:50,targetSize:200,layerName:null,labelled:!0,labelFormat:"dm",lineSymbolizer:{strokeColor:"#333",strokeWidth:1,strokeOpacity:.5},labelSymbolizer:{},gratLayer:null,initialize:function(e){e=e||{},e.layerName=e.layerName||OpenLayers.i18n("Graticule"),OpenLayers.Control.prototype.initialize.apply(this,[e]),this.labelSymbolizer.stroke=!1,this.labelSymbolizer.fill=!1,this.labelSymbolizer.label="${label}",this.labelSymbolizer.labelAlign="${labelAlign}",this.labelSymbolizer.labelXOffset="${xOffset}",this.labelSymbolizer.labelYOffset="${yOffset}"},destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.gratLayer&&(this.gratLayer.destroy(),this.gratLayer=null)},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.gratLayer){var e=new OpenLayers.Style({},{rules:[new OpenLayers.Rule({symbolizer:{Point:this.labelSymbolizer,Line:this.lineSymbolizer}})]});this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,{styleMap:new OpenLayers.StyleMap({"default":e}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher})}return this.div},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.addLayer(this.gratLayer),this.map.events.register("moveend",this,this.update),this.update(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("moveend",this,this.update),this.map.removeLayer(this.gratLayer),!0):!1},update:function(){var e=this.map.getExtent();if(e){this.gratLayer.destroyFeatures();var t=new OpenLayers.Projection("EPSG:4326"),i=this.map.getProjectionObject(),s=this.map.getResolution();i.proj&&"longlat"==i.proj.projName&&(this.numPoints=1);var a=this.map.getCenter(),r=new OpenLayers.Pixel(a.lon,a.lat);OpenLayers.Projection.transform(r,i,t);var n=this.targetSize*s;n*=n;for(var o,l=0;this.intervals.length>l;++l){o=this.intervals[l];var h=o/2,u=r.offset(new OpenLayers.Pixel(-h,-h)),p=r.offset(new OpenLayers.Pixel(h,h));OpenLayers.Projection.transform(u,t,i),OpenLayers.Projection.transform(p,t,i);var c=(u.x-p.x)*(u.x-p.x)+(u.y-p.y)*(u.y-p.y);if(n>=c)break}r.x=Math.floor(r.x/o)*o,r.y=Math.floor(r.y/o)*o;var d,m=0,y=[r.clone()],f=r.clone();do f=f.offset(new OpenLayers.Pixel(0,o)),d=OpenLayers.Projection.transform(f.clone(),t,i),y.unshift(f);while(e.containsPixel(d)&&1e3>++m);f=r.clone();do f=f.offset(new OpenLayers.Pixel(0,-o)),d=OpenLayers.Projection.transform(f.clone(),t,i),y.push(f);while(e.containsPixel(d)&&1e3>++m);m=0;var g=[r.clone()];f=r.clone();do f=f.offset(new OpenLayers.Pixel(-o,0)),d=OpenLayers.Projection.transform(f.clone(),t,i),g.unshift(f);
while(e.containsPixel(d)&&1e3>++m);f=r.clone();do f=f.offset(new OpenLayers.Pixel(o,0)),d=OpenLayers.Projection.transform(f.clone(),t,i),g.push(f);while(e.containsPixel(d)&&1e3>++m);for(var v=[],l=0;g.length>l;++l){for(var L=g[l].x,b=[],O=null,S=Math.min(y[0].y,90),w=Math.max(y[y.length-1].y,-90),_=(S-w)/this.numPoints,x=w,k=0;this.numPoints>=k;++k){var C=new OpenLayers.Geometry.Point(L,x);C.transform(t,i),b.push(C),x+=_,C.y>=e.bottom&&!O&&(O=C)}if(this.labelled){var M=new OpenLayers.Geometry.Point(O.x,e.bottom),E={value:L,label:this.labelled?OpenLayers.Util.getFormattedLonLat(L,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:2};this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(M,E))}var P=new OpenLayers.Geometry.LineString(b);v.push(new OpenLayers.Feature.Vector(P))}for(var k=0;y.length>k;++k)if(x=y[k].y,!(-90>x||x>90)){for(var b=[],N=g[0].x,T=g[g.length-1].x,j=(T-N)/this.numPoints,L=N,O=null,l=0;this.numPoints>=l;++l){var C=new OpenLayers.Geometry.Point(L,x);C.transform(t,i),b.push(C),L+=j,C.x<e.right&&(O=C)}if(this.labelled){var M=new OpenLayers.Geometry.Point(e.right,O.y),E={value:x,label:this.labelled?OpenLayers.Util.getFormattedLonLat(x,"lat",this.labelFormat):"",labelAlign:"rb",xOffset:-2,yOffset:2};this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(M,E))}var P=new OpenLayers.Geometry.LineString(b);v.push(new OpenLayers.Feature.Vector(P))}this.gratLayer.addFeatures(v)}},CLASS_NAME:"OpenLayers.Control.Graticule"}),OpenLayers.Lang.hr=OpenLayers.Util.applyDefaults({unhandledRequest:"Nepodržani zahtjev ${statusText}",Permalink:"Permalink",Overlays:"Overlays","Base Layer":"Osnovna karta",readNotImplemented:"Čitanje nije implementirano.",writeNotImplemented:"Pisanje nije implementirano.",noFID:"Ne mogu ažurirati značajku za koju ne postoji FID.",errorLoadingGML:"Greška u učitavanju GML datoteke ${url}",browserNotSupported:"Vaš preglednik ne podržava vektorsko renderiranje. Trenutno podržani rendereri su: ${renderers}",componentShouldBe:"addFeatures : komponenta bi trebala biti ${geomType}",getFeatureError:"getFeatureFromEvent je pozvao Layer bez renderera. Ovo obično znači da ste uništiili Layer, a ne neki Handler koji je povezan s njim.",commitSuccess:"WFS Transakcija: USPJEŠNA ${response}",commitFailed:"WFS Transakcija: NEUSPJEŠNA ${response}","Scale = 1 : ${scaleDenom}":"Mjerilo = 1 : ${scaleDenom}",layerAlreadyAdded:"Pokušali ste dodati layer:  ${layerName} na kartu, ali je već dodan",methodDeprecated:"Ova metoda nije odobrena i biti će maknuta u 3.0. Koristite ${newMethod}.",boundsAddError:"Morate dati obje vrijednosti ,  x i y  da bi dodali funkciju.",lonlatAddError:"Morate dati obje vrijednosti , (lon i lat) da bi dodali funkciju.",pixelAddError:"Morate dati obje vrijednosti ,  x i y  da bi dodali funkciju.",unsupportedGeometryType:"Nepodržani tip geometrije: ${geomType}"}),OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,{url:null,params:null,callback:null,scope:null,format:null,callbackKey:"callback",callbackPrefix:"",pendingRequests:null,srsInBBOX:!1,initialize:function(e){if(e=e||{},this.params={},this.pendingRequests={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),this.format||(this.format=new OpenLayers.Format.GeoJSON),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var t=new OpenLayers.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,i){return t.write(e,i)}}},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=OpenLayers.Util.applyDefaults(e,this.options),e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params),e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=new OpenLayers.Protocol.Response({requestType:"read"}),i=this.createRequest(e.url,e.params,OpenLayers.Function.bind(function(i){t.data=i,this.handleRead(t,e)},this));return t.priv=i,t},createRequest:function(e,t,i){var s=OpenLayers.Protocol.Script.register(i),a="OpenLayers.Protocol.Script.registry["+s+"]";t=OpenLayers.Util.extend({},t),t[this.callbackKey]=this.callbackPrefix+a,e=OpenLayers.Util.urlAppend(e,OpenLayers.Util.getParameterString(t));var r=document.createElement("script");r.type="text/javascript",r.src=e,r.id="OpenLayers_Protocol_Script_"+s,this.pendingRequests[r.id]=r;var n=document.getElementsByTagName("head")[0];return n.appendChild(r),r},destroyRequest:function(e){OpenLayers.Protocol.Script.unregister(e.id.split("_").pop()),delete this.pendingRequests[e.id],e.parentNode&&e.parentNode.removeChild(e)},handleRead:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){t.callback&&(e.data?(e.features=this.parseFeatures(e.data),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,this.destroyRequest(e.priv),t.callback.call(t.scope,e))},parseFeatures:function(e){return this.format.read(e)},abort:function(e){if(e)this.destroyRequest(e.priv);else for(var t in this.pendingRequests)this.destroyRequest(this.pendingRequests[t])},destroy:function(){this.abort(),delete this.params,delete this.format,OpenLayers.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Protocol.Script"}),function(){var e=OpenLayers.Protocol.Script,t=0;e.registry=[],e.register=function(i){var s=++t;return e.registry[s]=function(){e.unregister(s),i.apply(this,arguments)},s},e.unregister=function(t){delete e.registry[t]}}(),OpenLayers.Tile.Image.IFrame={useIFrame:null,clear:function(){if(this.useIFrame){if(this.imgDiv){var e=this.imgDiv.firstChild;OpenLayers.Event.stopObservingElement(e),this.imgDiv.removeChild(e),delete e}}else OpenLayers.Tile.Image.prototype.clear.apply(this,arguments)},renderTile:function(){if(OpenLayers.Tile.Image.prototype.renderTile.apply(this,arguments)&&this.useIFrame){var e=this.createRequestForm();this.imgDiv.appendChild(e),e.submit(),this.imgDiv.removeChild(e),delete e}return!0},initImgDiv:function(){if(this.useIFrame=null!==this.maxGetUrlLength&&!this.layer.async&&this.url.length>this.maxGetUrlLength,null!=this.imgDiv){var e=this.imgDiv.nodeName.toLowerCase();(this.useIFrame&&"img"==e||!this.useIFrame&&"div"==e)&&(this.removeImgDiv(),this.imgDiv=null)}if(this.useIFrame){if(null==this.imgDiv){var t=document.createElement("div");"msie"==OpenLayers.BROWSER_NAME&&(t.style.backgroundColor="#FFFFFF",t.style.filter="chroma(color=#FFFFFF)"),OpenLayers.Util.modifyDOMElement(t,null,new OpenLayers.Pixel(0,0),this.layer.getImageSize(),"absolute"),this.imgDiv=document.createElement("div"),this.imgDiv.appendChild(t),OpenLayers.Util.modifyDOMElement(this.imgDiv,this.id,null,this.layer.getImageSize(),"relative"),this.imgDiv.className="olTileImage",this.frame.appendChild(this.imgDiv),this.layer.div.appendChild(this.frame),null!=this.layer.opacity&&OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity),this.imgDiv.map=this.layer.map}this.imgDiv.viewRequestID=this.layer.map.viewRequestID}else OpenLayers.Tile.Image.prototype.initImgDiv.apply(this,arguments)},createIFrame:function(){var e,t=this.id+"_iFrame";"msie"==OpenLayers.BROWSER_NAME?(e=document.createElement('<iframe name="'+t+'">'),e.style.backgroundColor="#FFFFFF",e.style.filter="chroma(color=#FFFFFF)"):(e=document.createElement("iframe"),e.style.backgroundColor="transparent",e.name=t),e.id=t,e.scrolling="no",e.marginWidth="0px",e.marginHeight="0px",e.frameBorder="0",OpenLayers.Util.modifyDOMElement(e,t,new OpenLayers.Pixel(0,0),this.layer.getImageSize(),"absolute");var i=function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("loadend"))};return OpenLayers.Event.observe(e,"load",OpenLayers.Function.bind(i,this)),e},createRequestForm:function(){var e=document.createElement("form");e.method="POST";var t=this.layer.params._OLSALT;t=(t?t+"_":"")+this.bounds.toBBOX(),e.action=OpenLayers.Util.urlAppend(this.layer.url,t),this.imgDiv.insertBefore(this.createIFrame(),this.imgDiv.firstChild),e.target=this.id+"_iFrame",this.layer.getImageSize();var i=OpenLayers.Util.getParameters(this.url);for(var s in i){var a=document.createElement("input");a.type="hidden",a.name=s,a.value=i[s],e.appendChild(a)}return e}},OpenLayers.Layer.WMS.Post=OpenLayers.Class(OpenLayers.Layer.WMS,{unsupportedBrowsers:["mozilla","firefox","opera"],SUPPORTED_TRANSITIONS:[],usePost:null,initialize:function(e,t,i,s){var a=[];a.push(e,t,i,s),OpenLayers.Layer.WMS.prototype.initialize.apply(this,a),this.usePost=-1==OpenLayers.Util.indexOf(this.unsupportedBrowsers,OpenLayers.BROWSER_NAME)},addTile:function(e,t){return new OpenLayers.Tile.Image(this,t,e,null,this.tileSize,{maxGetUrlLength:this.usePost?0:null})},CLASS_NAME:"OpenLayers.Layer.WMS.Post"}),OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforesetfeature","setfeature","beforetransform","transform","transformcomplete"],geometryTypes:null,layer:null,preserveAspectRatio:!1,rotate:!0,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,initialize:function(e,t){this.EVENT_TYPES=OpenLayers.Control.TransformFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES),OpenLayers.Control.prototype.initialize.apply(this,[t]),this.layer=e,this.rotationHandleSymbolizer||(this.rotationHandleSymbolizer={stroke:!1,pointRadius:10,fillOpacity:0,cursor:"pointer"}),this.createBox(),this.createControl()},activate:function(){var e=!1;return OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragControl.activate(),this.layer.addFeatures([this.box]),this.rotate&&this.layer.addFeatures(this.rotationHandles),this.layer.addFeatures(this.handles),e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.layer.removeFeatures(this.handles),this.rotate&&this.layer.removeFeatures(this.rotationHandles),this.layer.removeFeatures([this.box]),this.dragControl.deactivate(),e=!0),e&&this.unsetFeature(),e},setMap:function(e){this.dragControl.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setFeature:function(e,t){t=OpenLayers.Util.applyDefaults(t,{rotation:0,scale:1,ratio:1});var i=this.rotation,s=this.center;OpenLayers.Util.extend(this,t);var a=this.events.triggerEvent("beforesetfeature",{feature:e});if(a!==!1){this.feature=e,this.activate(),this._setfeature=!0;var r=this.feature.geometry.getBounds();this.box.move(r.getCenterLonLat()),this.box.geometry.rotate(-i,s),this._angle=0;var n;if(this.rotation){var o=e.geometry.clone();o.rotate(-this.rotation,this.center);var l=new OpenLayers.Feature.Vector(o.getBounds().toGeometry());l.geometry.rotate(this.rotation,this.center),this.box.geometry.rotate(this.rotation,this.center),this.box.move(l.geometry.getBounds().getCenterLonLat());var h=l.geometry.components[0].components[0];n=h.getBounds().getCenterLonLat()}else n=new OpenLayers.LonLat(r.left,r.bottom);this.handles[0].move(n),delete this._setfeature,this.events.triggerEvent("setfeature",{feature:e})}},unsetFeature:function(){this.active?this.deactivate():(this.feature=null,this.rotation=0,this.scale=1,this.ratio=1)},createBox:function(){var e=this;this.center=new OpenLayers.Geometry.Point(0,0);var t=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,"string"==typeof this.renderIntent?null:this.renderIntent);t.geometry.move=function(t,i){e._moving=!0,OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments),e.center.move(t,i),delete e._moving};for(var i,s,a,r=function(e,t){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.move(e,t),this._handle.geometry.move(e,t)},n=function(e,t,i){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.resize(e,t,i),this._handle.geometry.resize(e,t,i)},o=function(e,t){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.rotate(e,t),this._handle.geometry.rotate(e,t)},l=function(t,i){var s=this.x,a=this.y;if(OpenLayers.Geometry.Point.prototype.move.call(this,t,i),!e._moving){var r=e.dragControl.handlers.drag.evt,n=!e._setfeature&&e.preserveAspectRatio,o=!(n||r&&r.shiftKey),l=new OpenLayers.Geometry.Point(s,a),h=e.center;this.rotate(-e.rotation,h),l.rotate(-e.rotation,h);var u=this.x-h.x,p=this.y-h.y,c=u-(this.x-l.x),d=p-(this.y-l.y);this.x=s,this.y=a;var m,y=1;if(o)m=1e-5>Math.abs(d)?1:p/d,y=(1e-5>Math.abs(c)?1:u/c)/m;else{var f=Math.sqrt(c*c+d*d),g=Math.sqrt(u*u+p*p);m=g/f}e._moving=!0,e.box.geometry.rotate(-e.rotation,h),delete e._moving,e.box.geometry.resize(m,h,y),e.box.geometry.rotate(e.rotation,h),e.transformFeature({scale:m,ratio:y})}},h=function(t,i){var s=this.x,a=this.y;if(OpenLayers.Geometry.Point.prototype.move.call(this,t,i),!e._moving){var r=e.dragControl.handlers.drag.evt,n=r&&r.shiftKey?45:1,o=e.center,l=this.x-o.x,h=this.y-o.y,u=l-t,p=h-i;this.x=s,this.y=a;var c=Math.atan2(p,u),d=Math.atan2(h,l),m=d-c;m*=180/Math.PI,e._angle=(e._angle+m)%360;var y=e.rotation%n;(Math.abs(e._angle)>=n||0!==y)&&(m=Math.round(e._angle/n)*n-y,e._angle=0,e.box.geometry.rotate(m,o),e.transformFeature({rotation:m}))}},u=Array(8),p=Array(4),c=0;8>c;++c)i=t.geometry.components[c],s=new OpenLayers.Feature.Vector(i.clone(),null,"string"==typeof this.renderIntent?null:this.renderIntent),0==c%2&&(a=new OpenLayers.Feature.Vector(i.clone(),null,"string"==typeof this.rotationHandleSymbolizer?null:this.rotationHandleSymbolizer),a.geometry.move=h,i._rotationHandle=a,p[c/2]=a),i.move=r,i.resize=n,i.rotate=o,s.geometry.move=l,i._handle=s,u[c]=s;this.box=t,this.rotationHandles=p,this.handles=u},createControl:function(){var e=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:!0,moveFeature:function(){this.feature===e.feature&&(this.feature=e.box),OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(t){t===e.box&&(e.transformFeature({center:e.center}),e.drawHandles())},onStart:function(t){var i=!e.geometryTypes||-1!==OpenLayers.Util.indexOf(e.geometryTypes,t.geometry.CLASS_NAME),s=OpenLayers.Util.indexOf(e.handles,t);s+=OpenLayers.Util.indexOf(e.rotationHandles,t),t!==e.feature&&t!==e.box&&-2==s&&i&&e.setFeature(t)},onComplete:function(){e.events.triggerEvent("transformcomplete",{feature:e.feature})}})},drawHandles:function(){for(var e=this.layer,t=0;8>t;++t)this.rotate&&0===t%2&&e.drawFeature(this.rotationHandles[t/2],this.rotationHandleSymbolizer),e.drawFeature(this.handles[t],this.renderIntent)},transformFeature:function(e){if(!this._setfeature){this.scale*=e.scale||1,this.ratio*=e.ratio||1;var t=this.rotation;if(this.rotation=(this.rotation+(e.rotation||0))%360,this.events.triggerEvent("beforetransform",e)!==!1){var i=this.feature,s=i.geometry,a=this.center;s.rotate(-t,a),e.scale||e.ratio?s.resize(e.scale,a,e.ratio):e.center&&i.move(e.center.getBounds().getCenterLonLat()),s.rotate(this.rotation,a),this.layer.drawFeature(i),i.toState(OpenLayers.State.UPDATE),this.events.triggerEvent("transform",e)}}this.layer.drawFeature(this.box,this.renderIntent),this.drawHandles()},destroy:function(){for(var e,t=0;8>t;++t)e=this.box.geometry.components[t],e._handle.destroy(),e._handle=null,e._rotationHandle&&e._rotationHandle.destroy(),e._rotationHandle=null;this.box.destroy(),this.box=null,this.layer=null,this.dragControl.destroy(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.TransformFeature"}),OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(){if(OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0])),this.layerInfo){var e=this.layerInfo,t=new OpenLayers.Bounds(e.fullExtent.xmin,e.fullExtent.ymin,e.fullExtent.xmax,e.fullExtent.ymax);if(this.projection="EPSG:"+e.spatialReference.wkid,this.sphericalMercator=102100==e.spatialReference.wkid,this.units="esriFeet"==e.units?"ft":"m",e.tileInfo){this.tileSize=new OpenLayers.Size(e.tileInfo.width||e.tileInfo.cols,e.tileInfo.height||e.tileInfo.rows),this.tileOrigin=new OpenLayers.LonLat(e.tileInfo.origin.x,e.tileInfo.origin.y);var i=new OpenLayers.Geometry.Point(t.left,t.top),s=new OpenLayers.Geometry.Point(t.right,t.bottom);this.useScales?this.scales=[]:this.resolutions=[],this.lods=[];for(var a in e.tileInfo.lods)if(e.tileInfo.lods.hasOwnProperty(a)){var r=e.tileInfo.lods[a];this.useScales?this.scales.push(r.scale):this.resolutions.push(r.resolution);var n=this.getContainingTileCoords(i,r.resolution);r.startTileCol=n.x,r.startTileRow=n.y;var o=this.getContainingTileCoords(s,r.resolution);r.endTileCol=o.x,r.endTileRow=o.y,this.lods.push(r)}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]),this.serverResolutions=this.resolutions,this.overrideDPI&&e.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=e.tileInfo.dpi)}}},getContainingTileCoords:function(e,t){return new OpenLayers.Pixel(Math.max(Math.floor((e.x-this.tileOrigin.lon)/(this.tileSize.w*t)),0),Math.max(Math.floor((this.tileOrigin.lat-e.y)/(this.tileSize.h*t)),0))},calculateMaxExtentWithLOD:function(e){var t=e.endTileCol-e.startTileCol+1,i=e.endTileRow-e.startTileRow+1,s=this.tileOrigin.lon+e.startTileCol*this.tileSize.w*e.resolution,a=s+t*this.tileSize.w*e.resolution,r=this.tileOrigin.lat-e.startTileRow*this.tileSize.h*e.resolution,n=r-i*this.tileSize.h*e.resolution;return new OpenLayers.Bounds(s,n,a,r)},calculateMaxExtentWithExtent:function(e,t){var i=new OpenLayers.Geometry.Point(e.left,e.top),s=new OpenLayers.Geometry.Point(e.right,e.bottom),a=this.getContainingTileCoords(i,t),r=this.getContainingTileCoords(s,t),n={resolution:t,startTileCol:a.x,startTileRow:a.y,endTileCol:r.x,endTileRow:r.y};return this.calculateMaxExtentWithLOD(n)},getUpperLeftTileCoord:function(e){var t=new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top);return this.getContainingTileCoords(t,e)},getLowerRightTileCoord:function(e){var t=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(t,e)},getMaxExtentForResolution:function(e){var t=this.getUpperLeftTileCoord(e),i=this.getLowerRightTileCoord(e),s=i.x-t.x+1,a=i.y-t.y+1,r=this.tileOrigin.lon+t.x*this.tileSize.w*e,n=r+s*this.tileSize.w*e,o=this.tileOrigin.lat-t.y*this.tileSize.h*e,l=o-a*this.tileSize.h*e;return new OpenLayers.Bounds(r,l,n,o)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options)),OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},getMaxExtent:function(){var e=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(e)},getTileOrigin:function(){var e=this.getMaxExtent();return new OpenLayers.LonLat(e.left,e.bottom)},getURL:function(e){var t=this.getResolution(),i=this.tileOrigin.lon+t*this.tileSize.w/2,s=this.tileOrigin.lat-t*this.tileSize.h/2,a=e.getCenterLonLat();({x:a.lon,y:a.lat});var r=Math.round(Math.abs((a.lon-i)/(t*this.tileSize.w))),n=Math.round(Math.abs((s-a.lat)/(t*this.tileSize.h))),o=this.map.getZoom();if(this.lods){var l=this.lods[this.map.getZoom()];if(l.startTileCol>r||r>l.endTileCol||l.startTileRow>n||n>l.endTileRow)return null}else{var h=this.getUpperLeftTileCoord(t),u=this.getLowerRightTileCoord(t);if(h.x>r||r>=u.x||h.y>n||n>=u.y)return null}var p=this.url,c=""+r+n+o;return OpenLayers.Util.isArray(p)&&(p=this.selectUrl(c,p)),this.useArcGISServer?p+="/tile/${z}/${y}/${x}":(r="C"+this.zeroPad(r,8,16),n="R"+this.zeroPad(n,8,16),o="L"+this.zeroPad(o,2,16),p=p+"/${z}/${y}/${x}."+this.type),p=OpenLayers.String.format(p,{x:r,y:n,z:o})},zeroPad:function(e,t,i){for(var s=e.toString(i||10);t>s.length;)s="0"+s;return s},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"}),OpenLayers.Lang["be-tarask"]=OpenLayers.Util.applyDefaults({unhandledRequest:"Неапрацаваны вынік запыту ${statusText}",Permalink:"Сталая спасылка",Overlays:"Слаі","Base Layer":"Базавы слой",readNotImplemented:"Функцыянальнасьць чытаньня ня створаная.",writeNotImplemented:"Функцыянальнасьць запісу ня створаная.",noFID:"Немагчыма абнавіць магчымасьць, для якога не існуе FID.",errorLoadingGML:"Памылка загрузкі файла GML ${url}",browserNotSupported:"Ваш браўзэр не падтрымлівае вэктарную графіку. У цяперашні момант падтрымліваюцца: ${renderers}",componentShouldBe:"addFeatures : кампанэнт павінен быць ${geomType}",getFeatureError:"getFeatureFromEvent выкліканы для слоя бяз рэндэру. Звычайна гэта азначае, што Вы зьнішчылі слой, але пакінулі зьвязаны зь ім апрацоўшчык.",minZoomLevelError:"Уласьцівасьць minZoomLevel прызначана толькі для выкарыстаньня са слаямі вытворнымі ад FixedZoomLevels. Тое, што  гэты wfs-слой правяраецца на minZoomLevel — рэха прошлага. Але мы ня можам выдаліць гэтую магчымасьць, таму што ад яе залежаць некаторыя заснаваныя на OL дастасаваньні. Тым ня менш, праверка minZoomLevel будзе выдаленая ў вэрсіі 3.0. Калі ласка, выкарыстоўваеце замест яе ўстаноўкі мінімальнага/максымальнага памераў, як апісана тут: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS-транзакцыя: ПОСЬПЕХ ${response}",commitFailed:"WFS-транзакцыя: ПАМЫЛКА ${response}",googleWarning:"Не атрымалася загрузіць слой Google. <br><br>Каб пазбавіцца гэтага паведамленьня, выберыце новы базавы слой у сьпісе ў верхнім правым куце.<br><br> Хутчэй за ўсё, прычына ў тым, што скрыпт бібліятэкі Google Maps ня быў уключаныя альбо не ўтрымлівае слушны API-ключ для Вашага сайта.<br><br>Распрацоўшчыкам: Для таго, каб даведацца як зрабіць так, каб усё працавала, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>націсьніце тут</a>",getLayerWarning:"Немагчыма загрузіць слой ${layerType}.<br><br>Каб пазбавіцца гэтага паведамленьня, выберыце новы базавы слой у сьпісе ў верхнім правым куце.<br><br>Хутчэй за ўсё, прычына ў тым, што скрыпт бібліятэкі ${layerLib} ня быў слушна ўключаны.<br><br>Распрацоўшчыкам: Для таго, каб даведацца як зрабіць так, каб усё працавала, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>націсьніце тут</a>","Scale = 1 : ${scaleDenom}":"Маштаб = 1 : ${scaleDenom}",W:"З",E:"У",N:"Пн",S:"Пд",layerAlreadyAdded:"Вы паспрабавалі дадаць слой ${layerName} на мапу, але ён ужо дададзены",reprojectDeprecated:"Вы выкарыстоўваеце ўстаноўку 'reproject' для слоя ${layerName}. Гэтая ўстаноўка зьяўляецца састарэлай: яна выкарыстоўвалася для падтрымкі паказу зьвестак на камэрцыйных базавых мапах, але гэта функцыя цяпер рэалізаваная ў убудаванай падтрымцы сфэрычнай праекцыі Мэркатара. Дадатковая інфармацыя ёсьць на http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Гэты мэтад састарэлы і будзе выдалены ў вэрсіі 3.0. Калі ласка, замест яго выкарыстоўвайце ${newMethod}.",boundsAddError:"Вам неабходна падаць абодва значэньні x і y для функцыі складаньня.",lonlatAddError:"Вам неабходна падаць абодва значэньні lon і lat для функцыі складаньня.",pixelAddError:"Вам неабходна падаць абодва значэньні x і y для функцыі складаньня.",unsupportedGeometryType:"Тып геамэтрыі не падтрымліваецца: ${geomType}",filterEvaluateNotImplemented:"evaluate не рэалізаваны для гэтага тыпу фільтру."}),OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,EVENT_TYPES:["beforegetfeatureinfo","nogetfeatureinfo","getfeatureinfo"],initialize:function(e){if(this.EVENT_TYPES=OpenLayers.Control.WMSGetFeatureInfo.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES),e=e||{},e.handlerOptions=e.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[e]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions)),this.drillDown===!0&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var t={};t[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,t,this.handlerOptions.click||{})}},activate:function(){return this.active||this.handler.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},getInfoForClick:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy}),OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait"),this.request(e.xy,{})},getInfoForHover:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy}),this.request(e.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var e,t,i=this.layers||this.map.layers,s=[],a=0,r=i.length;r>a;++a)e=i[a],e instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||e.getVisibility())&&(t=OpenLayers.Util.isArray(e.url)?e.url[0]:e.url,this.drillDown!==!1||this.url||(this.url=t),(this.drillDown===!0||this.urlMatches(t))&&s.push(e));return s},urlMatches:function(e){var t=OpenLayers.Util.isEquivalentUrl(this.url,e);if(!t&&this.layerUrls)for(var i=0,s=this.layerUrls.length;s>i;++i)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[i],e)){t=!0;break}return t},buildWMSOptions:function(e,t,i,s){for(var a=[],r=[],n=0,o=t.length;o>n;n++)a=a.concat(t[n].params.LAYERS),r=r.concat(this.getStyleNames(t[n]));var l=t[0],h=this.map.getProjection(),u=l.projection;u&&u.equals(this.map.getProjectionObject())&&(h=u.getCode());var p=OpenLayers.Util.extend({service:"WMS",version:l.params.VERSION,request:"GetFeatureInfo",layers:a,query_layers:a,styles:r,bbox:this.map.getExtent().toBBOX(null,l.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:s,info_format:l.params.INFO_FORMAT||this.infoFormat},parseFloat(l.params.VERSION)>=1.3?{crs:h,i:parseInt(i.x),j:parseInt(i.y)}:{srs:h,x:parseInt(i.x),y:parseInt(i.y)});return OpenLayers.Util.applyDefaults(p,this.vendorParams),{url:e,params:OpenLayers.Util.upperCaseObject(p),callback:function(t){this.handleResponse(i,t,e)},scope:this}},getStyleNames:function(e){var t;return t=e.params.STYLES?e.params.STYLES:OpenLayers.Util.isArray(e.params.LAYERS)?Array(e.params.LAYERS.length):e.params.LAYERS.replace(/[^,]/g,"")},request:function(e,t){var i=this.findLayers();if(0==i.length)return this.events.triggerEvent("nogetfeatureinfo"),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),void 0;if(t=t||{},this.drillDown===!1){var s=this.buildWMSOptions(this.url,i,e,i[0].params.FORMAT),a=OpenLayers.Request.GET(s);t.hover===!0&&(this.hoverRequest=a)}else{this._requestCount=0,this._numRequests=0,this.features=[];for(var r,n={},o=0,l=i.length;l>o;o++){var h=i[o];r=OpenLayers.Util.isArray(h.url)?h.url[0]:h.url,r in n?n[r].push(h):(this._numRequests++,n[r]=[h])}var i;for(var r in n){i=n[r];var s=this.buildWMSOptions(r,i,e,i[0].params.FORMAT);OpenLayers.Request.GET(s)}}},triggerGetFeatureInfo:function(e,t,i){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:i,request:e,xy:t}),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(e,t,i){var s=t.responseXML;s&&s.documentElement||(s=t.responseText);var a=this.format.read(s);this.drillDown===!1?this.triggerGetFeatureInfo(t,e,a):(this._requestCount++,this._features="object"===this.output?(this._features||[]).concat({url:i,features:a}):(this._features||[]).concat(a),this._requestCount===this._numRequests&&(this.triggerGetFeatureInfo(t,e,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"}),OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(e,t){this.readChildNodes(e,t)},LayerLimit:function(e,t){t.layerLimit=parseInt(this.getChildValue(e))},MaxWidth:function(e,t){t.maxWidth=parseInt(this.getChildValue(e))},MaxHeight:function(e,t){t.maxHeight=parseInt(this.getChildValue(e))},BoundingBox:function(e,t){var i=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);i.srs=e.getAttribute("CRS"),t.bbox[i.srs]=i},CRS:function(e,t){this.readers.wms.SRS.apply(this,[e,t])},EX_GeographicBoundingBox:function(e,t){t.llbbox=[],this.readChildNodes(e,t.llbbox)},westBoundLongitude:function(e,t){t[0]=this.getChildValue(e)},eastBoundLongitude:function(e,t){t[2]=this.getChildValue(e)},southBoundLatitude:function(e,t){t[1]=this.getChildValue(e)},northBoundLatitude:function(e,t){t[3]=this.getChildValue(e)},MinScaleDenominator:function(e,t){t.maxScale=parseFloat(this.getChildValue(e)).toPrecision(16)},MaxScaleDenominator:function(e,t){t.minScale=parseFloat(this.getChildValue(e)).toPrecision(16)},Dimension:function(e,t){var i=e.getAttribute("name").toLowerCase(),s={name:i,units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol"),nearestVal:"1"===e.getAttribute("nearestValue"),multipleVal:"1"===e.getAttribute("multipleValues"),"default":e.getAttribute("default")||"",current:"1"===e.getAttribute("current"),values:this.getChildValue(e).split(",")};t.dimensions[s.name]=s},Keyword:function(e,t){var i={value:this.getChildValue(e),vocabulary:e.getAttribute("vocabulary")};t.keywords&&t.keywords.push(i)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(e,t){this.readers.wms.UserDefinedSymbolization.apply(this,[e,t]),t.userSymbols.inlineFeature=1==parseInt(e.getAttribute("InlineFeature")),t.userSymbols.remoteWCS=1==parseInt(e.getAttribute("RemoteWCS"))},DescribeLayer:function(e,t){this.readers.wms.DescribeLayer.apply(this,[e,t])},GetLegendGraphic:function(e,t){this.readers.wms.GetLegendGraphic.apply(this,[e,t])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"}),OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"}),OpenLayers.Format.CQL=function(){function e(e,t){return t instanceof RegExp?t.exec(e):t(e)}function t(t,i){var s,a,n=i.length;for(s=0;n>s;s++){a=i[s];var o=r[a],l=e(t,o);if(l){var h=l[0],u=t.substr(h.length).replace(/^\s*/,"");return{type:a,text:h,remainder:u}}}var p="ERROR: In parsing: ["+t+"], expected one of: ";for(s=0;n>s;s++)a=i[s],p+="\n    "+a+": "+r[a];throw Error(p)}function i(e){var i,s=[],a=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{if(i=t(e,a),e=i.remainder,a=n[i.type],"END"!=i.type&&!a)throw Error("No follows list for "+i.type);s.push(i)}while("END"!=i.type);return s}function s(e){function t(){var e=s.pop();switch(e.type){case"LOGICAL":var i=t(),a=t();return new OpenLayers.Filter.Logical({filters:[a,i],type:h[e.text.toUpperCase()]});case"NOT":var r=t();return new OpenLayers.Filter.Logical({filters:[r],type:OpenLayers.Filter.Logical.NOT});case"BETWEEN":var n,l,u;return s.pop(),l=t(),n=t(),u=t(),new OpenLayers.Filter.Comparison({property:u,lowerBoundary:n,upperBoundary:l,type:OpenLayers.Filter.Comparison.BETWEEN});case"COMPARISON":var p=t(),u=t();return new OpenLayers.Filter.Comparison({property:u,value:p,type:o[e.text.toUpperCase()]});case"VALUE":return/^'.*'$/.test(e.text)?e.text.substr(1,e.text.length-2):Number(e.text);
case"SPATIAL":switch(e.text.toUpperCase()){case"BBOX":var c=t(),d=t(),m=t(),y=t(),f=t();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:f,value:OpenLayers.Bounds.fromArray([y,m,d,c])});case"INTERSECTS":var p=t(),u=t();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:u,value:p});case"WITHIN":var p=t(),u=t();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:u,value:p});case"CONTAINS":var p=t(),u=t();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:u,value:p});case"DWITHIN":var g=t(),p=t(),u=t();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:p,property:u,distance:Number(g)})}case"GEOMETRY":return OpenLayers.Geometry.fromWKT(e.text);default:return e.text}}for(var i=[],s=[];e.length;){var a=e.shift();switch(a.type){case"PROPERTY":case"GEOMETRY":case"VALUE":s.push(a);break;case"COMPARISON":case"BETWEEN":case"LOGICAL":for(var r=p[a.type];i.length>0&&r>=p[i[i.length-1].type];)s.push(i.pop());i.push(a);break;case"SPATIAL":case"NOT":case"LPAREN":i.push(a);break;case"RPAREN":for(;i.length>0&&"LPAREN"!=i[i.length-1].type;)s.push(i.pop());i.pop(),i.length>0&&"SPATIAL"==i[i.length-1].type&&s.push(i.pop());case"COMMA":case"END":break;default:throw Error("Unknown token type "+a.type)}}for(;i.length>0;)s.push(i.pop());var n=t();if(s.length>0){for(var l="Remaining tokens after building AST: \n",u=s.length-1;u>=0;u--)l+=s[u].type+": "+s[u].text+"\n";throw Error(l)}return n}var a,r={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('\w+'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(e){var t=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(e);if(t){var i=e.length,s=e.indexOf("(",t[0].length);if(s>-1)for(var a=1;i>s&&a>0;)switch(s++,e.charAt(s)){case"(":a++;break;case")":a--;break;default:}return[e.substr(0,s+1)]}},END:/^$/},n={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA"],BETWEEN:["VALUE"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},o={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN},l={},h={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},u={},p={RPAREN:3,LOGICAL:2,COMPARISON:1};for(a in o)o.hasOwnProperty(a)&&(l[o[a]]=a);for(a in h)h.hasOwnProperty(a)&&(u[h[a]]=a);return OpenLayers.Class(OpenLayers.Format,{read:function(e){var t=s(i(e));return this.keepData&&(this.data=t),t},write:function(e){if(e instanceof OpenLayers.Geometry)return""+e;switch(e.CLASS_NAME){case"OpenLayers.Filter.Spatial":switch(e.type){case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+e.property+","+e.value.toBBOX()+")";case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+e.property+", "+this.write(e.value)+", "+e.distance+")";case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+e.property+", "+this.write(e.value)+")";case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+e.property+", "+this.write(e.value)+")";case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+e.property+", "+this.write(e.value)+")";default:throw Error("Unknown spatial filter type: "+e.type)}case"OpenLayers.Filter.Logical":if(e.type==OpenLayers.Filter.Logical.NOT)return"NOT ("+this.write(e.filters[0])+")";for(var t="(",i=!0,s=0;e.filters.length>s;s++)i?i=!1:t+=") "+u[e.type]+" (",t+=this.write(e.filters[s]);return t+")";case"OpenLayers.Filter.Comparison":return e.type==OpenLayers.Filter.Comparison.BETWEEN?e.property+" BETWEEN "+this.write(e.lowerBoundary)+" AND "+this.write(e.upperBoundary):e.property+" "+l[e.type]+" "+this.write(e.value);case void 0:if("string"==typeof e)return"'"+e+"'";if("number"==typeof e)return e+"";default:throw Error("Can't encode: "+e.CLASS_NAME+" "+e)}},CLASS_NAME:"OpenLayers.Format.CQL"})}(),OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforesplit","split","aftersplit"],layer:null,source:null,sourceOptions:null,tolerance:null,edge:!0,deferDelete:!1,mutual:!0,targetFilter:null,sourceFilter:null,handler:null,initialize:function(e){Array.prototype.push.apply(this.EVENT_TYPES,OpenLayers.Control.prototype.EVENT_TYPES),OpenLayers.Control.prototype.initialize.apply(this,[e]),this.options=e||{},this.options.source&&this.setSource(this.options.source)},setSource:function(e){this.active?(this.deactivate(),this.handler&&(this.handler.destroy(),delete this.handler),this.source=e,this.activate()):this.source=e},activate:function(){var e=OpenLayers.Control.prototype.activate.call(this);return e&&(this.source?this.source.events&&this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this}):(this.handler||(this.handler=new OpenLayers.Handler.Path(this,{done:function(e){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(e)})}},{layerOptions:this.sourceOptions})),this.handler.activate())),e},deactivate:function(){var e=OpenLayers.Control.prototype.deactivate.call(this);return e&&this.source&&this.source.events&&this.layer.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this}),e},onSketchComplete:function(e){return this.feature=null,!this.considerSplit(e.feature)},afterFeatureModified:function(e){if(e.modified){var t=e.feature;(t.geometry instanceof OpenLayers.Geometry.LineString||t.geometry instanceof OpenLayers.Geometry.MultiLineString)&&(this.feature=e.feature,this.considerSplit(e.feature))}},removeByGeometry:function(e,t){for(var i=0,s=e.length;s>i;++i)if(e[i].geometry===t){e.splice(i,1);break}},isEligible:function(e){return e.state!==OpenLayers.State.DELETE&&(e.geometry instanceof OpenLayers.Geometry.LineString||e.geometry instanceof OpenLayers.Geometry.MultiLineString)&&this.feature!==e&&(!this.targetFilter||this.targetFilter.evaluate(e.attributes))},considerSplit:function(e){var t=!1,i=!1;if(!this.sourceFilter||this.sourceFilter.evaluate(e.attributes)){for(var s,a,r,n,o,l,h,u=this.layer&&this.layer.features||[],p=[],c=[],d=this.layer===this.source&&this.mutual,m={edge:this.edge,tolerance:this.tolerance,mutual:d},y=[e.geometry],f=0,g=u.length;g>f;++f)if(n=u[f],this.isEligible(n)){o=[n.geometry];for(var v=0;y.length>v;++v){l=y[v];for(var L=0;o.length>L;++L)s=o[L],l.getBounds().intersectsBounds(s.getBounds())&&(a=l.split(s,m),a&&(r=this.events.triggerEvent("beforesplit",{source:e,target:n}),r!==!1&&(d&&(h=a[0],h.length>1&&(h.unshift(v,1),Array.prototype.splice.apply(y,h),v+=h.length-3),a=a[1]),a.length>1&&(a.unshift(L,1),Array.prototype.splice.apply(o,a),L+=a.length-3))))}o&&o.length>1&&(this.geomsToFeatures(n,o),this.events.triggerEvent("split",{original:n,features:o}),Array.prototype.push.apply(p,o),c.push(n),i=!0)}if(y&&y.length>1&&(this.geomsToFeatures(e,y),this.events.triggerEvent("split",{original:e,features:y}),Array.prototype.push.apply(p,y),c.push(e),t=!0),t||i){if(this.deferDelete){for(var b,O=[],f=0,g=c.length;g>f;++f)b=c[f],b.state===OpenLayers.State.INSERT?O.push(b):(b.state=OpenLayers.State.DELETE,this.layer.drawFeature(b));this.layer.destroyFeatures(O,{silent:!0});for(var f=0,g=p.length;g>f;++f)p[f].state=OpenLayers.State.INSERT}else this.layer.destroyFeatures(c,{silent:!0});this.layer.addFeatures(p,{silent:!0}),this.events.triggerEvent("aftersplit",{source:e,features:p})}}return t},geomsToFeatures:function(e,t){var i=e.clone();delete i.geometry;for(var s,a=0,r=t.length;r>a;++a)s=i.clone(),s.geometry=t[a],s.state=OpenLayers.State.INSERT,t[a]=s},destroy:function(){this.active&&this.deactivate(),OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"}),OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,{fois:null,formatOptions:null,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e]),e.format||(this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){e=OpenLayers.Util.extend({},e),OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"}),i=this.format,s=OpenLayers.Format.XML.prototype.write.apply(i,[i.writeNode("sos:GetFeatureOfInterest",{fois:this.fois})]);return t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),data:s}),t},handleRead:function(e,t){if(t.callback){var i=e.priv;i.status>=200&&300>i.status?(e.features=this.parseFeatures(i),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,t.callback.call(t.scope,e)}},parseFeatures:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||0>=t.length?null:this.format.read(t)},CLASS_NAME:"OpenLayers.Protocol.SOS.v1_0_0"}),OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments),this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||DEFAULT_FORMAT]},getURL:function(e){e=this.adjustBounds(e);var t=this.map.getResolution(),i=Math.round(1e4*this.map.getScale())/1e4,s=Math.round(e.left/t),a=-Math.round(e.top/t),r=Math.floor(s/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w,n=Math.floor(a/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h,o=this.url;OpenLayers.Util.isArray(o)&&(o=this.selectUrl(paramsString,o));var l=[o,"/",this.params.map,"/",i,"/",this.params.g.replace(/\s/g,"_"),"/def/t",n,"/l",r,"/t",a,"l",s,".",this.extension];return l.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"}),OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments),this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"}),OpenLayers.Feature.WFS=OpenLayers.Class(OpenLayers.Feature,{initialize:function(e,t){var i=arguments,s=this.processXMLNode(t);i=Array(e,s.lonlat,s),OpenLayers.Feature.prototype.initialize.apply(this,i),this.createMarker(),this.layer.addMarker(this.marker)},destroy:function(){null!=this.marker&&this.layer.removeMarker(this.marker),OpenLayers.Feature.prototype.destroy.apply(this,arguments)},processXMLNode:function(e){var t=OpenLayers.Ajax.getElementsByTagNameNS(e,"http://www.opengis.net/gml","gml","Point"),i=OpenLayers.Util.getXmlNodeValue(OpenLayers.Ajax.getElementsByTagNameNS(t[0],"http://www.opengis.net/gml","gml","coordinates")[0]),s=i.split(",");return{lonlat:new OpenLayers.LonLat(parseFloat(s[0]),parseFloat(s[1])),id:null}},CLASS_NAME:"OpenLayers.Feature.WFS"}),OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",initialize:function(e){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[e])},readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"}),OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",initialize:function(e){OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.initialize.apply(this,[e])},readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(e,t){t.vendorSpecific={tileSets:[]},this.readChildNodes(e,t.vendorSpecific)},TileSet:function(e,t){var i={srs:{},bbox:{},resolutions:[]};this.readChildNodes(e,i),t.tileSets.push(i)},Resolutions:function(e,t){for(var i=this.getChildValue(e).split(" "),s=0,a=i.length;a>s;s++)""!=i[s]&&t.resolutions.push(parseFloat(i[s]))},Width:function(e,t){t.width=parseInt(this.getChildValue(e))},Height:function(e,t){t.height=parseInt(this.getChildValue(e))},Layers:function(e,t){t.layers=this.getChildValue(e)},Styles:function(e,t){t.styles=this.getChildValue(e)}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"}),OpenLayers.Lang.lt=OpenLayers.Util.applyDefaults({unhandledRequest:"Neapdorota užklausa gražino ${statusText}",Permalink:"Pastovi nuoroda",Overlays:"Papildomi sluoksniai","Base Layer":"Pagrindinis sluoksnis",readNotImplemented:"Skaitymas nėra įgyvendintas.",writeNotImplemented:"Rašymas nėra įgyvendintas.",noFID:"Negaliu atnaujinti objekto, kuris neturi FID.",errorLoadingGML:"Klaida užkraunant GML failą ${url}",browserNotSupported:"Jūsų naršyklė nemoka parodyti vektorių. Šiuo metu galima naudotis tokiais rodymo varikliais:\n{renderers}",componentShouldBe:"addFeatures : komponentas turi būti ${geomType}",getFeatureError:"getFeatureFromEvent buvo iškviestas sluoksniui, kuris neturi priskirto paišymo variklio. Tai paprastai nutinka, kai jūs pašalinate sluoksnį, bet paliekate su juo susijusį [handler]",commitSuccess:"WFS Tranzakcija: PAVYKO ${response}",commitFailed:"WFS Tranzakcija: ŽLUGO ${response}","Scale = 1 : ${scaleDenom}":"Mastelis = 1 : ${scaleDenom}",W:"V",E:"R",N:"Š",S:"P",Graticule:"Tinklelis",layerAlreadyAdded:"Bandėte pridėti prie žemėlapio sluoksnį ${layerName}, tačiau jis jau yra pridėtas",methodDeprecated:"Šis metodas yra pasenęs ir 3.0 versijoje bus pašalintas. Prašome naudoti ${newMethod}.",boundsAddError:"Add funkcijai reikia pateikti tiek x, tiek y reikšmes.",lonlatAddError:"Add funkcijai reikia pateikti tiek lon, tiek lat reikšmes",pixelAddError:"Add funkcijai būtina perduoti tiek x, tiek y reikšmes.",unsupportedGeometryType:"Nepalaikomas geometrijos tipas: ${geomType}",end:""}),OpenLayers.Layer.WFS=OpenLayers.Class(OpenLayers.Layer.Vector,OpenLayers.Layer.Markers,{isBaseLayer:!1,tile:null,ratio:2,DEFAULT_PARAMS:{service:"WFS",version:"1.0.0",request:"GetFeature"},featureClass:null,format:null,formatObject:null,formatOptions:null,vectorMode:!0,encodeBBOX:!1,extractAttributes:!1,initialize:function(e,t,i,s){void 0==s&&(s={}),!s.featureClass&&OpenLayers.Layer.Vector&&OpenLayers.Feature.Vector||(this.vectorMode=!1),i=OpenLayers.Util.upperCaseObject(i),OpenLayers.Util.extend(s,{reportError:!1});var a=[];a.push(e,s),OpenLayers.Layer.Vector.prototype.initialize.apply(this,a),this.renderer&&this.vectorMode||(this.vectorMode=!1,s.featureClass||(s.featureClass=OpenLayers.Feature.WFS),OpenLayers.Layer.Markers.prototype.initialize.apply(this,a)),this.params&&this.params.typename&&!this.options.typename&&(this.options.typename=this.params.typename),this.options.geometry_column||(this.options.geometry_column="the_geom"),this.params=OpenLayers.Util.applyDefaults(i,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),this.url=t},destroy:function(){this.vectorMode?OpenLayers.Layer.Vector.prototype.destroy.apply(this,arguments):OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.tile&&this.tile.destroy(),this.tile=null,this.ratio=null,this.featureClass=null,this.format=null,this.formatObject&&this.formatObject.destroy&&this.formatObject.destroy(),this.formatObject=null,this.formatOptions=null,this.vectorMode=null,this.encodeBBOX=null,this.extractAttributes=null},setMap:function(){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);var e={extractAttributes:this.extractAttributes};OpenLayers.Util.extend(e,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(e.externalProjection=this.projection,e.internalProjection=this.map.getProjectionObject()),this.formatObject=this.format?new this.format(e):new OpenLayers.Format.GML(e)}else OpenLayers.Layer.Markers.prototype.setMap.apply(this,arguments)},moveTo:function(e,t,i){if(this.vectorMode?OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments):OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),i)return!1;if(t&&this.vectorMode&&this.renderer.clear(),this.options.minZoomLevel&&(OpenLayers.Console.warn(OpenLayers.i18n("minZoomLevelError")),this.map.getZoom()<this.options.minZoomLevel))return null;null==e&&(e=this.map.getExtent());var s=null==this.tile,a=!s&&!this.tile.bounds.containsBounds(e);if(t||s||!i&&a){var r=e.getCenterLonLat(),n=e.getWidth()*this.ratio,o=e.getHeight()*this.ratio,l=new OpenLayers.Bounds(r.lon-n/2,r.lat-o/2,r.lon+n/2,r.lat+o/2),h=this.map.getSize();h.w=h.w*this.ratio,h.h=h.h*this.ratio;var u=new OpenLayers.LonLat(l.left,l.top),p=this.map.getLayerPxFromLonLat(u),c=this.getFullRequestString(),d=null,m=this.params.filter||this.params.FILTER;if(d=m?{FILTER:m}:{BBOX:this.encodeBBOX?l.toBBOX():l.toArray()},this.map&&!this.projection.equals(this.map.getProjectionObject())){var y=l.clone();y.transform(this.map.getProjectionObject(),this.projection),m||(d.BBOX=this.encodeBBOX?y.toBBOX():y.toArray())}c+="&"+OpenLayers.Util.getParameterString(d),this.tile?(this.vectorMode?(this.destroyFeatures(),this.renderer.clear()):this.clearMarkers(),this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null,this.tile=new OpenLayers.Tile.WFS(this,p,l,c,h),this.addTileMonitoringHooks(this.tile),this.tile.draw()):(this.tile=new OpenLayers.Tile.WFS(this,p,l,c,h),this.addTileMonitoringHooks(this.tile),this.tile.draw())}},addTileMonitoringHooks:function(e){e.onLoadStart=function(){this==this.layer.tile&&this.layer.events.triggerEvent("loadstart")},e.events.register("loadstart",e,e.onLoadStart),e.onLoadEnd=function(){this==this.layer.tile&&(this.layer.events.triggerEvent("tileloaded"),this.layer.events.triggerEvent("loadend"))},e.events.register("loadend",e,e.onLoadEnd),e.events.register("unload",e,e.onLoadEnd)},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,scope:e})},onMapResize:function(){this.vectorMode?OpenLayers.Layer.Vector.prototype.onMapResize.apply(this,arguments):OpenLayers.Layer.Markers.prototype.onMapResize.apply(this,arguments)},display:function(){this.vectorMode?OpenLayers.Layer.Vector.prototype.display.apply(this,arguments):OpenLayers.Layer.Markers.prototype.display.apply(this,arguments)},mergeNewParams:function(e){var t=OpenLayers.Util.upperCaseObject(e),i=[t];return OpenLayers.Layer.HTTPRequest.prototype.mergeNewParams.apply(this,i)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.WFS(this.name,this.url,this.params,this.getOptions())),e=this.vectorMode?OpenLayers.Layer.Vector.prototype.clone.apply(this,[e]):OpenLayers.Layer.Markers.prototype.clone.apply(this,[e])},getFullRequestString:function(){var e=this.projection.getCode()||this.map.getProjection();return this.params.SRS="none"==e?null:e,OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},commit:function(){if(!this.writer){var e={};this.map&&!this.projection.equals(this.map.getProjectionObject())&&(e.externalProjection=this.projection,e.internalProjection=this.map.getProjectionObject()),this.writer=new OpenLayers.Format.WFS(e,this)}var t=this.writer.write(this.features);OpenLayers.Request.POST({url:this.url,data:t,success:this.commitSuccess,failure:this.commitFailure,scope:this})},commitSuccess:function(e){var t=e.responseText;if(-1!=t.indexOf("SUCCESS")){this.commitReport(OpenLayers.i18n("commitSuccess",{response:t}));for(var i=0;this.features.length>i;i++)this.features[i].state=null}else(-1!=t.indexOf("FAILED")||-1!=t.indexOf("Exception"))&&this.commitReport(OpenLayers.i18n("commitFailed",{response:t}))},commitFailure:function(){},commitReport:function(e){OpenLayers.Console.userError(e)},refresh:function(){this.tile&&(this.vectorMode?(this.renderer.clear(),this.features.length=0):(this.clearMarkers(),this.markers.length=0),this.tile.draw())},getDataExtent:function(){var e;return e=this.vectorMode?OpenLayers.Layer.Vector.prototype.getDataExtent.apply(this):OpenLayers.Layer.Markers.prototype.getDataExtent.apply(this)},setOpacity:function(e){this.vectorMode?OpenLayers.Layer.Vector.prototype.setOpacity.apply(this,[e]):OpenLayers.Layer.Markers.prototype.setOpacity.apply(this,[e])},CLASS_NAME:"OpenLayers.Layer.WFS"}),OpenLayers.Lang.io=OpenLayers.Util.applyDefaults({"Scale = 1 : ${scaleDenom}":"Skalo = 1 : ${scaleDenom}"}),OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{roundedCorner:!0,roundedCornerColor:"darkblue",layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.layerStates=[]},destroy:function(){OpenLayers.Event.stopObservingElement(this.div),OpenLayers.Event.stopObservingElement(this.minimizeDiv),OpenLayers.Event.stopObservingElement(this.maximizeDiv),this.clearLayersArray("base"),this.clearLayersArray("data"),this.map.events.un({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this})},draw:function(){return OpenLayers.Control.prototype.draw.apply(this),this.loadContents(),this.outsideViewport||this.minimizeControl(),this.redraw(),this.div},clearLayersArray:function(e){var t=this[e+"Layers"];if(t)for(var i=0,s=t.length;s>i;i++){var a=t[i];OpenLayers.Event.stopObservingElement(a.inputElem),OpenLayers.Event.stopObservingElement(a.labelSpan)}this[e+"LayersDiv"].innerHTML="",this[e+"Layers"]=[]},checkRedraw:function(){var e=!1;if(this.layerStates.length&&this.map.layers.length==this.layerStates.length)for(var t=0,i=this.layerStates.length;i>t;t++){var s=this.layerStates[t],a=this.map.layers[t];if(s.name!=a.name||s.inRange!=a.inRange||s.id!=a.id||s.visibility!=a.visibility){e=!0;break}}else e=!0;return e},redraw:function(){if(!this.checkRedraw())return this.div;this.clearLayersArray("base"),this.clearLayersArray("data");var e=!1,t=!1,i=this.map.layers.length;this.layerStates=Array(i);for(var s=0;i>s;s++){var a=this.map.layers[s];this.layerStates[s]={name:a.name,visibility:a.visibility,inRange:a.inRange,id:a.id}}var r=this.map.layers.slice();this.ascending||r.reverse();for(var s=0,i=r.length;i>s;s++){var a=r[s],n=a.isBaseLayer;if(a.displayInLayerSwitcher){n?t=!0:e=!0;var o=n?a==this.map.baseLayer:a.getVisibility(),l=document.createElement("input");l.id=this.id+"_input_"+a.name,l.name=n?this.id+"_baseLayers":a.name,l.type=n?"radio":"checkbox",l.value=a.name,l.checked=o,l.defaultChecked=o,n||a.inRange||(l.disabled=!0);var h={inputElem:l,layer:a,layerSwitcher:this};OpenLayers.Event.observe(l,"mouseup",OpenLayers.Function.bindAsEventListener(this.onInputClick,h));var u=document.createElement("span");OpenLayers.Element.addClass(u,"labelSpan"),n||a.inRange||(u.style.color="gray"),u.innerHTML=a.name,u.style.verticalAlign=n?"bottom":"baseline",OpenLayers.Event.observe(u,"click",OpenLayers.Function.bindAsEventListener(this.onInputClick,h));var p=document.createElement("br"),c=n?this.baseLayers:this.dataLayers;c.push({layer:a,inputElem:l,labelSpan:u});var d=n?this.baseLayersDiv:this.dataLayersDiv;d.appendChild(l),d.appendChild(u),d.appendChild(p)}}return this.dataLbl.style.display=e?"":"none",this.baseLbl.style.display=t?"":"none",this.div},onInputClick:function(e){this.inputElem.disabled||("radio"==this.inputElem.type?(this.inputElem.checked=!0,this.layer.map.setBaseLayer(this.layer)):(this.inputElem.checked=!this.inputElem.checked,this.layerSwitcher.updateMap())),OpenLayers.Event.stop(e)},onLayerClick:function(){this.updateMap()},updateMap:function(){for(var e=0,t=this.baseLayers.length;t>e;e++){var i=this.baseLayers[e];i.inputElem.checked&&this.map.setBaseLayer(i.layer,!1)}for(var e=0,t=this.dataLayers.length;t>e;e++){var i=this.dataLayers[e];i.layer.setVisibility(i.inputElem.checked)}},maximizeControl:function(e){this.div.style.width="",this.div.style.height="",this.showControls(!1),null!=e&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.div.style.width="0px",this.div.style.height="0px",this.showControls(!0),null!=e&&OpenLayers.Event.stop(e)},showControls:function(e){this.maximizeDiv.style.display=e?"":"none",this.minimizeDiv.style.display=e?"none":"",this.layersDiv.style.display=e?"none":""},loadContents:function(){OpenLayers.Event.observe(this.div,"mouseup",OpenLayers.Function.bindAsEventListener(this.mouseUp,this)),OpenLayers.Event.observe(this.div,"click",this.ignoreEvent),OpenLayers.Event.observe(this.div,"mousedown",OpenLayers.Function.bindAsEventListener(this.mouseDown,this)),OpenLayers.Event.observe(this.div,"dblclick",this.ignoreEvent),this.layersDiv=document.createElement("div"),this.layersDiv.id=this.id+"_layersDiv",OpenLayers.Element.addClass(this.layersDiv,"layersDiv"),this.baseLbl=document.createElement("div"),this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer"),OpenLayers.Element.addClass(this.baseLbl,"baseLbl"),this.baseLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv"),this.dataLbl=document.createElement("div"),this.dataLbl.innerHTML=OpenLayers.i18n("Overlays"),OpenLayers.Element.addClass(this.dataLbl,"dataLbl"),this.dataLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv"),this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv)),this.div.appendChild(this.layersDiv),this.roundedCorner&&(OpenLayers.Rico.Corner.round(this.div,{corners:"tl bl",bgColor:"transparent",color:this.roundedCornerColor,blend:!1}),OpenLayers.Rico.Corner.changeOpacity(this.layersDiv,.75));var e=OpenLayers.Util.getImagesLocation(),t=new OpenLayers.Size(18,18),i=e+"layer-switcher-maximize.png";this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,t,i,"absolute"),OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv"),this.maximizeDiv.style.display="none",OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this)),this.div.appendChild(this.maximizeDiv);var i=e+"layer-switcher-minimize.png",t=new OpenLayers.Size(18,18);this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,t,i,"absolute"),OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv"),this.minimizeDiv.style.display="none",OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this)),this.div.appendChild(this.minimizeDiv)},ignoreEvent:function(e){OpenLayers.Event.stop(e)},mouseDown:function(e){this.isMouseDown=!0,this.ignoreEvent(e)},mouseUp:function(e){this.isMouseDown&&(this.isMouseDown=!1,this.ignoreEvent(e))},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"}),OpenLayers.Lang.el=OpenLayers.Util.applyDefaults({"Scale = 1 : ${scaleDenom}":"Κλίμακα ~ 1 : ${scaleDenom}"}),OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:!1,read:function(e){return"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),this.parseFeatures(e)},write:function(e){var t;if(OpenLayers.Util.isArray(e)){t=this.createElementNSPlus("atom:feed"),t.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle}));for(var i=0,s=e.length;s>i;i++)t.appendChild(this.buildEntryNode(e[i]))}else t=this.buildEntryNode(e);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},buildContentNode:function(e){var t=this.createElementNSPlus("atom:content",{attributes:{type:e.type||null}});if(e.src)t.setAttribute("src",e.src);else if("text"==e.type||null==e.type)t.appendChild(this.createTextNode(e.value));else if("html"==e.type){if("string"!=typeof e.value)throw"HTML content must be in form of an escaped string";t.appendChild(this.createTextNode(e.value))}else"xhtml"==e.type?t.appendChild(e.value):"xhtml"==e.type||e.type.match(/(\+|\/)xml$/)?t.appendChild(e.value):t.appendChild(this.createTextNode(e.value));return t},buildEntryNode:function(e){var t=e.attributes,i=t.atom||{},s=this.createElementNSPlus("atom:entry");if(i.authors)for(var a=OpenLayers.Util.isArray(i.authors)?i.authors:[i.authors],r=0,n=a.length;n>r;r++)s.appendChild(this.buildPersonConstructNode("author",a[r]));if(i.categories)for(var o,l=OpenLayers.Util.isArray(i.categories)?i.categories:[i.categories],r=0,n=l.length;n>r;r++)o=l[r],s.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:o.term,scheme:o.scheme||null,label:o.label||null}}));if(i.content&&s.appendChild(this.buildContentNode(i.content)),i.contributors)for(var h=OpenLayers.Util.isArray(i.contributors)?i.contributors:[i.contributors],r=0,n=h.length;n>r;r++)s.appendChild(this.buildPersonConstructNode("contributor",h[r]));if(e.fid&&s.appendChild(this.createElementNSPlus("atom:id",{value:e.fid})),i.links)for(var u,p=OpenLayers.Util.isArray(i.links)?i.links:[i.links],r=0,n=p.length;n>r;r++)u=p[r],s.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:u.href,rel:u.rel||null,type:u.type||null,hreflang:u.hreflang||null,title:u.title||null,length:u.length||null}}));if(i.published&&s.appendChild(this.createElementNSPlus("atom:published",{value:i.published})),i.rights&&s.appendChild(this.createElementNSPlus("atom:rights",{value:i.rights})),(i.summary||t.description)&&s.appendChild(this.createElementNSPlus("atom:summary",{value:i.summary||t.description})),s.appendChild(this.createElementNSPlus("atom:title",{value:i.title||t.title||this.defaultEntryTitle})),i.updated&&s.appendChild(this.createElementNSPlus("atom:updated",{value:i.updated})),e.geometry){var c=this.createElementNSPlus("georss:where");c.appendChild(this.buildGeometryNode(e.geometry)),s.appendChild(c)}return s},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})},buildGeometryNode:function(e){this.gmlParser||this.initGmlParser();var t=this.gmlParser.writeNode("feature:_geometry",e);return t.firstChild},buildPersonConstructNode:function(e,t){var i=["uri","email"],s=this.createElementNSPlus("atom:"+e);s.appendChild(this.createElementNSPlus("atom:name",{value:t.name}));for(var a=0,r=i.length;r>a;a++)t[i[a]]&&s.appendChild(this.createElementNSPlus("atom:"+i[a],{value:t[i[a]]}));return s},getFirstChildValue:function(e,t,i,s){var a,r=this.getElementsByTagNameNS(e,t,i);
return a=r&&r.length>0?this.getChildValue(r[0],s):s},parseFeature:function(e){var t={},i=null,s=null,a=null,r=this.namespaces.atom;this.parsePersonConstructs(e,"author",t),s=this.getElementsByTagNameNS(e,r,"category"),s.length>0&&(t.categories=[]);for(var n=0,o=s.length;o>n;n++)i={},i.term=s[n].getAttribute("term"),a=s[n].getAttribute("scheme"),a&&(i.scheme=a),a=s[n].getAttribute("label"),a&&(i.label=a),t.categories.push(i);s=this.getElementsByTagNameNS(e,r,"content"),s.length>0&&(i={},a=s[0].getAttribute("type"),a&&(i.type=a),a=s[0].getAttribute("src"),a?i.src=a:(i.value="text"==i.type||"html"==i.type||null==i.type?this.getFirstChildValue(e,r,"content",null):"xhtml"==i.type||i.type.match(/(\+|\/)xml$/)?this.getChildEl(s[0]):this.getFirstChildValue(e,r,"content",null),t.content=i)),this.parsePersonConstructs(e,"contributor",t),t.id=this.getFirstChildValue(e,r,"id",null),s=this.getElementsByTagNameNS(e,r,"link"),s.length>0&&(t.links=Array(s.length));for(var l=["rel","type","hreflang","title","length"],n=0,o=s.length;o>n;n++){i={},i.href=s[n].getAttribute("href");for(var h=0,u=l.length;u>h;h++)a=s[n].getAttribute(l[h]),a&&(i[l[h]]=a);t.links[n]=i}i=this.getFirstChildValue(e,r,"published",null),i&&(t.published=i),i=this.getFirstChildValue(e,r,"rights",null),i&&(t.rights=i),i=this.getFirstChildValue(e,r,"summary",null),i&&(t.summary=i),t.title=this.getFirstChildValue(e,r,"title",null),t.updated=this.getFirstChildValue(e,r,"updated",null);var p={title:t.title,description:t.summary,atom:t},c=this.parseLocations(e)[0],d=new OpenLayers.Feature.Vector(c,p);return d.fid=t.id,d},parseFeatures:function(e){var t=[],i=this.getElementsByTagNameNS(e,this.namespaces.atom,"entry");0==i.length&&(i=[e]);for(var s=0,a=i.length;a>s;s++)t.push(this.parseFeature(i[s]));return t},parseLocations:function(e){var t=this.namespaces.georss,i={components:[]},s=this.getElementsByTagNameNS(e,t,"where");if(s&&s.length>0){this.gmlParser||this.initGmlParser();for(var a=0,r=s.length;r>a;a++)this.gmlParser.readChildNodes(s[a],i)}var n=i.components,o=this.getElementsByTagNameNS(e,t,"point");if(o&&o.length>0)for(var a=0,r=o.length;r>a;a++){var l=OpenLayers.String.trim(o[a].firstChild.nodeValue).split(/\s+/);2!=l.length&&(l=OpenLayers.String.trim(o[a].firstChild.nodeValue).split(/\s*,\s*/)),n.push(new OpenLayers.Geometry.Point(parseFloat(l[1]),parseFloat(l[0])))}var h=this.getElementsByTagNameNS(e,t,"line");if(h&&h.length>0)for(var u,p,c,a=0,r=h.length;r>a;a++){u=OpenLayers.String.trim(h[a].firstChild.nodeValue).split(/\s+/),c=[];for(var d=0,m=u.length;m>d;d+=2)p=new OpenLayers.Geometry.Point(parseFloat(u[d+1]),parseFloat(u[d])),c.push(p);n.push(new OpenLayers.Geometry.LineString(c))}var y=this.getElementsByTagNameNS(e,t,"polygon");if(y&&y.length>0)for(var u,p,c,a=0,r=y.length;r>a;a++){u=OpenLayers.String.trim(y[a].firstChild.nodeValue).split(/\s+/),c=[];for(var d=0,m=u.length;m>d;d+=2)p=new OpenLayers.Geometry.Point(parseFloat(u[d+1]),parseFloat(u[d])),c.push(p);n.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(n)]))}if(this.internalProjection&&this.externalProjection)for(var a=0,r=n.length;r>a;a++)n[a]&&n[a].transform(this.externalProjection,this.internalProjection);return n},parsePersonConstructs:function(e,t,i){for(var s=[],a=this.namespaces.atom,r=this.getElementsByTagNameNS(e,a,t),n=["uri","email"],o=0,l=r.length;l>o;o++){var h={};h.name=this.getFirstChildValue(r[o],a,"name",null);for(var u=0,p=n.length;p>u;u++){var c=this.getFirstChildValue(r[o],a,n[u],null);c&&(h[n[u]]=c)}s.push(h)}s.length>0&&(i[t+"s"]=s)},CLASS_NAME:"OpenLayers.Format.Atom"}),OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress})},defaultKeyPress:function(e){switch(e.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:var t=this.map.getSize();this.map.pan(0,-.75*t.h);break;case 34:var t=this.map.getSize();this.map.pan(0,.75*t.h);break;case 35:var t=this.map.getSize();this.map.pan(.75*t.w,0);break;case 36:var t=this.map.getSize();this.map.pan(-.75*t.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut()}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"}),Oskari.clazz.define("Oskari.mapframework.bundle.MapWmtsBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.MapWmtsBundleInstance")},update:function(e,t,i,s){e.alert("RECEIVED update notification "+s)}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/plugin/wmtslayer/WmtsLayerPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/domain/WmtsLayer.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/service/WmtsLayerService.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/service/WmtsLayerModelBuilder.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/format/WMTS_1_0_0_capabilities.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/layer/WMTS.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwmts/instance.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"mapwmts","Bundle-Name":"mapwmts","Bundle-Tag":{mapframework:!0},"Bundle-Icon":{href:"icon.png"},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"WMTS",Title:"WMTS"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","Ext"]}}}),Oskari.bundle_manager.installBundleClass("mapwmts","Oskari.mapframework.bundle.MapWmtsBundle"),Oskari.clazz.define("Oskari.mapframework.wmts.mapmodule.plugin.WmtsLayerPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this._wmtsLayerClazz=Oskari.clazz.create("Oskari.openlayers.Patch.layer.WMTS")},{__name:"WmtsLayerPlugin",getName:function(){return this.pluginName},getMap:function(){return this._map},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},register:function(){this.getMapModule().setLayerPlugin("WmtsLayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("WmtsLayer",null)},init:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerAddEvent:function(e){this.afterMapLayerAddEvent(e)},AfterMapLayerRemoveEvent:function(e){this.afterMapLayerRemoveEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this.afterChangeMapLayerOpacityEvent(e)},AfterChangeMapLayerStyleEvent:function(e){this.afterChangeMapLayerStyleEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){for(var t=this._sandbox,i=0;e.length>i;i++){var s=e[i],a=s.getId();s.isLayerOfType("WMTS")&&(t.printDebug("preselecting "+a),this.addMapLayerToMap(s,!0,s.isBaseLayer()))}},afterMapLayerAddEvent:function(e){this.addMapLayerToMap(e.getMapLayer(),e.getKeepLayersOrder(),e.isBasemap())},addMapLayerToMap:function(e){if(e.isLayerOfType("WMTS")){var t=this,i=t.getMap();e.getWmtsMatrixSet().matrixIds;var s=e.getWmtsLayerDef(),a=null;a=e.isBaseLayer()||e.isGroupLayer()?"basemap_"+e.getId():"layer_"+e.getId();var r=this._sandbox,n=e.getWmtsUrls()[0],o=e.getWmtsMatrixSet(),l={visibility:!0,transparent:!0,format:"image/png",url:n,layer:e.getWmtsName(),style:e.getCurrentStyle().getName(),matrixIds:o.matrixIds,matrixSet:o.identifier,isBaseLayer:e.isBaseLayer(),buffer:0,minScale:e.getMinScale(),maxScale:e.getMaxScale()};r.printDebug("[WmtsLayerPlugin] creating WMTS Layer "+o.identifier+" / "+l.id+"/"+l.layer+"/"+l.url);var h=OpenLayers.Util.applyDefaults(l,{url:n,name:a,style:e.getCurrentStyle().getName(),matrixIds:o.matrixIds,layerDef:s}),u=this._wmtsLayerClazz.getPatch(),p=new u(h);p.opacity=e.getOpacity()/100,r.printDebug("[WmtsLayerPlugin] created WMTS layer "+p),i.addLayers([p])}},afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this.removeMapLayerFromMap(t)},removeMapLayerFromMap:function(e){if(e.isLayerOfType("WMTS"))if(e.isBaseLayer()||e.isGroupLayer())if(e.getSubLayers().length>0)for(var t=0;e.getSubLayers().length>t;t++){var i=this._map.getLayersByName("basemap_"+e.getSubLayers()[t].getId());i[0].destroy()}else{var i=this._map.getLayersByName("layer_"+e.getId());i[0].destroy()}else{var i=this._map.getLayersByName("layer_"+e.getId());i[0].destroy()}},getOLMapLayers:function(e){if(!e.isLayerOfType("WMTS"))return null;if(!e.isBaseLayer()&&!e.isGroupLayer())return this._map.getLayersByName("layer_"+e.getId());if(!(e.getSubLayers().length>0))return this._map.getLayersByName("layer_"+e.getId());for(var t=0;e.getSubLayers().length>t;t++)return this._map.getLayersByName("basemap_"+e.getSubLayers()[t].getId());return null},afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer();if(t.isLayerOfType("WMTS"))if(t.isBaseLayer()||t.isGroupLayer())if(t.getSubLayers().length>0)for(var i=0;t.getSubLayers().length>i;i++){var s=this._map.getLayersByName("basemap_"+t.getSubLayers()[i].getId());s[0].setOpacity(t.getOpacity()/100)}else{var s=this._map.getLayersByName("layer_"+t.getId());null!=s[0]&&s[0].setOpacity(t.getOpacity()/100)}else{this._sandbox.printDebug("Setting Layer Opacity for "+t.getId()+" to "+t.getOpacity());var s=this._map.getLayersByName("layer_"+t.getId());null!=s[0]&&s[0].setOpacity(t.getOpacity()/100)}},afterChangeMapLayerStyleEvent:function(e){var t=e.getMapLayer();if(t.isLayerOfType("WMTS")&&!t.isBaseLayer()){var i=this._map.getLayersByName("layer_"+t.getId());null!=i&&i[0].mergeNewParams({styles:t.getCurrentStyle().getName()})}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.wmts.domain.WmtsLayer",function(){this._id=null,this._name=null,this._WmtsLayerName=null,this._WmtsMatrixSet=null,this._inspireName=null,this._organizationName=null,this._dataUrl=null,this._type=null,this._opacity=null,this._featureInfoEnabled=null,this._subLayers=[],this._styles=[],this._description=null,this._WmtsUrls=[],this._dataUrl=null,this._legendImage=null,this._maxScale=null,this._minScale=null,this._queryable=null,this._currentStyle=null,this._visible=null,this._queryFormat=null,this._orderNumber=null,this._permissions={},this._geometry=[],this._geometryWKT=null},{setGeometryWKT:function(e){this._geometryWKT=e},getGeometryWKT:function(){return this._geometryWKT},setGeometry:function(e){this._geometry=e},getGeometry:function(){return this._geometry},addPermission:function(e,t){this._permissions[e]=t},removePermission:function(e){this._permissions[e]=null},getPermission:function(e){return this._permissions[e]},setId:function(e){this._id=e},getId:function(){return this._id},setQueryFormat:function(e){this._queryFormat=e},getQueryFormat:function(){return this._queryFormat},setName:function(e){this._name=e},getName:function(){return this._name},setType:function(e){this._type=e},getType:function(){return this._type},setOpacity:function(e){this._opacity=e},getOpacity:function(){return this._opacity},setDataUrl:function(e){this._dataUrl=e},getDataUrl:function(){return this._dataUrl},setOrganizationName:function(e){this._organizationName=e},getOrganizationName:function(){return this._organizationName},setInspireName:function(e){this._inspireName=e},getInspireName:function(){return this._inspireName},setFeatureInfoEnabled:function(e){this._featureInfoEnabled=e},isFeatureInfoEnabled:function(){return this._featureInfoEnabled===!0?!0:!1},setDescription:function(e){this._description=e},getDescription:function(){return this._description},setWmtsName:function(e){this._WmtsName=e},getWmtsName:function(){return this._WmtsName},setWmtsMatrixSet:function(e){this._WmtsMatrixSet=e},getWmtsMatrixSet:function(){return this._WmtsMatrixSet},setWmtsLayerDef:function(e){this._WmtsLayerDef=e},getWmtsLayerDef:function(){return this._WmtsLayerDef},addWmtsUrl:function(e){this._WmtsUrls.push(e)},getWmtsUrls:function(){return this._WmtsUrls},addStyle:function(e){this._styles.push(e)},getStyles:function(){return this._styles},addSubLayer:function(e){this._subLayers.push(e)},getSubLayers:function(){return this._subLayers},setLegendImage:function(e){this._legendImage=e},getLegendImage:function(){return this._legendImage},setMaxScale:function(e){this._maxScale=e},getMaxScale:function(){return this._maxScale},setMinScale:function(e){this._minScale=e},getMinScale:function(){return this._minScale},setQueryable:function(e){this._queryable=e},getQueryable:function(){return this._queryable},setAsBaseLayer:function(){this._type="BASE_LAYER"},setAsNormalLayer:function(){this._type="NORMAL_LAYER"},setAsGroupLayer:function(){this._type="GROUP_LAYER"},setOrderNumber:function(e){this._orderNumber=e},getOrderNumber:function(){return this._orderNumber},isBaseLayer:function(){return"BASE_LAYER"==this._type?!0:!1},selectStyle:function(e){var t=null;if(!(this._styles.length>0))return t=Oskari.clazz.create("Oskari.mapframework.domain.Style"),t.setName(""),t.setTitle(""),t.setLegend(""),this._currentStyle=t,void 0;if(""===e)return this._styles.length>1?this._currentStyle=this._styles[0]:(t=Oskari.clazz.create("Oskari.mapframework.domain.Style"),t.setName(""),t.setTitle(""),t.setLegend(""),this._currentStyle=t),void 0;for(var i=0;this._styles.length>i;i++)if(t=this._styles[i],t.getName()==e)return this._currentStyle=t,void 0;t=Oskari.clazz.create("Oskari.mapframework.domain.Style"),t.setName(""),t.setTitle(""),t.setLegend(""),this._currentStyle=t},getCurrentStyle:function(){return this._currentStyle},isVisible:function(){return this._visible},setVisible:function(e){this._visible=e},isInScale:function(e){var t=this.isBaseLayer();if(!e){var i=Oskari.$().sandbox;e=i.getMap().getScale()}return this.isBaseLayer()||((e>this.getMaxScale()||!this.getMaxScale())&&this.getMinScale()>e||!this.getMinScale())&&(t=!0),t},isLayerOfType:function(e){return"WMTS"==e||"wmtslayer"==e},isGroupLayer:function(){return"GROUP_LAYER"==this._type?!0:!1},getMetadataIdentifier:function(){return this._metadataIdentifier},setMetadataIdentifier:function(e){this._metadataIdentifier=e},getBackendStatus:function(){return this._backendStatus},setBackendStatus:function(e){this._backendStatus=e}}),Oskari.clazz.define("Oskari.mapframework.wmts.service.WMTSLayerService",function(e){this.mapLayerService=e,this.capabilities={},this.capabilitiesClazz=Oskari.clazz.create("Oskari.openlayers.Patch.WMTSCapabilities_v1_0_0")},{setCapabilities:function(e,t){this.capabilities[e]=t},getCapabilities:function(e){return this.capabilities[e]},readWMTSCapabilites:function(e,t,i){var s=this,a=this.capabilitiesClazz.getPatch(),r=new a;OpenLayers.Request.GET({url:t,params:{SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetCapabilities"},success:function(t){var a=t.responseXML;a&&a.documentElement||(a=t.responseText);var n=r.read(a);s.setCapabilities(e,n),s.parseCapabilitiesToLayers(e,n,i)},failure:function(){alert("Trouble getting capabilities doc"),OpenLayers.Console.error.apply(OpenLayers.Console,arguments)}})},parseCapabilitiesToLayers:function(e,t,i){var s=this.mapLayerService,a=null;a=t.operationsMetadata.GetTile.dcp.http.getArray?t.operationsMetadata.GetTile.dcp.http.getArray:t.operationsMetadata.GetTile.dcp.http.get;for(var r=t.contents.layers,n=t.contents,i=n.tileMatrixSets[i],o=0;r.length>o;o++){var l=r[o],h=l.identifier;l.identifier;var u={name:h,minScale:1e7,maxScale:1,opacity:100,wmtsName:h,descriptionLink:"",orgName:"WMTS",type:"wmtslayer",legendImage:"",formats:{value:"text/html"},isQueryable:!0,minScale:1024e4,style:"",dataUrl:"",name:h,opacity:100,inspire:"WMTS",maxScale:1},p=Oskari.clazz.create("Oskari.mapframework.wmts.domain.WmtsLayer");p.setAsNormalLayer(),p.setId(h),p.setName(u.name),p.setWmtsName(u.wmtsName),p.setOpacity(u.opacity),p.setMaxScale(u.maxScale),p.setMinScale(u.minScale),p.setDescription(u.info),p.setDataUrl(u.dataUrl),p.setOrganizationName(u.orgName),p.setInspireName(u.inspire),p.setWmtsMatrixSet(i),p.setWmtsLayerDef(l),p.addWmtsUrl(a);for(var c,d=Oskari.clazz.builder("Oskari.mapframework.domain.Style"),m=0,y=l.styles.length;y>m;++m){c=l.styles[m];var f=d();if(f.setName(c.identifier),f.setTitle(c.identifier),p.addStyle(f),c.isDefault){p.selectStyle(c.identifier);break}}s.addLayer(p,!1)}}}),Oskari.clazz.define("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder",function(){},{parseLayerData:function(e,t){if(e.setWmtsName(t.wmsName),t.wmsUrl)for(var i=t.wmsUrl.split(","),s=0;i.length>s;s++)e.addWmtsUrl(i[s]);for(var a,r=Oskari.clazz.builder("Oskari.mapframework.domain.Style"),s=0,n=t.styles.length;n>s;++s){a=t.styles[s];var o=r();if(o.setName(a.identifier),o.setTitle(a.identifier),e.addStyle(o),a.isDefault){e.selectStyle(a.identifier);break}}e.setFeatureInfoEnabled(!0),t.tileMatrixSetData&&(e.setWmtsMatrixSet(t.tileMatrixSetData),e.setWmtsLayerDef(t.tileLayerData))}}),Oskari.clazz.define("Oskari.openlayers.Patch.WMTSCapabilities_v1_0_0",function(){},{getPatch:function(){return this.patch?this.patch:this.buildPatch()},buildPatch:function(){return this.patch=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.options=e;var t=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(t,this.yx)},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t.version=this.version,t},props:{wmts:{TileMatrixLimits:{MinTileRow:["minTileRow",parseInt],MaxTileRow:["maxTileRow",parseInt],MinTileCol:["minTileCol",parseInt],MaxTileCol:["maxTileCol",parseInt],TileMatrix:["tileMatrix",null]}}},readers:{wmts:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={},t.contents.layers=[],t.contents.tileMatrixSets={},this.readChildNodes(e,t.contents)},Layer:function(e,t){var i={styles:[],formats:[],tileMatrixSetLinks:[],tileMatrixSetLinksMap:{}};i.layers=[],this.readChildNodes(e,i),t.layers.push(i)},Style:function(e,t){var i={};i.isDefault="true"===e.getAttribute("isDefault"),this.readChildNodes(e,i),t.styles.push(i)},Format:function(e,t){t.formats.push(this.getChildValue(e))},TileMatrixSetLink:function(e,t){var i={};this.readChildNodes(e,i),t.tileMatrixSetLinks.push(i),t.tileMatrixSetLinksMap[i.tileMatrixSet]=i},TileMatrixSet:function(e,t){if(t.layers){var i={matrixIds:[]};this.readChildNodes(e,i),t.tileMatrixSets[i.identifier]=i}else t.tileMatrixSet=this.getChildValue(e)},TileMatrix:function(e,t){var i={supportedCRS:t.supportedCRS};this.readChildNodes(e,i),t.matrixIds.push(i)},ScaleDenominator:function(e,t){t.scaleDenominator=parseFloat(this.getChildValue(e))},TopLeftCorner:function(e,t){var i,s=this.getChildValue(e),a=s.split(" ");if(t.supportedCRS){var r=t.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");i=!!this.yx[r]}t.topLeftCorner=i?new OpenLayers.LonLat(a[1],a[0]):new OpenLayers.LonLat(a[0],a[1])},TileWidth:function(e,t){t.tileWidth=parseInt(this.getChildValue(e))},TileHeight:function(e,t){t.tileHeight=parseInt(this.getChildValue(e))},MatrixWidth:function(e,t){t.matrixWidth=parseInt(this.getChildValue(e))},MatrixHeight:function(e,t){t.matrixHeight=parseInt(this.getChildValue(e))},ResourceURL:function(e,t){t.resourceUrl=t.resourceUrl||{},t.resourceUrl[e.getAttribute("resourceType")]={format:e.getAttribute("format"),template:e.getAttribute("template")}},WSDL:function(e,t){t.wsdl={},t.wsdl.href=e.getAttribute("xlink:href")},ServiceMetadataURL:function(e,t){t.serviceMetadataUrl={},t.serviceMetadataUrl.href=e.getAttribute("xlink:href")},TileMatrixSetLimits:function(e,t){var i={tileMatrixLimits:[]};t.tileMatrixSetLimits=i,this.readChildNodes(e,i);for(var s={},a=0;i.tileMatrixLimits.length>a;a++){var r=i.tileMatrixLimits[a];s[r.tileMatrix]=r}t.tileMatrixSetLimitsMap=s},TileMatrixLimits:function(e,t){for(var i=this.getElementsByTagNameNS(e,this.namespaces.wmts,"*"),s=this.props.wmts.TileMatrixLimits,a={},r=0;i.length>r;r++){var n=i[r],o=this.getChildValue(n),l=n.localName||n.nodeName.split(":").pop(),h=s[l][0],u=s[l][1];a[h]=u?u(o):o}t.tileMatrixLimits.push(a)}},ows:OpenLayers.Util.applyDefaults({HTTP:function(e,t){t.http={},this.readChildNodes(e,t.http)},Get:function(e,t){var i=this.getAttributeNS(e,this.namespaces.xlink,"href");t.get||(t.get=i),t.getArray||(t.getArray=[]),t.getArray.push(i)}},OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows)},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"}),this.patch}},{protocol:["Oskari.openlayers.Patch"]}),Oskari.clazz.define("Oskari.openlayers.Patch.layer.WMTS",function(){},{getPatch:function(){return this.patch?this.patch:this.buildPatch()},buildPatch:function(){return this.patch=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,layerDef:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(e){var t={url:!0,layer:!0,style:!0,matrixSet:!0};for(var i in t)if(!(i in e))throw Error("Missing property '"+i+"' in layer configuration.");e.params=OpenLayers.Util.upperCaseObject(e.params);var s=[e.name,e.url,e.params,e];if(OpenLayers.Layer.Grid.prototype.initialize.apply(this,s),this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()),this.matrixIds){var a=this.matrixIds.length;if(a&&"string"==typeof this.matrixIds[0]){var r=this.matrixIds;this.matrixIds=Array(a);for(var n=0;a>n;++n)this.matrixIds[n]={identifier:r[n]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.updateMatrixProperties()},updateMatrixProperties:function(){this.matrix=this.getMatrix(),this.matrix&&(this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=this.maxExtent))},moveTo:function(e,t){return(t||!this.matrix)&&this.updateMatrixProperties(),OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.WMTS(this.options)),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getMatrix:function(){var e;if(this.matrixIds&&0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0])for(var t,i=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.map.getResolution()/28e-5,s=Number.POSITIVE_INFINITY,a=0,r=this.matrixIds.length;r>a;++a)t=Math.abs(1-this.matrixIds[a].scaleDenominator/i),s>t&&(s=t,e=this.matrixIds[a]);else e=this.matrixIds[this.map.getZoom()+this.zoomOffset];else e={identifier:this.map.getZoom()+this.zoomOffset};return e},getTileInfo:function(e){var t=this.map.getResolution(),i=(e.lon-this.tileOrigin.lon)/(t*this.tileSize.w),s=(this.tileOrigin.lat-e.lat)/(t*this.tileSize.h),a=Math.floor(i),r=Math.floor(s);return{col:a,row:r,i:Math.floor((i-a)*this.tileSize.w),j:Math.floor((s-r)*this.tileSize.h)}},getURL:function(e){e=this.adjustBounds(e);var t="";if(this.tileFullExtent&&!this.tileFullExtent.intersectsBounds(e))return t;var i=e.getCenterLonLat(),s=this.getTileInfo(i);if(this.matrix.identifier,this.layerDef&&this.layerDef.tileMatrixSetLinksMap){var a=this.layerDef.tileMatrixSetLinksMap[this.matrixSet],r=a?a.tileMatrixSetLimitsMap[this.matrix.identifier]:null,n=r?s.row>=r.minTileRow&&s.row<=r.maxTileRow:!1,o=r?s.col>=r.minTileCol&&s.col<=r.maxTileCol:!1;if(!n||!o)return OpenLayers.Util.getImagesLocation()+"blank.gif"}if("REST"===this.requestEncoding.toUpperCase()){var l=this.version+"/"+this.layer+"/"+this.style+"/";if(this.dimensions)for(var h=0;this.dimensions.length>h;h++)this.params[this.dimensions[h]]&&(l=l+this.params[this.dimensions[h]]+"/");l=l+this.matrixSet+"/"+this.matrix.identifier+"/"+s.row+"/"+s.col+"."+this.formatSuffix,t=OpenLayers.Util.isArray(this.url)?this.selectUrl(l,this.url):this.url,t.match(/\/$/)||(t+="/"),t+=l}else if("KVP"===this.requestEncoding.toUpperCase()){var u={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:s.row,TILECOL:s.col,FORMAT:this.format};t=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[u])}return t},mergeNewParams:function(e){return"KVP"===this.requestEncoding.toUpperCase()?OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(e)]):void 0},CLASS_NAME:"OpenLayers.Layer.WMTS"}),this.patch}},{protocol:["Oskari.openlayers.Patch"]}),Oskari.clazz.define("Oskari.mapframework.bundle.MapWmtsBundleInstance",function(){this.name="MapWmts",this.mediator=null,this.sandbox=null,this.service=null,this.ui=null},{start:function(){if("started"!=this.mediator.getState()){var e=Oskari.$("sandbox");this.sandbox=e;var t=e.getService("Oskari.mapframework.service.MapLayerService");t.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer");var i=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder");t.registerLayerModelBuilder("wmtslayer",i);var s=Oskari.clazz.create("Oskari.mapframework.wmts.service.WMTSLayerService",t);return this.service=s,this.mediator.setState("started"),this}},update:function(e,t,i,s){e.alert("RECEIVED update notification @BUNDLE_INSTANCE: "+s)},stop:function(){return this.mediator.setState("stopped"),this},getName:function(){return this.__name},__name:"Oskari.mapframework.bundle.MapWmtsBundleInstance"},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.bundle.extension.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.MapWfsBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs.MapWfsBundleInstance")},update:function(e,t,i,s){e.alert("RECEIVED update notification "+s)}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/domain/WfsLayer.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/domain/QueuedTile.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/domain/TileQueue.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/domain/WfsTileRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/event/WFSFeaturesSelectedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/service/WfsTileService.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/plugin/wfslayer/QueuedTilesGrid.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/plugin/wfslayer/QueuedTilesStrategy.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/plugin/wfslayer/WfsLayerPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapwfs/instance.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"mapwfs","Bundle-Name":"mapwfs","Bundle-Tag":{mapframework:!0},"Bundle-Icon":{href:"icon.png"},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"WFS",Title:"WFS"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","Ext"]}}}),Oskari.bundle_manager.installBundleClass("mapwfs","Oskari.mapframework.bundle.mapwfs.MapWfsBundle"),Oskari.clazz.define("Oskari.mapframework.domain.WfsLayer",function(){this._id=null,this._type=null,this._opacity=null,this._inspireName=null,this._organizationName=null,this._dataUrl=null,this._queryable=!0,this._subLayers=[],this._description=null,this._name=null,this._visible=null,this._metadataIdentifier=null,this._maxScale=null,this._minScale=null,this._orderNumber=null,this._featureInfoEnabled=!0,this._permissions={},this._geometry=[],this._geometryWKT=null,this._backendStatus=null},{setGeometryWKT:function(e){this._geometryWKT=e},getGeometryWKT:function(){return this._geometryWKT},setGeometry:function(e){this._geometry=e},getGeometry:function(){return this._geometry},setQueryable:function(e){this._queryable=e},getQueryable:function(){return this._queryable},addPermission:function(e,t){this._permissions[e]=t},removePermission:function(e){this._permissions[e]=null},getPermission:function(e){return this._permissions[e]},setId:function(e){this._id=e},getId:function(){return this._id},setName:function(e){this._name=e},getName:function(){return this._name},setType:function(e){this._type=e},getType:function(){return this._type},setOpacity:function(e){this._opacity=e},getOpacity:function(){return this._opacity},setDataUrl:function(e){this._dataUrl=e},getDataUrl:function(){return this._dataUrl},setOrganizationName:function(e){this._organizationName=e},getOrganizationName:function(){return this._organizationName},setInspireName:function(e){this._inspireName=e},getInspireName:function(){return this._inspireName},setFeatureInfoEnabled:function(e){this._featureInfoEnabled=e},isFeatureInfoEnabled:function(){return this._featureInfoEnabled===!0?!0:!1},setDescription:function(e){this._description=e},getDescription:function(){return this._description},addSubLayer:function(e){this._subLayers.push(e)},getSubLayers:function(){return this._subLayers},setMaxScale:function(e){this._maxScale=e},getMaxScale:function(){return this._maxScale},setMinScale:function(e){this._minScale=e},getMinScale:function(){return this._minScale},setAsBaseLayer:function(){this._type="BASE_LAYER"},setAsNormalLayer:function(){this._type="NORMAL_LAYER"},setOrderNumber:function(e){this._orderNumber=e},getOrderNumber:function(){return this._orderNumber},isBaseLayer:function(){return"BASE_LAYER"===this._type},isGroupLayer:function(){return!1},isInScale:function(e){var t=this.isBaseLayer();if(!e){var i=Oskari.$().sandbox;e=i.getMap().getScale()}return this.isBaseLayer()||((e>this.getMaxScale()||!this.getMaxScale())&&this.getMinScale()>e||!this.getMinScale())&&(t=!0),t},isVisible:function(){return this._visible===!0},setVisible:function(e){this._visible=e},isLayerOfType:function(e){return"WFS"==e||"wfs"==e},getMetadataIdentifier:function(){return this._metadataIdentifier},setMetadataIdentifier:function(e){this._metadataIdentifier=e},getBackendStatus:function(){return this._backendStatus},setBackendStatus:function(e){this._backendStatus=e
}}),Oskari.clazz.define("Oskari.mapframework.gridcalc.QueuedTile",function(e){for(p in e)this[p]=e[p]},{getBounds:function(){return this.bounds}}),Oskari.clazz.define("Oskari.mapframework.gridcalc.TileQueue",function(){this.queue=[]},{getQueue:function(){return this.queue},getLength:function(){return this.queue.length},popJob:function(){var e=this.queue,t=e.length;if(0===t)return null;if(4>t)return e.shift(-1);var i=null,s=Math.floor(t/2);return i=e[s],this.queue=e.slice(0,s).concat(e.slice(s+1)),i},pushJob:function(e){this.queue.push(e)},flushQueue:function(){this.queue=[]}}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.domain.WfsTileRequest",function(e,t,i,s,a,r){this._bbox=t,this._mapWidth=i,this._mapHeight=s,this._mapLayer=e,this._creator=a,this._sequenceNumber=r},{getMapLayer:function(){return this._mapLayer},getBbox:function(){return this._bbox},getMapWidth:function(){return this._mapWidth},getMapHeight:function(){return this._mapHeight},getSequenceNumber:function(){return this._sequenceNumber}}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.event.WFSFeaturesSelectedEvent",function(e,t,i){this._wfsFeatureIds=e,this._addToSelection=i,this._mapLayer=t},{__name:"WFSFeaturesSelectedEvent",getName:function(){return this.__name},getWfsFeatureIds:function(){return this._wfsFeatureIds},isKeepSelection:function(){return this._addToSelection?this._addToSelection:!1},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.service.WfsTileService",function(e){this.plugin=e,this._TILE_SIZE_IN_PIXELS=256,this._componentName="WfsRequestTiler",this._mapPollingInterval=100,this._simultaneousPngRequest=4,this._wfsMapUpdateRequests={},this._WFSFeaturesSelectedEvent=null,this._tileCount=16,this._doMapLayerReArrange=!1,this.sandbox=e._sandbox,this.endpointUrl=this.sandbox.getAjaxUrl(),this.pngUrl=this.endpointUrl.replace("ajax.jsp&","png.jsp"),this.pngUrl=this.pngUrl.replace("p_p_lifecycle=1","p_p_lifecycle=2"),this.pngUrl=this.pngUrl.replace("p_p_state=exclusive","p_p_state=normal")},{__qname:"Oskari.mapframework.bundle.mapwfs.service.WfsTileService",getQName:function(){return this.__qname},__name:"WfsTileService",getName:function(){return this.__name},scheduleMapLayerRearrangeAfterWfsMapTilesAreReady:function(){this._doMapLayerReArrange=!0},removeWFsLayerRequests:function(e){var t=e.getId();if(null!==this._wfsMapUpdateRequests[t]){var i=this._wfsMapUpdateRequests[t];this._wfsMapUpdateRequests[t]=null,delete i}},removeWFSMapHighlightRequest:function(){this._WFSFeaturesSelectedEvent=null},scheduleWFSMapLayerUpdate:function(e,t,i,s,a){var r=e.getId(),n=this._wfsMapUpdateRequests[r];null!==n&&(this._wfsMapUpdateRequests[r]=null,delete n),this._wfsMapUpdateRequests[r]=[];var o=this.splitBbox(t,i,s,this._TILE_SIZE_IN_PIXELS);this._tileCount=o.length;for(var l=Oskari.clazz.builder("Oskari.mapframework.bundle.mapwfs.domain.WfsTileRequest"),h=0;o.length>h;h++){var u=l(e,o[h],i,s,a,h);this._wfsMapUpdateRequests[r].push(u)}this._doMapLayerReArrange=!0},scheduleWFSMapHighlightUpdate:function(e){this._WFSFeaturesSelectedEvent=e,this.processHighlightQueue()},splitBbox:function(){var e=this.sandbox.getMap(),t=[];if(e){var i=this.plugin.getTileQueue();i&&(t=i.getQueue())}return t},processMapQueue:function(){var e=this;this.sandbox.printDebug("[WfsTileService.processMapQueue] Looping this._wfsMapUpdateRequests...");for(var t in this._wfsMapUpdateRequests){var i=this._wfsMapUpdateRequests[t];if(null!==i&&i.length>0){this.sandbox.printDebug("[WfsTileService.processMapQueue] Got requestArray of size "+i.length+" for id "+t);var s=i[0];this.sandbox.printDebug("[WfsTileService.processMapQueue] Creating request for '"+s.getMapLayer().getName()+"'");var a=s.getBbox(),r=this.sandbox.getMap().getZoom(),n=this.pngUrl+"&flow_pm_wfsLayerId="+s.getMapLayer().getId()+"&flow_pm_bbox_min_x="+a.bounds.left+"&flow_pm_bbox_min_y="+a.bounds.bottom+"&flow_pm_bbox_max_x="+a.bounds.right+"&flow_pm_bbox_max_y="+a.bounds.top+"&flow_pm_map_width="+this._TILE_SIZE_IN_PIXELS+"&flow_pm_map_heigh="+this._TILE_SIZE_IN_PIXELS+"&flow_pm_zoom_level="+r+"&action_route=GET_PNG_MAP",o="WFS_LAYER_IMAGE_"+s.getMapLayer().getId()+"_"+s.getSequenceNumber();return e.plugin.drawImageTile(s.getMapLayer(),n,a,o),this.sandbox.printDebug("[WfsTileService.processMapQueue] removing handled element"),i.splice(0,1),0===i.length&&(delete i,this.sandbox.printDebug("[WfsTileService.processMapQueue] deleting empty requestArray")),void 0}}if(this.sandbox.printDebug("[WfsTileService.processMapQueue] _doMapLayerReArrange is "+this._doMapLayerReArrange),this._doMapLayerReArrange){var l=this.sandbox.getRequestBuilder("RearrangeSelectedMapLayerRequest"),h=l();this.sandbox.request(this.plugin,h),this._doMapLayerReArrange=!1}},processHighlightQueue:function(){var e=this._WFSFeaturesSelectedEvent;if(e)try{var t=e.getMapLayer();if(!t.isLayerOfType("WFS"))throw"Trying to highlight feature from layer that is not WFS layer!";var i=e.getWfsFeatureIds();if(!i&&i.length>0)return e.isKeepSelection()||this.plugin.removeHighlightOnMapLayer(t.getId()),void 0;for(var s=this.sandbox.getMap(),a=s.getBbox(),r=s.getWidth(),n=s.getHeight(),o=this,l=o.pngUrl+"&flow_pm_wfsLayerId="+t.getId()+"&flow_pm_bbox_min_x="+a.left+"&flow_pm_bbox_min_y="+a.bottom+"&flow_pm_bbox_max_x="+a.right+"&flow_pm_bbox_max_y="+a.top+"&flow_pm_map_width="+r+"&flow_pm_map_heigh="+n+"&action_route=GET_HIGHLIGHT_WFS_FEATURE_IMAGE",h=function(e){o.plugin.drawImageTile(t,l+"&wfsFeatureId="+e,a,"HIGHLIGHTED_FEATURE",!0)},u=0;i.length>u;++u)h(i[u])}finally{this._WFSFeaturesSelectedEvent=null}},startPollers:function(){for(i=0;this._tileCount>i;i++)this.processMapQueue()}},{protocol:["Oskari.mapframework.service.Service"]}),Oskari.clazz.define("Oskari.mapframework.gridcalc.QueuedTilesGrid",function(e){this.grid=[],this.map=null,this.tileSize=null,this.maxExtent=null,this.buffer=0,this.numLoadingTiles=0;for(p in e)this[p]=e[p]},{destroy:function(){this.clearGrid(),this.grid=null,this.tileSize=null},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;t>e;e++)for(var i=this.grid[e],s=0,a=i.length;a>s;s++){var r=i[s];r.destroy()}this.grid=[]}},moveTo:function(e,t){if(e=e||this.map.getExtent(),null!=e){var i=!this.grid.length||t,s=this.getTilesBounds();i||!s.containsBounds(e,!0)?this.initGriddedTiles(e):this.moveGriddedTiles(e)}},setTileSize:function(){},getTilesBounds:function(){var e=null;if(this.grid.length){var t=this.grid.length-1,i=this.grid[t][0],s=this.grid[0].length-1,a=this.grid[0][s];e=new OpenLayers.Bounds(i.bounds.left,i.bounds.bottom,a.bounds.right,a.bounds.top)}return e},calculateGridLayout:function(e,t,i){var s=i*this.tileSize.w,a=i*this.tileSize.h,r=e.left-t.left,n=Math.floor(r/s)-this.buffer,o=r/s-n,l=-o*this.tileSize.w,h=t.left+n*s,u=e.top-(t.bottom+a),p=Math.ceil(u/a)+this.buffer,c=p-u/a,d=-c*this.tileSize.h,m=t.bottom+p*a;return{tilelon:s,tilelat:a,tileoffsetlon:h,tileoffsetlat:m,tileoffsetx:l,tileoffsety:d}},initGriddedTiles:function(e){var t=this.map.getSize(),i=Math.ceil(t.h/this.tileSize.h)+Math.max(1,2*this.buffer),s=Math.ceil(t.w/this.tileSize.w)+Math.max(1,2*this.buffer),a=this.maxExtent,r=this.map.getResolution(),n=this.calculateGridLayout(e,a,r),o=Math.round(n.tileoffsetx),l=Math.round(n.tileoffsety),h=n.tileoffsetlon,u=n.tileoffsetlat,p=n.tilelon,c=n.tilelat;this.origin=new OpenLayers.Pixel(o,l);var d=o,m=h,y=0,f=parseInt(this.map.layerContainerDiv.style.left),g=parseInt(this.map.layerContainerDiv.style.top);do{var v=this.grid[y++];v||(v=[],this.grid.push(v)),h=m,o=d;var L=0;do{var b=new OpenLayers.Bounds(h,u,h+p,u+c),O=o;O-=f;var S=l;S-=g;var w=new OpenLayers.Pixel(O,S),_=v[L++];_?_.moveTo(b,w,!1):(_=this.addTile(b,w),v.push(_)),h+=p,o+=this.tileSize.w}while(e.right+p*this.buffer>=h||s>L);u-=c,l+=this.tileSize.h}while(u>=e.bottom-c*this.buffer||i>y);this.removeExcessTiles(y,L)},addTile:function(e,t){return new OpenLayers.Tile(this.layer,e,t,"",this.tileSize)},moveGriddedTiles:function(){for(var e=this.buffer||1;;){var t=this.grid[0][0].position,i=this.map.getViewPortPxFromLayerPx(t);if(i.x>-this.tileSize.w*(e-1))this.shiftColumn(!0);else if(i.x<-this.tileSize.w*e)this.shiftColumn(!1);else if(i.y>-this.tileSize.h*(e-1))this.shiftRow(!0);else{if(!(i.y<-this.tileSize.h*e))break;this.shiftRow(!1)}}},shiftRow:function(e){for(var t=e?0:this.grid.length-1,i=this.grid,s=i[t],a=this.map.getResolution(),r=e?-this.tileSize.h:this.tileSize.h,n=a*-r,o=e?i.pop():i.shift(),l=0,h=s.length;h>l;l++){var u=s[l],p=u.bounds.clone(),c=u.position.clone();p.bottom=p.bottom+n,p.top=p.top+n,c.y=c.y+r,o[l].moveTo(p,c)}e?i.unshift(o):i.push(o)},shiftColumn:function(e){for(var t=e?-this.tileSize.w:this.tileSize.w,i=this.map.getResolution(),s=i*t,a=0,r=this.grid.length;r>a;a++){var n=this.grid[a],o=e?0:n.length-1,l=n[o],h=l.bounds.clone(),u=l.position.clone();h.left=h.left+s,h.right=h.right+s,u.x=u.x+t;var p=e?this.grid[a].pop():this.grid[a].shift();p.moveTo(h,u),e?n.unshift(p):n.push(p)}},removeExcessTiles:function(e,t){for(;this.grid.length>e;)for(var i=this.grid.pop(),s=0,a=i.length;a>s;s++){var r=i[s];r.destroy()}for(;this.grid[0].length>t;)for(var s=0,a=this.grid.length;a>s;s++){var i=this.grid[s],r=i.pop();r.destroy()}},onMapResize:function(){},CLASS_NAME:"NLSFI.OpenLayers.Strategy.QueuedTilesGrid"}),Oskari.clazz.define("Oskari.mapframework.gridcalc.QueuedTilesStrategy",function(e){this.debugGridFeatures=!0,this.options=e,this.tileQueue=e.tileQueue,this.autoActivate=!0,this.autoDestroy=!1,this.grid=null,this.bounds=null;for(p in e)this[p]=e[p];this.active=!1},{setLayer:function(e){this.layer=e},flushTileQueue:function(){for(var e=this.tileQueue.queue,t=[],i=0;e.length>i;i++)null!=e[i].tileFeature&&(t.push(e[i].tileFeature),e[i].tileFeature=null);t.length>0&&this.layer.destroyFeatures(t),this.tileQueue.flushQueue()},unloadOutOfViewFeatures:function(){},ratio:1,activate:function(){return this.active?!1:(this.active=!0,this.grid=Oskari.clazz.create("Oskari.mapframework.gridcalc.QueuedTilesGrid",{map:this.layer.map,layer:this.layer,maxExtent:this.layer.map.getMaxExtent(),tileSize:this.layer.map.getTileSize()}),this.layer.events.on({refresh:this.updateRefresh,scope:this}),!0)},deactivate:function(){return this.active?(this.layer.events.un({refresh:this.update,scope:this}),this.grid.destroy(),this.grid=null,!0):!1},updateRefresh:function(){this.update()},updateMoveEnd:function(){this.update()},update:function(){var e=this.layer.map.getExtent();this.grid.moveTo(e,!0),this.flushTileQueue();var t=this.layer.map.getZoom();this.minZoom>t||this.triggerRead()},invalidBounds:function(e){return e||(e=this.layer.map.getExtent()),!this.bounds||!this.bounds.containsBounds(e)},triggerUnload:function(){this.layer.destroyFeatures()},triggerRead:function(){for(var e=this.grid.grid,t=[],i=this.debugGridFeatures,s=0;e.length>s;s++)for(var a=0;e[s].length>a;a++){var r=e[s][a].bounds.clone(),n={left:r.left,top:r.top,right:r.right,bottom:r.bottom},o=null;if(i){var l=new OpenLayers.Geometry.Point(r.left,r.bottom),h=new OpenLayers.Geometry.Point(r.right,r.top),u=new OpenLayers.Geometry.Point(r.left,r.top),p=new OpenLayers.Geometry.Point(r.right,r.bottom),c=new OpenLayers.Geometry.LineString([l,p,h,u,l]),o=new OpenLayers.Feature.Vector(c,{featureClassName:this.CLASS_NAME,description:""});o.renderIntent="tile",t.push(o)}var d=Oskari.clazz.create("Oskari.mapframework.gridcalc.QueuedTile",{bounds:n,tileFeature:o});this.tileQueue.pushJob(d)}i&&this.layer.addFeatures(t)},merge:function(e){var t=e.features;t&&t.length>0&&this.layer.addFeatures(t)},CLASS_NAME:"NLSFI.OpenLayers.Strategy.QueuedTilesStrategy"}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.plugin.wfslayer.WfsLayerPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this.service=null},{__name:"WfsLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},init:function(){},register:function(){this.getMapModule().setLayerPlugin("wfslayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("wfslayer",null)},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),this.createTilesGrid(),this.service=Oskari.clazz.create("Oskari.mapframework.bundle.mapwfs.service.WfsTileService",this),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapMoveEvent:function(e){var t=this._sandbox.getObjectCreator(e);this._sandbox.printDebug("[WfsLayerPlugin] got AfterMapMoveEvent from "+t),this.afterAfterMapMoveEvent()},AfterMapLayerAddEvent:function(e){this.afterMapLayerAddEvent(e)},AfterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();t.isLayerOfType("WFS")&&this.afterMapLayerRemoveEvent(e)},AfterHighlightWFSFeatureRowEvent:function(e){this.handleAfterHighlightWFSFeatureRowEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this.afterChangeMapLayerOpacityEvent(e)},AfterDimMapLayerEvent:function(e){this.handleAfterDimMapLayerEvent(e)},MapClickedEvent:function(e){if(!this._sandbox.getMap().isMoving()){var t=e.getLonLat(),i=e.getMouseX(),s=e.getMouseY();this._getFeatureIds(t,i,s)}},WFSFeaturesSelectedEvent:function(e){this.service.scheduleWFSMapHighlightUpdate(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){for(var t=this._sandbox,i=0;e.length>i;i++){var s=e[i],a=s.getId();s.isLayerOfType("WFS")&&(t.printDebug("[WfsLayerPlugin] preselecting "+a),this.addMapLayerToMap(s,!0,s.isBaseLayer()))}},afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer();if(t.isLayerOfType("WFS"))for(var i=this.getOLMapLayers(t),s=0;i.length>s;s++)i[s].setOpacity(t.getOpacity()/100)},handleAfterDimMapLayerEvent:function(e){var t=e.getMapLayer();if(t.isLayerOfType("WFS"))for(var i=RegExp("wfs_layer_"+t.getId()+"_HIGHLIGHTED_FEATURE*","i"),s=this._map.getLayersByName(i),a=0;s.length>a;a++)s[a].destroy()},afterMapLayerAddEvent:function(e){this.addMapLayerToMap(e.getMapLayer(),e.getKeepLayersOrder(),e.isBasemap()),this.afterAfterMapMoveEvent()},addMapLayerToMap:function(){},afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this.service.removeWFsLayerRequests(t),this.removeMapLayerFromMap(t)},removeMapLayerFromMap:function(e){for(var t=this.getOLMapLayers(e),i=0;t.length>i;i++)t[i].destroy()},getOLMapLayers:function(e){if(!e||e.isLayerOfType("WFS")){var t="";e&&(t="_"+e.getId());var i=RegExp("wfs_layer"+t+"_*","i");return this._map.getLayersByName(i)}},drawImageTile:function(e,t,i,s,a){var r="wfs_layer_"+e.getId()+"_"+s,n=null;if(i.bounds&&i.bounds.left&&i.bounds.right&&i.bounds.top&&i.bounds.bottom?n=new OpenLayers.Bounds(i.bounds.left,i.bounds.bottom,i.bounds.right,i.bounds.top):i.left&&i.right&&i.top&&i.bottom&&(n=new OpenLayers.Bounds(i.left,i.bottom,i.right,i.top)),t&&e&&n){var o=this.mapModule.calculateLayerScales(e.getMaxScale(),e.getMinScale()),l=null;if(!a)for(var h=this._map.getLayersByName(r),u=0;h.length>u;u++)l=this._map.getLayerIndex(h[u]),h[u].destroy();var p=new OpenLayers.Size(256,256),c=new OpenLayers.Layer.Image(r,t,n,p,{scales:o,transparent:!0,format:"image/png",isBaseLayer:!1,displayInLayerSwitcher:!0,visibility:!0,buffer:0});c.opacity=e.getOpacity()/100,this._map.addLayer(c),c.setVisibility(!0),c.redraw(!0);var d=this._map.layers.length,m=this._map.getLayersByName("Markers");m.length>0&&(this._map.setLayerIndex(m[0],d),d--),null!==l&&null!==c&&this._map.setLayerIndex(c,l);var y=RegExp("wfs_layer_"+e.getId()+"_WFS_LAYER_IMAGE*","i"),f=this._map.getLayersByName(y);if(f.length>0){var g=this._map.getLayerIndex(f[f.length-1]),v=this._map.getLayersByName(r);v.length>0&&this._map.setLayerIndex(v[0],g)}}},handleAfterHighlightWFSFeatureRowEvent:function(e){var t=e.getWfsFeatureIds();if(0==t.length&&!e.isKeepSelection()){var i=e.getMapLayer();this.removeHighlightOnMapLayer(i.getId())}},removeHighlightOnMapLayer:function(e){var t="";e&&(t="wfs_layer_"+e);for(var i=RegExp(t+"_HIGHLIGHTED_FEATURE*","i"),s=this._map.getLayersByName(i),a=0;s.length>a;a++)s[a].destroy()},updateWfsImages:function(){for(var e=Oskari.$().sandbox.findAllSelectedMapLayers(),t=0;e.length>t;t++)e[t].isInScale()&&e[t].isLayerOfType("WFS")&&this.doWfsLayerRelatedQueries(e[t])},doWfsLayerRelatedQueries:function(e){if(e.isInScale()){var t=this._sandbox.getMap(),i=t.getBbox(),s=t.getWidth(),a=t.getHeight();this.service.scheduleWFSMapLayerUpdate(e,i,s,a,this.getName()),this.service.startPollers()}},afterAfterMapMoveEvent:function(){this.tileStrategy.update(),this._tilesLayer.redraw(),this.updateWfsImages(this.getName())},createTilesGrid:function(){var e=this;e._sandbox;var t=Oskari.clazz.create("Oskari.mapframework.gridcalc.TileQueue"),i=Oskari.clazz.create("Oskari.mapframework.gridcalc.QueuedTilesStrategy",{tileQueue:t});i.debugGridFeatures=!1,this.tileQueue=t,this.tileStrategy=i;var s=new OpenLayers.StyleMap({"default":new OpenLayers.Style({pointRadius:3,strokeColor:"red",strokeWidth:2,fillColor:"#800000"}),tile:new OpenLayers.Style({strokeColor:"#008080",strokeWidth:5,fillColor:"#ffcc66",fillOpacity:.5}),select:new OpenLayers.Style({fillColor:"#66ccff",strokeColor:"#3399ff"})});this._tilesLayer=new OpenLayers.Layer.Vector("Tiles Layer",{strategies:[i],styleMap:s,visibility:!0}),this._map.addLayer(this._tilesLayer),this._tilesLayer.setOpacity(.3)},getTileQueue:function(){return this.tileQueue},_getFeatureIds:function(e){var t=this,i=this._sandbox,s=i.findAllHighlightedLayers();if(0!=s.length&&s[0]&&s[0].isLayerOfType("WFS")){if(1!=s.length)return i.printDebug("Trying to highlight WFS feature but there is either too many or none selected WFS layers. Size: "+s.length),void 0;var a=s[0];if(!a.isInScale())return i.printDebug("Trying to hightlight WFS feature from wfs layer that is not in scale!"),void 0;var r=i.getMap(),n=this._map.getExtent(),o="&flow_pm_wfsLayerId="+a.getId()+"&flow_pm_point_x="+e.lon+"&flow_pm_point_y="+e.lat+"&flow_pm_bbox_min_x="+n.left+"&flow_pm_bbox_min_y="+n.bottom+"&flow_pm_bbox_max_x="+n.right+"&flow_pm_bbox_max_y="+n.top+"&flow_pm_zoom_level="+r.getZoom()+"&flow_pm_map_width="+r.getWidth()+"&flow_pm_map_heigh="+r.getHeight()+"&action_route=GET_HIGHLIGHT_WFS_FEATURE_IMAGE_BY_POINT",l=i.isCtrlKeyDown();jQuery.ajax({dataType:"json",type:"POST",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:i.getAjaxUrl()+o,data:o,success:function(e){t._handleGetFeatureIdsResponse(e,a,l)}})}},_handleGetFeatureIdsResponse:function(response,layer,keepCollection){var sandbox=this._sandbox;"true"==response.error&&sandbox.printWarn("Couldn't get feature id for selected map point.");var selectedFeatures=eval("("+response.selectedFeatures+")"),featureIds=[];null!=selectedFeatures&&null!=selectedFeatures.id&&featureIds.push(selectedFeatures.id);var builder=sandbox.getEventBuilder("WFSFeaturesSelectedEvent"),event=builder(featureIds,layer,keepCollection);sandbox.notifyAll(event)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapwfs.MapWfsBundleInstance",function(){this._localization=null,this._pluginInstances={}},{__name:"MapWFS",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},start:function(){var e=this;if(!e.started){e.started=!0;var t=Oskari.$("sandbox");e.sandbox=t,t.register(e);for(p in e.eventHandlers)t.registerForEventByName(e,p)}},update:function(){},stop:function(){var e=this.sandbox;for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);this.sandbox.unregister(this),this.started=!1},init:function(){return null},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{MapClickedEvent:function(e){if(!this.sandbox.getMap().isMoving()){var t=e.getLonLat(),i=e.getMouseX(),s=e.getMouseY();this._getFeatureIds(t,i,s)}}},_getFeatureIds:function(e){var t=this,i=this.sandbox,s=i.findAllHighlightedLayers();if(0!=s.length&&s[0]&&s[0].isLayerOfType("WFS")){if(1!=s.length)throw"Trying to highlight WFS feature but there is either too many or none selected WFS layers. Size: "+s.length;var a=s[0];if(!a.isInScale())return core.printDebug("Trying to hightlight WFS feature from wfs layer that is not in scale!"),void 0;var r=i.getMap(),n=this._map.getExtent(),o="&flow_pm_wfsLayerId="+a.getId()+"&flow_pm_point_x="+e.lon+"&flow_pm_point_y="+e.lat+"&flow_pm_bbox_min_x="+n.left+"&flow_pm_bbox_min_y="+n.bottom+"&flow_pm_bbox_max_x="+n.right+"&flow_pm_bbox_max_y="+n.top+"&flow_pm_zoom_level="+r.getZoom()+"&flow_pm_map_width="+r.getWidth()+"&flow_pm_map_heigh="+r.getHeight()+"&actionKey=GET_HIGHLIGHT_WFS_FEATURE_IMAGE_BY_POINT",l=i.isCtrlKeyDown();jQuery.ajax({dataType:"json",type:"POST",url:this.endpointUrl+o,data:o,success:function(e){t._handleGetFeatureIdsResponse(e,a,l)}})}},_handleGetFeatureIdsResponse:function(response,layer,keepCollection){var sandbox=this.sandbox;"true"==response.error&&sandbox.printWarn("Couldn't get feature id for selected map point.");var selectedFeatures=eval("("+response.selectedFeatures+")"),featureIds=[];null!=selectedFeatures&&null!=selectedFeatures.id&&(featureIds=selectedFeatures.id);var builder=sandbox.getEventBuilder("WFSFeaturesSelectedEvent"),event=builder(featureIds,layer,keepCollection);sandbox.notifyAll(event)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),Oskari.clazz.define("Oskari.mapframework.service.base.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/service/service.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"service-base","Bundle-Name":"mapframework.service.base.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.service.Bundle",Title:" mapframework.service.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("service-base","Oskari.mapframework.service.base.Bundle"),Oskari.clazz.define("Oskari.mapframework.service.Service",function(){throw"mapframework.service.Service should not be used"},{getName:function(){throw"Running default implementation of Service.getName(). implement your own!"}}),Oskari.clazz.define("Oskari.mapframework.common.ui.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/common/enhancement/disable-development-mode-enhancement.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/common/enhancement/set-default-map-control-active-enhancement.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/common/enhancement/openlayers-image-path-enhancement.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"common","Bundle-Name":"mapframework.common.ui.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.common.ui.Bundle",Title:" mapframework.common.ui.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("common","Oskari.mapframework.common.ui.Bundle"),Oskari.clazz.define("Oskari.mapframework.enhancement.common.DisableDevelopmentModeEnhancement",function(e){this._enableMapMovementLogging=e},{enhance:function(e){e.disableDebug(),this._enableMapMovementLogging&&e.enableMapMovementLogging()}},{protocol:["Oskari.mapframework.enhancement.Enhancement"]}),Oskari.clazz.define("Oskari.mapframework.enhancement.common.SetDefaultMapControlActiveEnhancement",function(e){this._controlId=e},{enhance:function(e){e.printDebug("[SetDefaultMapControlActiveEnhancement] Requesting '"+this._controlId+"' ");var t=e.getRequestBuilder("ToolSelectionRequest"),i=t(this._controlId);e.processRequest(i)},setControl:function(e){this._controlId=e},CONTROL_NAME_NAVIGATE:"map_control_select_tool"},{protocol:["Oskari.mapframework.enhancement.Enhancement"]}),Oskari.clazz.define("Oskari.mapframework.enhancement.common.OpenLayersImagePathEnhancement",function(){},{getName:function(){return"OpenLayersImagePathEnhancement"},enhance:function(){OpenLayers.ImgPath=Oskari.$().startup.imageLocation+"/lib/openlayers/img/"}},{protocol:["Oskari.mapframework.enhancement.Enhancement"]}),Oskari.clazz.define("Oskari.mapframework.event.map.layer.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/event/common/after-rearrange-selected-map-layer-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-change-map-layer-opacity-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-change-map-layer-style-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-highlight-map-layer-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-dim-map-layer-event.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"event-map-layer","Bundle-Name":"mapframework.event.map.layer.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.event.Bundle",Title:" mapframework.event.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("event-map-layer","Oskari.mapframework.event.map.layer.Bundle"),Oskari.clazz.define("Oskari.mapframework.event.common.AfterRearrangeSelectedMapLayerEvent",function(e,t,i){this._creator=null,this._movedMapLayer=e,this._fromPosition=t,this._toPosition=i},{__name:"AfterRearrangeSelectedMapLayerEvent",getName:function(){return this.__name},getMovedMapLayer:function(){return this._movedMapLayer},getFromPosition:function(){return this._fromPosition},getToPosition:function(){return this._toPosition}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterChangeMapLayerOpacityEvent",function(e){this._mapLayer=e},{__name:"AfterChangeMapLayerOpacityEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterChangeMapLayerStyleEvent",function(e){this._mapLayer=e},{__name:"AfterChangeMapLayerStyleEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterHighlightMapLayerEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterHighlightMapLayerEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterDimMapLayerEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterDimMapLayerEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.request.map.layer.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/request/common/rearrange-selected-map-layer-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/change-map-layer-opacity-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/change-map-layer-style-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/highlight-map-layer-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/dim-map-layer-request.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"request-map-layer","Bundle-Name":"mapframework.request.map.layer.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.request.Bundle",Title:" mapframework.request.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("request-map-layer","Oskari.mapframework.request.map.layer.Bundle"),Oskari.clazz.define("Oskari.mapframework.request.common.RearrangeSelectedMapLayerRequest",function(e,t){this._mapLayerId=e,this._toPosition=t},{__name:"RearrangeSelectedMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getToPosition:function(){return this._toPosition}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.ChangeMapLayerOpacityRequest",function(e,t){this._creator=null,this._mapLayerId=e,this._opacity=t},{__name:"ChangeMapLayerOpacityRequest",getName:function(){return this.__name},getOpacity:function(){return this._opacity},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.ChangeMapLayerStyleRequest",function(e,t){this._creator=null,this._mapLayerId=e,this._style=t},{__name:"ChangeMapLayerStyleRequest",getName:function(){return this.__name},getStyle:function(){return this._style},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.HighlightMapLayerRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"HighlightMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.DimMapLayerRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"DimMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.PluginMapModuleBundle",function(){this.singleton=null},{create:function(){return this.singleton||(this.singleton=Oskari.clazz.create("Oskari.mapframework.bundle.PluginMapModuleBundleInstance")),this.singleton},update:function(e,t,i,s){e.alert("RECEIVED update notification "+s)}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/ui/module/map-module.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/Plugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/controls/ControlsPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/controls/PorttiKeyboard.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/controls/PorttiMouse.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/DisableMapKeyboardMovementRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/DisableMapMouseMovementRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/EnableMapKeyboardMovementRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/EnableMapMouseMovementRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapMovementControlsRequestHandler.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/show-map-measurement-request.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/getinfo/GetFeatureInfoHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/GetFeatureInfoRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/GetFeatureInfoActivationRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/getinfo/GetInfoPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/markers/MarkersPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/RemoveMarkerRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MarkerRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/search/SearchPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/search/service/searchservice.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/search/css/search.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/logo/LogoPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/logo/css/logoplugin.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/indexmap/IndexMapPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/indexmap/css/indexmap.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/scalebar/ScaleBarPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/layers/LayerSelectionPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/layers/css/layersselection.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/layers/LayersPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapLayerVisibilityRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapLayerVisibilityRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapMoveByLayerContentRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapMoveByLayerContentRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/event/MapLayerVisibilityChangedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/wmslayer/WmsLayerPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/wmslayer/SnappyGrid.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/vectorlayer/VectorLayerPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/ToolSelectionRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/controls/ToolSelectionHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapLayerUpdateRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapLayerUpdateRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/MapMoveRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/event/MapClickedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/event/EscPressedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/request/ClearHistoryRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/controls/ClearHistoryHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/zoombar/Portti2Zoombar.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/portti2zoombar/css/porttizoombar.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/plugin/panbuttons/PanButtons.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/plugin/panbuttons/css/panbuttons.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/instance.js"},{type:"text/css",src:"../../../../resources/framework/bundle/mapmodule-plugin/css/mapmodule.css"}],locales:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/fi.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/sv.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapmodule-plugin/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"mapmodule-plugin","Bundle-Name":"mapmodule","Bundle-Tag":{mapframework:!0},"Bundle-Icon":{href:"icon.png"},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"Kartta",Title:"Kartta"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","Ext","OpenLayers"]}}}),Oskari.bundle_manager.installBundleClass("mapmodule-plugin","Oskari.mapframework.bundle.PluginMapModuleBundle"),Oskari.clazz.define("Oskari.mapframework.ui.module.common.MapModule",function(e,t){this._id=e,this._imageUrl=t,this._controls={},this._layerPlugins={},this._projectionCode="EPSG:3067",this._supportedFormats={},this._map=null,this._mapScales=[],this._mapResolutions=[2e3,1e3,500,200,100,50,20,10,4,2,1,.5,.25],this._sandbox=null,this._stealth=!1,this._pluginInstances={},this._navigationHistoryTool=new OpenLayers.Control.NavigationHistory,this._navigationHistoryTool.id="navigationhistory",this._localization=null
},{getImageUrl:function(){return this._imageUrl?this._imageUrl:"/Oskari/resources"},getControls:function(){return this._controls},getMapControl:function(e){return this._controls[e]},addMapControl:function(e,t){this._controls[e]=t,this._map.addControl(t)},removeMapControl:function(e){this._map.removeControl(this._controls[e]),this._controls[e]=null,delete this._controls[e]},setLayerPlugin:function(e,t){this._layerPlugins[e]=t},getLayerPlugin:function(e){return this._layerPlugins[e]},getLayerPlugins:function(){return this._layerPlugins},clearNavigationHistory:function(){this._navigationHistoryTool.clear()},getName:function(){return this._id+"MapModule"},getSandbox:function(){return this._sandbox},getLocalization:function(e,t){return this._localization&&t!==!0||(this._localization=Oskari.getLocalization("MapModule")),e?this._localization[e]:this._localization},init:function(e){e.printDebug("Initializing map module...#############################################"),this._sandbox=e;for(p in this.eventHandlers)e.registerForEventByName(this,p);this.requestHandlers={mapLayerUpdateHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapLayerUpdateRequestHandler",e,this),mapMoveRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMoveRequestHandler",e,this),clearHistoryHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.controls.ClearHistoryHandler",e,this)},e.addRequestHandler("MapModulePlugin.MapLayerUpdateRequest",this.requestHandlers.mapLayerUpdateHandler),e.addRequestHandler("MapMoveRequest",this.requestHandlers.mapMoveRequestHandler),e.addRequestHandler("ClearHistoryRequest",this.requestHandlers.clearHistoryHandler),this._createMap();for(var t=0;this._mapResolutions.length>t;++t){var i=OpenLayers.Util.getScaleFromResolution(this._mapResolutions[t],"m");i=1e4*i,i=Math.round(i),i/=1e4,this._mapScales.push(i)}return this._createBaseLayer(),this.addMapControl("navigationHistoryTool",this._navigationHistoryTool),this.getMapControl("navigationHistoryTool").activate(),this._map},getPluginInstances:function(){return this._pluginInstances},isPluginActivated:function(e){var t=this._pluginInstances[this.getName()+e];return t?!0:!1},registerPlugin:function(e){var t=this._sandbox;e.setMapModule(this);var i=e.getName();t.printDebug("["+this.getName()+"]"+" Registering "+i),e.register(),this._pluginInstances[i]=e},unregisterPlugin:function(e){var t=this._sandbox,i=e.getName();t.printDebug("["+this.getName()+"]"+" Unregistering "+i),e.unregister(),this._pluginInstances[i]=void 0,e.setMapModule(null),delete this._pluginInstances[i]},startPlugin:function(e){var t=this._sandbox,i=e.getName();t.printDebug("["+this.getName()+"]"+" Starting "+i),e.startPlugin(t)},stopPlugin:function(e){var t=this._sandbox,i=e.getName();t.printDebug("["+this.getName()+"]"+" Starting "+i),e.stopPlugin(t)},startPlugins:function(e){for(var t in this._pluginInstances)e.printDebug("["+this.getName()+"]"+" Starting "+t),this._pluginInstances[t].startPlugin(e)},stopPlugins:function(e){for(var t in this._pluginInstances)e.printDebug("["+this.getName()+"]"+" Starting "+t),this._pluginInstances[t].stopPlugin(e)},getStealth:function(){return this._stealth},setStealth:function(e){this._stealth=1==e},notifyAll:function(e,t){this._stealth||this._sandbox.notifyAll(e,t)},getMap:function(){return this._map},_createMap:function(){this._sandbox;var e=new OpenLayers.LonLat(0,0);return this._map=new OpenLayers.Map({controls:[],units:"m",maxExtent:new OpenLayers.Bounds(0,0,1e7,1e7),resolutions:this._mapResolutions,projection:this._projectionCode,isBaseLayer:!0,center:e,theme:null,zoom:0}),this._map},getProjection:function(){return this._projectionCode},_createBaseLayer:function(){var e=new OpenLayers.Layer("BaseLayer",{layerId:0,isBaseLayer:!0,displayInLayerSwitcher:!1});this._map.addLayer(e)},moveMapToLanLot:function(e,t,i){var s=i===!0;this._map.setCenter(e,this._map.getZoom(),s),t&&this.adjustZoomLevel(t,!0),this._updateDomain()},centerMap:function(e,t,i){this._map.setCenter(e,t,!1),this._updateDomain(),i!==!0&&this.notifyMoveEnd()},zoomIn:function(){this.adjustZoomLevel(1)},zoomOut:function(){this.adjustZoomLevel(-1)},zoomTo:function(e){this.setZoomLevel(e,!1)},panMapEast:function(){var e=this._map.getSize();this.panMapByPixels(.75*e.w,0)},panMapWest:function(){var e=this._map.getSize();this.panMapByPixels(-.75*e.w,0)},panMapNorth:function(){var e=this._map.getSize();this.panMapByPixels(0,-.75*e.h)},panMapSouth:function(){var e=this._map.getSize();this.panMapByPixels(0,.75*e.h)},panMapByPixels:function(e,t,i,s,a){this._map.pan(e,t,{dragging:a?!0:!1,animate:!1}),this._updateDomain(),i!==!0&&this.notifyStartMove(),s!==!0&&this.notifyMoveEnd()},moveMapByPixels:function(e,t,i,s){this._map.moveByPx(e,t),this._updateDomain(),i!==!0&&this.notifyStartMove(),s!==!0&&this.notifyMoveEnd()},centerMapByPixels:function(e,t,i,s){var a=new OpenLayers.Pixel(e,t),r=this._map.getLonLatFromViewPortPx(a);this.isValidLonLat(r.lon,r.lat)&&(this.moveMapToLanLot(r),i!==!0&&this.notifyStartMove(),s!==!0&&this.notifyMoveEnd())},isValidLonLat:function(e,t){var i=!0;return 625e4>t||t>82e5?i=!1:((0>e||e>135e4)&&(i=!1),i)},zoomToExtent:function(e,t,i){this._map.zoomToExtent(e),this._updateDomain(),t!==!0&&this.notifyStartMove(),i!==!0&&this.notifyMoveEnd()},adjustZoomLevel:function(e,t){var i=this._getNewZoomLevel(e);this._map.zoomTo(i),this._updateDomain(),t!==!0&&this.notifyMoveEnd()},setZoomLevel:function(e,t){e!=this._map.getZoom()&&((0>e||e>this._map.getNumZoomLevels)&&(e=this._map.getZoom()),this._map.zoomTo(e),this._updateDomain(),t!==!0&&this.notifyMoveEnd())},_getNewZoomLevel:function(e){var t=this._map.getZoom()+e;return t>=0&&this._map.getNumZoomLevels()>=t?t:this._map.getZoom()},notifyStartMove:function(){if(!this.getStealth()){this._sandbox.getMap().setMoving(!0);var e=this._map.getCenter().lon,t=this._map.getCenter().lat,i=this._sandbox.getEventBuilder("MapMoveStartEvent")(e,t);this._sandbox.notifyAll(i)}},notifyMoveEnd:function(){if(!this.getStealth()){var e=this._sandbox;e.getMap().setMoving(!1);var t=this._map.getCenter();this._updateDomain();var i=e.getEventBuilder("AfterMapMoveEvent")(t.lon,t.lat,this._map.getZoom(),!1,this._map.getScale());e.notifyAll(i),e.doSniffing()}},_updateDomain:function(){if(!this.getStealth()){var e=this._sandbox,t=e.getMap(),i=this._map.getCenter();t.moveTo(i.lon,i.lat,this._map.getZoom()),t.setScale(this._map.getScale());var s=this._map.getCurrentSize();t.setWidth(s.w),t.setHeight(s.h),t.setResolution(this._map.getResolution()),t.setExtent(this._map.getExtent()),t.setMaxExtent(this._map.getMaxExtent()),t.setBbox(this._map.calculateBounds()),t.setMarkerVisible(this._hasMarkers())}},calculateLayerScales:function(e,t){for(var i=[],s=0;this._mapScales.length>s;s++)(!t||t>=this._mapScales[s])&&(!e||this._mapScales[s]>=e)&&i.push(this._mapScales[s]);return i},getClosestZoomLevel:function(e,t){var i=this._map.getZoom();if(!t||!e)return i;var s=this._map.getScale();if(t>s){for(var a=i;a>0;a--)if(this._mapScales[a]>=t)return a}else if(s>e)for(var a=i;this._mapScales.length>a;a++)if(e>=this._mapScales[a])return a;return i},start:function(e){this.started||(e.printDebug("Starting "+this.getName()),this.startPlugins(e),this.updateCurrentState(),this.started=!0)},stop:function(e){this.started&&(this.stopPlugins(e),this.started=!1)},_drawMarker:function(){this._removeMarkers();var e=this._map.getCenter(),t=new OpenLayers.Layer.Markers("Markers");this._map.addLayer(t);var i=new OpenLayers.Size(32,32),s=new OpenLayers.Pixel(-16,-i.h),a=new OpenLayers.Icon(this.getImageUrl()+"/framework/bundle/mapmodule-plugin/images/marker.png",i,s),r=new OpenLayers.Marker(e,a);t.addMarker(r)},_removeMarkers:function(){var e=this._map.getLayersByName("Markers");if(e)for(var t=0;e.length>t;t++)e[t]&&this._map.removeLayer(e[t],!1)},_hasMarkers:function(){var e=this._map.getLayersByName("Markers");if(e)for(var t=0;e.length>t;t++)if(e[t]&&e[t].markers&&e[t].markers.length>0)return!0;return!1},eventHandlers:{SearchClearedEvent:function(){this._removeMarkers()}},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},getOLMapLayers:function(e){var t=this,i=t._sandbox,s=i.findMapLayerFromSelectedMapLayers(e);if(!s)return null;var a=this.getLayerPlugins();for(var r in a){var n=a[r],o=n.getOLMapLayers(s);if(o)return o}return null},updateCurrentState:function(){var e=this,t=e._sandbox,i=t.findAllSelectedMapLayers(),s=this.getLayerPlugins();for(p in s){var a=s[p];t.printDebug("preselecting "+p),a.preselectLayers(i)}}},{protocol:["Oskari.mapframework.module.Module"]}),Oskari.clazz.define("Oskari.mapframework.ui.module.common.mapmodule.Plugin",function(){throw"Oskari.mapframework.ui.module.common.mapmodule.Plugin should not be instantiated"},{getName:function(){throw"Implement your own"},setMapModule:function(){throw"Implement your own"},register:function(){throw"Implement your own"},unregister:function(){throw"Implement your own"},startPlugin:function(){throw"Implement your own"},stopPlugin:function(){throw"Implement your own"},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}}),Oskari.clazz.define("Oskari.mapframework.mapmodule.ControlsPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null},{__name:"ControlsPlugin",getName:function(){return this.pluginName},hasUI:function(){return!0},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name,this._createMapControls())},register:function(){},unregister:function(){},init:function(e){var t=this,i=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMovementControlsRequestHandler",t.getMapModule());this.requestHandlers={ToolSelectionRequest:Oskari.clazz.create("Oskari.mapframework.mapmodule.ToolSelectionHandler",e,t),EnableMapKeyboardMovementRequest:i,DisableMapKeyboardMovementRequest:i,EnableMapMouseMovementRequest:i,DisableMapMouseMovementRequest:i}},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(var t in this.requestHandlers)e.addRequestHandler(t,this.requestHandlers[t]);for(var i in this.eventHandlers)e.registerForEventByName(this,i);this._addMapControls()},stopPlugin:function(e){for(var t in this.requestHandlers)e.removeRequestHandler(t,this.requestHandlers[t]);for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._removeMapControls(),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{"Toolbar.ToolSelectedEvent":function(){this._zoomBoxTool.deactivate(),this._measureControls.line.deactivate(),this._measureControls.area.deactivate()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_addMapControls:function(){this.getMapModule().addMapControl("zoomBoxTool",this._zoomBoxTool),this._zoomBoxTool.deactivate(),this.getMapModule().addMapControl("keyboardControls",this._keyboardControls),this.getMapModule().getMapControl("keyboardControls").activate(),this.getMapModule().addMapControl("measureControls_line",this._measureControls.line),this._measureControls.line.deactivate(),this.getMapModule().addMapControl("measureControls_area",this._measureControls.area),this._measureControls.area.deactivate(),this.getMapModule().addMapControl("mouseControls",this._mouseControls)},_removeMapControls:function(){this._zoomBoxTool.deactivate(),this.getMapModule().removeMapControl("zoomBoxTool",this._zoomBoxTool),this._keyboardControls.deactivate(),this.getMapModule().removeMapControl("keyboardControls",this._keyboardControls),this._measureControls.line.deactivate(),this._measureControls.area.deactivate(),this.getMapModule().removeMapControl("measureControls_line",this._measureControls.line),this.getMapModule().removeMapControl("measureControls_area",this._measureControls.area),this._mouseControls.deactivate(),this.getMapModule().removeMapControl("mouseControls",this._mouseControls)},_createMapControls:function(){function e(e,i){var s=t._sandbox,a=e.geometry,r=e.units,n=e.order,o=e.measure,l=null;1===n?l=o.toFixed(3)+" "+r:2===n&&(l=o.toFixed(3)+" "+r+"<sup>2</sup>");var h=null,u=null;if(i&&OpenLayers.Format.GeoJSON){var p=new OpenLayers.Format.GeoJSON;h=p.write(a,!0),u="application/json"}s.request(t,s.getRequestBuilder("ShowMapMeasurementRequest")(l,i,h,u))}var t=this;if(t._sandbox,!this._zoomBoxTool){OpenLayers.Control.ZoomBox.prototype.draw=function(){this.handler=new OpenLayers.Handler.Box(this,{done:function(e){this.zoomBox(e),t.getMapModule().notifyMoveEnd()}},{keyMask:this.keyMask})},this._zoomBoxTool=new OpenLayers.Control.ZoomBox({alwaysZoom:!0}),this._keyboardControls=new OpenLayers.Control.PorttiKeyboard,this._keyboardControls.setup(this.getMapModule());var i={handlerOptions:{persist:!0},immediate:!0},s={handlerOptions:{persist:!0},immediate:!0};this._measureControls={line:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,i),area:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,s)};for(var a in this._measureControls){var r=this._measureControls[a];r.events.on({measure:function(t){e(t,!0)},measurepartial:function(t){e(t,!1)}})}this._mouseControls=new OpenLayers.Control.PorttiMouse,this._mouseControls.setup(this.getMapModule())}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),OpenLayers.Control.PorttiKeyboard=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:50,core:null,setup:function(e){this.mapmodule=e,this.sandbox=e.getSandbox()},initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyDown,keyup:this.defaultKeyUp})},defaultKeyDown:function(e){switch(e.keyCode){case OpenLayers.Event.KEY_LEFT:this.mapmodule.panMapByPixels(-this.slideFactor,0,!1,!0);break;case OpenLayers.Event.KEY_RIGHT:this.mapmodule.panMapByPixels(this.slideFactor,0,!1,!0);break;case OpenLayers.Event.KEY_UP:this.mapmodule.panMapByPixels(0,-this.slideFactor,!1,!0);break;case OpenLayers.Event.KEY_DOWN:this.mapmodule.panMapByPixels(0,this.slideFactor,!1,!0);break;case 17:this.sandbox.postRequestByName("CtrlKeyDownRequest");break;case 27:this.sandbox.postRequestByName("EscPressedEvent");break;case 33:this.mapmodule.notifyStartMove(),this.mapmodule.panMapNorth();break;case 34:this.mapmodule.notifyStartMove(),this.mapmodule.panMapSouth();break;case 35:this.mapmodule.notifyStartMove(),this.mapmodule.panMapEast();break;case 36:this.mapmodule.notifyStartMove(),this.mapmodule.panMapWest();break;case 43:case 61:case 187:case 107:this.mapmodule.zoomIn();break;case 45:case 109:case 189:case 95:this.mapmodule.zoomOut()}},defaultKeyUp:function(e){switch(e.keyCode){case 17:this.sandbox.postRequestByName("CtrlKeyUpRequest");break;case 37:case 38:case 39:case 40:case 33:case 34:case 35:case 36:case 43:case 61:case 187:case 107:case 45:case 109:case 189:case 95:this.mapmodule.notifyMoveEnd()}},CLASS_NAME:"OpenLayers.Control.PorttiKeyboard"}),OpenLayers.Control.PorttiMouse=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:1,documentDrag:!1,kinetic:null,enableKinetic:!1,kineticInterval:10,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,useCenterMapInWheelZoom:!0,useCenterMapInDblClickZoom:!1,initialize:function(){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},setup:function(e){this.mapmodule=e,this.sandbox=this.mapmodule.getSandbox(),this._hoverEventBuilder=this.sandbox.getEventBuilder("MouseHoverEvent"),this._hoverEvent=this._hoverEventBuilder(),this._mapClickedBuilder=this.sandbox.getEventBuilder("MapClickedEvent")},destroy:function(){this.deactivate(),this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.handlers.drag.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.handlers.hover.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.handlers.drag.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),this.handlers.hover.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){if(this.enableKinetic){var e={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(e=OpenLayers.Util.extend(e,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(e)}this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag}),this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var t={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},i={"double":!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,t,i);var s={move:this.defaultHoverMove,pause:this.defaultHoverPause},a=this,r={pixelTolerance:1.1,passesTolerance:function(e){var t=!0;if(a.panned)return!1;if(this.pixelTolerance&&this.px){var i=Math.sqrt(Math.pow(this.px.x-e.x,2)+Math.pow(this.px.y-e.y,2));this.pixelTolerance>i&&(t=!1)}return t}};if(this.handlers.hover=new OpenLayers.Handler.Hover(this,s,r),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw(),this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions),OpenLayers.Control.PinchZoom){var n=this.pinchZoomOptions||{};n.pinchDone=function(e,t,i){this.applyTransform("");var s=this.map.getZoomForResolution(this.map.getResolution()/i.scale,!0);if(s!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var r=this.map.getResolutionForZoom(s),n=this.map.getLonLatFromPixel(this.pinchOrigin),o=this.currentCenter,l=this.map.getSize();n.lon+=r*(l.w/2-o.x),n.lat-=r*(l.h/2-o.y),a.sendMapSetCenter(n,s)}},this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},n))}},defaultClick:function(e){if(e.lastTouches&&2==e.lastTouches.length)this.sendMapZoomOut();else{var t=-1!=navigator.userAgent.indexOf("MSIE 8.0");if(t){var i=(new Date).getTime();this.lastDblClickMs?1e3>i-this.lastDblClickMs||this.sendMapClickEvent(e):this.sendMapClickEvent(e)}else this.sendMapClickEvent(e)}},defaultDblClick:function(e){var t=1,i=this.map.getZoom(),s=this.map.getZoom()+Math.round(t);if(s=Math.max(s,0),s=Math.min(s,this.map.getNumZoomLevels()),s!==i){var a=this.map.getSize(),r=a.w/2-e.xy.x,n=e.xy.y-a.h/2,o=this.map.baseLayer.getResolutionForZoom(s),l=this.map.getLonLatFromPixel(e.xy),h=null;h=this.useCenterMapInDblClickZoom?this.map.getCenter():new OpenLayers.LonLat(l.lon+r*o,l.lat+n*o);var u=-1!=navigator.userAgent.indexOf("MSIE 8.0");u&&(this.lastDblClickMs=(new Date).getTime()),this.sendMapSetCenter(h,s)}},defaultDblRightClick:function(){this.sendMapZoomOut()},wheelChange:function(e,t){var i=this.map.getZoom(),s=this.map.getZoom()+Math.round(t);if(s=Math.max(s,0),s=Math.min(s,this.map.getNumZoomLevels()),s!==i){var a=this.map.getSize(),r=a.w/2-e.xy.x,n=e.xy.y-a.h/2,o=this.map.baseLayer.getResolutionForZoom(s),l=this.map.getLonLatFromPixel(e.xy),h=null;h=this.useCenterMapInWheelZoom?this.map.getCenter():new OpenLayers.LonLat(l.lon+r*o,l.lat+n*o),this.sendMapSetCenter(h,s)}},wheelUp:function(e,t){this.wheelChange(e,t||1)},wheelDown:function(e,t){this.wheelChange(e,t||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},panMapStart:function(){this.kinetic&&this.kinetic.begin(),this.panned=!1},panMap:function(e){this.kinetic&&this.kinetic.update(e),this.panned||this.mapmodule.notifyStartMove(),this.panned=!0,this.map.pan(this.handlers.drag.last.x-e.x,this.handlers.drag.last.y-e.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var t=null;if(this.kinetic&&(t=this.kinetic.end(e)),this.mapmodule.panMapByPixels(this.handlers.drag.x-e.x,this.handlers.drag.y-e.y,!0,!1,!1),t){var i=this;this.kinetic.move(t,function(e,t){i.mapmodule.panMapByPixels(e,t,!0,!1,!1)})}this.panned=!1}},defaultHoverMove:function(e){if(!this.panned){var t=this.map.getLonLatFromViewPortPx(e.xy);this._hoverEvent.set(t.lon,t.lat,!1,e.pageX,e.pageY),this.sandbox.notifyAll(this._hoverEvent,!0)}},defaultHoverPause:function(e){if(!this.panned){var t=this.map.getLonLatFromViewPortPx(e.xy),i=this._hoverEventBuilder();i.set(t.lon,t.lat,!1,e.pageX,e.pageY),this.sandbox.notifyAll(i)}},sendMapClickEvent:function(e){var t=this.map.getLonLatFromViewPortPx(e.xy),e=this._mapClickedBuilder(t,e.xy.x,e.xy.y);this.sandbox.notifyAll(e)},sendMapSetCenter:function(e,t){this.mapmodule.centerMap(e,t)},sendMapZoomOut:function(){this.mapmodule.zoomOut()},sendMapZoomIn:function(){this.mapmodule.zoomIn()},CLASS_NAME:"OpenLayers.Control.PorttiMouse"}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.DisableMapKeyboardMovementRequest",function(){this._creator=null},{__name:"DisableMapKeyboardMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.DisableMapMouseMovementRequest",function(){this._creator=null},{__name:"DisableMapMouseMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.EnableMapKeyboardMovementRequest",function(){this._creator=null},{__name:"EnableMapKeyboardMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.EnableMapMouseMovementRequest",function(){this._creator=null},{__name:"EnableMapMouseMovementRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMovementControlsRequestHandler",function(e){this.mapModule=e},{handleRequest:function(e,t){if("EnableMapKeyboardMovementRequest"==t.getName()){var i=this.mapModule.getMapControl("keyboardControls");i&&i.activate()}else if("DisableMapKeyboardMovementRequest"==t.getName()){var i=this.mapModule.getMapControl("keyboardControls");i&&i.deactivate()}else if("EnableMapMouseMovementRequest"==t.getName()){var i=this.mapModule.getMapControl("mouseControls");i&&(i.activate(),i.registerMouseEvents())}else if("DisableMapMouseMovementRequest"==t.getName()){var i=this.mapModule.getMapControl("mouseControls");i&&(i.deactivate(),i.unregisterMouseEvents())}}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.request.common.ShowMapMeasurementRequest",function(e,t,i,s){this._creator=null,this._value=e,this._geometry=i,this._finished=t,this._geometryMimeType=s},{__name:"ShowMapMeasurementRequest",getName:function(){return this.__name},getValue:function(){return this._value},getGeometry:function(){return this._geometry},getGeometryMimeType:function(){return this._geometryMimeType},isFinished:function(){return this._finished}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.getinfo.GetFeatureInfoHandler",function(e){this.getInfoPlugin=e},{handleRequest:function(e,t){"MapModulePlugin.GetFeatureInfoRequest"==t.getName()?this.getInfoPlugin.handleGetInfo({lon:t.getLon(),lat:t.getLat()},t.getX(),t.getY()):"MapModulePlugin.GetFeatureInfoActivationRequest"==t.getName()&&this.getInfoPlugin.setEnabled(t.isEnabled())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.GetFeatureInfoRequest",function(e,t,i,s){this._lon=e,this._lat=t,this._x=i,this._y=s},{__name:"MapModulePlugin.GetFeatureInfoRequest",getName:function(){return this.__name},getLon:function(){return this._lon},getLat:function(){return this._lat},getX:function(){return this._x},getY:function(){return this._y}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.GetFeatureInfoActivationRequest",function(e){this._enable=e===!0},{__name:"MapModulePlugin.GetFeatureInfoActivationRequest",getName:function(){return this.__name},isEnabled:function(){return this._enable}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.mapmodule.GetInfoPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.enabled=!0,this.infoboxId="getinforesult",this._pendingAjaxQuery={busy:!1,jqhr:null,timestamp:null}},{__name:"GetInfoPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(e){var t=this;this._sandbox=e,this._sandbox.printDebug("[GetInfoPlugin] init"),this.getGFIHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.getinfo.GetFeatureInfoHandler",t),this.templateTable=jQuery("<table></table>"),this.templateTableRow=jQuery('<tr style="padding: 5px;"></tr>'),this.templateTableCell=jQuery('<td style="padding: 2px"></td>'),this.templateHeader=jQuery('<div style="border:1pt solid navy;background-color: #424343;margin-top: 14px; margin-bottom: 10px;height:15px;"><div class="icon-bubble-left" style="height:15px;display:inline;float:left;"></div>'),this.templateHeaderTitle=jQuery('<div style="color:white;float:left;display:inline;margin-left:8px;"></div>')},register:function(){},unregister:function(){},startPlugin:function(e){e&&e.register&&(this._sandbox=e),this._map=this.getMapModule().getMap(),this._sandbox.register(this);for(p in this.eventHandlers)this._sandbox.registerForEventByName(this,p);this._sandbox.addRequestHandler("MapModulePlugin.GetFeatureInfoRequest",this.getGFIHandler),this._sandbox.addRequestHandler("MapModulePlugin.GetFeatureInfoActivationRequest",this.getGFIHandler)},stopPlugin:function(e){var t=this;t._closeGfiInfo(),e&&e.register&&(this._sandbox=e);for(p in this.eventHandlers)this._sandbox.unregisterFromEventByName(this,p);this._sandbox.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},setEnabled:function(e){this.enabled=e===!0,this.enabled||this._closeGfiInfo()},eventHandlers:{EscPressedEvent:function(){this._closeGfiInfo()},MapClickedEvent:function(e){if(this.enabled){var t=e.getLonLat(),i=e.getMouseX(),s=e.getMouseY();this.handleGetInfo(t,i,s)}},AfterMapMoveEvent:function(){this._cancelAjaxRequest()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_cancelAjaxRequest:function(){var e=this;if(e._pendingAjaxQuery.busy){var t=e._pendingAjaxQuery.jqhr;e._pendingAjaxQuery.jqhr=null,t&&(this._sandbox.printDebug("[GetInfoPlugin] Abort jqhr ajax request"),t.abort(),t=null,e._pendingAjaxQuery.busy=!1)}},_buildLayerIdList:function(){for(var e=this,t=e._sandbox.findAllSelectedMapLayers(),i=null,s=e._sandbox.getMap().getScale(),a=0;t.length>a;a++){var r=t[a];r.getQueryable&&r.getQueryable()&&r.isInScale(s)&&r.isVisible()&&(i||(i=""),""!==i&&(i+=","),i+=r.getId())}return i},_startAjaxRequest:function(e){var t=this;t._pendingAjaxQuery.busy=!0,t._pendingAjaxQuery.timestamp=e},_finishAjaxRequest:function(){var e=this;e._pendingAjaxQuery.busy=!1,e._pendingAjaxQuery.jqhr=null,this._sandbox.printDebug("[GetInfoPlugin] finished jqhr ajax request")},_notifyAjaxFailure:function(){var e=this;e._sandbox.printDebug("[GetInfoPlugin] GetFeatureInfo AJAX failed")},_isAjaxRequestBusy:function(){var e=this;return e._pendingAjaxQuery.busy},handleGetInfo:function(e,t,i){var s=this,a=new Date,r=a.getTime();if(s._pendingAjaxQuery.busy&&s._pendingAjaxQuery.timestamp&&500>r-s._pendingAjaxQuery.timestamp)return s._sandbox.printDebug("[GetInfoPlugin] GetFeatureInfo NOT SENT (time difference < 500ms)"),void 0;s._cancelAjaxRequest();var n=s._buildLayerIdList();if(!n)return s._sandbox.printDebug("[GetInfoPlugin] NO layers with featureInfoEnabled, in scale and visible"),void 0;s._startAjaxRequest(r);var o=this._sandbox.getAjaxUrl(),l=e.lon,h=e.lat,u=s._sandbox.getMap();jQuery.ajax({beforeSend:function(e){s._pendingAjaxQuery.jqhr=e,e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(t){if(t.data&&t.data instanceof Array){t.lonlat=e;var i=s._parseGfiResponse(t);if(!i)return;if(i.popupid=s.infoboxId,i.lonlat=e,!s._isAjaxRequestBusy())return;s._showFeatures(i)}s._finishAjaxRequest()},error:function(){s._finishAjaxRequest(),s._notifyAjaxFailure()},always:function(){s._finishAjaxRequest()},complete:function(){s._finishAjaxRequest()},data:{layerIds:n,projection:s.mapModule.getProjection(),x:t,y:i,lon:l,lat:h,width:u.getWidth(),height:u.getHeight(),bbox:u.getBbox().toBBOX(),zoom:u.getZoom()},type:"POST",dataType:"json",url:o+"action_route=GetFeatureInfoWMS"})},_closeGfiInfo:function(){var e="InfoBox.HideInfoBoxRequest",t=this._sandbox.getRequestBuilder(e),i=t(this.infoboxId);this._sandbox.request(this,i)},_showGfiInfo:function(e,t){var i=this,s="InfoBox.ShowInfoBoxRequest",a=this._sandbox.getRequestBuilder(s),r=a("getinforesult","GetInfo Result",e,t,!0);this._sandbox.request(i,r)},_formatResponseForInfobox:function(e){var t=[];if(!e||!e.data)return t;var i=this,s=[];e.data.length?s=e.data:s.push(e.data);for(var a=0;s.length>a;a++){var r=s[a],n=i._formatGfiDatum(r);null!=n&&t.push({html:n})}return t},_parseGfiResponse:function(e){var t=this._sandbox,i=e.data,s=[],a=e.lonlat,r=a.lon+", "+a.lat,n=e.layerCount;if(0!=n&&0!=i.length&&i instanceof Array){for(var o=0;i.length>o;o++){var l=i[o],h=l.layerId,u=t.findMapLayerFromSelectedMapLayers(h),p=u?u.getName():"",c=l.type;if("WFS_LAYER"==c){var d=l.features;if(!d||!d.length)continue;for(var m=0;d.length>m;m++){var y=d[m],f=y.children;if(f&&f.length)for(var g=0;f.length>g;g++){var v=f[g],L=v.pnr_PaikanNimi;L&&L["pnr:kirjoitusasu"]&&(r=L["pnr:kirjoitusasu"]);var b=this._json2html(v);s.push({markup:b,layerId:h,layerName:p})}}}else{var b=this._formatGfiDatum(l);null!=b&&s.push({markup:b,layerId:h,layerName:p})}}return{fragments:s,title:r}}},_formatJSONValue:function(e){if(e){var t=jQuery("<span></span>");if("[object Array]"===Object.prototype.toString.call(e))for(var i=0;e.length>i;++i){var s=e[i];for(objAttr in s){var a=this._formatJSONValue(s[objAttr]);a&&(t.append(objAttr),t.append(": "),t.append(a),t.append("<br/>"))}}else if(e.indexOf&&0==e.indexOf("http://")){var r=jQuery('<a target="_blank"></a>');r.attr("href",e),r.append(e),t.append(r)}else t.append(e);return t}},_formatGfiDatum:function(e){if(!e.presentationType)return null;var t=typeof e.content,i=!1;if("string"==t&&(i=e.content.indexOf("<html>")>=0,i=i||e.content.indexOf("<HTML>")>=0),"JSON"==e.presentationType||e.content&&e.content.parsed){var s=this.templateTable.clone(),a=!1,r=e.content.parsed;for(attr in r){var n=this._formatJSONValue(r[attr]);if(n){var o=this.templateTableRow.clone();s.append(o),a||o.css("background-color","#EEEEEE"),a=!a;
var l=this.templateTableCell.clone();l.append(attr),o.append(l);var h=this.templateTableCell.clone();h.append(n),o.append(h)}}return s}var n=jQuery("<div></div>");return n.append(e.content),n},_json2html:function(e){if(null==e)return"";var t=!0,i="<table>";for(var s in e){var a=e[s],r=(typeof a).toLowerCase();switch(r){case"string":valpres=a.startsWith("http://")?'<a href="'+a+'" target="_blank">'+a+"</a>":a;break;case"undefined":valpres="n/a";break;case"boolean":valpres=a?"true":"false";break;case"number":valpres=""+number;break;case"function":valpres="?";break;case"object":valpres=this._json2html(a);break;default:valpres=""}t=!t,i+='<tr style="padding: 5px;',i+=t?'">':' background-color: #EEEEEE;">',i+='<td style="padding: 2px;">'+s+"</td>",i+='<td style="padding: 2px;">'+valpres+"</td>",i+="</tr>"}return i+="</table>"},_showFeatures:function(e){var t=this,i={},s=jQuery("<div></div>");i.html="",i.actions={};for(var a=0;e.fragments.length>a;a++){var r=e.fragments[a],n=r.layerName,o=r.markup,l=jQuery("<div></div>"),h=this.templateHeader.clone(),u=this.templateHeaderTitle.clone();u.append(n),h.append(u),l.append(h),o&&l.append(o),s.append(l)}i.html=s;var p=this.getMapModule().getLocalization("plugin",!0),c=p[this.__name];e.title=c.title;var d="InfoBox.ShowInfoBoxRequest",m=t._sandbox.getRequestBuilder(d),y=m(e.popupid,e.title,[i],e.lonlat,!0);t._sandbox.request(t,y)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.mapmodule.MarkersPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null},{__name:"MarkersPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(){this.requestHandler=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MarkerRequestHandler",this)},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),this._createMapMarkersLayer(),e.register(this),this._sandbox.addRequestHandler("MapModulePlugin.RemoveMarkerRequest",this.requestHandler);for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){this._sandbox.removeRequestHandler("MapModulePlugin.RemoveMarkerRequest",this.requestHandler);for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},removeMapMarkers:function(){var e=this.getMapModule();e&&e._removeMarkers()},_createMapMarkersLayer:function(){this._sandbox;var e=new OpenLayers.Layer.Markers("Markers");this._map.addLayer(e)}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.RemoveMarkerRequest",function(e){this._list=e},{__name:"MapModulePlugin.RemoveMarkerRequest",getName:function(){return this.__name},getMarkerIds:function(){return this._list}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MarkerRequestHandler",function(e){this.markersPlugin=e},{handleRequest:function(e,t){"MapModulePlugin.RemoveMarkerRequest"==t.getName()&&this.markersPlugin.removeMapMarkers(t.getMarkerIds())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._conf=e,this.container=null,this.loc=null},{__name:"SearchPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(e){var t=this.getMapModule().getLocalization("plugin",!0);this.loc=t[this.__name],this.template=jQuery('<div class="search-div"><div class="search-textarea-and-button"><input placeholder="'+this.loc.placeholder+'" type="text" />'+'<input type="button" value="'+this.loc.search+'" name="search" />'+"</div>"+'<div class="results">'+'<div class="header"><div class="close icon-close" title="'+this.loc.close+'"></div></div>'+'<div class="content">&nbsp;</div>'+"</div>"+"</div>"),this.templateResultsTable=jQuery("<table class='search-results'><thead><tr><th>"+this.loc.column_name+"</th>"+"<th>"+this.loc.column_village+"</th>"+"<th>"+this.loc.column_type+"</th>"+"</tr></thead><tbody></tbody></table>"),this.templateResultsRow=jQuery("<tr><td nowrap='nowrap'><a href='JavaScript:void(0);'></a></td><td nowrap='nowrap'></td><td nowrap='nowrap'></td></tr>");var i=null;i=this.conf&&this.conf.url?this.conf.url:e.getAjaxUrl()+"action_route=GetSearchResult",this.service=Oskari.clazz.create("Oskari.mapframework.bundle.search.service.SearchService",i)},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);this._createUI()},stopPlugin:function(e){this.container.remove();for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_createUI:function(){var e=this._sandbox,t=this,i=this.template.clone();this.container=i;var s=jQuery("div.mapplugins.left");s&&0!=s.length||(s=jQuery(this._map.div),i.addClass("mapplugin"));var t=this,a=i.find("input[type=text]");a.focus(function(){e.request(t.getName(),e.getRequestBuilder("DisableMapKeyboardMovementRequest")())}),a.blur(function(){e.request(t.getName(),e.getRequestBuilder("EnableMapKeyboardMovementRequest")())}),a.keypress(function(e){t._checkForEnter(e)}),i.find("input[type=button]").click(function(){t._doSearch()}),i.find("div.close").click(function(){t._hideSearch()}),i.find("div.results").hide(),s.append(i),this._conf&&this._conf.location&&(this._conf.location.top&&i.css("top",this._conf.location.top),this._conf.location.left&&i.css("left",this._conf.location.left),this._conf.location.right&&i.css("right",this._conf.location.right),this._conf.location.bottom&&i.css("bottom",this._conf.location.bottom))},_checkForEnter:function(e){var t;window.event?t=window.event.keyCode:e&&(t=e.which),13==e.keyCode&&this._doSearch()},_doSearch:function(){if(1!=this._searchInProgess){var e=this;this._hideSearch(),this._searchInProgess=!0;var t=this.container.find("input[type=text]");t.addClass("search-loading");var i=t.val(),s=function(t){e._showResults(t),e._enableSearch()},a=function(){e._enableSearch()};this.service.doSearch(i,s,a)}},_showResults:function(e){var t=e.error,i=this,s=this.container.find("div.results");s.find("div.header");var a=s.find("div.content");if(null!=t)return a.html(t),s.show(),void 0;var r=e.totalCount;if(0==r)a.html(this.loc.noresults),s.show();else if(1==r){var n=e.locations[0].lon,o=e.locations[0].lat,l=e.locations[0].zoomLevel;this._sandbox.request(this.getName(),this._sandbox.getRequestBuilder("MapMoveRequest")(n,o,l,!1))}else{for(var h=this.templateResultsTable.clone(),u=h.find("tbody"),p=0;r>p;p++){if(p>=100){u.append("<tr><td class='search-result-too-many' colspan='3'>"+this.loc.toomanyresults+"</td></tr>");break}var n=e.locations[p].lon,o=e.locations[p].lat,l=e.locations[p].zoomLevel,c=n+"---"+o+"---"+l,d=this.templateResultsRow.clone();d.attr("data-location",c);var m=e.locations[p].name,y=e.locations[p].village,f=e.locations[p].type,g=d.find("td"),v=jQuery(g[0]).find("a");v.attr("data-location",c),v.append(m),v.click(function(){return i._resultClicked(jQuery(this).attr("data-location")),!1}),jQuery(g[1]).append(y),jQuery(g[2]).append(f),u.append(d)}u.find(":odd").addClass("odd"),a.html(h),s.show()}},_resultClicked:function(e){var t=e.split("---"),i=t[0],s=t[1],a=t[2];this._sandbox.request(this.getName(),this._sandbox.getRequestBuilder("MapMoveRequest")(i,s,a,!1))},_enableSearch:function(){this._searchInProgess=!1,jQuery("#search-string").removeClass("search-loading")},_hideSearch:function(){this.container.find("div.results").hide(),this._sandbox.request(this.getName(),this._sandbox.getRequestBuilder("HideMapMarkerRequest")())}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.search.service.SearchService",function(e){this._searchUrl=e},{__qname:"Oskari.mapframework.bundle.search.service.SearchService",getQName:function(){return this.__qname},__name:"SearchService",getName:function(){return this.__name},doSearch:function(e,t,i){var s=Oskari.getLang();jQuery.ajax({dataType:"json",type:"POST",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/json")},url:this._searchUrl,data:"searchKey="+e+"&Language="+s,error:i,success:t})}},{protocol:["Oskari.mapframework.service.Service"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.template=null,this.element=null},{__name:"LogoPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(){this.template=jQuery("<div class='logoplugin'><div class='icon'></div><div class='terms'><a href='JavaScript:void(0);'></a></div></div>")},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);this._createUI()},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null,this.element.find("a").unbind("click"),this.element.remove(),this.element=void 0},start:function(){},stop:function(){},eventHandlers:{},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},_createUI:function(){var e=this._sandbox,t=jQuery(this._map.div);this.element||(this.element=this.template.clone()),t.append(this.element);var i=this.getMapModule().getLocalization("plugin",!0),s=i[this.__name],a=this.element.find("div.icon");a.bind("click",function(){e.generateMapLinkParameters();var t=s.mapLinkBase+e.generateMapLinkParameters();return window.open(t,"_blank"),!1});var a=this.element.find("a");a.append(s.terms),a.bind("click",function(){var e=s.termsLink;return window.open(e,"_blank"),!1})}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._conf=e,this._indexMap=null,this._indexMapUrl="/framework/bundle/mapmodule-plugin/plugin/indexmap/images/suomi25m_tm35fin.png"},{__name:"IndexMapPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(){},_createUI:function(){var e=new OpenLayers.Layer.Image("Overview map image",this.getMapModule().getImageUrl()+this._indexMapUrl,new OpenLayers.Bounds(26783,6608595,852783,7787250),new OpenLayers.Size(120,173)),t={mapOptions:{maxExtent:new OpenLayers.Bounds(26783,6608595,852783,7787250),units:"m",projection:this._map.getProjection(),numZoomLevels:1},layers:[e],size:new OpenLayers.Size(120,173),autoPan:!1,controls:[]};this._indexMap=new OpenLayers.Control.OverviewMap(t)},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),this._createUI(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);this.getMapModule().addMapControl("overviewMap",this._indexMap)},stopPlugin:function(e){this.getMapModule().removeMapControl("overviewMap");for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapMoveEvent:function(){this._indexMap&&this._indexMap.update()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._scalebar=null},{__name:"ScaleBarPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(){this._scalebar=new OpenLayers.Control.ScaleLine},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);this.getMapModule().addMapControl("scaleBar",this._scalebar)},stopPlugin:function(e){this.getMapModule().removeMapControl("scaleBar");for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapMoveEvent:function(){this._scalebar&&this._scalebar.update()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.element=void 0,this.conf=e,this.initialSetup=!0},{__name:"LayerSelectionPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},getMap:function(){return this._map},register:function(){},unregister:function(){},init:function(){this.template=jQuery('<div class=\'layerSelectionPlugin\'><div class="header"><div class="header-icon icon-arrow-white-right"></div></div><div class="content"><div class="layers"></div><div class="baselayers"></div></div></div>'),this.templateLayer=jQuery("<div class='layer'><span></span></div>"),this.templateCheckbox=jQuery("<input type='checkbox' />"),this.templateRadiobutton=jQuery("<input type='radio' name='defaultBaselayer'/>"),this.templateBaseLayerHeader=jQuery('<div class="baseLayerHeader"></div>')},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);this._createUI()},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this.element&&(this.element.remove(),this.element=void 0,delete this.element)},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.removeLayer(e.getMapLayer())},AfterMapLayerAddEvent:function(e){this.addLayer(e.getMapLayer())},MapLayerVisibilityChangedEvent:function(e){this.updateLayer(e.getMapLayer())},AfterMapMoveEvent:function(){if(this.initialSetup&&(this.initialSetup=!1,this.conf&&this.conf.baseLayers)){for(var e=0;this.conf.baseLayers.length>e;++e){var t=this._sandbox.findMapLayerFromSelectedMapLayers(this.conf.baseLayers[e]);this.addBaseLayer(t)}this.conf.defaultBaseLayer&&this.selectBaseLayer(this.conf.defaultBaseLayer)}}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(){},selectBaseLayer:function(e){var t=this.element.find("div.content div.baselayers");if(t&&0!=t.length){var i=t.find("input[value="+e+"]");i.attr("checked","checked"),this._changedBaseLayer()}},addLayer:function(e){var t=this.element.find("div.content"),i=t.find("div.layers"),s=this.templateLayer.clone();s.find("span").append(e.getName());var a=this.templateCheckbox.clone();a.attr("value",e.getId()),e.isVisible()?a.attr("checked",!0):a.attr("checked",!1),this._bindCheckbox(a,e),s.find("span").before(a),this.layerRefs[e.getId()]=s,i.append(s)},updateLayer:function(e){var t=this.layerRefs[e.getId()],i=t.find("input"),s=e.isVisible();s?i.is(":checked")||i.attr("checked","checked"):i.is(":checked")&&i.removeAttr("checked")},_bindCheckbox:function(e,t){var i=this;e.change(function(){var e=jQuery(this),s=e.is(":checked");s?i._setLayerVisible(t,!0):i._setLayerVisible(t,!1)})},_setLayerVisible:function(e,t){var i=this._sandbox,s=i.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest"),a=s(e.getId(),t);i.request(this,a)},removeLayer:function(e){var t=this.layerRefs[e.getId()];t.remove(),delete this.layerRefs[e.getId()]},addBaseLayer:function(e){if(e&&e.getId){var t=this.layerRefs[e.getId()];t.remove();var i=t.find("input");i.remove(),i=this.templateRadiobutton.clone(),i.attr("value",e.getId());var s=this;i.bind("change",function(){s._changedBaseLayer()}),t.find("span").before(i);var a=this.element.find("div.content div.baselayers");if(0==a.find("div.layer").length){var r=this.getMapModule().getLocalization("plugin"),n=r[this.__name],o=this.templateBaseLayerHeader.clone();o.append(n.chooseDefaultBaseLayer),a.before(o),i.attr("checked","checked")}a.append(t),s._changedBaseLayer()}},removeBaseLayer:function(e){var t=this.layerRefs[e.getId()];t.remove();var i=t.find("input");i.remove(),i=this.templateCheckbox.clone(),i.attr("value",e.getId()),this._bindCheckbox(i,e),t.find("span").before(i);var s=this.element.find("div.content div.layers");s.append(t),this._setLayerVisible(e,!0);var a=this.element.find("div.content div.baselayers"),r=a.find("div.layer");if(0==r.length){var n=this.element.find("div.content div.baseLayerHeader");n.remove()}else{var o=r.find("input:checked");0==o.length&&(jQuery(r.find("input").get(0)).attr("checked","checked"),this._changedBaseLayer())}},_changedBaseLayer:function(){for(var e=this.getBaseLayers(),t=0;e.baseLayers.length>t;++t){var i=e.baseLayers[t],s=this._sandbox.findMapLayerFromSelectedMapLayers(i);this._setLayerVisible(s,e.defaultBaseLayer==i)}},setupLayers:function(){var e=this;delete this.layerRefs,this.layerRefs={};for(var t=this._sandbox.findAllSelectedMapLayers(),i=0;t.length>i;++i)e.addLayer(t[i])},openSelection:function(){var e=this.element.find("div.header div.header-icon");e.removeClass("icon-arrow-white-right"),e.addClass("icon-arrow-white-down"),this.element.find("div.content").show()},closeSelection:function(){var e=this.element.find("div.header div.header-icon");e.removeClass("icon-arrow-white-down"),e.addClass("icon-arrow-white-right"),this.element.find("div.content").hide()},getBaseLayers:function(){for(var e=this.element.find("div.content div.baselayers div.layer input"),t=[],i=null,s=0;e.length>s;++s){var a=jQuery(e[s]);t.push(a.val()),a.is(":checked")&&(i=a.val())}return{baseLayers:t,defaultBaseLayer:i}},_createUI:function(){var e=this;this.element||(this.element=this.template.clone());var t=this.getMapModule().getLocalization("plugin",!0),i=t[this.__name],s=this.element.find("div.header");s.append(i.title),s.bind("click",function(){var t=e.element.find("div.content");t.is(":hidden")?e.openSelection():e.closeSelection()}),this.closeSelection(),this.setupLayers();var a=jQuery("div.mapplugins.left");if(a&&0!=a.length){var r=a.find("div");r&&0!=r.length?r.first().before(this.element):a.append(this.element)}else{a=jQuery(this._map.div);var n=this.element.find("div.content");n.addClass("mapplugin"),a.append(this.element)}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.LayersPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this._visibilityPollingInterval=1500,this._visibilityCheckOrder=0,this._previousTimer=null},{__name:"LayersPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},hasUI:function(){return!1},getMap:function(){return this._map},register:function(){},unregister:function(){},init:function(e){this.requestHandlers={layerVisibilityHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequestHandler",e,this),layerContentHandler:Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequestHandler",e,this)}},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);e.addRequestHandler("MapModulePlugin.MapLayerVisibilityRequest",this.requestHandlers.layerVisibilityHandler),e.addRequestHandler("MapModulePlugin.MapMoveByLayerContentRequest",this.requestHandlers.layerContentHandler)},stopPlugin:function(e){e.removeRequestHandler("MapModulePlugin.MapLayerVisibilityRequest",this.requestHandlers.layerVisibilityHandler),e.removeRequestHandler("MapModulePlugin.MapMoveByLayerContentRequest",this.requestHandlers.layerContentHandler);for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterRearrangeSelectedMapLayerEvent:function(e){this._afterRearrangeSelectedMapLayerEvent(e)},MapMoveStartEvent:function(){this._visibilityCheckOrder++,this._previousTimer&&(clearTimeout(this._previousTimer),this._previousTimer=null)},AfterMapMoveEvent:function(){this._scheduleVisiblityCheck()},AfterMapLayerAddEvent:function(e){this._parseGeometryForLayer(e.getMapLayer()),this._scheduleVisiblityCheck()}},_scheduleVisiblityCheck:function(){var e=this;this._previousTimer&&(clearTimeout(this._previousTimer),this._previousTimer=null),this._visibilityCheckOrder++,this._previousTimer=setTimeout(function(){e._checkLayersVisibility(e._visibilityCheckOrder)},this._visibilityPollingInterval)},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(){},_parseGeometryForLayer:function(e){if(e.getGeometry&&0==e.getGeometry().length){var t=e.getGeometryWKT();if(!t)return;var i=new OpenLayers.Format.WKT,s=i.read(t);if(s){s.constructor!=Array&&(s=[s]);for(var a=[],r=0;s.length>r;++r)a.push(s[r].geometry);e.setGeometry(a)}}},_checkLayersVisibility:function(e){if(e==this._visibilityCheckOrder){for(var t=this._sandbox.findAllSelectedMapLayers(),i=0;t.length>i;++i){var s=t[i];s.isVisible()&&this.notifyLayerVisibilityChanged(s)}this._visibilityCheckScheduled=!1}},_isInScale:function(e){var t=this._sandbox.getMap().getScale();return e.isInScale(t)},isInGeometry:function(e){var t=e.getGeometry();if(!t)return!0;if(0==t.length)return!0;for(var i=this.getMap().getExtent(),s=0;t.length>s;++s){var a=t[s].getBounds();if(a&&a.intersectsBounds(i))return!0}return!1},notifyLayerVisibilityChanged:function(e){var t=e.isVisible(),i=e.isVisible();e.isVisible()&&(t=this._isInScale(e),i=this.isInGeometry(e));var s=this.getMap();if(t&&i&&e.isVisible()){var a=s.getLayersByName("layer_"+e.getId()),r=a.length?a[0]:null;r&&!r.getVisibility()&&(r.setVisibility(!0),r.display(!0))}else{var a=s.getLayersByName("layer_"+e.getId()),r=a.length?a[0]:null;r&&r.getVisibility()&&(r.setVisibility(!1),r.display(!1))}var n=this._sandbox.getEventBuilder("MapLayerVisibilityChangedEvent")(e,t,i);this._sandbox.notifyAll(n)},_afterRearrangeSelectedMapLayerEvent:function(){var e=this._sandbox.findAllSelectedMapLayers(),t=0,i=this._map.layers.length,s=this._map.getLayersByName("Markers");s.length>0&&(this._map.setLayerIndex(s[0],i),i--);for(var a=0;e.length>a;a++)if(e[a].isBaseLayer()||e[a].isGroupLayer())for(var r=0;e[a].getSubLayers().length>r;r++){var s=this._map.getLayersByName("basemap_"+e[a].getSubLayers()[r].getId());this._map.setLayerIndex(s[0],t),t++}else if(e[a].isLayerOfType("WFS")){for(var n=RegExp("wfs_layer_"+e[a].getId()+"_WFS_LAYER_IMAGE*","i"),o=this._map.getLayersByName(n),l=0;o.length>l;l++)this._map.setLayerIndex(o[l],t),t++;var n=RegExp("wfs_layer_"+e[a].getId()+"_HIGHLIGHTED_FEATURE*","i"),s=this._map.getLayersByName(n);s.length>0&&(this._map.setLayerIndex(s[0],t),t++)}else{var s=this._map.getLayersByName("layer_"+e[a].getId());this._map.setLayerIndex(s[0],t),t++}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequest",function(e,t){this._creator=null,this._mapLayerId=e,this._visible=t},{__name:"MapModulePlugin.MapLayerVisibilityRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getVisible:function(){return this._visible}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerVisibilityRequestHandler",function(e,t){this.sandbox=e,this.layersPlugin=t},{handleRequest:function(e,t){var i=t.getMapLayerId(),s=this.sandbox.findMapLayerFromSelectedMapLayers(i);if(s){s.setVisible(t.getVisible()),this.layersPlugin.getMap();for(var a=this.layersPlugin.getMapModule(),r=a.getOLMapLayers(s.getId()),n=0;r.length>n;n++)r[n].setVisibility(s.isVisible()),r[n].display(s.isVisible());this.layersPlugin.notifyLayerVisibilityChanged(s)}}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"MapModulePlugin.MapMoveByLayerContentRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveByLayerContentRequestHandler",function(e,t){this.sandbox=e,this.layersPlugin=t},{handleRequest:function(e,t){var i=t.getMapLayerId(),s=this.sandbox.findMapLayerFromSelectedMapLayers(i);if(s){var a=this.layersPlugin.getMapModule().getClosestZoomLevel(s.getMinScale(),s.getMaxScale());if(this.layersPlugin.getMapModule().setZoomLevel(a,!0),s.getGeometry().length>0){var r=this.layersPlugin.isInGeometry(s);if(!r){var n=s.getGeometry()[0].getCentroid();this.layersPlugin.getMapModule().moveMapToLanLot(new OpenLayers.LonLat(n.x,n.y))}}this.layersPlugin.getMapModule().notifyMoveEnd(),this.layersPlugin._checkLayersVisibility(this.layersPlugin._visibilityCheckOrder)}}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.MapLayerVisibilityChangedEvent",function(e,t,i){this._mapLayer=e,this._inScale=1==t,this._geomMatch=0!=i},{__name:"MapLayerVisibilityChangedEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer},isInScale:function(){return this._inScale},isGeometryMatch:function(){return this._geomMatch}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.mapmodule.WmsLayerPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={}},{__name:"WmsLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},hasUI:function(){return!1},register:function(){this.getMapModule().setLayerPlugin("wmslayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("wmslayer",null)},init:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerAddEvent:function(e){this._afterMapLayerAddEvent(e)},AfterMapLayerRemoveEvent:function(e){this._afterMapLayerRemoveEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this._afterChangeMapLayerOpacityEvent(e)},AfterChangeMapLayerStyleEvent:function(e){this._afterChangeMapLayerStyleEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){for(var t=this._sandbox,i=0;e.length>i;i++){var s=e[i],a=s.getId();s.isLayerOfType("WMS")&&(t.printDebug("preselecting "+a),this._addMapLayerToMap(s,!0,s.isBaseLayer()))}},_afterMapLayerAddEvent:function(e){this._addMapLayerToMap(e.getMapLayer(),e.getKeepLayersOrder(),e.isBasemap())},_addMapLayerToMap:function(e,t,i){if(e.isLayerOfType("WMS")){this._sandbox.printDebug(" [SnappyWMSLayer]  Creating "+e.getId()+" KEEP ON TOP ? "+t+" BASE? "+i);var s=this._map.getLayersByName("Markers");if(s)for(var a=0;s.length>a;a++)s[a]&&this._map.removeLayer(s[a],!1);if(e.isGroupLayer()||e.isBaseLayer()||1==i)if(e.getSubLayers().length>0)for(var r=0;e.getSubLayers().length>r;r++){for(var n="",o=0;e.getSubLayers()[r].getWmsUrls().length>o;o++)n+=e.getSubLayers()[r].getWmsUrls()[o];var l=this.getMapModule().calculateLayerScales(e.getSubLayers()[r].getMaxScale(),e.getSubLayers()[r].getMinScale()),h=Oskari.$("SnappyWMSLayer"),u=new h("basemap_"+e.getSubLayers()[r].getId(),e.getSubLayers()[r].getWmsUrls(),{layers:e.getSubLayers()[r].getWmsName(),transparent:!0,id:e.getSubLayers()[r].getId(),styles:e.getSubLayers()[r].getCurrentStyle().getName(),format:"image/png"},{layerId:e.getSubLayers()[r].getWmsName(),scales:l,isBaseLayer:!1,displayInLayerSwitcher:!0,visibility:!0,buffer:0});u.opacity=e.getOpacity()/100,this._map.addLayer(u),this._sandbox.printDebug(" [SnappyWMSLayer]  Created SnappyGrid for WMS WITH SUBLAYERS for "+e.getId()),t||this._map.setLayerIndex(u,0)}else{var l=this.getMapModule().calculateLayerScales(e.getMaxScale(),e.getMinScale()),h=Oskari.$("SnappyWMSLayer"),u=new h("layer_"+e.getId(),e.getWmsUrls(),{layers:e.getWmsName(),transparent:!0,id:e.getId(),styles:e.getCurrentStyle().getName(),format:"image/png"},{layerId:e.getWmsName(),scales:l,isBaseLayer:!1,displayInLayerSwitcher:!0,visibility:!0,buffer:0});u.opacity=e.getOpacity()/100,this._map.addLayer(u),this._sandbox.printDebug(" [SnappyWMSLayer]  Created SnappyGrid for WMS WITH SUBLAYERS for "+e.getId()),t?this._map.setLayerIndex(u,this._map.layers.length):this._map.setLayerIndex(u,0)}else{var l=this.getMapModule().calculateLayerScales(e.getMaxScale(),e.getMinScale()),h=Oskari.$("SnappyWMSLayer"),u=new h("layer_"+e.getId(),e.getWmsUrls(),{layers:e.getWmsName(),transparent:!0,id:e.getId(),styles:e.getCurrentStyle().getName(),format:"image/png"},{layerId:e.getWmsName(),scales:l,isBaseLayer:!1,displayInLayerSwitcher:!0,visibility:!0,buffer:0});u.opacity=e.getOpacity()/100,this._map.addLayer(u),this._sandbox.printDebug("#!#! CREATED OPENLAYER.LAYER.WMS for "+e.getId()),t?this._map.setLayerIndex(u,this._map.layers.length):this._map.setLayerIndex(u,0)}if(s)for(var a=0;s.length>a;a++)s[a]&&this._map.addLayer(s[a])}},_afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this._removeMapLayerFromMap(t)},_removeMapLayerFromMap:function(e){if(e.isLayerOfType("WMS"))if(e.isBaseLayer()||e.isGroupLayer())if(e.getSubLayers().length>0)for(var t=0;e.getSubLayers().length>t;t++){var i=e.getSubLayers()[t],s=this._map.getLayersByName("basemap_"+i.getId());s&&s[0]&&s[0].destroy&&s[0].destroy()
}else{var s=this._map.getLayersByName("layer_"+e.getId());s[0].destroy()}else{var s=this._map.getLayersByName("layer_"+e.getId());s[0].destroy()}},getOLMapLayers:function(e){if(!e.isLayerOfType("WMS"))return null;if(e.isBaseLayer()||e.isGroupLayer()){if(e.getSubLayers().length>0){for(var t=[],i=0;e.getSubLayers().length>i;i++){var s=this._map.getLayersByName("basemap_"+e.getSubLayers()[i].getId());t.push(s[0])}return t}return this._map.getLayersByName("layer_"+e.getId())}return this._map.getLayersByName("layer_"+e.getId())},_afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer();if(t.isLayerOfType("WMS"))if(t.isBaseLayer()||t.isGroupLayer())if(t.getSubLayers().length>0)for(var i=0;t.getSubLayers().length>i;i++){var s=this._map.getLayersByName("basemap_"+t.getSubLayers()[i].getId());s[0].setOpacity(t.getOpacity()/100)}else{var s=this._map.getLayersByName("layer_"+t.getId());null!=s[0]&&s[0].setOpacity(t.getOpacity()/100)}else{this._sandbox.printDebug("Setting Layer Opacity for "+t.getId()+" to "+t.getOpacity());var s=this._map.getLayersByName("layer_"+t.getId());null!=s[0]&&s[0].setOpacity(t.getOpacity()/100)}},_afterChangeMapLayerStyleEvent:function(e){var t=e.getMapLayer();if(!t.isBaseLayer()){var i=this._map.getLayersByName("layer_"+t.getId());null!=i&&i[0].mergeNewParams({styles:t.getCurrentStyle().getName()})}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.$("SnappyGrid",OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,grid:null,singleTile:!1,ratio:1.5,buffer:2,numLoadingTiles:0,initialize:function(){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.events.addEventType("tileloaded"),this.grid=[]},destroy:function(){this.clearGrid(),this.grid=null,this.tileSize=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;t>e;e++)for(var i=this.grid[e],s=0,a=i.length;a>s;s++){var r=i[s];this.removeTileMonitoringHooks(r),r.destroy()}this.grid=[]}},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e},moveTo:function(e,t,i){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),e=e||this.map.getExtent(),null!=e){var s=!this.grid.length||t,a=this.getTilesBounds();this.singleTile?(s||!i&&!a.containsBounds(e))&&this.initSingleTile(e):s||!a.containsBounds(e,!0)?this.initGriddedTiles(e):this.moveGriddedTiles(e)}},setTileSize:function(e){this.singleTile&&(e=this.map.getSize(),e.h=parseInt(e.h*this.ratio),e.w=parseInt(e.w*this.ratio)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[e])},getGridBounds:function(){var e="The getGridBounds() function is deprecated. It will be removed in 3.0. Please use getTilesBounds() instead.";return OpenLayers.Console.warn(e),this.getTilesBounds()},getTilesBounds:function(){var e=null;if(this.grid.length){var t=this.grid.length-1,i=this.grid[t][0],s=this.grid[0].length-1,a=this.grid[0][s];e=new OpenLayers.Bounds(i.bounds.left,i.bounds.bottom,a.bounds.right,a.bounds.top)}return e},initSingleTile:function(e){var t=e.getCenterLonLat(),i=e.getWidth()*this.ratio,s=e.getHeight()*this.ratio,a=new OpenLayers.Bounds(t.lon-i/2,t.lat-s/2,t.lon+i/2,t.lat+s/2),r=new OpenLayers.LonLat(a.left,a.top),n=this.map.getLayerPxFromLonLat(r);this.grid.length||(this.grid[0]=[]);var o=this.grid[0][0];o?o.moveTo(a,n):(o=this.addTile(a,n),this.addTileMonitoringHooks(o),o.draw(),this.grid[0][0]=o),this.removeExcessTiles(1,1)},calculateGridLayout:function(e,t,i){var s=i*this.tileSize.w,a=i*this.tileSize.h,r=e.left-t.left,n=Math.floor(r/s)-this.buffer,o=r/s-n,l=-o*this.tileSize.w,h=t.left+n*s,u=e.top-(t.bottom+a),p=Math.ceil(u/a)+this.buffer,c=p-u/a,d=-c*this.tileSize.h,m=t.bottom+p*a;return{tilelon:s,tilelat:a,tileoffsetlon:h,tileoffsetlat:m,tileoffsetx:l,tileoffsety:d}},initGriddedTiles:function(e){var t=this.map.getSize(),i=Math.ceil(t.h/this.tileSize.h)+Math.max(1,2*this.buffer),s=Math.ceil(t.w/this.tileSize.w)+Math.max(1,2*this.buffer),a=this.getMaxExtent(),r=this.map.getResolution(),n=this.calculateGridLayout(e,a,r),o=Math.round(n.tileoffsetx),l=Math.round(n.tileoffsety),h=n.tileoffsetlon,u=n.tileoffsetlat,p=n.tilelon,c=n.tilelat;this.origin=new OpenLayers.Pixel(o,l);var d=o,m=h,y=0,f=parseInt(this.map.layerContainerDiv.style.left),g=parseInt(this.map.layerContainerDiv.style.top);do{var v=this.grid[y++];v||(v=[],this.grid.push(v)),h=m,o=d;var L=0;do{var b=new OpenLayers.Bounds(h,u,h+p,u+c),O=o;O-=f;var S=l;S-=g;var w=new OpenLayers.Pixel(O,S),_=v[L++];_?_.moveTo(b,w,!1):(_=this.addTile(b,w),this.addTileMonitoringHooks(_),v.push(_)),h+=p,o+=this.tileSize.w}while(e.right+p*this.buffer>=h||s>L);u-=c,l+=this.tileSize.h}while(u>=e.bottom-c*this.buffer||i>y);this.removeExcessTiles(y,L),this.spiralTileLoad()},getMaxExtent:function(){return this.maxExtent},spiralTileLoad:function(){for(var e=[],t=["right","down","left","up"],i=0,s=-1,a=OpenLayers.Util.indexOf(t,"right"),r=0;t.length>r;){var n=i,o=s;switch(t[a]){case"right":o++;break;case"down":n++;break;case"left":o--;break;case"up":n--}var l=null;this.grid.length>n&&n>=0&&this.grid[0].length>o&&o>=0&&(l=this.grid[n][o]),null==l||l.queued?(a=(a+1)%4,r++):(e.unshift(l),l.queued=!0,r=0,i=n,s=o)}for(var h=0,u=e.length;u>h;h++){var l=e[h];l.draw(),l.queued=!1}},addTile:function(){},addTileMonitoringHooks:function(e){e.onLoadStart=function(){0==this.numLoadingTiles&&this.events.triggerEvent("loadstart"),this.numLoadingTiles++},e.events.register("loadstart",this,e.onLoadStart),e.onLoadEnd=function(){this.numLoadingTiles--,this.events.triggerEvent("tileloaded"),0==this.numLoadingTiles&&this.events.triggerEvent("loadend")},e.events.register("loadend",this,e.onLoadEnd),e.events.register("unload",this,e.onLoadEnd)},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,scope:this})},moveGriddedTiles:function(){for(var e=this.buffer||1;;){var t=this.grid[0][0].position,i=this.map.getViewPortPxFromLayerPx(t);if(i.x>-this.tileSize.w*(e-1))this.shiftColumn(!0);else if(i.x<-this.tileSize.w*e)this.shiftColumn(!1);else if(i.y>-this.tileSize.h*(e-1))this.shiftRow(!0);else{if(!(i.y<-this.tileSize.h*e))break;this.shiftRow(!1)}}},shiftRow:function(e){for(var t=e?0:this.grid.length-1,i=this.grid,s=i[t],a=this.map.getResolution(),r=e?-this.tileSize.h:this.tileSize.h,n=a*-r,o=e?i.pop():i.shift(),l=0,h=s.length;h>l;l++){var u=s[l],p=u.bounds.clone(),c=u.position.clone();p.bottom=p.bottom+n,p.top=p.top+n,c.y=c.y+r,o[l].moveTo(p,c)}e?i.unshift(o):i.push(o)},shiftColumn:function(e){for(var t=e?-this.tileSize.w:this.tileSize.w,i=this.map.getResolution(),s=i*t,a=0,r=this.grid.length;r>a;a++){var n=this.grid[a],o=e?0:n.length-1,l=n[o],h=l.bounds.clone(),u=l.position.clone();h.left=h.left+s,h.right=h.right+s,u.x=u.x+t;var p=e?this.grid[a].pop():this.grid[a].shift();p.moveTo(h,u),e?n.unshift(p):n.push(p)}},removeExcessTiles:function(e,t){for(;this.grid.length>e;)for(var i=this.grid.pop(),s=0,a=i.length;a>s;s++){var r=i[s];this.removeTileMonitoringHooks(r),r.destroy()}for(;this.grid[0].length>t;)for(var s=0,a=this.grid.length;a>s;s++){var i=this.grid[s],r=i.pop();this.removeTileMonitoringHooks(r),r.destroy()}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(e){var t=this.maxExtent,i=this.getResolution(),s=i*this.tileSize.w,a=i*this.tileSize.h,r=this.getLonLatFromViewPortPx(e),n=t.left+s*Math.floor((r.lon-t.left)/s),o=t.bottom+a*Math.floor((r.lat-t.bottom)/a);return new OpenLayers.Bounds(n,o,n+s,o+a)},CLASS_NAME:"OpenLayers.Layer.SnappyGrid"})),Oskari.$("SnappyWMSLayer",OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},reproject:!1,isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{"EPSG:4326":!0},initialize:function(e,t,i,s){var a=[];i=OpenLayers.Util.upperCaseObject(i),parseFloat(i.VERSION)>=1.3&&!i.EXCEPTIONS&&(i.EXCEPTIONS="INIMAGE"),a.push(e,t,i,s),OpenLayers.Layer.Grid.prototype.initialize.apply(this,a),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),!this.noMagic&&this.params.TRANSPARENT&&"true"==(""+this.params.TRANSPARENT).toLowerCase()&&(null!=s&&s.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},reverseAxisOrder:function(){return parseFloat(this.params.VERSION)>=1.3&&!!this.yx[this.map.getProjectionObject().getCode()]},getURL:function(e){e=this.adjustBounds(e);var t=this.getImageSize(),i={},s=this.reverseAxisOrder();i.BBOX=this.encodeBBOX?e.toBBOX(null,s):e.toArray(s),i.WIDTH=t.w,i.HEIGHT=t.h;var a=this.getFullRequestString(i);return a},mergeNewParams:function(e){var t=OpenLayers.Util.upperCaseObject(e),i=[t];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,i)},getFullRequestString:function(e){var t=this.map.getProjectionObject(),i=this.projection&&this.projection.equals(t)?this.projection.getCode():t.getCode(),s="none"==i?null:i;return parseFloat(this.params.VERSION)>=1.3?this.params.CRS=s:this.params.SRS=s,"boolean"==typeof this.params.TRANSPARENT&&(e.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"),OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.SnappyWMS"})),Oskari.clazz.define("Oskari.mapframework.mapmodule.VectorLayerPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._supportedFormats={},this._sldFormat=new OpenLayers.Format.SLD({multipleSymbolizers:!1,namedLayersAsArray:!0})},{__name:"VectorLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},hasUI:function(){return!1},register:function(){this.getMapModule().setLayerPlugin("vectorlayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("vectorlayer",null)},init:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),this.registerVectorFormats(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerAddEvent:function(e){this.afterMapLayerAddEvent(e)},AfterMapLayerRemoveEvent:function(e){this.afterMapLayerRemoveEvent(e)},FeaturesAvailableEvent:function(e){this.handleFeaturesAvailableEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){for(var t=this._sandbox,i=0;e.length>i;i++){var s=e[i],a=s.getId();s.isLayerOfType("VECTOR")&&(t.printDebug("preselecting "+a),this.addMapLayerToMap(s,!0,s.isBaseLayer()))}},afterMapLayerAddEvent:function(e){this.addMapLayerToMap(e.getMapLayer(),e.getKeepLayersOrder(),e.isBasemap())},registerVectorFormat:function(e,t){this._supportedFormats[e]=t},registerVectorFormats:function(){this.registerVectorFormat("application/json",new OpenLayers.Format.GeoJSON({})),this.registerVectorFormat("application/nlsfi-x-openlayers-feature",new function(){this.read=function(e){return e}})},addMapLayerToMap:function(e,t){if(e.isLayerOfType("VECTOR")){var i=this._map.getLayersByName("Markers");this._map.removeLayer(i[0],!1);var s=new OpenLayers.StyleMap,a={styleMap:s},r=e.getStyledLayerDescriptor();if(r){this._sandbox.printDebug(r);var n=this._sldFormat.read(r);window.styleInfo=n;var o=n.namedLayers[0].userStyles,l=o[0];s.styles["default"]=l}var h=new OpenLayers.Layer.Vector("layer_"+e.getId(),a);h.opacity=e.getOpacity()/100,this._map.addLayer(h),this._sandbox.printDebug("#!#! CREATED VECTOR / OPENLAYER.LAYER.VECTOR for "+e.getId()),t?this._map.setLayerIndex(h,this._map.layers.length):this._map.setLayerIndex(h,0),this._map.addLayer(i[0])}},afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this.removeMapLayerFromMap(t)},removeMapLayerFromMap:function(e){if(e.isLayerOfType("VECTOR")){var t=this._map.getLayersByName("layer_"+e.getId());t[0].destroy()}},getOLMapLayers:function(e){return e.isLayerOfType("VECTOR")?this._map.getLayersByName("layer_"+e.getId()):void 0},handleFeaturesAvailableEvent:function(e){var t=e.getMapLayer(),i=e.getMimeType(),s=e.getFeatures(),a=e.getOp(),r=this._map.getLayersByName("layer_"+t.getId())[0];if(r){a&&"replace"==a&&r.removeFeatures(r.features);var n=this._supportedFormats[i];if(n){var o=n.read(s);r.addFeatures(o)}}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.ToolSelectionRequest",function(e){this._toolId=e},{tools:{navigate:"map_control_navigate_tool",zoom:"map_control_zoom_tool",previous:"map_control_tool_prev",next:"map_control_tool_prev",measure:"map_control_measure_tool",measure_area:"map_control_measure_area_tool",select:"map_control_select_tool",draw_area:"map_control_draw_area_tool"},__name:"ToolSelectionRequest",getName:function(){return this.__name},getToolId:function(){return this._toolId},setToolId:function(e){this._toolId=e},getNamespace:function(){return-1==this._toolId.indexOf(".")?"":this._toolId.substring(0,this._toolId.lastIndexOf("."))},getToolName:function(){return-1==this._toolId.indexOf(".")?this._toolId:this._toolId.substring(this._toolId.lastIndexOf("."))}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.mapmodule.ToolSelectionHandler",function(e,t){this.sandbox=e,this.controlsPlugin=t},{handleRequest:function(e,t){t.getToolId(),t.getNamespace();var i=t.getToolName();if("map_control_tool_prev"==i){var s=this.sandbox.findRegisteredModuleInstance("StateHandler");s&&s.historyMovePrevious()}else if("map_control_tool_next"==i){var s=this.sandbox.findRegisteredModuleInstance("StateHandler");s&&s.historyMoveNext()}else if("map_control_select_tool"==i){var a=this.sandbox.findRegisteredModuleInstance("SketchLayerPlugin");a&&a.clearBbox()}else"map_control_zoom_tool"==i?this.controlsPlugin._zoomBoxTool.activate():"map_control_measure_tool"==i?this.controlsPlugin._measureControls.line.activate():"map_control_measure_area_tool"==i&&this.controlsPlugin._measureControls.area.activate()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerUpdateRequest",function(e,t,i){this._layerId=e,this._forced=1==t,this._parameters=i},{__name:"MapModulePlugin.MapLayerUpdateRequest",getName:function(){return this.__name},getLayerId:function(){return this._layerId},isForced:function(){return this._forced},getParameters:function(){return this._parameters},setParameters:function(e){this._parameters=e}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapLayerUpdateRequestHandler",function(e,t){this.sandbox=e,this.mapModule=t},{handleRequest:function(e,t){var i=t.getLayerId(),s=t.isForced(),a=t.getParameters(),r=this.sandbox,n=r.findMapLayerFromSelectedMapLayers(i);if(n)if(a&&n.isLayerOfType("WMS")){var o=this.mapModule.getOLMapLayers(i),l=0;if(o){l=o.length;for(var h=0;o.length>h;++h)o[h].mergeNewParams(a)}this.sandbox.printDebug("[MapLayerUpdateRequestHandler] WMS layer / merge new params: "+i+", found "+l)}else{var o=this.mapModule.getOLMapLayers(i),l=0;if(o){l=o.length;for(var h=0;o.length>h;++h)o[h].redraw(s)}this.sandbox.printDebug("[MapLayerUpdateRequestHandler] Layer / update layer "+i+", found "+l)}}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.MapMoveRequestHandler",function(e,t){this.sandbox=e,this.mapModule=t},{handleRequest:function(e,t){var i=t.getCenterX(),s=t.getCenterY(),a=t.getMarker(),r=t.getZoom(),n=new OpenLayers.LonLat(i,s);this.mapModule.moveMapToLanLot(n,r,!1),(r||0===r)&&("OpenLayers.Bounds"===r.CLASS_NAME?this.mapModule._map.zoomToExtent(r):this.mapModule._map.zoomTo(r)),this.mapModule._updateDomain(),a&&this.mapModule._drawMarker(),this.mapModule.notifyMoveEnd(),this.sandbox.printDebug("[MapMoveRequestHandler] map moved")}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.MapClickedEvent",function(e,t,i){this._lonlat=e,this._mouseX=t,this._mouseY=i},{__name:"MapClickedEvent",getName:function(){return this.__name},getLonLat:function(){return this._lonlat},getMouseX:function(){return this._mouseX},getMouseY:function(){return this._mouseY}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.event.EscPressedEvent",function(){},{__name:"EscPressedEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.request.ClearHistoryRequest",function(){},{__name:"ClearHistoryRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.controls.ClearHistoryHandler",function(e,t){this.mapModule=t,this.sandbox=e},{handleRequest:function(){this.mapModule.clearNavigationHistory()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.Portti2Zoombar",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.__templates={},this.__elements={},this.__parent=null,this._slider=null,this._zoombar_messages={},this._suppressEvents=!1,this._conf=e},{__name:"Portti2Zoombar",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},hasUI:function(){return!0},setMapModule:function(e){this.mapModule=e,e&&(this._map=e.getMap(),this.pluginName=e.getName()+this.__name)},init:function(){this.__templates.zoombar=jQuery('<div class="oskariui mapplugin pzbDiv" title="Koko Suomi"><div class="pzbDiv-plus"></div><input type=\'hidden\' /><div class="slider"></div><div class="pzbDiv-minus"></div></div>')},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);this._draw(),this._setZoombarValue(this._map.getZoom())},stopPlugin:function(e){this.__elements.zoombarSlider&&(this.__elements.zoombarSlider.remove(),this._slider.remove(),delete this.__elements.zoombarSlider),e.unregister(this),this._sandbox=null},_draw:function(){var e=this;e.__parent||(e.__parent=this._map.div),e.__elements.zoombarSlider||(e.__elements.zoombarSlider=e.__templates.zoombar.clone());var t="pzb-input-"+this.getName(),i="pzb-slider-"+this.getName(),s=e.__elements.zoombarSlider.find("div.slider");e.__elements.zoombarSlider.find("input").attr("id",t),s.attr("id",i),jQuery(e.__parent).append(e.__elements.zoombarSlider);var s=e.__elements.zoombarSlider.find("div.slider");s.css("height",11*this._map.getNumZoomLevels()+"px"),e._slider=s.slider({orientation:"vertical",range:"min",min:0,max:this._map.getNumZoomLevels()-1,value:this._map.getZoom(),slide:function(t,i){e.getMapModule().zoomTo(i.value)}});var a=e.__elements.zoombarSlider.find(".pzbDiv-plus");a.bind("click",function(){12>e._slider.slider("value")&&e.getMapModule().zoomTo(e._slider.slider("value")+1)});var r=e.__elements.zoombarSlider.find(".pzbDiv-minus");r.bind("click",function(){e._slider.slider("value")>0&&e.getMapModule().zoomTo(e._slider.slider("value")-1)}),this._conf&&this._conf.location&&(this._conf.location.top&&(e.__elements.zoombarSlider.css("bottom","auto"),e.__elements.zoombarSlider.css("top",this._conf.location.top)),this._conf.location.left&&(e.__elements.zoombarSlider.css("right","auto"),e.__elements.zoombarSlider.css("left",this._conf.location.left)),this._conf.location.right&&(e.__elements.zoombarSlider.css("left","auto"),e.__elements.zoombarSlider.css("right",this._conf.location.right)),this._conf.location.bottom&&(e.__elements.zoombarSlider.css("top","auto"),e.__elements.zoombarSlider.css("bottom",this._conf.location.bottom)))},_setZoombarValue:function(e){var t=this;t._slider&&(this._suppressEvents=!0,t._slider.slider("value",e),this._suppressEvents=!1)},eventHandlers:{AfterMapMoveEvent:function(e){if(this._sandbox){var t=this;t._setZoombarValue(e.getZoom())}}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.mapmodule.plugin.PanButtons",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.__templates={},this.__elements={},this.__parent=null,this.__conf=e,this.__prestart=null},{__name:"PanButtons",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},hasUI:function(){return!0},setMapModule:function(e){this.mapModule=e,e&&(this._map=e.getMap(),this.pluginName=e.getName()+this.__name)},init:function(){this.__templates.pan=jQuery('<div class="panbuttonDiv"><div>  <img class="panbuttonDivImg" usemap="#panbuttons">    <map name="panbuttons">      <area shape="circle" class="panbuttons_center" coords="45,45,20" href="#">      <area shape="polygon" class="panbuttons_left" coords="13,20,25,30,20,45,27,65,13,70,5,45" href="#">      <area shape="polygon" class="panbuttons_up" coords="30,8,45,4,60,8,60,23,45,20,30,23" href="#">      <area shape="polygon" class="panbuttons_right" coords="79,20,67,30,72,45,65,65,79,70,87,45" href="#">      <area shape="polygon" class="panbuttons_down" coords="30,82,45,86,60,82,60,68,45,70,30,68" href="#">    </map>  </img></div></div>')},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p);var t=null;if(this._map.div&&(t=jQuery(this._map.div).find(".pzbDiv")),this.__conf&&this.__conf.location&&this.__conf.location.top&&t){var i=this,s=i.__conf.location.top;"auto"==s?s=10:s.indexOf("px")>=0&&(s=s.substring(0,s.indexOf("px"))),jQuery(i._map.div).height();var a="auto",r=t.css("top"),n=t.css("bottom");r||(r="auto"),n||(n="auto"),null==i.__prestart&&(i.__prestart={zbtop:r,zbbtm:n}),s=10,a="auto",r=110,n="auto","auto"!==r&&(r+="px"),"auto"!==n&&(n+="px"),t.css("top",r),t.css("bottom",n),"auto"!==s&&(s+="px"),"auto"!==a&&(a+="px"),i.__conf.location.top=s,i.__conf.location.bottom=a,window.setTimeout(function(){var e=i.__elements.panbuttons;e&&(e.css("top",s),e.css("bottom","auto"))},50)}this._draw()},stopPlugin:function(e){this.__elements.panbuttons&&(this.__elements.panbuttons.remove(),delete this.__elements.panbuttons),this._map.div&&this.__prestart&&(zb=jQuery(this._map.div).find(".pzbDiv"),zb&&(zb.css("top",this.__prestart.zbtop),zb.css("bottom",this.__prestart.zbbtm))),e.unregister(this)},_draw:function(){var e=this;e.__parent||(e.__parent=this._map.div),e.__elements.panbuttons||(e.__elements.panbuttons=e.__templates.pan.clone());var t=e.__elements.panbuttons;e.__conf&&e.__conf.location&&(e.__conf.location.top&&(t.css("bottom","auto"),t.css("top",e.__conf.location.top)),e.__conf.location.left&&(t.css("right","auto"),t.css("left",e.__conf.location.left)),e.__conf.location.right&&(t.css("left","auto"),t.css("right",e.__conf.location.right)),e.__conf.location.bottom&&(t.css("top","auto"),t.css("bottom",e.__conf.location.bottom)));var i=this.getMapModule().getImageUrl()+"/framework/bundle/mapmodule-plugin/plugin/panbuttons/images/",s=t.find(".panbuttonDivImg");s.attr("src",i+"default.png");var a=t.find(".panbuttons_center");a.bind("mouseover",function(){s.attr("src",i+"root.png")}),a.bind("mouseout",function(){s.attr("src",i+"default.png")}),a.bind("click",function(){var t="StateHandler.SetStateRequest",i=e.getMapModule(),s=i.getSandbox(),a=s.getRequestBuilder(t);a&&s.request(e,a())});var r=t.find(".panbuttons_left");r.bind("mouseover",function(){s.attr("src",i+"left.png")}),r.bind("mouseout",function(){s.attr("src",i+"default.png")}),r.bind("click",function(){e.getMapModule().panMapByPixels(-100,0,!0)});var n=t.find(".panbuttons_right");n.bind("mouseover",function(){s.attr("src",i+"right.png")}),n.bind("mouseout",function(){s.attr("src",i+"default.png")}),n.bind("click",function(){e.getMapModule().panMapByPixels(100,0,!0)});var o=t.find(".panbuttons_up");o.bind("mouseover",function(){s.attr("src",i+"up.png")}),o.bind("mouseout",function(){s.attr("src",i+"default.png")}),o.bind("click",function(){e.getMapModule().panMapByPixels(0,-100,!0)});var l=t.find(".panbuttons_down");l.bind("mouseover",function(){s.attr("src",i+"down.png")}),l.bind("mouseout",function(){s.attr("src",i+"default.png")}),l.bind("click",function(){e.getMapModule().panMapByPixels(0,100,!0)}),jQuery(e.__parent).append(t)},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.PluginMapModuleBundleInstance",function(){this.name="mapmodule",this.mediator=null,this.sandbox=null,this.conf=null,this.impl=null,this.facade=null,this.ui=null},{__name:"Oskari.mapframework.bundle.PluginMapModuleBundleInstance",getName:function(){return this.__name},start:function(){if("started"!=this.mediator.getState()){this.libs={ext:Oskari.$("Ext")};var e=Oskari.$("UI.facade");this.facade=e;var t=e.getSandbox();this.sandbox=t;var i=Oskari.$("startup");this.conf=i;var s=i.mapConfigurations.index_map,a=i.mapConfigurations.zoom_bar,r=i.mapConfigurations.scala_bar,n=i.mapConfigurations.pan,o=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapModule","Main",s,a,r,n);this.impl=o;var l=this._createMapPanel();this._panel=l;var h=this.facade.appendExtensionModule(this.impl,this.name,{},this,"Center",{fi:{title:""},sv:{title:"?"},en:{title:""}},l);this.def=h;var u=[];u.push("Oskari.mapframework.bundle.mapmodule.plugin.LayersPlugin"),u.push("Oskari.mapframework.mapmodule.WmsLayerPlugin"),u.push("Oskari.mapframework.mapmodule.MarkersPlugin"),u.push("Oskari.mapframework.mapmodule.VectorLayerPlugin"),u.push("Oskari.mapframework.mapmodule.TilesGridPlugin"),u.push("Oskari.mapframework.mapmodule.ControlsPlugin"),u.push("Oskari.mapframework.mapmodule.WfsLayerPlugin"),u.push("Oskari.mapframework.mapmodule.GetInfoPlugin");for(var p=0;u.length>p;p++){var c=Oskari.clazz.create(u[p]);o.registerPlugin(c)}var d=this._createMapContainer(this.impl.getMap());return this._mapster=d,l.add(d),e.registerPart("Mapster",this._mapster),this.impl.start(t),this.mediator.setState("started"),this}},_createMapPanel:function(){var e=this.libs.ext,t=e.create("Ext.Panel",{region:"center",layout:"fit",items:[]});return t},_createMapContainer:function(e){var t=this.libs.ext,i=t.createWidget("nlsfimappanel",{olmap:e,layout:"absolute"});return i},update:function(e,t,i,s){e.alert("RECEIVED update notification @BUNDLE_INSTANCE: "+s)},stop:function(){return this.impl.stop(),this.facade.removeExtensionModule(this.impl,this.name,this.impl.eventHandlers,this,this.def),this.def=null,this.mediator.setState("stopped"),this}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.bundle.extension.Extension"]}),Oskari.clazz.define("Oskari.mapframework.event.base.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/event/event.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"event-base","Bundle-Name":"mapframework.event.base.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.event.Bundle",Title:" mapframework.event.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("event-base","Oskari.mapframework.event.base.Bundle"),Oskari.clazz.define("Oskari.mapframework.event.Event",function(){throw"mapframework.event.Event should not be used"},{getName:function(){throw"Running default implementation of Event.getName(). implement your own!"},setCreator:function(e){this._creator=e},getCreator:function(){return this._creator}}),Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.MapFullBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.mapfull.MapFullBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/mapfull/enhancement/start-map-with-link-enhancement.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"mapfull","Bundle-Name":"mapframework.mapfull.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"mapframework.mapfull.Bundle",Title:"mapframework.mapfull.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("mapfull","Oskari.mapframework.bundle.mapfull.MapFullBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.mapfull.MapFullBundleInstance",function(){this.map=null,this.core=null,this.sandbox=null,this.mapmodule=null,this.state=void 0,this.mapDivId="mapdiv"},{getMapModule:function(){return this.mapmodule},getSandbox:function(){return this.sandbox},_createUi:function(){function e(){jQuery("#"+t.mapDivId).height(jQuery(window).height()),jQuery("#contentMap").height(jQuery(window).height())}var t=this;if(this.conf.size)jQuery("#"+this.mapDivId).width(this.conf.size.width),jQuery("#"+this.mapDivId).height(this.conf.size.height);else{var i;jQuery(window).resize(function(){clearTimeout(i),i=setTimeout(e,100)}),e()}var s=Oskari.clazz.create("Oskari.mapframework.ui.module.common.MapModule","Main",this.conf.imageLocation);this.mapmodule=s;var a=this.sandbox.register(s);if(s.start(this.sandbox),a.render(this.mapDivId),this.conf.plugins)for(var r=this.conf.plugins,n=0;r.length>n;n++)r[n].instance=Oskari.clazz.create(r[n].id,r[n].config),s.registerPlugin(r[n].instance),s.startPlugin(r[n].instance);this.map=a},start:function(){Proj4js.defs={"EPSG:3067":"+proj=utm +zone=35 +ellps=GRS80 +units=m +no_defs","EPSG:4326":"+title=WGS 84 +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"};var e=this,t=e.conf;Oskari.getLang();var i=Oskari.clazz.create("Oskari.mapframework.core.Core");this.core=i;var s=i.getSandbox();this.sandbox=s,t&&t.mapElement&&(this.mapDivId=t.mapElement),s.setUser(t.user),s.setAjaxUrl(t.globalMapAjaxUrl);var a=this._createServices(t),r=[];r.push(Oskari.clazz.create("Oskari.mapframework.enhancement.mapfull.StartMapWithLinkEnhancement")),i.init(a,r);var n=s.getService("Oskari.mapframework.service.MapLayerService"),o=t.layers;if(o)for(var l=0;o.length>l;l++){var h=n.createMapLayer(o[l]);n.addLayer(h,!0)}this._createUi(),s.registerAsStateful(this.mediator.bundleId,this),this.setState(this.state)
},_teardownState:function(e){for(var t=this.sandbox.findAllSelectedMapLayers(),i=this.sandbox.getRequestBuilder("RemoveMapLayerRequest"),s=0;t.length>s;s++)this.sandbox.request(e.getName(),i(t[s].getId()))},_createServices:function(e){var t=[],i=Oskari.clazz.create("Oskari.mapframework.service.MapLayerService",e.globalMapAjaxUrl+"action_route=GetMapLayers&lang="+Oskari.getLang(),this.core.getSandbox());t.push(i),i.registerLayerModel("wmtslayer","Oskari.mapframework.wmts.domain.WmtsLayer");var s=Oskari.clazz.create("Oskari.mapframework.wmts.service.WmtsLayerModelBuilder");return i.registerLayerModelBuilder("wmtslayer",s),"true"==e.disableDevelopmentMode&&(core.disableDebug(),t.push(Oskari.clazz.create("Oskari.mapframework.service.UsageSnifferService",2,"/log/")),core.enableMapMovementLogging()),t},update:function(){},stop:function(){this.sandbox.unregisterStateful(this.mediator.bundleId),alert("Stopped!")},setState:function(e){var t=this.sandbox.findRegisteredModuleInstance("MainMapModule");if(this._teardownState(t),e.selectedLayers)for(var i=this.sandbox.getRequestBuilder("AddMapLayerRequest"),s=this.sandbox.getRequestBuilder("ChangeMapLayerOpacityRequest"),a=this.sandbox.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest"),r=this.sandbox.getRequestBuilder("ChangeMapLayerStyleRequest"),n=e.selectedLayers.length,o=0;n>o;++o){var l=e.selectedLayers[o];this.sandbox.request(t.getName(),i(l.id,!0)),l.hidden&&this.sandbox.request(t.getName(),a(l.id,!1)),l.style&&this.sandbox.request(t.getName(),r(l.id,l.style)),l.opacity&&this.sandbox.request(t.getName(),s(l.id,l.opacity))}e.east&&this.sandbox.getMap().moveTo(e.east,e.north,e.zoom),this.sandbox.syncMapState(!0)},getState:function(){var e=this.sandbox.getMap(),t=this.sandbox.findAllSelectedMapLayers();e.getZoom();for(var i=e.getX(),s=e.getY(),a={north:s,east:i,zoom:e.getZoom(),selectedLayers:[]},r=0;t.length>r;r++){var n=t[r],o={id:n.getId(),opacity:n.getOpacity()};n.isVisible()||(o.hidden=!0),n.getCurrentStyle&&n.getCurrentStyle()&&n.getCurrentStyle().getName()&&"!default!"!=n.getCurrentStyle().getName()&&(o.style=n.getCurrentStyle().getName()),a.selectedLayers.push(o)}return a}},{protocol:["Oskari.bundle.BundleInstance","Oskari.userinterface.Stateful"]}),Oskari.clazz.define("Oskari.mapframework.enhancement.mapfull.StartMapWithLinkEnhancement",function(){},{enhance:function(e){e.printDebug("Checking if map is started with link...");var t=e.getRequestParameter("coord"),i=e.getRequestParameter("zoomLevel");e.getRequestParameter("mapLayers");var s=e.getRequestParameter("showMarker"),a=e.getRequestParameter("isCenterMarker"),r=e.getRequestParameter("keepLayersOrder");if(null===r&&(r=!0),e.getMap().setMarkerVisible("true"==s||"true"==a),null!==t&&null!==i){var n;n=t.indexOf("_")>=0?t.split("_"):t.split("%20");var o=n[0],l=n[1];if(null===o||null===l)return e.printDebug("Could not parse link location. Skipping."),void 0;e.printDebug("This is startup by link, moving map..."),e.getMap().moveTo(o,l,i)}}},{protocol:["Oskari.mapframework.enhancement.Enhancement"]}),Oskari.clazz.define("Oskari.mapframework.core.base.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/core/core.js"},{type:"text/javascript",src:"../../../../sources/framework/core/core-enhancement-methods.js"},{type:"text/javascript",src:"../../../../sources/framework/core/core-key-listener-methods.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"core-base","Bundle-Name":"mapframework.core.base.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.core.Bundle",Title:" mapframework.core.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("core-base","Oskari.mapframework.core.base.Bundle"),Oskari.clazz.define("Oskari.mapframework.core.Core",function(){this._selectedLayers=Array(),this._mapLayersHighlighted=Array(),this._map,this._sandbox=Oskari.clazz.create("Oskari.mapframework.sandbox.Sandbox",this),Oskari.$("sandbox",this._sandbox),this._services=[],this._servicesByQName={},this._debug=!1,this._doSniffing=!1,this._ctrlKeyDown=!1,this._allowMultipleHighlightLayers=!1,this._mapIdFromUrl,this._availableRequestsByName={},this._availableEventsByName={}},{init:function(e,t){if(this.printDebug("Initializing core..."),this._sandbox,this._services=e,e)for(var i=0;e.length>i;i++)this.registerService(e[i]);this.printDebug("Sandbox ready, building up domain..."),this._map=Oskari.clazz.create("Oskari.mapframework.domain.Map"),this.enhancements=t;var s=this;s._start()},_start:function(){if(this._doEnhancements(this.enhancements),this._doSniffing){this._mapIdFromUrl=this.getRequestParameter("id"),this.printDebug("Application configured for sniffing. Starting sniffer.");var e=this.getService("Oskari.mapframework.service.UsageSnifferService");e&&e.startSniffing()}this.printDebug("Modules started. Core ready.")},dispatch:function(e){this._sandbox.notifyAll(e)},defaultRequestHandlers:{AddMapLayerRequest:function(e){return this._handleAddMapLayerRequest(e),!0},RemoveMapLayerRequest:function(e){return this._handleRemoveMapLayerRequest(e),!0},ShowMapLayerInfoRequest:function(e){return this._handleShowMapLayerInfoRequest(e),!0},RearrangeSelectedMapLayerRequest:function(e){return this._handleRearrangeSelectedMapLayerRequest(e),!0},ChangeMapLayerOpacityRequest:function(e){return this._handleChangeMapLayerOpacityRequest(e),!0},ChangeMapLayerStyleRequest:function(e){return this._handleChangeMapLayerStyleRequest(e),!0},HighlightMapLayerRequest:function(e){return this._handleHighlightMapLayerRequest(e),!0},HighlightWFSFeatureRequest:function(e){return this.handleHighlightWFSFeatureRequest(e),!0},HideMapMarkerRequest:function(e){return this._handleHideMapMarkerRequest(e),!0},DimMapLayerRequest:function(e){return this._handleDimMapLayerRequest(e.getMapLayerId()),!0},CtrlKeyDownRequest:function(){return this._handleCtrlKeyDownRequest(),!0},CtrlKeyUpRequest:function(){return this._handleCtrlKeyUpRequest(),!0},__default:function(e){return this.printWarn("!!!"),this.printWarn("  There is no handler for"),this.printWarn("  '"+e.getName()+"'"),!1}},processRequest:function(e){var t=e.getName(),i=this.defaultRequestHandlers[t];if(i)rv=i.apply(this,[e]);else{var s=this.externalHandlerCls[t];s?rv=s.handleRequest(this,e):(i=this.defaultRequestHandlers.__default,rv=i.apply(this,[e]))}return delete e,rv},externalHandlerCls:{},addRequestHandler:function(e,t){this.externalHandlerCls[e]=t},removeRequestHandler:function(e,t){this.externalHandlerCls[e]===t&&(this.externalHandlerCls[e]=null)},_getQNameForRequest:function(e){var t=this._availableRequestsByName[e];if(!t){this.printDebug("#!#!# ! Updating request metadata...");var i=Oskari.clazz.protocol("Oskari.mapframework.request.Request");for(p in i){var s=i[p],a=s._class.prototype.getName();this._availableRequestsByName[a]=p}this.printDebug("#!#!# ! Finished Updating request metadata..."),t=this._availableRequestsByName[e]}return t},getRequestBuilder:function(e){var t=this._getQNameForRequest(e);return t?Oskari.clazz.builder(t):void 0},_getQNameForEvent:function(e){var t=this._availableEventsByName[e];if(!t){this.printDebug("#!#!# ! Updating event metadata...");var i=Oskari.clazz.protocol("Oskari.mapframework.event.Event");for(p in i){var s=i[p],a=s._class.prototype.getName();this._availableEventsByName[a]=p}this.printDebug("#!#!# ! Finished Updating event metadata..."),t=this._availableEventsByName[e]}return t},getEventBuilder:function(e){var t=this._getQNameForEvent(e);return t?Oskari.clazz.builder(t):void 0},disableDebug:function(){this._debug=!1},enableDebug:function(){this._debug=!0},enableMapMovementLogging:function(){this._doSniffing=!0},printDebug:function(e){this._debug&&null!=window.console&&(null!=window.console.debug?console.debug(e):null!=window.console.log&&console.log(e))},printWarn:function(e){null!=window.console&&console.warn(e)},registerService:function(e){this._servicesByQName[e.getQName()]=e},getService:function(e){return this._servicesByQName[e]},getMap:function(){return this._map},getSandbox:function(){return this._sandbox},getRequestParameter:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",i=RegExp(t),s=i.exec(window.location.href);return null==s?null:s[1]},getObjectName:function(e){return e.__name},getObjectCreator:function(e){return e._creator},setObjectCreator:function(e,t){e._creator=t},copyObjectCreatorToFrom:function(e,t){e._creator=t._creator}}),Oskari.clazz.category("Oskari.mapframework.core.Core","enhancement-methods",{_doEnhancements:function(e){for(var t=0;e.length>t;t++)e[t].enhance(this)}}),Oskari.clazz.category("Oskari.mapframework.core.Core","feature-key-listener-methods",{_handleCtrlKeyDownRequest:function(){this._ctrlKeyDown=!0},_handleCtrlKeyUpRequest:function(){this._ctrlKeyDown=!1},isCtrlKeyDown:function(){return this._ctrlKeyDown}}),Oskari.clazz.define("Oskari.mapframework.bundle.oskariui.OskariUIBundle",function(){},{create:function(){return this},update:function(){},start:function(){},stop:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.bundle.BundleInstance"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/oskariui/jquery-ui-1.9.1.custom.min.js"},{type:"text/css",src:"../../../../resources/framework/bundle/oskariui/css/jquery-ui-1.9.1.custom.css"}],locales:[]},bundle:{manifest:{"Bundle-Identifier":"oskariui","Bundle-Name":"oskariui","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2012"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("oskariui","Oskari.mapframework.bundle.oskariui.OskariUIBundle"),function(e,t){function i(t,i){var a,r,n,o=t.nodeName.toLowerCase();return"area"===o?(a=t.parentNode,r=a.name,t.href&&r&&"map"===a.nodeName.toLowerCase()?(n=e("img[usemap=#"+r+"]")[0],!!n&&s(n)):!1):(/input|select|textarea|button|object/.test(o)?!t.disabled:"a"===o?t.href||i:i)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().andSelf().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var a=0,r=/^ui-id-\d+$/;e.ui=e.ui||{},e.ui.version||(e.extend(e.ui,{version:"1.9.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,i){return"number"==typeof t?this.each(function(){var s=this;setTimeout(function(){e(s).focus(),i&&i.call(s)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var s,a,r=e(this[0]);r.length&&r[0]!==document;){if(s=r.css("position"),("absolute"===s||"relative"===s||"fixed"===s)&&(a=parseInt(r.css("zIndex"),10),!isNaN(a)&&0!==a))return a;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(i,s){function a(t,i,s,a){return e.each(r,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var r="Width"===s?["Left","Right"]:["Top","Bottom"],n=s.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+s]=function(i){return i===t?o["inner"+s].call(this):this.each(function(){e(this).css(n,a(this,i)+"px")})},e.fn["outer"+s]=function(t,i){return"number"!=typeof t?o["outer"+s].call(this,t):this.each(function(){e(this).css(n,a(this,t,!0,i)+"px")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var s=e.attr(t,"tabindex"),a=isNaN(s);return(a||s>=0)&&i(t,!a)}}),e(function(){var t=document.body,i=t.appendChild(i=document.createElement("div"));i.offsetHeight,e.extend(i.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=100===i.offsetHeight,e.support.selectstart="onselectstart"in i,t.removeChild(i).style.display="none"}),function(){var t=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];e.ui.ie=t.length?!0:!1,e.ui.ie6=6===parseFloat(t[1],10)}(),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,i,s){var a,r=e.ui[t].prototype;for(a in s)r.plugins[a]=r.plugins[a]||[],r.plugins[a].push([i,s[a]])},call:function(e,t,i){var s,a=e.plugins[t];if(a&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(s=0;a.length>s;s++)e.options[a[s][0]]&&a[s][1].apply(e.element,i)}},contains:e.contains,hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",a=!1;return t[s]>0?!0:(t[s]=1,a=t[s]>0,t[s]=0,a)},isOverAxis:function(e,t,i){return e>t&&t+i>e},isOver:function(t,i,s,a,r,n){return e.ui.isOverAxis(t,s,r)&&e.ui.isOverAxis(i,a,n)}}))}(jQuery),function(e,t){var i=0,s=Array.prototype.slice,a=e.cleanData;e.cleanData=function(t){for(var i,s=0;null!=(i=t[s]);s++)try{e(i).triggerHandler("remove")}catch(r){}a(t)},e.widget=function(t,i,s){var a,r,n,o,l=t.split(".")[0];t=t.split(".")[1],a=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][a.toLowerCase()]=function(t){return!!e.data(t,a)},e[l]=e[l]||{},r=e[l][t],n=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new n(e,t)},e.extend(n,r,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),o=new i,o.options=e.widget.extend({},o.options),e.each(s,function(t,a){e.isFunction(a)&&(s[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},s=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,r=this._superApply;return this._super=e,this._superApply=s,t=a.apply(this,arguments),this._super=i,this._superApply=r,t}}())}),n.prototype=e.widget.extend(o,{widgetEventPrefix:o.widgetEventPrefix||t},s,{constructor:n,namespace:l,widgetName:t,widgetBaseClass:a,widgetFullName:a}),r?(e.each(r._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,n,i._proto)}),delete r._childConstructors):i._childConstructors.push(n),e.widget.bridge(t,n)},e.widget.extend=function(i){for(var a,r,n=s.call(arguments,1),o=0,l=n.length;l>o;o++)for(a in n[o])r=n[o][a],n[o].hasOwnProperty(a)&&r!==t&&(i[a]=e.isPlainObject(r)?e.isPlainObject(i[a])?e.widget.extend({},i[a],r):e.widget.extend({},r):r);return i},e.widget.bridge=function(i,a){var r=a.prototype.widgetFullName;e.fn[i]=function(n){var o="string"==typeof n,l=s.call(arguments,1),h=this;return n=!o&&l.length?e.widget.extend.apply(null,[n].concat(l)):n,o?this.each(function(){var s,a=e.data(this,r);return a?e.isFunction(a[n])&&"_"!==n.charAt(0)?(s=a[n].apply(a,l),s!==a&&s!==t?(h=s&&s.jquery?h.pushStack(s.get()):s,!1):void 0):e.error("no such method '"+n+"' for "+i+" widget instance"):e.error("cannot call methods on "+i+" prior to initialization; "+"attempted to call method '"+n+"'")}):this.each(function(){var t=e.data(this,r);t?t.option(n||{})._init():new a(n,this)}),h}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,s){s=e(s||this.defaultElement||this)[0],this.element=e(s),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),s!==this&&(e.data(s,this.widgetName,this),e.data(s,this.widgetFullName,this),this._on(this.element,{remove:function(e){e.target===s&&this.destroy()}}),this.document=e(s.style?s.ownerDocument:s.document||s),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(i,s){var a,r,n,o=i;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof i)if(o={},a=i.split("."),i=a.shift(),a.length){for(r=o[i]=e.widget.extend({},this.options[i]),n=0;a.length-1>n;n++)r[a[n]]=r[a[n]]||{},r=r[a[n]];if(i=a.pop(),s===t)return r[i]===t?null:r[i];r[i]=s}else{if(s===t)return this.options[i]===t?null:this.options[i];o[i]=s}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,i){var s,a=this;i?(t=s=e(t),this.bindings=this.bindings.add(t)):(i=t,t=this.element,s=this.widget()),e.each(i,function(i,r){function n(){return a.options.disabled===!0||e(this).hasClass("ui-state-disabled")?void 0:("string"==typeof r?a[r]:r).apply(a,arguments)}"string"!=typeof r&&(n.guid=r.guid=r.guid||n.guid||e.guid++);var o=i.match(/^(\w+)\s*(.*)$/),l=o[1]+a.eventNamespace,h=o[2];h?s.delegate(h,l,n):t.bind(l,n)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var a,r,n=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],r=i.originalEvent,r)for(a in r)a in i||(i[a]=r[a]);return this.element.trigger(i,s),!(e.isFunction(n)&&n.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,a,r){"string"==typeof a&&(a={effect:a});var n,o=a?a===!0||"number"==typeof a?i:a.effect||i:t;a=a||{},"number"==typeof a&&(a={duration:a}),n=!e.isEmptyObject(a),a.complete=r,a.delay&&s.delay(a.delay),n&&e.effects&&(e.effects.effect[o]||e.uiBackCompat!==!1&&e.effects[o])?s[t](a):o!==t&&s[o]?s[o](a.duration,a.easing,r):s.queue(function(i){e(this)[t](),r&&r.call(s[0]),i()})}}),e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})}(jQuery),function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.9.1",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!t){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var s=this,a=1===i.which,r="string"==typeof this.options.cancel&&i.target.nodeName?e(i.target).closest(this.options.cancel).length:!1;return a&&!r&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){s.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===e.data(i.target,this.widgetName+".preventClickEvent")&&e.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return s._mouseMove(e)},this._mouseUpDelegate=function(e){return s._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return!e.ui.ie||document.documentMode>=9||t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){function i(e,t,i){return[parseInt(e[0],10)*(c.test(e[0])?t/100:1),parseInt(e[1],10)*(c.test(e[1])?i/100:1)]}function s(t,i){return parseInt(e.css(t,i),10)||0}e.ui=e.ui||{};var a,r=Math.max,n=Math.abs,o=Math.round,l=/left|center|right/,h=/top|center|bottom/,u=/[\+\-]\d+%?/,p=/^\w+/,c=/%$/,d=e.fn.position;e.position={scrollbarWidth:function(){if(a!==t)return a;var i,s,r=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),n=r.children()[0];return e("body").append(r),i=n.offsetWidth,r.css("overflow","scroll"),s=n.offsetWidth,i===s&&(s=r[0].clientWidth),r.remove(),a=i-s},getScrollInfo:function(t){var i=t.isWindow?"":t.element.css("overflow-x"),s=t.isWindow?"":t.element.css("overflow-y"),a="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,r="scroll"===s||"auto"===s&&t.height<t.element[0].scrollHeight;return{width:a?e.position.scrollbarWidth():0,height:r?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),s=e.isWindow(i[0]);return{element:i,isWindow:s,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s?i.width():i.outerWidth(),height:s?i.height():i.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return d.apply(this,arguments);t=e.extend({},t);var a,c,m,y,f,g=e(t.of),v=e.position.getWithinInfo(t.within),L=e.position.getScrollInfo(v),b=g[0],O=(t.collision||"flip").split(" "),S={};return 9===b.nodeType?(c=g.width(),m=g.height(),y={top:0,left:0}):e.isWindow(b)?(c=g.width(),m=g.height(),y={top:g.scrollTop(),left:g.scrollLeft()}):b.preventDefault?(t.at="left top",c=m=0,y={top:b.pageY,left:b.pageX}):(c=g.outerWidth(),m=g.outerHeight(),y=g.offset()),f=e.extend({},y),e.each(["my","at"],function(){var e,i,s=(t[this]||"").split(" ");1===s.length&&(s=l.test(s[0])?s.concat(["center"]):h.test(s[0])?["center"].concat(s):["center","center"]),s[0]=l.test(s[0])?s[0]:"center",s[1]=h.test(s[1])?s[1]:"center",e=u.exec(s[0]),i=u.exec(s[1]),S[this]=[e?e[0]:0,i?i[0]:0],t[this]=[p.exec(s[0])[0],p.exec(s[1])[0]]}),1===O.length&&(O[1]=O[0]),"right"===t.at[0]?f.left+=c:"center"===t.at[0]&&(f.left+=c/2),"bottom"===t.at[1]?f.top+=m:"center"===t.at[1]&&(f.top+=m/2),a=i(S.at,c,m),f.left+=a[0],f.top+=a[1],this.each(function(){var l,h,u=e(this),p=u.outerWidth(),d=u.outerHeight(),b=s(this,"marginLeft"),w=s(this,"marginTop"),_=p+b+s(this,"marginRight")+L.width,x=d+w+s(this,"marginBottom")+L.height,k=e.extend({},f),C=i(S.my,u.outerWidth(),u.outerHeight());"right"===t.my[0]?k.left-=p:"center"===t.my[0]&&(k.left-=p/2),"bottom"===t.my[1]?k.top-=d:"center"===t.my[1]&&(k.top-=d/2),k.left+=C[0],k.top+=C[1],e.support.offsetFractions||(k.left=o(k.left),k.top=o(k.top)),l={marginLeft:b,marginTop:w},e.each(["left","top"],function(i,s){e.ui.position[O[i]]&&e.ui.position[O[i]][s](k,{targetWidth:c,targetHeight:m,elemWidth:p,elemHeight:d,collisionPosition:l,collisionWidth:_,collisionHeight:x,offset:[a[0]+C[0],a[1]+C[1]],my:t.my,at:t.at,within:v,elem:u})}),e.fn.bgiframe&&u.bgiframe(),t.using&&(h=function(e){var i=y.left-k.left,s=i+c-p,a=y.top-k.top,o=a+m-d,l={target:{element:g,left:y.left,top:y.top,width:c,height:m},element:{element:u,left:k.left,top:k.top,width:p,height:d},horizontal:0>s?"left":i>0?"right":"center",vertical:0>o?"top":a>0?"bottom":"middle"};p>c&&c>n(i+s)&&(l.horizontal="center"),d>m&&m>n(a+o)&&(l.vertical="middle"),l.important=r(n(i),n(s))>r(n(a),n(o))?"horizontal":"vertical",t.using.call(this,e,l)}),u.offset(e.extend(k,{using:h}))})},e.ui.position={fit:{left:function(e,t){var i,s=t.within,a=s.isWindow?s.scrollLeft:s.offset.left,n=s.width,o=e.left-t.collisionPosition.marginLeft,l=a-o,h=o+t.collisionWidth-n-a;t.collisionWidth>n?l>0&&0>=h?(i=e.left+l+t.collisionWidth-n-a,e.left+=l-i):e.left=h>0&&0>=l?a:l>h?a+n-t.collisionWidth:a:l>0?e.left+=l:h>0?e.left-=h:e.left=r(e.left-o,e.left)},top:function(e,t){var i,s=t.within,a=s.isWindow?s.scrollTop:s.offset.top,n=t.within.height,o=e.top-t.collisionPosition.marginTop,l=a-o,h=o+t.collisionHeight-n-a;t.collisionHeight>n?l>0&&0>=h?(i=e.top+l+t.collisionHeight-n-a,e.top+=l-i):e.top=h>0&&0>=l?a:l>h?a+n-t.collisionHeight:a:l>0?e.top+=l:h>0?e.top-=h:e.top=r(e.top-o,e.top)}},flip:{left:function(e,t){var i,s,a=t.within,r=a.offset.left+a.scrollLeft,o=a.width,l=a.isWindow?a.scrollLeft:a.offset.left,h=e.left-t.collisionPosition.marginLeft,u=h-l,p=h+t.collisionWidth-o-l,c="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,d="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,m=-2*t.offset[0];0>u?(i=e.left+c+d+m+t.collisionWidth-o-r,(0>i||n(u)>i)&&(e.left+=c+d+m)):p>0&&(s=e.left-t.collisionPosition.marginLeft+c+d+m-l,(s>0||p>n(s))&&(e.left+=c+d+m))},top:function(e,t){var i,s,a=t.within,r=a.offset.top+a.scrollTop,o=a.height,l=a.isWindow?a.scrollTop:a.offset.top,h=e.top-t.collisionPosition.marginTop,u=h-l,p=h+t.collisionHeight-o-l,c="top"===t.my[1],d=c?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,m="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,y=-2*t.offset[1];0>u?(s=e.top+d+m+y+t.collisionHeight-o-r,e.top+d+m+y>u&&(0>s||n(u)>s)&&(e.top+=d+m+y)):p>0&&(i=e.top-t.collisionPosition.marginTop+d+m+y-l,e.top+d+m+y>p&&(i>0||p>n(i))&&(e.top+=d+m+y))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,s,a,r,n=document.getElementsByTagName("body")[0],o=document.createElement("div");t=document.createElement(n?"div":"body"),s={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},n&&e.extend(s,{position:"absolute",left:"-1000px",top:"-1000px"});for(r in s)t.style[r]=s[r];t.appendChild(o),i=n||document.documentElement,i.insertBefore(t,i.firstChild),o.style.cssText="position: absolute; left: 10.7432222px;",a=e(o).offset().left,e.support.offsetFractions=a>10&&11>a,t.innerHTML="",i.removeChild(t)}(),e.uiBackCompat!==!1&&function(e){var i=e.fn.position;e.fn.position=function(s){if(!s||!s.offset)return i.call(this,s);var a=s.offset.split(" "),r=s.at.split(" ");return 1===a.length&&(a[1]=a[0]),/^\d/.test(a[0])&&(a[0]="+"+a[0]),/^\d/.test(a[1])&&(a[1]="+"+a[1]),1===r.length&&(/left|center|right/.test(r[0])?r[1]="center":(r[1]=r[0],r[0]="center")),i.call(this,e.extend(s,{at:r[0]+a[0]+" "+r[1]+a[1],offset:t}))}}(jQuery)}(jQuery),function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"==this.options.helper&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(e(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),i.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)
},_mouseDrag:function(t,i){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",t,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(i=e.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1);for(var s=this.element[0],a=!1;s&&(s=s.parentNode);)s==document&&(a=!0);if(!a&&"original"===this.options.helper)return!1;if("invalid"==this.options.revert&&!i||"valid"==this.options.revert&&i||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)){var r=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){r._trigger("stop",t)!==!1&&r._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var i=this.options.handle&&e(this.options.handle,this.element).length?!1:!0;return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(i=!0)}),i},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):"clone"==i.helper?this.element.clone().removeAttr("id"):this.element;return s.parents("body").length||s.appendTo("parent"==i.appendTo?this.element[0].parentNode:i.appendTo),s[0]!=this.element[0]&&!/(fixed|absolute)/.test(s.css("position"))&&s.css("position","absolute"),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=["document"==t.containment?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"==t.containment?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"==t.containment?0:e(window).scrollLeft())+e("document"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==t.containment?0:e(window).scrollTop())+(e("document"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(t.containment)||t.containment.constructor==Array)t.containment.constructor==Array&&(this.containment=t.containment);else{var i=e(t.containment),s=i[0];if(!s)return;var a=(i.offset(),"hidden"!=e(s).css("overflow"));this.containment=[(parseInt(e(s).css("borderLeftWidth"),10)||0)+(parseInt(e(s).css("paddingLeft"),10)||0),(parseInt(e(s).css("borderTopWidth"),10)||0)+(parseInt(e(s).css("paddingTop"),10)||0),(a?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(e(s).css("borderLeftWidth"),10)||0)-(parseInt(e(s).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(a?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(e(s).css("borderTopWidth"),10)||0)-(parseInt(e(s).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i}},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"==t?1:-1,a=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),r=/(html|body)/i.test(a[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:a.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:a.scrollLeft())*s}},_generatePosition:function(t){var i=this.options,s="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(s[0].tagName),r=t.pageX,n=t.pageY;if(this.originalPosition){var o;if(this.containment){if(this.relative_container){var l=this.relative_container.offset();o=[this.containment[0]+l.left,this.containment[1]+l.top,this.containment[2]+l.left,this.containment[3]+l.top]}else o=this.containment;t.pageX-this.offset.click.left<o[0]&&(r=o[0]+this.offset.click.left),t.pageY-this.offset.click.top<o[1]&&(n=o[1]+this.offset.click.top),t.pageX-this.offset.click.left>o[2]&&(r=o[2]+this.offset.click.left),t.pageY-this.offset.click.top>o[3]&&(n=o[3]+this.offset.click.top)}if(i.grid){var h=i.grid[1]?this.originalPageY+Math.round((n-this.originalPageY)/i.grid[1])*i.grid[1]:this.originalPageY;n=o?h-this.offset.click.top<o[1]||h-this.offset.click.top>o[3]?h-this.offset.click.top<o[1]?h+i.grid[1]:h-i.grid[1]:h:h;var u=i.grid[0]?this.originalPageX+Math.round((r-this.originalPageX)/i.grid[0])*i.grid[0]:this.originalPageX;r=o?u-this.offset.click.left<o[0]||u-this.offset.click.left>o[2]?u-this.offset.click.left<o[0]?u+i.grid[0]:u-i.grid[0]:u:u}}return{top:n-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():a?0:s.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():a?0:s.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s]),"drag"==t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var s=e(this).data("draggable"),a=s.options,r=e.extend({},i,{item:s.element});s.sortables=[],e(a.connectToSortable).each(function(){var i=e.data(this,"sortable");i&&!i.options.disabled&&(s.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,r))})},stop:function(t,i){var s=e(this).data("draggable"),a=e.extend({},i,{item:s.element});e.each(s.sortables,function(){this.instance.isOver?(this.instance.isOver=0,s.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"==s.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,a))})},drag:function(t,i){var s=e(this).data("draggable"),a=this;e.each(s.sortables,function(){var r=!1,n=this;this.instance.positionAbs=s.positionAbs,this.instance.helperProportions=s.helperProportions,this.instance.offset.click=s.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(r=!0,e.each(s.sortables,function(){return this.instance.positionAbs=s.positionAbs,this.instance.helperProportions=s.helperProportions,this.instance.offset.click=s.offset.click,this!=n&&this.instance._intersectsWith(this.instance.containerCache)&&e.ui.contains(n.instance.element[0],this.instance.element[0])&&(r=!1),r})),r?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(a).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=s.offset.click.top,this.instance.offset.click.left=s.offset.click.left,this.instance.offset.parent.left-=s.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=s.offset.parent.top-this.instance.offset.parent.top,s._trigger("toSortable",t),s.dropped=this.instance.element,s.currentItem=s.element,this.instance.fromOutside=s),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),s._trigger("fromSortable",t),s.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),i=e(this).data("draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=e(this).data("draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i){var s=e(i.helper),a=e(this).data("draggable").options;s.css("opacity")&&(a._opacity=s.css("opacity")),s.css("opacity",a.opacity)},stop:function(t,i){var s=e(this).data("draggable").options;s._opacity&&e(i.helper).css("opacity",s._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("draggable");t.scrollParent[0]!=document&&"HTML"!=t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data("draggable"),s=i.options,a=!1;i.scrollParent[0]!=document&&"HTML"!=i.scrollParent[0].tagName?(s.axis&&"x"==s.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<s.scrollSensitivity?i.scrollParent[0].scrollTop=a=i.scrollParent[0].scrollTop+s.scrollSpeed:t.pageY-i.overflowOffset.top<s.scrollSensitivity&&(i.scrollParent[0].scrollTop=a=i.scrollParent[0].scrollTop-s.scrollSpeed)),s.axis&&"y"==s.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<s.scrollSensitivity?i.scrollParent[0].scrollLeft=a=i.scrollParent[0].scrollLeft+s.scrollSpeed:t.pageX-i.overflowOffset.left<s.scrollSensitivity&&(i.scrollParent[0].scrollLeft=a=i.scrollParent[0].scrollLeft-s.scrollSpeed))):(s.axis&&"x"==s.axis||(t.pageY-e(document).scrollTop()<s.scrollSensitivity?a=e(document).scrollTop(e(document).scrollTop()-s.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<s.scrollSensitivity&&(a=e(document).scrollTop(e(document).scrollTop()+s.scrollSpeed))),s.axis&&"y"==s.axis||(t.pageX-e(document).scrollLeft()<s.scrollSensitivity?a=e(document).scrollLeft(e(document).scrollLeft()-s.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<s.scrollSensitivity&&(a=e(document).scrollLeft(e(document).scrollLeft()+s.scrollSpeed)))),a!==!1&&e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("draggable"),i=t.options;t.snapElements=[],e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var i=e(this),s=i.offset();this!=t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:s.top,left:s.left})})},drag:function(t,i){for(var s=e(this).data("draggable"),a=s.options,r=a.snapTolerance,n=i.offset.left,o=n+s.helperProportions.width,l=i.offset.top,h=l+s.helperProportions.height,u=s.snapElements.length-1;u>=0;u--){var p=s.snapElements[u].left,c=p+s.snapElements[u].width,d=s.snapElements[u].top,m=d+s.snapElements[u].height;if(n>p-r&&c+r>n&&l>d-r&&m+r>l||n>p-r&&c+r>n&&h>d-r&&m+r>h||o>p-r&&c+r>o&&l>d-r&&m+r>l||o>p-r&&c+r>o&&h>d-r&&m+r>h){if("inner"!=a.snapMode){var y=r>=Math.abs(d-h),f=r>=Math.abs(m-l),g=r>=Math.abs(p-o),v=r>=Math.abs(c-n);y&&(i.position.top=s._convertPositionTo("relative",{top:d-s.helperProportions.height,left:0}).top-s.margins.top),f&&(i.position.top=s._convertPositionTo("relative",{top:m,left:0}).top-s.margins.top),g&&(i.position.left=s._convertPositionTo("relative",{top:0,left:p-s.helperProportions.width}).left-s.margins.left),v&&(i.position.left=s._convertPositionTo("relative",{top:0,left:c}).left-s.margins.left)}var L=y||f||g||v;if("outer"!=a.snapMode){var y=r>=Math.abs(d-l),f=r>=Math.abs(m-h),g=r>=Math.abs(p-n),v=r>=Math.abs(c-o);y&&(i.position.top=s._convertPositionTo("relative",{top:d,left:0}).top-s.margins.top),f&&(i.position.top=s._convertPositionTo("relative",{top:m-s.helperProportions.height,left:0}).top-s.margins.top),g&&(i.position.left=s._convertPositionTo("relative",{top:0,left:p}).left-s.margins.left),v&&(i.position.left=s._convertPositionTo("relative",{top:0,left:c-s.helperProportions.width}).left-s.margins.left)}!s.snapElements[u].snapping&&(y||f||g||v||L)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[u].item})),s.snapElements[u].snapping=y||f||g||v||L}else s.snapElements[u].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[u].item})),s.snapElements[u].snapping=!1}}}),e.ui.plugin.add("draggable","stack",{start:function(){var t=e(this).data("draggable").options,i=e.makeArray(e(t.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});if(i.length){var s=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=s+e}),this[0].style.zIndex=s+i.length}}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i){var s=e(i.helper),a=e(this).data("draggable").options;s.css("zIndex")&&(a._zIndex=s.css("zIndex")),s.css("zIndex",a.zIndex)},stop:function(t,i){var s=e(this).data("draggable").options;s._zIndex&&e(i.helper).css("zIndex",s._zIndex)}})}(jQuery),function(e){e.widget("ui.droppable",{version:"1.9.1",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,i=t.accept;this.isover=0,this.isout=1,this.accept=e.isFunction(i)?i:function(e){return e.is(i)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var t=e.ui.ddmanager.droppables[this.options.scope],i=0;t.length>i;i++)t[i]==this&&t.splice(i,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){"accept"==t&&(this.accept=e.isFunction(i)?i:function(e){return e.is(i)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var s=i||e.ui.ddmanager.current;if(!s||(s.currentItem||s.element)[0]==this.element[0])return!1;var a=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");return t.options.greedy&&!t.options.disabled&&t.options.scope==s.options.scope&&t.accept.call(t.element[0],s.currentItem||s.element)&&e.ui.intersect(s,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)?(a=!0,!1):void 0}),a?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(s)),this.element):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(t,i,s){if(!i.offset)return!1;var a=(t.positionAbs||t.position.absolute).left,r=a+t.helperProportions.width,n=(t.positionAbs||t.position.absolute).top,o=n+t.helperProportions.height,l=i.offset.left,h=l+i.proportions.width,u=i.offset.top,p=u+i.proportions.height;switch(s){case"fit":return a>=l&&h>=r&&n>=u&&p>=o;case"intersect":return a+t.helperProportions.width/2>l&&h>r-t.helperProportions.width/2&&n+t.helperProportions.height/2>u&&p>o-t.helperProportions.height/2;case"pointer":var c=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,d=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,m=e.ui.isOver(d,c,u,l,i.proportions.height,i.proportions.width);return m;case"touch":return(n>=u&&p>=n||o>=u&&p>=o||u>n&&o>p)&&(a>=l&&h>=a||r>=l&&h>=r||l>a&&r>h);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var s=e.ui.ddmanager.droppables[t.options.scope]||[],a=i?i.type:null,r=(t.currentItem||t.element).find(":data(droppable)").andSelf();e:for(var n=0;s.length>n;n++)if(!(s[n].options.disabled||t&&!s[n].accept.call(s[n].element[0],t.currentItem||t.element))){for(var o=0;r.length>o;o++)if(r[o]==s[n].element[0]){s[n].proportions.height=0;continue e}s[n].visible="none"!=s[n].element.css("display"),s[n].visible&&("mousedown"==a&&s[n]._activate.call(s[n],i),s[n].offset=s[n].element.offset(),s[n].proportions={width:s[n].element[0].offsetWidth,height:s[n].element[0].offsetHeight})}},drop:function(t,i){var s=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,i)))}),s},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s=e.ui.intersect(t,this,this.options.tolerance),a=s||1!=this.isover?s&&0==this.isover?"isover":null:"isout";if(a){var r;if(this.options.greedy){var n=this.options.scope,o=this.element.parents(":data(droppable)").filter(function(){return e.data(this,"droppable").options.scope===n});o.length&&(r=e.data(o[0],"droppable"),r.greedyChild="isover"==a?1:0)}r&&"isover"==a&&(r.isover=0,r.isout=1,r._out.call(r,i)),this[a]=1,this["isout"==a?"isover":"isout"]=0,this["isover"==a?"_over":"_out"].call(this,i),r&&"isout"==a&&(r.isout=0,r.isover=1,r._over.call(r,i))}}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}}}(jQuery),function(e){e.widget("ui.resizable",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var t=this,i=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=i.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor==String){"all"==this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw");var s=this.handles.split(",");this.handles={};for(var a=0;s.length>a;a++){var r=e.trim(s[a]),n="ui-resizable-"+r,o=e('<div class="ui-resizable-handle '+n+'"></div>');o.css({zIndex:i.zIndex}),"se"==r&&o.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(o)}}this._renderAxis=function(t){t=t||this.element;for(var i in this.handles){if(this.handles[i].constructor==String&&(this.handles[i]=e(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var s=e(this.handles[i],this.element),a=0;a=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth();var r=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join("");t.css(r,a),this._proportionallyResize()}e(this.handles[i]).length}},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!t.resizing){if(this.className)var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);t.axis=e&&e[1]?e[1]:"se"}}),i.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){i.disabled||(e(this).removeClass("ui-resizable-autohide"),t._handles.show())}).mouseleave(function(){i.disabled||t.resizing||(e(this).addClass("ui-resizable-autohide"),t._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){t(this.element);var i=this.element;this.originalElement.css({position:i.css("position"),width:i.outerWidth(),height:i.outerHeight(),top:i.css("top"),left:i.css("left")}).insertAfter(i),i.remove()}return this.originalElement.css("resize",this.originalResizeStyle),t(this.originalElement),this},_mouseCapture:function(t){var i=!1;for(var s in this.handles)e(this.handles[s])[0]==t.target&&(i=!0);return!this.options.disabled&&i},_mouseStart:function(i){var s=this.options,a=this.element.position(),r=this.element;this.resizing=!0,this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()},(r.is(".ui-draggable")||/absolute/.test(r.css("position")))&&r.css({position:"absolute",top:a.top,left:a.left}),this._renderProxy();var n=t(this.helper.css("left")),o=t(this.helper.css("top"));s.containment&&(n+=e(s.containment).scrollLeft()||0,o+=e(s.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:n,top:o},this.size=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.originalSize=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.originalPosition={left:n,top:o},this.sizeDiff={width:r.outerWidth()-r.width(),height:r.outerHeight()-r.height()},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio="number"==typeof s.aspectRatio?s.aspectRatio:this.originalSize.width/this.originalSize.height||1;var l=e(".ui-resizable-"+this.axis).css("cursor");return e("body").css("cursor","auto"==l?this.axis+"-resize":l),r.addClass("ui-resizable-resizing"),this._propagate("start",i),!0},_mouseDrag:function(e){var t=this.helper,i=(this.options,this.originalMousePosition),s=this.axis,a=e.pageX-i.left||0,r=e.pageY-i.top||0,n=this._change[s];if(!n)return!1;var o=n.apply(this,[e,a,r]);return this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(o=this._updateRatio(o,e)),o=this._respectSize(o,e),this._propagate("resize",e),t.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(o),this._trigger("resize",e,this.ui()),!1},_mouseStop:function(t){this.resizing=!1;var i=this.options,s=this;if(this._helper){var a=this._proportionallyResizeElements,r=a.length&&/textarea/i.test(a[0].nodeName),n=r&&e.ui.hasScroll(a[0],"left")?0:s.sizeDiff.height,o=r?0:s.sizeDiff.width,l={width:s.helper.width()-o,height:s.helper.height()-n},h=parseInt(s.element.css("left"),10)+(s.position.left-s.originalPosition.left)||null,u=parseInt(s.element.css("top"),10)+(s.position.top-s.originalPosition.top)||null;i.animate||this.element.css(e.extend(l,{top:u,left:h})),s.helper.height(s.size.height),s.helper.width(s.size.width),this._helper&&!i.animate&&this._proportionallyResize()}return e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,s,a,r,n,o=this.options;n={minWidth:i(o.minWidth)?o.minWidth:0,maxWidth:i(o.maxWidth)?o.maxWidth:1/0,minHeight:i(o.minHeight)?o.minHeight:0,maxHeight:i(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=n.minHeight*this.aspectRatio,a=n.minWidth/this.aspectRatio,s=n.maxHeight*this.aspectRatio,r=n.maxWidth/this.aspectRatio,t>n.minWidth&&(n.minWidth=t),a>n.minHeight&&(n.minHeight=a),n.maxWidth>s&&(n.maxWidth=s),n.maxHeight>r&&(n.maxHeight=r)),this._vBoundaries=n},_updateCache:function(e){this.options,this.offset=this.helper.offset(),i(e.left)&&(this.position.left=e.left),i(e.top)&&(this.position.top=e.top),i(e.height)&&(this.size.height=e.height),i(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=(this.options,this.position),s=this.size,a=this.axis;return i(e.height)?e.width=e.height*this.aspectRatio:i(e.width)&&(e.height=e.width/this.aspectRatio),"sw"==a&&(e.left=t.left+(s.width-e.width),e.top=null),"nw"==a&&(e.top=t.top+(s.height-e.height),e.left=t.left+(s.width-e.width)),e},_respectSize:function(e,t){var s=(this.helper,this._vBoundaries),a=(this._aspectRatio||t.shiftKey,this.axis),r=i(e.width)&&s.maxWidth&&s.maxWidth<e.width,n=i(e.height)&&s.maxHeight&&s.maxHeight<e.height,o=i(e.width)&&s.minWidth&&s.minWidth>e.width,l=i(e.height)&&s.minHeight&&s.minHeight>e.height;o&&(e.width=s.minWidth),l&&(e.height=s.minHeight),r&&(e.width=s.maxWidth),n&&(e.height=s.maxHeight);var h=this.originalPosition.left+this.originalSize.width,u=this.position.top+this.size.height,p=/sw|nw|w/.test(a),c=/nw|ne|n/.test(a);o&&p&&(e.left=h-s.minWidth),r&&p&&(e.left=h-s.maxWidth),l&&c&&(e.top=u-s.minHeight),n&&c&&(e.top=u-s.maxHeight);var d=!e.width&&!e.height;return d&&!e.left&&e.top?e.top=null:d&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){if(this.options,this._proportionallyResizeElements.length)for(var t=this.helper||this.element,i=0;this._proportionallyResizeElements.length>i;i++){var s=this._proportionallyResizeElements[i];if(!this.borderDif){var a=[s.css("borderTopWidth"),s.css("borderRightWidth"),s.css("borderBottomWidth"),s.css("borderLeftWidth")],r=[s.css("paddingTop"),s.css("paddingRight"),s.css("paddingBottom"),s.css("paddingLeft")];this.borderDif=e.map(a,function(e,t){var i=parseInt(e,10)||0,s=parseInt(r[t],10)||0;return i+s})}s.css({height:t.height()-this.borderDif[0]-this.borderDif[2]||0,width:t.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var t=this.element,i=this.options;if(this.elementOffset=t.offset(),this._helper){this.helper=this.helper||e('<div style="overflow:hidden;"></div>');var s=e.ui.ie6?1:0,a=e.ui.ie6?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+a,height:this.element.outerHeight()+a,position:"absolute",left:this.elementOffset.left-s+"px",top:this.elementOffset.top-s+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=(this.options,this.originalSize),s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,i){var s=(this.options,this.originalSize),a=this.originalPosition;return{top:a.top+i,height:s.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},sw:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,s]))},ne:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},nw:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,s]))
}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!=t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("resizable"),i=t.options,s=function(t){e(t).each(function(){var t=e(this);t.data("resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?s(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],s(i.alsoResize)):e.each(i.alsoResize,function(e){s(e)})},resize:function(t,i){var s=e(this).data("resizable"),a=s.options,r=s.originalSize,n=s.originalPosition,o={height:s.size.height-r.height||0,width:s.size.width-r.width||0,top:s.position.top-n.top||0,left:s.position.left-n.left||0},l=function(t,s){e(t).each(function(){var t=e(this),a=e(this).data("resizable-alsoresize"),r={},n=s&&s.length?s:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(n,function(e,t){var i=(a[t]||0)+(o[t]||0);i&&i>=0&&(r[t]=i||null)}),t.css(r)})};"object"!=typeof a.alsoResize||a.alsoResize.nodeType?l(a.alsoResize):e.each(a.alsoResize,function(e,t){l(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).data("resizable"),s=i.options,a=i._proportionallyResizeElements,r=a.length&&/textarea/i.test(a[0].nodeName),n=r&&e.ui.hasScroll(a[0],"left")?0:i.sizeDiff.height,o=r?0:i.sizeDiff.width,l={width:i.size.width-o,height:i.size.height-n},h=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,u=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,u&&h?{top:u,left:h}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};a&&a.length&&e(a[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var i=e(this).data("resizable"),s=i.options,a=i.element,r=s.containment,n=r instanceof e?r.get(0):/parent/.test(r)?a.parent().get(0):r;if(n)if(i.containerElement=e(n),/document/.test(r)||r==document)i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight};else{var o=e(n),l=[];e(["Top","Right","Left","Bottom"]).each(function(e,i){l[e]=t(o.css("padding"+i))}),i.containerOffset=o.offset(),i.containerPosition=o.position(),i.containerSize={height:o.innerHeight()-l[3],width:o.innerWidth()-l[1]};var h=i.containerOffset,u=i.containerSize.height,p=i.containerSize.width,c=e.ui.hasScroll(n,"left")?n.scrollWidth:p,d=e.ui.hasScroll(n)?n.scrollHeight:u;i.parentData={element:n,left:h.left,top:h.top,width:c,height:d}}},resize:function(t){var i=e(this).data("resizable"),s=i.options,a=(i.containerSize,i.containerOffset),r=(i.size,i.position),n=i._aspectRatio||t.shiftKey,o={top:0,left:0},l=i.containerElement;l[0]!=document&&/static/.test(l.css("position"))&&(o=a),r.left<(i._helper?a.left:0)&&(i.size.width=i.size.width+(i._helper?i.position.left-a.left:i.position.left-o.left),n&&(i.size.height=i.size.width/i.aspectRatio),i.position.left=s.helper?a.left:0),r.top<(i._helper?a.top:0)&&(i.size.height=i.size.height+(i._helper?i.position.top-a.top:i.position.top),n&&(i.size.width=i.size.height*i.aspectRatio),i.position.top=i._helper?a.top:0),i.offset.left=i.parentData.left+i.position.left,i.offset.top=i.parentData.top+i.position.top;var h=Math.abs((i._helper?i.offset.left-o.left:i.offset.left-o.left)+i.sizeDiff.width),u=Math.abs((i._helper?i.offset.top-o.top:i.offset.top-a.top)+i.sizeDiff.height),p=i.containerElement.get(0)==i.element.parent().get(0),c=/relative|absolute/.test(i.containerElement.css("position"));p&&c&&(h-=i.parentData.left),h+i.size.width>=i.parentData.width&&(i.size.width=i.parentData.width-h,n&&(i.size.height=i.size.width/i.aspectRatio)),u+i.size.height>=i.parentData.height&&(i.size.height=i.parentData.height-u,n&&(i.size.width=i.size.height*i.aspectRatio))},stop:function(){var t=e(this).data("resizable"),i=t.options,s=(t.position,t.containerOffset),a=t.containerPosition,r=t.containerElement,n=e(t.helper),o=n.offset(),l=n.outerWidth()-t.sizeDiff.width,h=n.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(r.css("position"))&&e(this).css({left:o.left-a.left-s.left,width:l,height:h}),t._helper&&!i.animate&&/static/.test(r.css("position"))&&e(this).css({left:o.left-a.left-s.left,width:l,height:h})}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("resizable"),i=t.options,s=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("resizable");t.options,t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("resizable");t.options,t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(t){var i=e(this).data("resizable"),s=i.options,a=i.size,r=i.originalSize,n=i.originalPosition,o=i.axis;s._aspectRatio||t.shiftKey,s.grid="number"==typeof s.grid?[s.grid,s.grid]:s.grid;var l=Math.round((a.width-r.width)/(s.grid[0]||1))*(s.grid[0]||1),h=Math.round((a.height-r.height)/(s.grid[1]||1))*(s.grid[1]||1);/^(se|s|e)$/.test(o)?(i.size.width=r.width+l,i.size.height=r.height+h):/^(ne)$/.test(o)?(i.size.width=r.width+l,i.size.height=r.height+h,i.position.top=n.top-h):/^(sw)$/.test(o)?(i.size.width=r.width+l,i.size.height=r.height+h,i.position.left=n.left-l):(i.size.width=r.width+l,i.size.height=r.height+h,i.position.top=n.top-h,i.position.left=n.left-l)}});var t=function(e){return parseInt(e,10)||0},i=function(e){return!isNaN(parseInt(e,10))}}(jQuery),function(e){e.widget("ui.selectable",e.ui.mouse,{version:"1.9.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var t=this;this.element.addClass("ui-selectable"),this.dragged=!1;var i;this.refresh=function(){i=e(t.options.filter,t.element[0]),i.addClass("ui-selectee"),i.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=i.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this;if(this.opos=[t.pageX,t.pageY],!this.options.disabled){var s=this.options;this.selectees=e(s.filter,this.element[0]),this._trigger("start",t),e(s.appendTo).append(this.helper),this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=e.data(this,"selectable-item");s.startselected=!0,!t.metaKey&&!t.ctrlKey&&(s.$element.removeClass("ui-selected"),s.selected=!1,s.$element.addClass("ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",t,{unselecting:s.element}))}),e(t.target).parents().andSelf().each(function(){var s=e.data(this,"selectable-item");if(s){var a=!t.metaKey&&!t.ctrlKey||!s.$element.hasClass("ui-selected");return s.$element.removeClass(a?"ui-unselecting":"ui-selected").addClass(a?"ui-selecting":"ui-unselecting"),s.unselecting=!a,s.selecting=a,s.selected=a,a?i._trigger("selecting",t,{selecting:s.element}):i._trigger("unselecting",t,{unselecting:s.element}),!1}})}},_mouseDrag:function(t){var i=this;if(this.dragged=!0,!this.options.disabled){var s=this.options,a=this.opos[0],r=this.opos[1],n=t.pageX,o=t.pageY;if(a>n){var l=n;n=a,a=l}if(r>o){var l=o;o=r,r=l}return this.helper.css({left:a,top:r,width:n-a,height:o-r}),this.selectees.each(function(){var l=e.data(this,"selectable-item");if(l&&l.element!=i.element[0]){var h=!1;"touch"==s.tolerance?h=!(l.left>n||a>l.right||l.top>o||r>l.bottom):"fit"==s.tolerance&&(h=l.left>a&&n>l.right&&l.top>r&&o>l.bottom),h?(l.selected&&(l.$element.removeClass("ui-selected"),l.selected=!1),l.unselecting&&(l.$element.removeClass("ui-unselecting"),l.unselecting=!1),l.selecting||(l.$element.addClass("ui-selecting"),l.selecting=!0,i._trigger("selecting",t,{selecting:l.element}))):(l.selecting&&((t.metaKey||t.ctrlKey)&&l.startselected?(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.$element.addClass("ui-selected"),l.selected=!0):(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.startselected&&(l.$element.addClass("ui-unselecting"),l.unselecting=!0),i._trigger("unselecting",t,{unselecting:l.element}))),l.selected&&!t.metaKey&&!t.ctrlKey&&!l.startselected&&(l.$element.removeClass("ui-selected"),l.selected=!1,l.$element.addClass("ui-unselecting"),l.unselecting=!0,i._trigger("unselecting",t,{unselecting:l.element})))}}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,this.options,e(".ui-unselecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",t,{unselected:s.element})}),e(".ui-selecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-selecting").addClass("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",t,{selected:s.element})}),this._trigger("stop",t),this.helper.remove(),!1}})}(jQuery),function(e){e.widget("ui.sortable",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,i){"disabled"===t?(this.options[t]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){var s=this;if(this.reverting)return!1;if(this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(t);var a=null;if(e(t.target).parents().each(function(){return e.data(this,s.widgetName+"-item")==s?(a=e(this),!1):void 0}),e.data(t.target,s.widgetName+"-item")==s&&(a=e(t.target)),!a)return!1;if(this.options.handle&&!i){var r=!1;if(e(this.options.handle,a).find("*").andSelf().each(function(){this==t.target&&(r=!0)}),!r)return!1}return this.currentItem=a,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,i,s){var a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",a.cursor)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(var r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!a.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var i=this.options,s=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-this.overflowOffset.top<i.scrollSensitivity&&(this.scrollParent[0].scrollTop=s=this.scrollParent[0].scrollTop-i.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-this.overflowOffset.left<i.scrollSensitivity&&(this.scrollParent[0].scrollLeft=s=this.scrollParent[0].scrollLeft-i.scrollSpeed)):(t.pageY-e(document).scrollTop()<i.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed)),t.pageX-e(document).scrollLeft()<i.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed))),s!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(var a=this.items.length-1;a>=0;a--){var r=this.items[a],n=r.item[0],o=this._intersectsWithPointer(r);if(o&&r.instance===this.currentContainer&&n!=this.currentItem[0]&&this.placeholder[1==o?"next":"prev"]()[0]!=n&&!e.contains(this.placeholder[0],n)&&("semi-dynamic"==this.options.type?!e.contains(this.element[0],n):!0)){if(this.direction=1==o?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,a=this.placeholder.offset();this.reverting=!0,e(this.helper).animate({left:a.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:a.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"==this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!=this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+"="),s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,a=s+this.helperProportions.height,r=e.left,n=r+e.width,o=e.top,l=o+e.height,h=this.offset.click.top,u=this.offset.click.left,p=s+h>o&&l>s+h&&t+u>r&&n>t+u;return"pointer"==this.options.tolerance||this.options.forcePointerForContainers||"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>r&&n>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>o&&l>a-this.helperProportions.height/2},_intersectsWithPointer:function(t){var i="x"===this.options.axis||e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),s="y"===this.options.axis||e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),a=i&&s,r=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return a?this.floating?n&&"right"==n||"down"==r?2:1:r&&("down"==r?2:1):!1},_intersectsWithSides:function(t){var i=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),s=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),a=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return this.floating&&r?"right"==r&&s||"left"==r&&!s:a&&("down"==a&&i||"up"==a&&!i)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!=e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!=e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i=[],s=[],a=this._connectWith();if(a&&t)for(var r=a.length-1;r>=0;r--)for(var n=e(a[r]),o=n.length-1;o>=0;o--){var l=e.data(n[o],this.widgetName);l&&l!=this&&!l.options.disabled&&s.push([e.isFunction(l.options.items)?l.options.items.call(l.element):e(l.options.items,l.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),l])}s.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var r=s.length-1;r>=0;r--)s[r][0].each(function(){i.push(this)});return e(i)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]==e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i=this.items,s=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],a=this._connectWith();if(a&&this.ready)for(var r=a.length-1;r>=0;r--)for(var n=e(a[r]),o=n.length-1;o>=0;o--){var l=e.data(n[o],this.widgetName);l&&l!=this&&!l.options.disabled&&(s.push([e.isFunction(l.options.items)?l.options.items.call(l.element[0],t,{item:this.currentItem}):e(l.options.items,l.element),l]),this.containers.push(l))}for(var r=s.length-1;r>=0;r--)for(var h=s[r][1],u=s[r][0],o=0,p=u.length;p>o;o++){var c=e(u[o]);c.data(this.widgetName+"-item",h),i.push({item:c,instance:h,width:0,height:0,left:0,top:0})}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var i=this.items.length-1;i>=0;i--){var s=this.items[i];if(s.instance==this.currentContainer||!this.currentContainer||s.item[0]==this.currentItem[0]){var a=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item;t||(s.width=a.outerWidth(),s.height=a.outerHeight());var r=a.offset();s.left=r.left,s.top=r.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var i=this.containers.length-1;i>=0;i--){var r=this.containers[i].element.offset();this.containers[i].containerCache.left=r.left,this.containers[i].containerCache.top=r.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}return this},_createPlaceholder:function(t){t=t||this;var i=t.options;if(!i.placeholder||i.placeholder.constructor==String){var s=i.placeholder;i.placeholder={element:function(){var i=e(document.createElement(t.currentItem[0].nodeName)).addClass(s||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return s||(i.style.visibility="hidden"),i},update:function(e,a){(!s||i.forcePlaceholderSize)&&(a.height()||a.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),a.width()||a.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}}t.placeholder=e(i.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),i.placeholder.update(t,t.placeholder)},_contactContainers:function(t){for(var i=null,s=null,a=this.containers.length-1;a>=0;a--)if(!e.contains(this.currentItem[0],this.containers[a].element[0]))if(this._intersectsWith(this.containers[a].containerCache)){if(i&&e.contains(this.containers[a].element[0],i.element[0]))continue;i=this.containers[a],s=a}else this.containers[a].containerCache.over&&(this.containers[a]._trigger("out",t,this._uiHash(this)),this.containers[a].containerCache.over=0);if(i)if(1===this.containers.length)this.containers[s]._trigger("over",t,this._uiHash(this)),this.containers[s].containerCache.over=1;else{for(var r=1e4,n=null,o=this.containers[s].floating?"left":"top",l=this.containers[s].floating?"width":"height",h=this.positionAbs[o]+this.offset.click[o],u=this.items.length-1;u>=0;u--)if(e.contains(this.containers[s].element[0],this.items[u].item[0])&&this.items[u].item[0]!=this.currentItem[0]){var p=this.items[u].item.offset()[o],c=!1;Math.abs(p-h)>Math.abs(p+this.items[u][l]-h)&&(c=!0,p+=this.items[u][l]),r>Math.abs(p-h)&&(r=Math.abs(p-h),n=this.items[u],this.direction=c?"up":"down")}if(!n&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[s],n?this._rearrange(t,n,null,!0):this._rearrange(t,null,this.containers[s].element,!0),this._trigger("change",t,this._uiHash()),this.containers[s]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[s]._trigger("over",t,this._uiHash(this)),this.containers[s].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"==i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!=i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(""==s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(""==s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(t.containment)){var i=e(t.containment)[0],s=e(t.containment).offset(),a="hidden"!=e(i).css("overflow");this.containment=[s.left+(parseInt(e(i).css("borderLeftWidth"),10)||0)+(parseInt(e(i).css("paddingLeft"),10)||0)-this.margins.left,s.top+(parseInt(e(i).css("borderTopWidth"),10)||0)+(parseInt(e(i).css("paddingTop"),10)||0)-this.margins.top,s.left+(a?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(e(i).css("borderLeftWidth"),10)||0)-(parseInt(e(i).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,s.top+(a?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(e(i).css("borderTopWidth"),10)||0)-(parseInt(e(i).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"==t?1:-1,a=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),r=/(html|body)/i.test(a[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:a.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:a.scrollLeft())*s}},_generatePosition:function(t){var i=this.options,s="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(s[0].tagName);"relative"==this.cssPosition&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var r=t.pageX,n=t.pageY;if(this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(r=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(n=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(r=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(n=this.containment[3]+this.offset.click.top)),i.grid)){var o=this.originalPageY+Math.round((n-this.originalPageY)/i.grid[1])*i.grid[1];n=this.containment?o-this.offset.click.top<this.containment[1]||o-this.offset.click.top>this.containment[3]?o-this.offset.click.top<this.containment[1]?o+i.grid[1]:o-i.grid[1]:o:o;var l=this.originalPageX+Math.round((r-this.originalPageX)/i.grid[0])*i.grid[0];r=this.containment?l-this.offset.click.left<this.containment[0]||l-this.offset.click.left>this.containment[2]?l-this.offset.click.left<this.containment[0]?l+i.grid[0]:l-i.grid[0]:l:l}return{top:n-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():a?0:s.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():a?0:s.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"==this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var a=this.counter;this._delay(function(){a==this.counter&&this.refreshPositions(!s)})},_clear:function(t,i){this.reverting=!1;var s=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(var a in this._storedCSS)("auto"==this._storedCSS[a]||"static"==this._storedCSS[a])&&(this._storedCSS[a]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!i&&s.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!i&&s.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(i||(s.push(function(e){this._trigger("remove",e,this._uiHash())
}),s.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),s.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer))));for(var a=this.containers.length-1;a>=0;a--)i||s.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[a])),this.containers[a].containerCache.over&&(s.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[a])),this.containers[a].containerCache.over=0);if(this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!i){this._trigger("beforeStop",t,this._uiHash());for(var a=0;s.length>a;a++)s[a].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(i||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!i){for(var a=0;s.length>a;a++)s[a].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}})}(jQuery),function(e){var t=5;e.widget("ui.slider",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var i,s,a=this.options,r=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),n="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",o=[];for(this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(a.disabled?" ui-slider-disabled ui-disabled":"")),this.range=e([]),a.range&&(a.range===!0&&(a.values||(a.values=[this._valueMin(),this._valueMin()]),a.values.length&&2!==a.values.length&&(a.values=[a.values[0],a.values[0]])),this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+("min"===a.range||"max"===a.range?" ui-slider-range-"+a.range:""))),s=a.values&&a.values.length||1,i=r.length;s>i;i++)o.push(n);this.handles=r.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).mouseenter(function(){a.disabled||e(this).addClass("ui-state-hover")}).mouseleave(function(){e(this).removeClass("ui-state-hover")}).focus(function(){a.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")}),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)}),this._on(this.handles,{keydown:function(i){var s,a,r,n,o=e(i.target).data("ui-slider-handle-index");switch(i.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(i.target).addClass("ui-state-active"),s=this._start(i,o),s===!1))return}switch(n=this.options.step,a=r=this.options.values&&this.options.values.length?this.values(o):this.value(),i.keyCode){case e.ui.keyCode.HOME:r=this._valueMin();break;case e.ui.keyCode.END:r=this._valueMax();break;case e.ui.keyCode.PAGE_UP:r=this._trimAlignValue(a+(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.PAGE_DOWN:r=this._trimAlignValue(a-(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(a===this._valueMax())return;r=this._trimAlignValue(a+n);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(a===this._valueMin())return;r=this._trimAlignValue(a-n)}this._slide(i,o,r)},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}),this._refreshValue(),this._animateOff=!1},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,s,a,r,n,o,l,h,u=this,p=this.options;return p.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},s=this._normValueFromMouse(i),a=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(s-u.values(t));a>i&&(a=i,r=e(this),n=t)}),p.range===!0&&this.values(1)===p.min&&(n+=1,r=e(this.handles[n])),o=this._start(t,n),o===!1?!1:(this._mouseSliding=!0,this._handleIndex=n,r.addClass("ui-state-active").focus(),l=r.offset(),h=!e(t.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=h?{left:0,top:0}:{left:t.pageX-l.left-r.width()/2,top:t.pageY-l.top-r.height()/2-(parseInt(r.css("borderTopWidth"),10)||0)-(parseInt(r.css("borderBottomWidth"),10)||0)+(parseInt(r.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,n,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,s,a,r;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/t,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),a=this._valueMax()-this._valueMin(),r=this._valueMin()+s*a,this._trimAlignValue(r)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var s,a,r;this.options.values&&this.options.values.length?(s=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>s||1===t&&s>i)&&(i=s),i!==this.values(t)&&(a=this.values(),a[t]=i,r=this._trigger("slide",e,{handle:this.handles[t],value:i,values:a}),s=this.values(t?0:1),r!==!1&&this.values(t,i,!0))):i!==this.value()&&(r=this._trigger("slide",e,{handle:this.handles[t],value:i}),r!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(t,i){var s,a,r;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),this._change(null,t),void 0;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(s=this.options.values,a=arguments[0],r=0;s.length>r;r+=1)s[r]=this._trimAlignValue(a[r]),this._change(null,r);this._refreshValue()},_setOption:function(t,i){var s,a=0;switch(e.isArray(this.options.values)&&(a=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case"disabled":i?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.prop("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=0;a>s;s+=1)this._change(null,s);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,s;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i},_trimAlignValue:function(e){if(this._valueMin()>=e)return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,s=e-i;return 2*Math.abs(i)>=t&&(s+=i>0?t:-t),parseFloat(s.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,i,s,a,r,n=this.options.range,o=this.options,l=this,h=this._animateOff?!1:o.animate,u={};this.options.values&&this.options.values.length?this.handles.each(function(s){i=100*((l.values(s)-l._valueMin())/(l._valueMax()-l._valueMin())),u["horizontal"===l.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[h?"animate":"css"](u,o.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===s&&l.range.stop(1,1)[h?"animate":"css"]({left:i+"%"},o.animate),1===s&&l.range[h?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:o.animate})):(0===s&&l.range.stop(1,1)[h?"animate":"css"]({bottom:i+"%"},o.animate),1===s&&l.range[h?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:o.animate}))),t=i}):(s=this.value(),a=this._valueMin(),r=this._valueMax(),i=r!==a?100*((s-a)/(r-a)):0,u["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[h?"animate":"css"](u,o.animate),"min"===n&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:i+"%"},o.animate),"max"===n&&"horizontal"===this.orientation&&this.range[h?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:o.animate}),"min"===n&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:i+"%"},o.animate),"max"===n&&"vertical"===this.orientation&&this.range[h?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:o.animate}))}})}(jQuery),function(e){function t(t,i){var s=(t.attr("aria-describedby")||"").split(/\s+/);s.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(s.join(" ")))}function i(t){var i=t.data("ui-tooltip-id"),s=(t.attr("aria-describedby")||"").split(/\s+/),a=e.inArray(i,s);-1!==a&&s.splice(a,1),t.removeData("ui-tooltip-id"),s=e.trim(s.join(" ")),s?t.attr("aria-describedby",s):t.removeAttr("aria-describedby")}var s=0;e.widget("ui.tooltip",{version:"1.9.1",options:{content:function(){return e(this).attr("title")},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flipfit"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(t,i){var s=this;return"disabled"===t?(this[i?"_disable":"_enable"](),this.options[t]=i,void 0):(this._super(t,i),"content"===t&&e.each(this.tooltips,function(e,t){s._updateContent(t)}),void 0)},_disable:function(){var t=this;e.each(this.tooltips,function(i,s){var a=e.Event("blur");a.target=a.currentTarget=s[0],t.close(a,!0)}),this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).andSelf().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var i=this,s=e(t?t.target:this.element).closest(this.options.items);if(s.length)return this.options.track&&s.data("ui-tooltip-id")?(this._find(s).position(e.extend({of:s},this.options.position)),this._off(this.document,"mousemove"),void 0):(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("tooltip-open",!0),t&&"mouseover"===t.type&&s.parents().each(function(){var t;e(this).data("tooltip-open")&&(t=e.Event("blur"),t.target=t.currentTarget=this,i.close(t,!0)),this.title&&(e(this).uniqueId(),i.parents[this.id]={element:this,title:this.title},this.title="")}),this._updateContent(s,t),void 0)},_updateContent:function(e,t){var i,s=this.options.content,a=this;return"string"==typeof s?this._open(t,e,s):(i=s.call(e[0],function(i){e.data("tooltip-open")&&a._delay(function(){this._open(t,e,i)})}),i&&this._open(t,e,i),void 0)},_open:function(i,s,a){function r(e){h.of=e,n.is(":hidden")||n.position(h)}var n,o,l,h=e.extend({},this.options.position);if(a){if(n=this._find(s),n.length)return n.find(".ui-tooltip-content").html(a),void 0;s.is("[title]")&&(i&&"mouseover"===i.type?s.attr("title",""):s.removeAttr("title")),n=this._tooltip(s),t(s,n.attr("id")),n.find(".ui-tooltip-content").html(a),this.options.track&&i&&/^mouse/.test(i.originalEvent.type)?(this._on(this.document,{mousemove:r}),r(i)):n.position(e.extend({of:s},this.options.position)),n.hide(),this._show(n,this.options.show),this.options.show&&this.options.show.delay&&(l=setInterval(function(){n.is(":visible")&&(r(h.of),clearInterval(l))},e.fx.interval)),this._trigger("open",i,{tooltip:n}),o={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var i=e.Event(t);i.currentTarget=s[0],this.close(i,!0)}},remove:function(){this._removeTooltip(n)}},i&&"mouseover"!==i.type||(o.mouseleave="close"),i&&"focusin"!==i.type||(o.focusout="close"),this._on(s,o)}},close:function(t){var s=this,a=e(t?t.currentTarget:this.element),r=this._find(a);this.closing||(a.data("ui-tooltip-title")&&a.attr("title",a.data("ui-tooltip-title")),i(a),r.stop(!0),this._hide(r,this.options.hide,function(){s._removeTooltip(e(this))}),a.removeData("tooltip-open"),this._off(a,"mouseleave focusout keyup"),a[0]!==this.element[0]&&this._off(a,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(e,t){t.element.title=t.title,delete s.parents[e]}),this.closing=!0,this._trigger("close",t,{tooltip:r}),this.closing=!1)},_tooltip:function(t){var i="ui-tooltip-"+s++,a=e("<div>").attr({id:i,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return e("<div>").addClass("ui-tooltip-content").appendTo(a),a.appendTo(this.document[0].body),e.fn.bgiframe&&a.bgiframe(),this.tooltips[i]=t,a},_find:function(t){var i=t.data("ui-tooltip-id");return i?e("#"+i):e()},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(i,s){var a=e.Event("blur");a.target=a.currentTarget=s[0],t.close(a,!0),e("#"+i).remove(),s.data("ui-tooltip-title")&&(s.attr("title",s.data("ui-tooltip-title")),s.removeData("ui-tooltip-title"))})}})}(jQuery),Oskari.clazz.define("Oskari.mapframework.request.base.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/request/request.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"request-base","Bundle-Name":"mapframework.request.base.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.request.Bundle",Title:" mapframework.request.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("request-base","Oskari.mapframework.request.base.Bundle"),Oskari.clazz.define("Oskari.mapframework.request.Request",function(){throw this._creator=null,"mapframework.request.Request should not be used"},{getName:function(){throw"Running default implementation of Request.getName(). implement your own!"},setCreator:function(e){this._creator=e},getCreator:function(){return this._creator}}),Oskari.clazz.define("Oskari.mapframework.domain.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/domain/wmslayer.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/vectorlayer.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/map.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/style.js"},{type:"text/javascript",src:"../../../../sources/framework/domain/user.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"domain","Bundle-Name":"mapframework.domain.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.domain.Bundle",Title:" mapframework.domain.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("domain","Oskari.mapframework.domain.Bundle"),Oskari.clazz.define("Oskari.mapframework.domain.WmsLayer",function(){this._id=null,this._name=null,this._wmsLayerName=null,this._inspireName=null,this._organizationName=null,this._dataUrl=null,this._type=null,this._metaType=null,this._opacity=null,this._featureInfoEnabled=null,this._subLayers=[],this._styles=[],this._description=null,this._wmsUrls=[],this._dataUrl=null,this._legendImage=null,this._maxScale=null,this._minScale=null,this._queryable=null,this._currentStyle=null,this._visible=null,this._queryFormat=null,this._orderNumber=null,this._permissions={},this._geometry=[],this._geometryWKT=null,this._metadataIdentifier=null,this._backendStatus=null},{setGeometryWKT:function(e){this._geometryWKT=e},getGeometryWKT:function(){return this._geometryWKT},setGeometry:function(e){this._geometry=e},getGeometry:function(){return this._geometry},addPermission:function(e,t){this._permissions[e]=t},removePermission:function(e){this._permissions[e]=null,delete this._permissions[e]},getPermission:function(e){return this._permissions[e]},setId:function(e){this._id=e},getId:function(){return this._id},setQueryFormat:function(e){this._queryFormat=e},getQueryFormat:function(){return this._queryFormat},setName:function(e){this._name=e},getName:function(){return this._name},setType:function(e){this._type=e},getType:function(){return this._type},setOpacity:function(e){this._opacity=e},getOpacity:function(){return this._opacity},setDataUrl:function(e){this._dataUrl=e},getDataUrl:function(){return this._dataUrl},setOrganizationName:function(e){this._organizationName=e},getOrganizationName:function(){return this._organizationName},setInspireName:function(e){this._inspireName=e},getInspireName:function(){return this._inspireName},setFeatureInfoEnabled:function(e){this._featureInfoEnabled=e},isFeatureInfoEnabled:function(){return this._featureInfoEnabled===!0?!0:!1},setDescription:function(e){this._description=e},getDescription:function(){return this._description},addSubLayer:function(e){this._subLayers.push(e)},getSubLayers:function(){return this._subLayers},setMaxScale:function(e){this._maxScale=e},getMaxScale:function(){return this._maxScale},setMinScale:function(e){this._minScale=e},getMinScale:function(){return this._minScale},setAsBaseLayer:function(){this._type="BASE_LAYER"},setAsNormalLayer:function(){this._type="NORMAL_LAYER"},setOrderNumber:function(e){this._orderNumber=e},getOrderNumber:function(){return this._orderNumber},setLegendImage:function(e){this._legendImage=e},getLegendImage:function(){return this._legendImage},hasLegendImage:function(){if(this._legendImage)return!0;for(var e=0;this._styles.length>e;++e)if(this._styles[e].getLegend())return!0;return!1},setQueryable:function(e){this._queryable=e},getQueryable:function(){return this._queryable},addWmsUrl:function(e){this._wmsUrls.push(e)},getWmsUrls:function(){return this._wmsUrls},addStyle:function(e){this._styles.push(e)},getStyles:function(){return this._styles},selectStyle:function(e){var t=null;if(!(this._styles.length>0))return t=Oskari.clazz.create("Oskari.mapframework.domain.Style"),t.setName(""),t.setTitle(""),t.setLegend(""),this._currentStyle=t,void 0;if(""===e)return this._styles.length>1?this._currentStyle=this._styles[0]:(t=Oskari.clazz.create("Oskari.mapframework.domain.Style"),t.setName(""),t.setTitle(""),t.setLegend(""),this._currentStyle=t),void 0;for(var i=0;this._styles.length>i;i++)if(t=this._styles[i],t.getName()==e)return this._currentStyle=t,void 0;t=Oskari.clazz.create("Oskari.mapframework.domain.Style"),t.setName(""),t.setTitle(""),t.setLegend(""),this._currentStyle=t},getCurrentStyle:function(){return this._currentStyle},setWmsName:function(e){this._wmsName=e},getWmsName:function(){return this._wmsName},setMetaType:function(e){this._metaType=e},getMetaType:function(){return this._metaType},setAsGroupLayer:function(){this._type="GROUP_LAYER"},isGroupLayer:function(){return"GROUP_LAYER"===this._type},isBaseLayer:function(){return"BASE_LAYER"===this._type},isVisible:function(){return this._visible===!0},setVisible:function(e){this._visible=e},isInScale:function(e){var t=this.isBaseLayer();if(!e){var i=Oskari.$().sandbox;e=i.getMap().getScale()}return this.isBaseLayer()||((e>this.getMaxScale()||!this.getMaxScale())&&this.getMinScale()>e||!this.getMinScale())&&(t=!0),t},isLayerOfType:function(e){return"WMS"===e||"wms"===e},getMetadataIdentifier:function(){return this._metadataIdentifier},setMetadataIdentifier:function(e){this._metadataIdentifier=e},getBackendStatus:function(){return this._backendStatus},setBackendStatus:function(e){this._backendStatus=e}}),Oskari.clazz.define("Oskari.mapframework.domain.VectorLayer",function(){this._id=null,this._type=null,this._opacity=null,this._inspireName=null,this._organizationName=null,this._dataUrl=null,this._subLayers=[],this._description=null,this._name=null,this._maxScale=null,this._minScale=null,this._sldspec=null,this._orderNumber=null,this._featureInfoEnabled=!0,this._metaType=null,this._permissions={},this._geometry=[],this._geometryWKT=null,this._visible=!0,this._metadataIdentifier=null,this._backendStatus=null},{setGeometryWKT:function(e){this._geometryWKT=e},getGeometryWKT:function(){return this._geometryWKT},setGeometry:function(e){this._geometry=e},getGeometry:function(){return this._geometry},addPermission:function(e,t){this._permissions[e]=t},removePermission:function(e){this._permissions[e]=null},getPermission:function(e){return this._permissions[e]},setId:function(e){this._id=e},getId:function(){return this._id},setName:function(e){this._name=e},getName:function(){return this._name},setType:function(e){this._type=e},getType:function(){return this._type},setOpacity:function(e){this._opacity=e},getOpacity:function(){return this._opacity},setDataUrl:function(e){this._dataUrl=e},getDataUrl:function(){return this._dataUrl},setOrganizationName:function(e){this._organizationName=e},getOrganizationName:function(){return this._organizationName},setInspireName:function(e){this._inspireName=e},getInspireName:function(){return this._inspireName},setFeatureInfoEnabled:function(e){this._featureInfoEnabled=e},isFeatureInfoEnabled:function(){return this._featureInfoEnabled===!0?!0:!1},setDescription:function(e){this._description=e},getDescription:function(){return this._description},addSubLayer:function(e){this._subLayers.push(e)},getSubLayers:function(){return this._subLayers},setMaxScale:function(e){this._maxScale=e},getMaxScale:function(){return this._maxScale},setMinScale:function(e){this._minScale=e},getMinScale:function(){return this._minScale},setAsBaseLayer:function(){this._type="BASE_LAYER"},setAsNormalLayer:function(){this._type="NORMAL_LAYER"},setOrderNumber:function(e){this._orderNumber=e},getOrderNumber:function(){return this._orderNumber},setStyledLayerDescriptor:function(e){this._sldspec=e},getStyledLayerDescriptor:function(){return this._sldspec},isBaseLayer:function(){if("BASE_LAYER"==this._type)return!0;if("NORMAL_LAYER"==this._type)return!1;throw"We found a layer that is not a NORMAL_LAYER or a BASE_LAYER. Type '"+this._type+"' is not correct!"},isInScale:function(e){var t=this.isBaseLayer();if(!e){var i=Oskari.$().sandbox;e=i.getMap().getScale()}return this.isBaseLayer()||((e>this.getMaxScale()||!this.getMaxScale())&&this.getMinScale()>e||!this.getMinScale())&&(t=!0),t},isVisible:function(){return this._visible},setVisible:function(e){this._visible=e},isLayerOfType:function(e){return"VECTOR"==e||"vector"==e},setMetaType:function(e){this._metaType=e},getMetaType:function(){return this._metaType},getStyles:function(){return[]},getMetadataIdentifier:function(){return this._metadataIdentifier},setMetadataIdentifier:function(e){this._metadataIdentifier=e},getBackendStatus:function(){return this._backendStatus},setBackendStatus:function(e){this._backendStatus=e}}),Oskari.clazz.define("Oskari.mapframework.domain.Map",function(){this._centerX=null,this._centerY=null,this._zoom=null,this._scale=null,this._bbox=null,this._markerVisible=null,this.width=null,this.height=null,this.resolution=null,this.extent=null,this.maxExtent=null,this._isMoving=!1},{moveTo:function(e,t,i){this._centerX=Math.floor(e),this._centerY=Math.floor(t),this._zoom=i},setMoving:function(e){this._isMoving=e},isMoving:function(){return this._isMoving},getX:function(){return this._centerX},getY:function(){return this._centerY},getZoom:function(){return this._zoom},setScale:function(e){this._scale=e},getScale:function(){return this._scale},setBbox:function(e){this._bbox=e},getBbox:function(){return this._bbox},setMarkerVisible:function(e){this._markerVisible=e},isMarkerVisible:function(){return 1==this._markerVisible?!0:!1},setWidth:function(e){this.width=e},getWidth:function(){return this.width},setHeight:function(e){this.height=e},getHeight:function(){return this.height},setResolution:function(e){this.resolution=e},getResolution:function(){return this.resolution},setExtent:function(e){this.extent=e},getExtent:function(){return this.extent},setMaxExtent:function(e){this.maxExtent=e},getMaxExtent:function(){return this.maxExtent}}),Oskari.clazz.define("Oskari.mapframework.domain.Style",function(){this._name=null,this._title=null,this._legend=null},{setName:function(e){this._name=e},getName:function(){return this._name},setTitle:function(e){this._title=e},getTitle:function(){return this._title},setLegend:function(e){this._legend=e},getLegend:function(){return this._legend}}),Oskari.clazz.define("Oskari.mapframework.domain.User",function(e){this._loggedIn=!1,e&&(this._firstName=e.firstName,this._lastName=e.lastName,this._nickName=e.nickName,this._loginName=e.loginName,this._uuid=e.userUUID,e.userUUID&&(this._loggedIn=!0))},{getName:function(){return this._firstName+" "+this._lastName},getFirstName:function(){return this._firstName},getLastName:function(){return this._lastName},getNickName:function(){return this._nickName},getLoginName:function(){return this._loginName},getUuid:function(){return this._uuid},isLoggedIn:function(){return this._loggedIn}}),Oskari.clazz.define("Oskari.mapframework.core.map.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/core/core-map-layer-methods.js"},{type:"text/javascript",src:"../../../../sources/framework/core/core-map-methods.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"core-map","Bundle-Name":"mapframework.core.map.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.core.Bundle",Title:" mapframework.core.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("core-map","Oskari.mapframework.core.map.Bundle"),Oskari.clazz.category("Oskari.mapframework.core.Core","map-layer-methods",{isLayerAlreadySelected:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),i=t.findMapLayer(e,this._selectedLayers);return null!=i},findMapLayerFromSelectedMapLayers:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),i=t.findMapLayer(e,this._selectedLayers);return i},isMapLayerAlreadyHighlighted:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),i=t.findMapLayer(e,this._mapLayersHighlighted);return null==i&&this.printDebug("[core-map-layer-methods] "+e+" is not yet highlighted."),null!=i},findMapLayerFromAllAvailable:function(e){var t=this.getService("Oskari.mapframework.service.MapLayerService"),i=t.findMapLayer(e);return null==i&&this.printDebug("Cannot find map layer with id '"+e+"' from all available. "+"Check that current user has VIEW permissions to that layer."),i},getAllSelectedLayers:function(){return this._selectedLayers},getAllHighlightedMapLayers:function(){return this._mapLayersHighlighted},allowMultipleHighlightLayers:function(e){this._allowMultipleHighlightLayers=e},_handleAddMapLayerRequest:function(e){var t=e.getMapLayerId(),i=e.getKeepLayersOrder(),s=e.isBasemap();if(this.printDebug("Trying to add map layer with id '"+t+"' AS "+(s?" BASE ":" NORMAL ")),this.isLayerAlreadySelected(t))return this.printDebug("Attempt to select already selected layer '"+t+"'"),void 0;var a=this.findMapLayerFromAllAvailable(t);if(!a)return this.printDebug("Attempt to select layer that is not available '"+t+"'"),void 0;if(1==s&&a.setType("BASE_LAYER"),null!=i&&i)this._selectedLayers.push(a);else if(a.isBaseLayer()||1==s){var r=this._selectedLayers,n=Array();n.push(a);for(var o=0;r.length>o;o++)n.push(r[o]);delete this._selectedLayers,this._selectedLayers=n}else this._selectedLayers.push(a);var l=this.getEventBuilder("AfterMapLayerAddEvent")(a,i,s);this.copyObjectCreatorToFrom(l,e),this.dispatch(l);var h=Array();h.push(a),this.doSniffing(h)},_handleRemoveMapLayerRequest:function(e){var t=e.getMapLayerId();if(this.printDebug("Trying to remove map layer with id '"+t+"'"),!this.isLayerAlreadySelected(t))return this.printDebug("Attempt to remove layer '"+t+"' that is not selected."),void 0;for(var i=this.findMapLayerFromAllAvailable(t),s=-1,a=0;this._selectedLayers.length>a;a++)if(this._selectedLayers[a]===i){s=a;break}this._selectedLayers.splice(s,1),this.isMapLayerAlreadyHighlighted(t)&&(this.printDebug("Maplayer is also highlighted, removing it from highlight list."),this._handleDimMapLayerRequest(t));
var r=this.getEventBuilder("AfterMapLayerRemoveEvent")(i);this.copyObjectCreatorToFrom(r,e),this.dispatch(r)},_handleShowMapLayerInfoRequest:function(e){var t=this.findMapLayerFromAllAvailable(e.getMapLayerId()),i=this.getEventBuilder("AfterShowMapLayerInfoEvent")(t);this.copyObjectCreatorToFrom(i,e),this.dispatch(i)},_handleRearrangeSelectedMapLayerRequest:function(e){var t=e.getToPosition(),i=e.getMapLayerId(),s=null,a=0;if(null!=i&&null!=t){s=this.findMapLayerFromSelectedMapLayers(i);for(var r=Array(),n=0,o=0,l=0;t>n;l++){o++;var h=this._selectedLayers[l];h.getId()!=i?(r.push(h),n++):a=l}r.push(s);for(var l=o;this._selectedLayers.length>l;l++){var h=this._selectedLayers[l];h.getId()!=i?r.push(h):a=l}delete this._selectedLayers,this._selectedLayers=r}var u=this.getEventBuilder("AfterRearrangeSelectedMapLayerEvent")(s,a,t);this.copyObjectCreatorToFrom(u,e),this.dispatch(u)},_handleChangeMapLayerOpacityRequest:function(e){var t=this.findMapLayerFromSelectedMapLayers(e.getMapLayerId());if(t){t.setOpacity(e.getOpacity());var i=this.getEventBuilder("AfterChangeMapLayerOpacityEvent")(t);this.copyObjectCreatorToFrom(i,e),this.dispatch(i)}},_handleChangeMapLayerStyleRequest:function(e){var t=this.findMapLayerFromSelectedMapLayers(e.getMapLayerId());if(t&&"!default!"!=e.getStyle()){t.selectStyle(e.getStyle());var i=this.getEventBuilder("AfterChangeMapLayerStyleEvent")(t);this.copyObjectCreatorToFrom(i,e),this.dispatch(i)}},_removeHighLightedMapLayer:function(e){for(var t=this.getAllHighlightedMapLayers(),i=0;t.length>i;i++){var s=t[i];if(!e||s.getId()==e){t.splice(i);var a=this.getEventBuilder("AfterDimMapLayerEvent")(s);return this.dispatch(a),void 0}}},_handleHighlightMapLayerRequest:function(e){this.getObjectCreator(e);var t=e.getMapLayerId();if(this.printDebug("[core-map-layer-methods] Trying to highlight map layer with id '"+t+"'"),this.isMapLayerAlreadyHighlighted(t))return this.printWarn("[core-map-layer-methods] Attempt to highlight already highlighted wms feature info map layer '"+t+"'"),void 0;1==this._allowMultipleHighlightLayers?this._removeHighLightedMapLayer(t):this._removeHighLightedMapLayer();var i=this.findMapLayerFromSelectedMapLayers(t);if(i){this._mapLayersHighlighted.push(i),this.printDebug("[core-map-layer-methods] Adding "+i+" ("+i.getId()+") to highlighted list.");var s=this.getEventBuilder("AfterHighlightMapLayerEvent")(i);this.copyObjectCreatorToFrom(s,e),this.dispatch(s)}},_handleDimMapLayerRequest:function(e){1==this._allowMultipleHighlightLayers?this._removeHighLightedMapLayer(e):this._removeHighLightedMapLayer();var t=this.findMapLayerFromAllAvailable(e);if(t){var i=this.getEventBuilder("AfterDimMapLayerEvent")(t);this.dispatch(i)}}}),Oskari.clazz.category("Oskari.mapframework.core.Core","map-methods",{doSniffing:function(e){if(this._doSniffing){for(var t=this.getService("Oskari.mapframework.service.UsageSnifferService"),i=Array(),s=this._map.getScale(),a=0;e.length>a;a++){for(var r=e[a],n=0;r.getSubLayers().length>n;n++){var o=r.getSubLayers()[n];o.isVisible()&&o.getMinScale()>=s&&s>=o.getMaxScale()&&i.push(o)}!r.isBaseLayer()&&r.isVisible()&&r.getMinScale()>=s&&s>=r.getMaxScale()&&i.push(r)}i.length>0&&t.registerMapMovement(i,this._map.getX(),this._map.getY(),this._map.getZoom(),this._map.getBbox().toBBOX(),this._mapIdFromUrl)}},_handleHideMapMarkerRequest:function(e){this._map.setMarkerVisible(!1);var t=this.getEventBuilder("AfterHideMapMarkerEvent")();this.copyObjectCreatorToFrom(t,e),this.dispatch(t)}}),Oskari.clazz.define("Oskari.mapframework.request.map.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/request/common/add-map-layer-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/remove-map-layer-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/map-move-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/show-map-layer-info-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/hide-map-marker-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/ctrl-key-down-request.js"},{type:"text/javascript",src:"../../../../sources/framework/request/common/ctrl-key-up-request.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"request-map","Bundle-Name":"mapframework.request.map.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.request.Bundle",Title:" mapframework.request.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("request-map","Oskari.mapframework.request.map.Bundle"),Oskari.clazz.define("Oskari.mapframework.request.common.AddMapLayerRequest",function(e,t,i,s){this._creator=null,this._mapLayerId=e,this._keepLayersOrder=1==t,this._isExternal=1==s,this._isBasemap=1==i},{__name:"AddMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId},getKeepLayersOrder:function(){return this._keepLayersOrder},isBasemap:function(){return this._isBasemap},isExternal:function(){return this._isExternal}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.RemoveMapLayerRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"RemoveMapLayerRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.MapMoveRequest",function(e,t,i,s){this._creator=null,this._centerX=e,this._centerY=t,this._zoom=i,this._marker=s},{__name:"MapMoveRequest",getName:function(){return this.__name},getCenterX:function(){return this._centerX},getCenterY:function(){return this._centerY},getZoom:function(){return this._zoom},getMarker:function(){return this._marker}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.ShowMapLayerInfoRequest",function(e){this._creator=null,this._mapLayerId=e},{__name:"ShowMapLayerInfoRequest",getName:function(){return this.__name},getMapLayerId:function(){return this._mapLayerId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.HideMapMarkerRequest",function(){this._creator=null},{__name:"HideMapMarkerRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.CtrlKeyDownRequest",function(){},{__name:"CtrlKeyDownRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.request.common.CtrlKeyUpRequest",function(){},{__name:"CtrlKeyUpRequest",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.sandbox.base.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox.js"},{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox-key-listener-methods.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"sandbox-base","Bundle-Name":"mapframework.sandbox.base.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.sandbox.Bundle",Title:" mapframework.sandbox.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("sandbox-base","Oskari.mapframework.sandbox.base.Bundle"),Oskari.clazz.define("Oskari.mapframework.sandbox.Sandbox",function(e){this._core=e,this._listeners=Array(),this._modules=Array(),this._modulesByName={},this._statefuls={},this.debugRequests=!1,this.debugEvents=!1,this.requestEventLog=[],this.requestEventStack=[],this.gatherDebugRequests=!1,this.maxGatheredRequestsAndEvents=4096,this.requestAndEventGather=[],this._eventLoopGuard=0,this._user=null,this._ajaxUrl=null},{disableDebug:function(){this.debugRequests=!1,this.debugEvents=!1,this.gatherDebugRequests=!1,this._core&&this._core.disableDebug()},enableDebug:function(){this.debugRequests=!0,this.debugEvents=!0,this.gatherDebugRequests=!0,this._core&&this._core.enableDebug()},printDebug:function(e){this._core.printDebug(e)},printWarn:function(e){this._core.printWarn(e)},setUser:function(e){this._user=Oskari.clazz.create("Oskari.mapframework.domain.User",e)},getUser:function(){return this._user||this.setUser(),this._user},setAjaxUrl:function(e){this._ajaxUrl=e},getAjaxUrl:function(){return this._ajaxUrl},registerService:function(e){this._core.registerService(e)},getService:function(e){return this._core.getService(e)},registerAsStateful:function(e,t){this._statefuls[e]=t},unregisterStateful:function(e){this._statefuls[e]=null,delete this._statefuls[e]},getStatefulComponents:function(){return this._statefuls},register:function(e){return this._modules.push(e),this._modulesByName[e.getName()]=e,e.init(this)},unregister:function(e){for(var t=[],i=0;this._modules.length>i;i++)e!==this._modules[i]&&t.push(this._modules[i]);this._modules=t,this._modulesByName[e.getName()]=void 0,delete this._modulesByName[e.getName()]},registerForEventByName:function(e,t){this._core.printDebug("#*#*#* Sandbox is registering module '"+e.getName()+"' to event '"+t+"'");var i=this._listeners[t];null==i&&(i=Array(),this._listeners[t]=i),i.push(e),this._core.printDebug("There are currently "+i.length+" listeners for event '"+t+"'")},unregisterFromEventByName:function(e,t){this._core.printDebug("Sandbox is unregistering module '"+e.getName()+"' from event '"+t+"'");var i=this._listeners[t];if(null==i)return this._core.printDebug("Module does not listen to that event, skipping."),void 0;for(var s=-1,a=0;i.length>a;a++)if(i[a]==e){s=a;break}s>-1?(i.splice(s,1),this._core.printDebug("Module unregistered successfully from event")):this._core.printDebug("Module does not listen to that event, skipping.")},getRequestBuilder:function(e){return this._core.getRequestBuilder(e)},getEventBuilder:function(e){return this._core.getEventBuilder(e)},request:function(e,t){var i=null;i=null!=e.getName?e.getName():e;var s=this.findRegisteredModuleInstance(i);if(null==s)throw"Attempt to create request with unknown component '"+e+"' as creator";this._core.setObjectCreator(t,i),this.printDebug("Module '"+i+"' is requesting for '"+this.getObjectName(t)+"'..."),this.gatherDebugRequests&&this._pushRequestAndEventGather(i+"->Sandbox: ",this.getObjectName(t));var a=null;return this._debugPushRequest(i,t),a=this._core.processRequest(t),this._debugPopRequest(),a},requestByName:function(e,t,i){this.printDebug("#!#!#! --------------> requestByName "+t);var s=this.getRequestBuilder(t),a=s.apply(this,i||[]);return this.request(e,a)},postMasterComponent:"postmaster",postRequestByName:function(e,t){var i=this,s=i.getRequestBuilder(e);s&&window.setTimeout(function(){var e=s.apply(i,t||[]),a=this.postMasterComponent;i._core.setObjectCreator(e,a),i.gatherDebugRequests&&i._pushRequestAndEventGather(a+"->Sandbox: ",i.getObjectName(e));var r=null;this.debugRequests&&i._debugPushRequest(a,e),r=i._core.processRequest(e),this.debugRequests&&i._debugPopRequest()},0)},_findModulesInterestedIn:function(e){var t=e.getName(),i=this._listeners[t];return i?i:[]},notifyAll:function(e,t){var i;t||(i=e.getName(),this._core.printDebug("Sandbox received notifyall for event '"+i+"'"));var s=this._findModulesInterestedIn(e);t||this._core.printDebug("Found "+s.length+" interested modules");for(var a=0;s.length>a;a++){var r=s[a];t||(this._core.printDebug("Notifying module '"+r.getName()+"'."),this.gatherDebugRequests&&this._pushRequestAndEventGather("Sandbox->"+r.getName()+":",i)),this._debugPushEvent(this.getObjectCreator(e),r,e),r.onEvent(e),this._debugPopEvent()}t||delete e},findRegisteredModuleInstance:function(e){return this._modulesByName[e]},getRequestParameter:function(e){return this._core.getRequestParameter(e)},getBrowserWindowSize:function(){jQuery.browser.opera&&null!=window.innerHeight&&window.innerHeight;var e=jQuery(window).width(),t={};return t.height=jQuery(window).height(),t.width=e,this.printDebug("Got browser window size is: width: "+t.width+" px, height:"+t.height+" px."),t},getObjectName:function(e){return this._core.getObjectName(e)},getObjectCreator:function(e){return this._core.getObjectCreator(e)},setObjectCreator:function(e,t){return this._core.setObjectCreator(e,t)},copyObjectCreatorToFrom:function(e,t){return this._core.copyObjectCreatorToFrom(e,t)},addRequestHandler:function(e,t){return this._core.addRequestHandler(e,t)},removeRequestHandler:function(e,t){return this._core.removeRequestHandler(e,t)},_debugPushRequest:function(e,t){if(this.debugRequests){var i={from:e,reqName:t.getName()};this.requestEventStack.push(i),this.requestEventLog.push(i),this.requestEventLog.length>64&&this.requestEventLog.shift()}},_debugPopRequest:function(){this.debugRequests&&this.requestEventStack.pop()},_debugPushEvent:function(e,t,i){if(this.debugEvents){if(this._eventLoopGuard++,this._eventLoopGuard>64)throw"Events Looped?";var s={from:e,to:t.getName(),evtName:i.getName()};this.requestEventStack.push(s),this.requestEventLog.push(s),this.requestEventLog.length>64&&this.requestEventLog.shift()}},_debugPopEvent:function(){this.debugEvents&&(this._eventLoopGuard--,this.requestEventStack.pop())},_pushRequestAndEventGather:function(e,t){var i={};i.name=e,i.request=t,this.requestAndEventGather.push(i),this.requestAndEventGather.length>this.maxGatheredRequestsAndEvents&&this.requestAndEventGather.shift()},popUpSeqDiagram:function(){var e='<html><head></head><body><div class="wsd" wsd_style="modern-blue"><pre>',t="";for(x in this.requestAndEventGather)t+=this.requestAndEventGather[x].name+this.requestAndEventGather[x].request+"\n";if(""!=t){e+=t+'</pre></div><script type="text/javascript" src="http://www.websequencediagrams.com/service.js"></script></body></html>';var i=window.open();i.document.write(e),this.requestAndEventGather=[]}else alert("No requests in queue")}}),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","key-listener-methods",{isCtrlKeyDown:function(){return this._core.isCtrlKeyDown()}}),Oskari.clazz.define("Oskari.mapframework.service.map.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/service/usage-sniffer-service.js"},{type:"text/javascript",src:"../../../../sources/framework/service/map-layer-service.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"service-map","Bundle-Name":"mapframework.service.map.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.service.Bundle",Title:" mapframework.service.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("service-map","Oskari.mapframework.service.map.Bundle"),Oskari.clazz.define("Oskari.mapframework.service.UsageSnifferService",function UsageSnifferService(e,t){this._sendInterval=e,this._snifferEndpoint=t,this._currentStatistics=[]},{__qname:"Oskari.mapframework.service.UsageSnifferService",getQName:function(){return this.__qname},__name:"UsageSnifferService",getName:function(){return this.__name},startSniffing:function(){var e=this;setInterval(function(){e._sendData()},1e3*this._sendInterval),this._clearStats()},_sendData:function(){for(var e=this._currentStatistics,t=0;e.length>t;t++)jQuery.get(e[t],function(){});this._clearStats()},_clearStats:function(){delete this._currentStatistics,this._currentStatistics=[]},registerMapMovement:function(e,t,i,s,a,r){for(var n=0;e.length>n;n++){var o=e[n],l=o.getId()+"?lon="+t+"&lat="+i+"&zoom="+s+"&bbox="+a;r&&(l+="&mapId="+r),this._currentStatistics.push(this._snifferEndpoint+l)}}},{protocol:["Oskari.mapframework.service.Service"]}),Oskari.clazz.define("Oskari.mapframework.service.MapLayerService",function(e,t){this._mapLayerUrl=e,this._sandbox=t,this._loadedLayersList=Array(),this._reservedLayerIds={},this.typeMapping={wmslayer:"Oskari.mapframework.domain.WmsLayer",wmtslayer:"Oskari.mapframework.wmts.domain.WmtsLayer",wfslayer:"Oskari.mapframework.domain.WfsLayer",vectorlayer:"Oskari.mapframework.domain.VectorLayer"},this.modelBuilderMapping={}},{__qname:"Oskari.mapframework.service.MapLayerService",getQName:function(){return this.__qname},__name:"MapLayerService",getName:function(){return this.__name},addLayer:function(e,t){if(this.checkForDuplicateId(e.getId(),e.getName()),this._reservedLayerIds[e.getId()]=!0,this._loadedLayersList.push(e),t!==!0){var i=this._sandbox.getEventBuilder("MapLayerEvent")(e.getId(),"add");this._sandbox.notifyAll(i)}},removeLayer:function(e,t){for(var i=null,s=0;this._loadedLayersList.length>s;s++)if(this._loadedLayersList[s].getId()==e){i=this._loadedLayersList[s],this._loadedLayersList.splice(s,1);break}if(i&&t!==!0){var a=this._sandbox.getEventBuilder("MapLayerEvent")(i.getId(),"remove");this._sandbox.notifyAll(a)}this._reservedLayerIds[e]=!1},updateLayer:function(e,t){var i=this.findMapLayer(e);if(i){i.setName(t.name);var s=this._sandbox.getEventBuilder("MapLayerEvent")(i.getId(),"update");this._sandbox.notifyAll(s)}},loadAllLayersAjax:function(e,t){var i=this;jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:this._mapLayerUrl,success:function(t){i._loadAllLayersAjaxCallBack(t,e)},error:function(e){t&&0!=e.status&&t()}})},_loadAllLayersAjaxCallBack:function(e,t){for(var i=e.layers,s=0;i.length>s;s++){var a=this.createMapLayer(i[s]);this._reservedLayerIds[a.getId()]!==!0&&this.addLayer(a,!0)}var r=this._sandbox.getEventBuilder("MapLayerEvent")(null,"add");this._sandbox.notifyAll(r),t&&t()},getAllLayers:function(){return this._loadedLayersList},getAllLayersByMetaType:function(e){for(var t=[],i=0;this._loadedLayersList.length>i;++i){var s=this._loadedLayersList[i];s.getMetaType&&s.getMetaType()===e&&t.push(s)}return t},registerLayerModel:function(e,t){this.typeMapping[e]=t},unregisterLayerModel:function(e){this.typeMapping[e]=void 0},registerLayerModelBuilder:function(e,t){this._sandbox.printDebug("[MapLayerService] registering handler for type "+e),this.modelBuilderMapping[e]=t},unregisterLayerModelBuilder:function(e){this.modelBuilderMapping[e]=void 0},createMapLayer:function(e){var t=null;return t="base"==e.type?this._createGroupMapLayer(e,!0):"groupMap"==e.type?this._createGroupMapLayer(e,!1):this._createActualMapLayer(e)},_createGroupMapLayer:function(e,t){var i=Oskari.clazz.create("Oskari.mapframework.domain.WmsLayer");if(t?i.setAsBaseLayer():i.setAsGroupLayer(),i.setVisible(!0),i.setId(e.id),i.setName(e.name),i.setMaxScale(e.maxScale),i.setMinScale(e.minScale),i.setDataUrl(e.dataUrl),i.setMetadataIdentifier(e.dataUrl_uuid),e.orgName?i.setOrganizationName(e.orgName):i.setOrganizationName(""),e.inspire?i.setInspireName(e.inspire):i.setInspireName(""),i.setLegendImage(e.legendImage),i.setDescription(e.info),i.setQueryable(!1),e.permissions)for(var s in e.permissions)i.addPermission(s,e.permissions[s]);for(var a=0;e.subLayer.length>a;a++){var r=this._createActualMapLayer(e.subLayer[a]);i.getSubLayers().push(r)}if(null!=e.opacity)i.setOpacity(e.opacity);else if(i.getSubLayers().length>0){var n=i.getSubLayers()[0].getOpacity();null!=n?i.setOpacity(n):i.setOpacity(100)}else i.setOpacity(100);return i},_createActualMapLayer:function(e){var t=null,i=e.id;if(null!=e){if(!this.typeMapping[e.type])throw"Unknown layer type '"+e.type+"'";if(t=Oskari.clazz.create(this.typeMapping[e.type]),"wmslayer"==e.type?this._populateWmsMapLayerAdditionalData(t,e):"vectorlayer"==e.type&&t.setStyledLayerDescriptor(e.styledLayerDescriptor),e.metaType&&t.setMetaType&&t.setMetaType(e.metaType),t.setAsNormalLayer(),t.setId(i),t.setName(e.name),null!=e.opacity?t.setOpacity(e.opacity):t.setOpacity(100),t.setMaxScale(e.maxScale),t.setMinScale(e.minScale),t.setDescription(e.subtitle),t.setMetadataIdentifier(e.dataUrl_uuid),e.backendStatus&&t.setBackendStatus&&t.setBackendStatus(e.backendStatus),e.orgName?t.setOrganizationName(e.orgName):t.setOrganizationName(""),e.inspire?t.setInspireName(e.inspire):t.setInspireName(""),t.setVisible(!0),e.geom&&t.setGeometryWKT&&t.setGeometryWKT(e.geom),e.permissions)for(var s in e.permissions)t.addPermission(s,e.permissions[s]);var a=this.modelBuilderMapping[e.type];a&&a.parseLayerData(t,e,this)}return t},_populateWmsMapLayerAdditionalData:function(e,t){if(e.setWmsName(t.wmsName),t.wmsUrl)for(var i=t.wmsUrl.split(","),s=0;i.length>s;s++)e.addWmsUrl(i[s]);return e.setFeatureInfoEnabled("disabled"!==t.gfi),this._populateStyles(e,t)},_populateStyles:function(e,t){var i=Oskari.clazz.builder("Oskari.mapframework.domain.Style");if(t.styles){for(var s=0;t.styles.length>s;s++){var a=t.styles,r=!isNaN(s);r&&(a=t.styles[s]);var n=i();if(n.setName(a.name),n.setTitle(a.title),n.setLegend(a.legend),e.addStyle(n),!r)break}e.selectStyle(t.style)}if(0==e.getStyles().length){var n=i();n.setName(""),n.setTitle(""),n.setLegend(""),e.addStyle(n),e.selectStyle("")}return e.setQueryable(1==t.isQueryable),e.setLegendImage(t.legendImage),e.setDataUrl(t.dataUrl),t.formats&&t.formats.value&&e.setQueryFormat(t.formats.value),e},checkForDuplicateId:function(e,t){if(this._reservedLayerIds[e]===!0){var i=this.findMapLayer(e);throw"Trying to add map layer with id '"+e+" ("+t+")' but that id is already reserved for '"+i.getName()+"'"}},findMapLayer:function(e,t){t||(t=this._loadedLayersList);for(var i=0;t.length>i;i++){var s=t[i];if(s.getId()==e)return s}for(var i=0;t.length>i;i++){var s=t[i],a=s.getSubLayers(),r=this.findMapLayer(e,a);if(null!=r)return r}return null}},{protocol:["Oskari.mapframework.service.Service"]}),Oskari.clazz.define("Oskari.mapframework.sandbox.map.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox-map-layer-methods.js"},{type:"text/javascript",src:"../../../../sources/framework/sandbox/sandbox-map-methods.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"sandbox-map","Bundle-Name":"mapframework.sandbox.map.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.sandbox.Bundle",Title:" mapframework.sandbox.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("sandbox-map","Oskari.mapframework.sandbox.map.Bundle"),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","map-layer-methods",{findMapLayerFromAllAvailable:function(e){var t=this._core.findMapLayerFromAllAvailable(e);return t},findAllSelectedMapLayers:function(){var e=this._core.getAllSelectedLayers();return e.slice(0)},findMapLayerFromSelectedMapLayers:function(e){var t=this._core.findMapLayerFromSelectedMapLayers(e);return t},isLayerAlreadySelected:function(e){return this._core.isLayerAlreadySelected(e)},findAllHighlightedLayers:function(){var e=this._core.getAllHighlightedMapLayers();return e},isMapLayerHighLighted:function(e){for(var t=this.findAllHighlightedLayers(),i=0;t.length>i;i++)if(t[i].getId()==e)return!0;return!1},allowMultipleHighlightLayers:function(e){this._core.allowMultipleHighlightLayers(e)}}),Oskari.clazz.category("Oskari.mapframework.sandbox.Sandbox","map-methods",{getMap:function(){return this._core.getMap()},syncMapState:function(e){var t=this._core.getMap(),i=t.getZoom(),s=t.isMarkerVisible();e===!0&&12==i&&this._core.processRequest(this._core.getRequestBuilder("MapMoveRequest")(t.getX(),t.getY(),0,!1)),this._core.processRequest(this._core.getRequestBuilder("MapMoveRequest")(t.getX(),t.getY(),i,s)),e===!0&&this._core.processRequest(this._core.getRequestBuilder("ClearHistoryRequest")())},generateMapLinkParameters:function(e){var t=this.getStatefulComponents().mapfull;if(t){for(var i=t.getState(),s="zoomLevel="+i.zoom+"&coord="+i.east+"_"+i.north+"&mapLayers=",a="",r=0;i.selectedLayers.length>r;r++)i.selectedLayers[r].hidden||(""!=a&&(a+=","),a+=i.selectedLayers[r].id+"+"+i.selectedLayers[r].opacity,a+=i.selectedLayers[r].style?"+"+i.selectedLayers[r].style:"+");return s+=a,e?(s+=1==e.marker?"&showMarker=true":"&showMarker=false",s+=0==e.forceCache?"&forceCache=false":"&forceCache=true",s+=0==e.noSavedState?"&noSavedState=false":"&noSavedState=true"):s+="&showMarker=false&forceCache=true&noSavedState=true",s}},doSniffing:function(e){e||(e=this._core.getAllSelectedLayers()),this._core.doSniffing(e)}}),Oskari.clazz.define("Oskari.mapframework.event.map.Bundle",function(){},{create:function(){return null},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../sources/framework/event/common/features-available-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-map-layer-add-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-map-layer-remove-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-map-move-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-map-move-start-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-show-map-layer-info-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/after-hide-map-marker-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/mouse-hover-event.js"},{type:"text/javascript",src:"../../../../sources/framework/event/common/MapLayerEvent.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"event-map","Bundle-Name":"mapframework.event.map.Bundle","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" mapframework.event.Bundle",Title:" mapframework.event.Bundle"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("event-map","Oskari.mapframework.event.map.Bundle"),Oskari.clazz.define("Oskari.mapframework.event.common.FeaturesAvailableEvent",function(e,t,i,s,a){this._creator=null,this._features=t,this._op=a,this._mapLayer=e,this._mimeType=i,this._projCode=s},{__name:"FeaturesAvailableEvent",getName:function(){return this.__name},getFeatures:function(){return this._features},getOp:function(){return this._op},getMapLayer:function(){return this._mapLayer},getMimeType:function(){return this._mimeType},getProjCode:function(){return this._projCode}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapLayerAddEvent",function(e,t,i){this._creator=null,this._mapLayer=e,this._keepLayersOrder=t,this._isBasemap=i?i:!1},{__name:"AfterMapLayerAddEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer},getKeepLayersOrder:function(){return this._keepLayersOrder},isBasemap:function(){return this._isBasemap}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapLayerRemoveEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterMapLayerRemoveEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterMapMoveEvent",function(e,t,i,s,a){this._creator=null,this._centerX=e,this._centerY=t,this._zoom=i,this._marker=s,this._scale=a},{__name:"AfterMapMoveEvent",getName:function(){return this.__name},getCreator:function(){return this._creator},getCenterX:function(){return this._centerX},getCenterY:function(){return this._centerY},getZoom:function(){return this._zoom},getMarker:function(){return this._marker},getScale:function(){return this._scale}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.MapMoveStartEvent",function(e,t){this._creator=null,this._x=e,this._y=t},{__name:"MapMoveStartEvent",getName:function(){return this.__name},getX:function(){return this._x},getY:function(){return this._y}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterShowMapLayerInfoEvent",function(e){this._creator=null,this._mapLayer=e},{__name:"AfterShowMapLayerInfoEvent",getName:function(){return this.__name},getMapLayer:function(){return this._mapLayer}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.AfterHideMapMarkerEvent",function(){},{__name:"AfterHideMapMarkerEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.MouseHoverEvent",function(e,t,i){this._creator=null,this._lon=e,this._lat=t,this._paused=i},{__name:"MouseHoverEvent",getName:function(){return this.__name},getLon:function(){return this._lon},getLat:function(){return this._lat},set:function(e,t,i,s,a){this._lon=e,this._lat=t,this._paused=i,this._pageX=s,this._pageY=a},isPaused:function(){return this._paused},getPageX:function(){return this._pageX},getPageY:function(){return this._pageY}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.event.common.MapLayerEvent",function(e,t){if(this._creator=null,this._layerId=e,!this.operations[t])throw"Unknown operation '"+t+"'";this._operation=t},{__name:"MapLayerEvent",getName:function(){return this.__name},getLayerId:function(){return this._layerId},getOperation:function(){return this._operation},operations:{add:"add",remove:"remove",update:"update"}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.userinterface.bundle.ui.UserInterfaceBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.userinterface.bundle.ui.UserInterfaceBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/AddExtensionRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/AddExtensionRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/RemoveExtensionRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/RemoveExtensionRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/UpdateExtensionRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/UpdateExtensionRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/ModalDialogRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/request/ModalDialogRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/event/ExtensionUpdatedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Accordion.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/AccordionPanel.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/TabContainer.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/TabDropdownContainer.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/TabPanel.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Badge.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Alert.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Popup.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Overlay.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Button.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Form.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/UIHelper.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/FormInput.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Popover.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/Grid.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/divmanazer/component/GridModel.js"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/divman.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/accordion.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/tab.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/modal.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/badge.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/alert.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/grid.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/popup.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/button.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/overlay.css"},{type:"text/css",src:"../../../../resources/framework/bundle/divmanazer/css/popover.css"}]},bundle:{manifest:{"Bundle-Identifier":"ui","Bundle-Name":"ui","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" kpI",Title:" kpI"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("divmanazer","Oskari.userinterface.bundle.ui.UserInterfaceBundle"),Oskari.clazz.define("Oskari.userinterface.bundle.ui.UserInterfaceBundleInstance",function(){this.sandbox=null,this.requestHandlers={},this.extensions=[],this.extensionsByName={},this.compiledTemplates={},this.flyoutContainer=null,this.tileContainer=null,this.flyoutZIndexBase=1100,this.menubarContainerId="#menubar"
},{getName:function(){return"userinterface.DivManazer"},init:function(){},getExtensionByName:function(e){return this.extensionsByName[e]},getSandbox:function(){return this.sandbox},start:function(){this.compileTemplates(),this.flyoutContainer=jQuery(document.body),this.tileContainer=jQuery(this.menubarContainerId),this.tileContainer.addClass("oskari-tile-container");var e=Oskari.$("sandbox");if(this.sandbox=e,this.sandbox.register(this),this.requestHandlers.add=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.AddExtensionRequestHandler",this),this.requestHandlers.remove=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.RemoveExtensionRequestHandler",this),this.requestHandlers.update=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.UpdateExtensionRequestHandler",this),e.addRequestHandler("userinterface.AddExtensionRequest",this.requestHandlers.add),e.addRequestHandler("userinterface.RemoveExtensionRequest",this.requestHandlers.remove),e.addRequestHandler("userinterface.UpdateExtensionRequest",this.requestHandlers.update),this.requestHandlers.modal=Oskari.clazz.create("Oskari.userinterface.bundle.ui.request.ModalDialogRequestHandler",this),e.addRequestHandler("userinterface.ModalDialogRequest",this.requestHandlers.modal),jQuery.browser.msie&&"9.0">jQuery.browser.version)for(var t=this.compiledTemplates["Oskari.userinterface.Flyout"].children(".oskari-flyoutcontentcontainer"),i=this.flyoutContainer.height(),s=this.ieFixClasses,a=0;s.length>a;a++){var r=s[a];if(i>=r.min&&r.max>=i){t.addClass(r.cls);break}}},update:function(){},stop:function(){sandbox.removeRequestHandler("userinterface.UpdateExtensionRequest",this.requestHandlers.update),sandbox.removeRequestHandler("userinterface.RemoveExtensionRequest",this.requestHandlers.remove),sandbox.removeRequestHandler("userinterface.AddExtensionRequest",this.requestHandlers.add),sandbox.removeRequestHandler("userinterface.ModalDialogRequest",this.requestHandlers.modal),this.sandbox.unregister(this),this.started=!1},templates:{"Oskari.userinterface.Tile":'<div class="oskari-tile oskari-tile-closed"><div class="oskari-tile-title"></div><div class="oskari-tile-status"></div></div>',"Oskari.userinterface.Flyout":'<div class="oskari-flyout oskari-closed"><div class="oskari-flyouttoolbar"><div class="oskari-flyoutheading"></div><div class="oskari-flyout-title"><p></p></div><div class="oskari-flyouttools"><div class="oskari-flyouttool-help"></div><div class="oskari-flyouttool-attach"></div><div class="oskari-flyouttool-detach"></div><div class="oskari-flyouttool-minimize"></div><div class="oskari-flyouttool-restore"></div><div class="oskari-flyouttool-close icon-close icon-close:hover"></div></div></div><div class="oskari-flyoutcontentcontainer"><div class="oskari-flyoutcontent"></div></div></div>'},compileTemplates:function(){var e=this;e.compiledTemplates["Oskari.userinterface.Tile"]=jQuery(this.templates["Oskari.userinterface.Tile"]);var t=jQuery(e.templates["Oskari.userinterface.Flyout"]);t.css("left",e.defaults.attach.left),t.css("top",e.defaults.attach.top),e.compiledTemplates["Oskari.userinterface.Flyout"]=t},addExtension:function(e){var t=this;e.startExtension();var i=e.getPlugins(),s=this.extensions,a=this.extensionsByName,r={state:"close",extension:e,draggable:null,draggableTarget:null,draggableHandle:null,viewState:{},extensionUpdatedEvent:null};r.extensionUpdatedEvent=this.sandbox.getEventBuilder("userinterface.ExtensionUpdatedEvent")(e,r.state);var n=s.length,o=e.getName(),l=i["Oskari.userinterface.Flyout"],h=null;if(null!=l){h=this.createFlyout(e,l,n,r),r.draggableHandle=h.children(".oskari-flyouttoolbar").get()[0];var u=h.get()[0],p=r.draggableHandle;r.draggableTarget=u,h.css("position","absolute");var c=!1;r.draggable=$(h).draggable({handle:jQuery(p),helper:c?function(){var e=jQuery("<div />");return e.css("width",h.css("width")),e.css("height",h.css("height")),e.css("border","2px solid rgba(0,0,0,.5)"),e.css("z-index",h.css("z-index")),e}:null,scroll:!1,stack:".oskari-flyout",create:function(){},start:function(){c&&h.css("display","none")},drag:function(){},stop:function(e,i){c&&(h.css("top",i.helper.css("top")),h.css("left",i.helper.css("left"))),t.shuffleZIndices(h),c&&h.css("display","");var s=t.getFlyoutViewState(h,"detach");r.viewState=s,t.notifyExtensionViewStateChange(r)}});var d=h.children(".oskari-flyoutcontentcontainer");d.children(".oskari-flyoutcontent");var m=d.children(".oskari-flyoutcontent");l.setEl(m.get()),this.flyoutContainer.append(h),l.startPlugin()}var y=i["Oskari.userinterface.Tile"],f=null;return null!=y&&(f=this.createTile(e,y,n,r),y.startPlugin(),f.fadeIn(200),this.tileContainer.append(f)),r.plugins={},y&&(r.plugins["Oskari.userinterface.Tile"]={plugin:y,el:f}),l&&(r.plugins["Oskari.userinterface.Flyout"]={plugin:l,el:h}),s.push(r),a[o]=r,r},createTile:function(e,t){var i=this;jQuery("#menubar");var s=this.compiledTemplates["Oskari.userinterface.Tile"].clone(!0,!0),a=s.children(".oskari-tile-title");return a.append(t.getTitle()),s.children(".oskari-tile-status"),s.click(function(){i.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"toggle"])}),t.setEl(s.get()),s},createFlyout:function(e,t){var i=this,s=this.compiledTemplates["Oskari.userinterface.Flyout"].clone(!0,!0);s.find(".oskari-flyout-title p").append(t.getTitle());var a=s.children(".oskari-flyouttoolbar").children(".oskari-flyouttools"),r={attach:a.children(".oskari-flyouttool-attach"),detach:a.children(".oskari-flyouttool-detach"),minimize:a.children(".oskari-flyouttool-minimize"),restore:a.children(".oskari-flyouttool-restore"),close:a.children(".oskari-flyouttool-close"),help:a.children(".oskari-flyouttool-help")};return r.detach.click(function(){i.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"detach"])}),r.attach.click(function(){i.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"attach"])}),r.minimize.click(function(){i.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"minimize"])}),r.restore.click(function(){i.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"restore"])}),r.close.click(function(){i.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[e,"close"])}),r.help.click(function(){i.getSandbox().postRequestByName("userguide.ShowUserGuideRequest",[{placement:"bottom",el:r.help,extension:e.getName(),toggle:!0}])}),s},removeExtension:function(e){var t=this,i=t.extensions,s=this.extensionsByName,a=s[e.getName()];a.state;var r=a.plugins["Oskari.userinterface.Flyout"];if(r){var n=r.plugin,o=r.el,l=this.flyoutOps,h=l.close;h.apply(this,[o,n,a]),o.remove()}var u=a.plugins["Oskari.userinterface.Tile"];if(u){u.plugin;var p=u.el;p.remove()}s[e.getName()]=null;for(var c=[],d=0,m=i.length;m>d;d++)i[d]!==a&&c.push(i[d]);t.extensions=c,e.stopExtension()},updateExtension:function(e,t){var i=this,s=i.extensions;if(e){var a=this.extensionsByName,r=a[e.getName()],n=r.state,o=t.getState();"toggle"==o&&("close"==n?o="attach":"attach"==n?o="close":"detach"==n?o="minimize":"minimize"==n?o="restore":"restore"==n&&(o="minimize"));var l=r.plugins["Oskari.userinterface.Flyout"];if("attach"==o&&l)for(var h=i.flyoutOps,u=h.close,p=0,c=s.length;c>p;p++){var d=s[p];if(d!==r&&"attach"==d.state){var m="close",y=d.plugins,f=y["Oskari.userinterface.Flyout"];if(f){var g=f.plugin,v=f.el;d.state=m,u.apply(this,[v,g,d]),i.notifyExtensionViewStateChange(d);var L=y["Oskari.userinterface.Tile"];if(L){L.plugin;var b=L.el;i.applyTransition(b,m,i.tileTransitions)}}}}if(l){var O=l.plugin,S=l.el,h=i.flyoutOps,w=h[o];w.apply(this,[S,O,r,s])}var _=r.plugins["Oskari.userinterface.Tile"];if(_){_.plugin;var x=_.el;i.applyTransition(x,o,i.tileTransitions)}r.state=o,i.notifyExtensionViewStateChange(r)}else for(var k=0;s.length>k;++k)this.updateExtension(s[k].extension,t)},notifyExtensionViewStateChange:function(e){var t=e.extensionUpdatedEvent;t.setViewState(e.state),t.setViewInfo(e.viewState),this.sandbox.notifyAll(t,!0)},validStates:{attach:{attach:!0,detach:!1,close:!1,minimize:!1,restore:!1,drawer:!1,curtain:!1},detach:{attach:!1,detach:!0,close:!1,minimize:!1,restore:!1,drawer:!1,curtain:!1},minimize:{attach:!0,detach:!0,close:!1,minimize:!0,restore:!1,drawer:!1,curtain:!1},restore:{attach:!1,detach:!0,close:!1,minimize:!1,restore:!0,drawer:!1,curtain:!1},close:{attach:!1,detach:!1,close:!0,minimize:!1,restore:!1,drawer:!1,curtain:!1},drawer:{attach:!1,detach:!1,close:!1,minimize:!1,restore:!1,drawer:!0,curtain:!1},shade:{attach:!1,detach:!1,close:!1,minimize:!1,restore:!1,drawer:!1,curtain:!0}},defaults:{detach:{left:"212px",top:"50px"},attach:{left:"192px",top:"30px"}},tileTransitions:{attach:{"oskari-tile-attached":!0,"oskari-tile-detached":!1,"oskari-tile-closed":!1},detach:{"oskari-tile-attached":!1,"oskari-tile-detached":!0,"oskari-tile-minimized":!1,"oskari-tile-closed":!1},minimize:{"oskari-tile-minimized":!0,"oskari-tile-closed":!1,"oskari-tile-detached":!1},restore:{"oskari-tile-minimized":!1,"oskari-tile-detached":!0},close:{"oskari-tile-closed":!0,"oskari-tile-attached":!1,"oskari-tile-detached":!1}},flyoutTransitions:{attach:{"oskari-attached":!0,"oskari-detached":!1,"oskari-closed":!1},detach:{"oskari-attached":!1,"oskari-detached":!0,"oskari-closed":!1},minimize:{"oskari-minimized":!0,"oskari-closed":!1,"oskari-detached":!1},restore:{"oskari-minimized":!1,"oskari-closed":!1,"oskari-detached":!0,"oskari-attached":!1},close:{"oskari-closed":!0,"oskari-minimized":!1,"oskari-detached":!1,"oskari-attached":!1}},applyTransition:function(e,t,i){var i=i[t];if(i)for(var s in i)i[s]?e.addClass(s):e.removeClass(s)},getFlyoutViewState:function(e,t){var i={left:e.css("left"),top:e.css("top"),width:e.width(),height:e.height(),"z-index":e.css("z-index"),viewState:t};return i},flyoutOps:{detach:function(e,t,i){var s=this;(!i.viewState.left||!i.viewState.top||i.viewState.left==s.defaults.attach.left&&i.viewState.top==s.defaults.attach.top)&&(i.viewState.left=s.defaults.detach.left,i.viewState.top=s.defaults.detach.top),{left:i.viewState.left,top:i.viewState.top},s.shuffleZIndices(e),s.applyTransition(e,"detach",s.flyoutTransitions);var a=s.getFlyoutViewState(e,"detach");i.viewState=a},attach:function(e,t,i){var s=this;s.shuffleZIndices(e),s.applyTransition(e,"attach",s.flyoutTransitions);var a=s.getFlyoutViewState(e,"attach");i.viewState=a},minimize:function(e,t,i){var s=this,a=s.getFlyoutViewState(e,"minimize");s.applyTransition(e,"minimize",s.flyoutTransitions),i.viewState=a},restore:function(e,t,i){var s=this;s.applyTransition(e,"restore",s.flyoutTransitions),i.viewState},close:function(e,t,i){var s=this;i.viewState={viewState:"close"},s.applyTransition(e,"close",s.flyoutTransitions)}},setState:function(e){var t=this,i=e;if(i)for(var s in t.extensionsByName){var a=t.extensionsByName[s],r=i.extensionStatesByName[s];r&&(a.state=r.state,a.viewState=r.viewState||{})}},getState:function(){var e=this;e.refreshExtensionViewStates();var t={extensionStatesByName:{}};for(var i in e.extensionsByName){var s=e.extensionsByName[i];t.extensionStatesByName[i]={state:s.state,viewState:s.viewState}}return t},applyState:function(){var e=this;e.restoreExtensionViewStates()},refreshExtensionViewStates:function(){var e=this;for(var t in e.extensionsByName){var i=e.extensionsByName[t],s=i.plugins["Oskari.userinterface.Flyout"];if(s){s.plugin;var a=s.el,r=e.getFlyoutViewState(a,i.state);i.viewState=r}}},restoreExtensionViewStates:function(){var e=this,t=e.flyoutOps,i=e.extensions;for(var s in e.extensionsByName){var a=e.extensionsByName[s];a.extension;var r=a.plugins["Oskari.userinterface.Flyout"];if(r){var n=r.plugin,o=r.el,l=a.viewState;o.removeAttr("style"),o.css("left",l.left),o.css("top",l.top),o.width(l.width),o.height(l.height),o.css("z-index",l["z-index"]);var h=t[a.state];h.apply(e,[o,n,a,i])}var u=a.plugins["Oskari.userinterface.Tile"];if(u){u.plugin;var p=u.el;e.applyTransition(p,a.state,e.tileTransitions)}}},shuffleZIndices:function(e){var t=this;t.extensions;var i=[],s={},a={},r={},n=1100;for(var o in t.extensionsByName){var l=t.extensionsByName[o];l.extension;var h=l.plugins["Oskari.userinterface.Flyout"];if(h){h.plugin;var u=h.el,p=u.css("z-index");i.push(p);var c=""+p;s[c]=p,r[c]=u,a[c]=l}}i.sort();for(var d=0;i.length>d;d++){var c=i[d];s[c]=n+d,r[c].css("z-index",s[i[d]])}e.css("z-index",n+i.length+2)},ieFixClasses:[{min:400,max:599,cls:"oskari-flyoutcontentcontainer_IE_400_599"},{min:600,max:799,cls:"oskari-flyoutcontentcontainer_IE_600_799"},{min:800,max:999,cls:"oskari-flyoutcontentcontainer_IE_800_999"},{min:1e3,max:1199,cls:"oskari-flyoutcontentcontainer_IE_1000_1199"},{min:1200,max:1399,cls:"oskari-flyoutcontentcontainer_IE_1200_1399"},{min:1400,max:9999,cls:"oskari-flyoutcontentcontainer_IE_1400"}]},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Stateful"]}),Oskari.clazz.define("Oskari.userinterface.request.AddExtensionRequest",function(e){this._extension=e},{__name:"userinterface.AddExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.AddExtensionRequestHandler",function(e){this.ui=e},{handleRequest:function(e,t){var i=t.getExtension();this.ui.addExtension(i)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.userinterface.request.RemoveExtensionRequest",function(e){this._extension=e},{__name:"userinterface.RemoveExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.RemoveExtensionRequestHandler",function(e){this.ui=e},{handleRequest:function(e,t){var i=t.getExtension();this.ui.removeExtension(i)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.userinterface.request.UpdateExtensionRequest",function(e,t,i){this._extension=e,this._state=t,this._extensionName=i},{__name:"userinterface.UpdateExtensionRequest",getName:function(){return this.__name},getExtension:function(){return this._extension},getState:function(){return this._state},getExtensionName:function(){return this._extensionName}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.UpdateExtensionRequestHandler",function(e){this.ui=e},{handleRequest:function(e,t){var i=t.getExtension(),s=t.getExtensionName();if(!i&&s&&"*"!=s){var a=this.ui.getExtensionByName(s);if(!a)return;i=a.extension}this.ui.updateExtension(i,t)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.userinterface.request.ModalDialogRequest",function(e,t,i,s){this._title=e?e:"Untitled",this._message=t?t:"Lorem ipsum",this._buttons=i?i:{},this._parent=parent?parent:jQuery("#mapdiv"),this._onshow=s?s:null},{__name:"userinterface.ModalDialogRequest",getName:function(){return this.__name},getTitle:function(){return this._title},getMessage:function(){return this._message},getButtons:function(){return this._buttons},getGeom:function(){return this._geom},getParent:function(){return this._parent},getOnShow:function(){return this._onshow}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.userinterface.bundle.ui.request.ModalDialogRequestHandler",function(e){this._ui=e,this._tpl={},this._tpl.modal=jQuery('<div id="modaldialog" class="modaldialog">  <div class="modaltitle"></div>  <div class="modalmessage"></div>  <div class="modalbuttons"></div> </div>'),this._tpl.button=jQuery('<div class="modalbutton"><input type="button" /></input></div>'),this._buttons={},this._args={closeClass:"modalclose",overlayId:"modaloverlay",overlayCss:{"background-color":"lightgrey",cursor:"wait"},containerId:"modalcontainer",containerCss:{"background-color":"white"},onClose:function(){this.close()},zIndex:80130}},{handleRequest:function(e,t){var i=this._tpl.modal.clone();i.find(".modaltitle").append(t.getTitle()),i.find(".modalmessage").append(t.getMessage());var s=t.getButtons(),a=i.find(".modalbuttons");for(var r in s)if(s[r].name){var n=s[r],o=this._tpl.button.clone(),l=o.find("input");l.attr("name",n.name),l.attr("text",n.text),l.attr("value",n.text),l.bind("click",n.onclick),n.close!==!1&&l.addClass(this._args.closeClass),a.append(o)}t.onshow&&(this._args.onShow=onshow),$.modal=i.modal(this._args)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.userinterface.event.ExtensionUpdatedEvent",function(e,t,i){this._creator=null,this._extension=e,this.viewstate=t,this.viewinfo=i},{__name:"userinterface.ExtensionUpdatedEvent",getName:function(){return this.__name},getExtension:function(){return this._extension},getViewState:function(){return this.viewstate},setViewState:function(e){this.viewstate=e},getViewInfo:function(){return this.viewinfo},setViewInfo:function(e){this.viewinfo=e}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.userinterface.component.Accordion",function(){this.template=jQuery('<div class="accordion"></div>'),this.templateMsg=jQuery('<div class="accordionmsg"></div>'),this.panels=[],this.ui=this.template.clone()},{addPanel:function(e){this.removeMessage(),this.panels.push(e),e.insertTo(this.ui)},removePanel:function(e){for(var t=null,i=0;this.panels.length>i;i++)if(this.panels[i]===e){t=this.panels[i],this.panels.splice(i,1);break}return t?(t.destroy(),!0):!1},removeAllPanels:function(){this.ui.empty(),this.panels=[]},removeMessage:function(){var e=this.ui.find("div.accordionmsg");e.length>0&&e.remove()},showMessage:function(e){this.removeMessage();var t=this.templateMsg.clone();t.append(e),this.ui.append(t)},showPanels:function(){for(var e=0;this.panels.length>e;e++)this.panels[e].setVisible(!0)},hidePanels:function(){for(var e=0;this.panels.length>e;e++)this.panels[e].setVisible(!1)},insertTo:function(e){e.append(this.ui)},getContainer:function(){return this.ui}}),Oskari.clazz.define("Oskari.userinterface.component.AccordionPanel",function(){this.template=jQuery('<div class="accordion_panel"><div class="header"><div class="headerIcon icon-arrow-right"></div><div class="headerText"></div></div><div class="content"></div></div>'),this.title=null,this.content=null,this.html=this.template.clone();var e=this,t=this.html.find("div.header");t.click(function(){e.isOpen()?e.close():e.open()}),this.html.find("div.content").hide()},{setVisible:function(e){1==e?this.html.show():this.html.hide()},isVisible:function(){return this.html.is(":visible")},isOpen:function(){return this.html.hasClass("open")},open:function(){this.html.addClass("open");var e=this.html.find("div.header div.headerIcon");e.removeClass("icon-arrow-right"),e.addClass("icon-arrow-down"),this.html.find("div.content").show()},close:function(){this.html.removeClass("open");var e=this.html.find("div.header div.headerIcon");e.removeClass("icon-arrow-down"),e.addClass("icon-arrow-right"),this.html.find("div.content").hide()},setTitle:function(e){this.title=e;var t=this.html.find("div.header div.headerText");t.html(this.title)},getTitle:function(){return this.title},setContent:function(e){this.content=e;var t=this.html.find("div.content");t.append(this.content)},destroy:function(){this.html.remove()},getContainer:function(){return this.html.find("div.content")},insertTo:function(e){e.append(this.html)}}),Oskari.clazz.define("Oskari.userinterface.component.TabContainer",function(e){this.panels=[],this.tabChangeListeners=[],this.emptyMsg=e?e:"No content",this.template=jQuery('<div class="oskariTabs">'+this.emptyMsg+"</div>"),this.templateTabs=jQuery('<div class="tabsHeader"><ul></ul></div><br clear="all"/><div class="tabsContent"></div>'),this.ui=this.template.clone()},{addPanel:function(e){var t=this;if(0==this.panels.length){var i=this.templateTabs.clone();this.ui.html(i)}var s=this.ui.find("ul"),a=e.getHeader();s.append(a),e.insertTo(this.ui.find("div.tabsContent")),this.panels.push(e),1==this.panels.length&&this.select(e);var r=a.find("a");r.bind("click",function(){return t.select(e),!1})},addTabChangeListener:function(e){this.tabChangeListeners.push(e)},select:function(e){for(var t=null,i=0;this.panels.length>i;i++)if(this.isSelected(this.panels[i])){t=this.panels[i],t.handleSelection(!1);break}var s=this.ui.find("ul");s.find("li").removeClass("active");var a=this.ui.children().children("div.tab-content");a.hide(),e.getHeader().addClass("active"),e.getContainer().show(),e.handleSelection(!0);for(var i=0;this.tabChangeListeners.length>i;i++)this.tabChangeListeners[i](t,e)},isSelected:function(e){return e.getHeader().hasClass("active")},removePanel:function(e){for(var t=null,i=0;this.panels.length>i;i++)if(this.panels[i]===e){t=this.panels[i],this.panels.splice(i,1);break}if(0==this.panels.length){this.ui.html(this.emptyMsg);for(var i=0;this.tabChangeListeners.length>i;i++)this.tabChangeListeners[i](e)}else this.select(this.panels[0]);return t?(t.destroy(),!0):!1},insertTo:function(e){e.append(this.ui)}}),Oskari.clazz.define("Oskari.userinterface.component.TabDropdownContainer",function(e){this.panels=[],this.tabChangeListeners=[],this.emptyMsg=e?e:"No content",this.template=jQuery('<div class="oskariTabs">'+this.emptyMsg+"</div>"),this.templateTabOption=jQuery("<option></option>"),this.templateTabs=jQuery('<div class="tabsHeader"><ul><li><select name="tabs"></select></li></ul></div><br clear="all"/><div class="tabsContent"></div>'),this.ui=this.template.clone()},{addPanel:function(e){var t=this;if(0==this.panels.length){var i=this.templateTabs.clone();this.ui.html(i)}var s=this.ui.find("ul li select"),a=this.templateTabOption.clone();a.append(e.getTitle()),s.append(a),e.setHeader(a),e.insertTo(this.ui.find("div.tabsContent")),this.panels.push(e),1==this.panels.length&&(this.select(e),s.bind("change",function(){t.select(t.panels[this.selectedIndex])}))},addTabChangeListener:function(e){this.tabChangeListeners.push(e)},select:function(e){var t=null;if(this.tabChangeListeners.length>0)for(var i=0;this.panels.length>i;i++)if(this.isSelected(this.panels[i])){t=this.panels[i];break}var s=this.ui.children().children("div.tab-content");s.hide();var a=this.ui.find("ul li select"),r=a.find("option");r.removeAttr("selected");var n=this._getPanelIndex(e);jQuery(r[n]).attr("selected","selected"),e.getContainer().show();for(var i=0;this.tabChangeListeners.length>i;i++)this.tabChangeListeners[i](t,e)},isSelected:function(e){var t=this.ui.find("ul li select :selected");return t.index()==this._getPanelIndex(e)},_getPanelIndex:function(e){for(var t=0;this.panels.length>t;t++)if(this.panels[t]==e)return t;return-1},removePanel:function(e){for(var t=null,i=0;this.panels.length>i;i++)if(this.panels[i]===e){t=this.panels[i],this.panels.splice(i,1);break}if(0==this.panels.length){this.ui.html(this.emptyMsg);for(var i=0;this.tabChangeListeners.length>i;i++)this.tabChangeListeners[i](e)}else this.select(this.panels[0]);return t?(t.destroy(),!0):!1},insertTo:function(e){e.append(this.ui)}}),Oskari.clazz.define("Oskari.userinterface.component.TabPanel",function(){this.template=jQuery('<div class="tab-content"></div>'),this.templateTabHeader=jQuery('<li><a href="JavaScript:void(0);"></a></li>'),this.title=null,this.content=null,this.header=null,this.selectionHandler=null,this.html=this.template.clone(),this.html.hide()},{setTitle:function(e){this.title=e;var t=this.templateTabHeader.clone();this.header=t;var i=t.find("a");i.html(this.getTitle())},getTitle:function(){return this.title},setHeader:function(e){this.header=e},getHeader:function(){return this.header},setContent:function(e){this.content=e,this.html.html(this.content)},destroy:function(){this.header.remove(),this.html.remove()},getContainer:function(){return this.html},setSelectionHandler:function(e){this.selectionHandler=e},handleSelection:function(e){this.selectionHandler&&this.selectionHandler(1==e)},insertTo:function(e){e.append(this.html)}}),Oskari.clazz.define("Oskari.userinterface.component.Badge",function(){this.compiledTemplates={},this.compileTemplates(),this.ui=null,this.container=null},{templates:{"default":'<span class="oskari-badge"></span>',success:'<span class="oskari-badge oskari-badge-success"></span>',warning:'<span class="oskari-badge oskari-badge-warning"></span>',important:'<span class="oskari-badge oskari-badge-important"></span>',info:'<span class="oskari-badge oskari-badge-info"></span>',success:'<span class="oskari-badge oskari-badge-inverse"></span>'},compileTemplates:function(){for(var e in this.templates)this.compiledTemplates[e]=jQuery(this.templates[e])},insertTo:function(e){this.container=e},setContent:function(e,t){this.ui&&(this.ui.remove(),this.ui=null);var i=this.compiledTemplates[t||"default"].clone();i.append(e),this.container.append(i),this.ui=i},hide:function(){this.ui&&(this.ui.remove(),this.ui=null)}}),Oskari.clazz.define("Oskari.userinterface.component.Alert",function(){this.compiledTemplates={},this.compileTemplates(),this.ui=null,this.container=null},{templates:{"default":'<div class="oskari-alert"><div class="oskari-alert-icon-close"></div></div>',success:'<div class="oskari-alert oskari-alert-success"><div class="oskari-alert-icon-close"></div></div>',error:'<div class="oskari-alert oskari-alert-error"><div class="oskari-alert-icon-close"></div></div>',info:'<div class="oskari-alert oskari-alert-info"><div class="oskari-alert-icon-close"></div></div>'},compileTemplates:function(){for(var e in this.templates)this.compiledTemplates[e]=jQuery(this.templates[e])},insertTo:function(e){this.container=e},setContent:function(e,t){this.ui&&(this.ui.remove(),this.ui=null);var i=this.compiledTemplates[t||"default"].clone();i.append(e),this.container.prepend(i),this.ui=i;var s=this;i.children(".oskari-alert-icon-close").click(function(){s.hide()})},hide:function(){this.ui&&(this.ui.remove(),this.ui=null)}}),Oskari.clazz.define("Oskari.userinterface.component.Popup",function(){this.template=jQuery('<div class="divmanazerpopup"><h3></h3><div class="content"></div><div class="actions"></div></div>'),this.templateButton=jQuery('<div class="button"><a href="JavaScript:void(0);"></a></div>'),this.dialog=this.template.clone(),this.overlay=null},{show:function(e,t,i){var s=this;if(this.dialog.find("h3").html(e),this.dialog.find("div.content").html(t),i&&i.length>0){var a=this.dialog.find("div.actions");a.empty();for(var r=0;i.length>r;++r)i[r].insertTo(a)}else this.dialog.bind("click",function(){s.close(!0)});jQuery("body").append(this.dialog),this.dialog.css("margin-left",-(this.dialog.width()/2)+"px"),this.dialog.css("margin-top",-(this.dialog.height()/2)+"px")},fadeout:function(e){var t=this,i=3e3;e&&(i=e),setTimeout(function(){t.close()},i)},addClass:function(e){this.dialog.addClass(e)},createCloseButton:function(e){var t=this,i=Oskari.clazz.create("Oskari.userinterface.component.Button");return i.setTitle(e),i.setHandler(function(){t.close(!0)}),i},close:function(e){var t=this;this.overlay&&this.overlay.close(),e?t.dialog.remove():(t.dialog.animate({opacity:0},500),setTimeout(function(){t.dialog.remove()},500))},alignment:["left","right","top","bottom"],moveTo:function(e,t){var i="right";t&&-1!=jQuery.inArray(t,this.alignment)&&(i=t);var s=jQuery(e),a=s.offset(),r=s.outerWidth(),n=s.outerHeight(),o=this.dialog.outerWidth(),l=this.dialog.outerHeight(),h=a.left,u=a.top;"right"==i?(h=h+r+5,u=u+n/2-l/2):"left"==i?(h=h-o-5,u=u+n/2-l/2):"top"==i?(u=u-l-5,h=h+r/2-o/2):"bottom"==i&&(u=u+n+5,h=h+r/2-o/2),0>h&&(h=0),0>u&&(u=0),this.dialog.addClass("arrow"),this.dialog.addClass(t),this.dialog.css({left:h+"px",top:u+"px","margin-left":0,"margin-top":0})},resetPosition:function(){this.dialog.removeClass("arrow");for(var e=0;this.alignment.length>e;++e)this.dialog.removeClass(this.alignment[e]);this.dialog.removeAttr("style")},makeModal:function(){var e=Oskari.clazz.create("Oskari.userinterface.component.Overlay");e.overlay("body"),this.overlay=e,e.followResizing(!0)},setContent:function(e){var t=this.dialog.find("div.content");t.empty(),t.append(e)},makeDraggable:function(){var e=this;e.dialog.css("position","absolute"),e.dialog.draggable({scroll:!1})}}),Oskari.clazz.define("Oskari.userinterface.component.Overlay",function(){this.template=jQuery('<div class="oskarioverlay transparent"></div>'),this._overlay=null,this._targetSelector=null,this._resizingWorkaround=null},{overlay:function(e){this._overlay=this.template.clone(),this._targetSelector=e,this._targetSelector||(this._targetSelector="body");var t=jQuery(this._targetSelector);t.append(this._overlay),this._setupSizeAndLocation(),this._overlay.bind("click",function(e){e.preventDefault()})},_setupSizeAndLocation:function(){var e=jQuery(this._targetSelector);this._overlay.css({left:"0px",top:"0px",width:e.width()+"px",height:e.height()+"px"})},resize:function(){var e=jQuery(this._targetSelector);this._overlay.height(e.height()),this._overlay.width(e.width())},followResizing:function(e){var t=this;e?jQuery(window).resize(function(){t.resize()}):this._resizingWorkaround=setTimeout(function(){t.resize(),t.followResizing()},500)},close:function(){this._overlay.remove(),jQuery(this._targetSelector),this._resizingWorkaround&&clearTimeout(this._resizingWorkaround)},bindClickToClose:function(){var e=this;this._overlay.bind("click",function(){e.close()})}}),Oskari.clazz.define("Oskari.userinterface.component.Button",function(){this.template=jQuery('<input type="button"/>'),this.title=null,this.ui=this.template.clone(),this.handler=null},{setTitle:function(e){this.title=e,this.ui&&this.ui.attr("value",e)},addClass:function(e){this.ui.addClass(e)},setEnabled:function(e){e===!0?this.ui.removeAttr("disabled"):this.ui.attr("disabled","disabled")},getTitle:function(){return this.title},setHandler:function(e){this.handler&&this.ui.unbind("click",this.handler),this.handler=e,this.ui.bind("click",this.handler)},destroy:function(){this.ui.remove()},insertTo:function(e){e.append(this.ui)},getButton:function(){return this.ui}}),Oskari.clazz.define("Oskari.userinterface.component.Form",function(){this.template=jQuery('<div class="oskariform"></div>'),this._form=this.template.clone(),this.fields=[]},{addField:function(e){this.fields.push(e)},getForm:function(){this._form=this.template.clone();for(var e=0;this.fields.length>e;++e)this._form.append(this.fields[e].getField());return this._form},validate:function(){for(var e=[],t=0;this.fields.length>t;++t)e=e.concat(this.fields[t].validate());return e},showErrors:function(){for(var e=0;this.fields.length>e;++e){var t=this.fields[e].validate();this.fields[e].showErrors(t)}},clearErrors:function(){for(var e=0;this.fields.length>e;++e)this.fields[e].clearErrors()}}),Oskari.clazz.define("Oskari.userinterface.component.UIHelper",function(e){this.sandbox=e},{processHelpLinks:function(e,t,i,s){if(t){var a=this,r=function(t){return function(a,r){var n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),o=n.createCloseButton("OK");o.addClass("primary"),a?(n.show(e,r["static"],[o]),n.moveTo(t,"bottom")):n.show(i,s,[o])}};t.find("[helptags]").each(function(e,t){var i=jQuery(t),s=i.attr("helptags");i.bind("click",function(){a.getHelpArticle(s,r(i))})})}},getHelpArticle:function(e,t){var i=this;jQuery.ajax({url:i.sandbox.getAjaxUrl()+"action_route=GetArticlesByTag",data:{tags:e},type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(e){e&&e.articles[0]&&e.articles[0].content?t(!0,e.articles[0].content):t(!1)},error:function(){t(!1)}})}}),Oskari.clazz.define("Oskari.userinterface.component.FormInput",function(e){this.template=jQuery('<div class="oskarifield"><label></label><input type="text" /></div>'),this.templateErrors=jQuery('<div class="error"></div>'),this.templateTooltip=jQuery('<div class="icon-info"></div>'),this.templateClearButton=jQuery('<div class="icon-close" style="margin-left: 0px; position: relative; display: inline-block; left: -20px; top: 3px;"></div>'),this._field=this.template.clone();
var t=this._field.find("label");t.attr("for",e);var i=this._field.find("input");i.attr("name",e),this._name=e,this._validator=null,this._required=!1,this._requiredMsg="required",this._contentCheck=!1,this._contentCheckMsg="illegal characters",this._bindFocusAndBlur(),this._regExp=/[\s\w\d\.\,\?\!\-äöåÄÖÅ]*/,this._colorRegExp=/^([A-Fa-f0-9]{6})$/},{setLabel:function(e){var t=this._field.find("label");t.html(e)},setTooltip:function(e,t){var i=this.templateTooltip.clone();i.attr("title",e),t&&(i.addClass("help"),i.attr("helptags",t));var s=this._field.find("label");s.before(i)},setPlaceholder:function(e){var t=this._field.find("input");t.attr("placeholder",e)},setRequired:function(e,t){this._required=1==e,t&&(this._requiredMsg=t)},setContentCheck:function(e,t,i){this._contentCheck=1==e,i&&(this._regExp=i),t&&(this._contentCheckMsg=t)},showErrors:function(e){this.clearErrors();for(var t=this.templateErrors.clone(),i=0;e.length>i;++i)t.append(e[i].error+"<br/>");this._field.append(t)},clearErrors:function(){var e=this._field.find("div.error");e.remove()},getField:function(){return this._field},getValue:function(e){var t=this._field.find("input").val();return e&&(t=t.match(this._regExp)),t},setValue:function(e){this._field.find("input").attr("value",e)},getName:function(){return this._name},setEnabled:function(e){e===!0?this._field.find("input").removeAttr("disabled"):this._field.find("input").attr("disabled","disabled")},setValidator:function(e){this._validator=e},validate:function(){var e=[];this._validator&&(e=this._validator(this));var t=this.getValue();return this._required&&(this.checkLength(t,1)||e.push({field:this.getName(),error:this._requiredMsg})),this._contentCheck&&(this.checkValue()||e.push({field:this.getName(),error:this._contentCheckMsg})),e},checkLength:function(e,t,i){if(e){var s=jQuery.trim(""+e);return t&&t>s.length?!1:i&&s.length>i?!1:!0}return!1},checkValue:function(){var e=this.getValue(),t=this.getValue(!0);return e==t},validateNumberRange:function(e,t,i){return isNaN(parseInt(e))?!1:isFinite(e)?t>e||e>i?!1:!0:!1},validateHexColor:function(e){return this._colorRegExp.test(e)},bindEnterKey:function(e){var t=this,i=this._field.find("input");i.keypress(function(i){t._isEnterPress(i)&&e()})},bindChange:function(e,t){var i=this._field.find("input");t?i.keyup(e):i.on("change",e)},addClearButton:function(){var e=this.templateClearButton.clone(),t=this._field.find("input");e.bind("click",function(){t.val(""),t.trigger("change"),t.trigger("keyup")}),t.after(e)},_bindFocusAndBlur:function(){var e=Oskari.$("sandbox");if(e){var t=e.getRequestBuilder("EnableMapKeyboardMovementRequest"),i=e.getRequestBuilder("DisableMapKeyboardMovementRequest");if(t&&i){var s=this._field.find("input");s.focus(function(){e.postRequestByName("DisableMapKeyboardMovementRequest")}),s.blur(function(){e.postRequestByName("EnableMapKeyboardMovementRequest")})}}},_isEnterPress:function(e){var t;return window.event?t=window.event.keyCode:e&&(t=e.which),13==e.keyCode}}),!function(e){"use strict";var t=function(e,t){this.init("oskariTooltip",e,t)};t.prototype={constructor:t,init:function(t,i,s){var a,r;this.type=t,this.$element=e(i),this.options=this.getOptions(s),this.enabled=!0,"manual"!=this.options.trigger&&(a="hover"==this.options.trigger?"mouseenter":"focus",r="hover"==this.options.trigger?"mouseleave":"blur",this.$element.on(a,this.options.selector,e.proxy(this.enter,this)),this.$element.on(r,this.options.selector,e.proxy(this.leave,this))),this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,t,this.$element.data()),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var i=e(t.currentTarget)[this.type](this._options).data(this.type);return i.options.delay&&i.options.delay.show?(clearTimeout(this.timeout),i.hoverState="in",this.timeout=setTimeout(function(){"in"==i.hoverState&&i.show()},i.options.delay.show),void 0):i.show()},leave:function(t){var i=e(t.currentTarget)[this.type](this._options).data(this.type);return i.options.delay&&i.options.delay.hide?(clearTimeout(this.timeout),i.hoverState="out",this.timeout=setTimeout(function(){"out"==i.hoverState&&i.hide()},i.options.delay.hide),void 0):i.hide()},show:function(){var e,t,i,s,a,r,n;if(this.hasContent()&&this.enabled){switch(e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),r=this.options.placement.apply(this.options.scope),t=/in/.test(r),e.remove().css({top:0,left:0,display:"block"}).appendTo(t?this.$element:document.body),i=this.getPosition(t),s=e[0].offsetWidth,a=e[0].offsetHeight,t?r.split(" ")[1]:r){case"bottom":n={top:i.top+i.height,left:i.left+i.width/2-s/2};break;case"top":n={top:i.top-a,left:i.left+i.width/2-s/2};break;case"left":n={top:i.top+i.height/2-a/2,left:i.left-s};break;case"right":n={top:i.top+i.height/2-a/2,left:i.left+i.width}}e.css(n).addClass(r).addClass("in")}},isHTML:function(e){return"string"!=typeof e||"<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3||/^(?:[^<]*<[\w\W]+>[^>]*$)/.exec(e)},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".oskari-tooltip-inner")[this.isHTML(t)?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){function t(){var t=setTimeout(function(){i.off(e.support.transition.end).remove()},500);i.one(e.support.transition.end,function(){clearTimeout(t),i.remove()})}var i=this.tip();i.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?t():i.remove()},fixTitle:function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(t){return e.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){return this.options.title.apply(this.options.scope)},tip:function(){return this.$tip=this.$tip||e(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()},attach:function(e){this.$element=e}},e.fn.oskariTooltip=function(i){return this.each(function(){var s=e(this),a=s.data("oskariTooltip"),r="object"==typeof i&&i;a||s.data("oskariTooltip",a=new t(this,r)),"string"==typeof i&&a[i]()})},e.fn.oskariTooltip.Constructor=t,e.fn.oskariTooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="oskari-tooltip"><div class="oskari-tooltip-arrow"></div><div class="oskari-tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0};var i=function(e,t){this.init("oskariPopover",e,t)};i.prototype=e.extend({},e.fn.oskariTooltip.Constructor.prototype,{constructor:i,setContent:function(){var e=this.tip(),t=this.getTitle(),i=this.getContent();e.find(".oskari-popover-title")[this.isHTML(t)?"html":"text"](t),e.find(".oskari-popover-content > *")[this.isHTML(i)?"html":"text"](i),e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){return this.options.content.apply(this.options.scope)},tip:function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip}}),e.fn.oskariPopover=function(t){return this.each(function(){var s=e(this),a=s.data("oskariPopover"),r="object"==typeof t&&t;a||s.data("oskariPopover",a=new i(this,r)),"string"==typeof t&&a[t]()})},e.fn.oskariPopover.Constructor=i,e.fn.oskariPopover.defaults=e.extend({},e.fn.oskariTooltip.defaults,{placement:"right",content:"",template:'<div class="oskari-popover"><div class="oskari-arrow"></div><div class="oskari-popover-inner"><h3 class="oskari-popover-title"></h3><div class="oskari-popover-content"><p></p></div></div></div>'}),Oskari.clazz.define("Oskari.userinterface.component.Popover",function(e,t){this.title=e,this.content=t,this.$container=null,this.data=null,this.shown=!1,this.placement="bottom"},{templates:{container:'<div class="oskari-popover-container"/>'},hide:function(){this.shown&&(this.shown=!1,this.data&&this.data.hide())},show:function(){this.shown||this.data&&(this.data.show(),this.shown=!0)},attachTo:function(t){var s=this;this.$container=e(t),this.data?this.data.attach(this.$container):this.data=new i(t,{scope:s,title:s.getTitle,content:s.getContent,trigger:"manual",placement:s.getPlacement}),this.$container.data("oskariPopover",this.data)},getTitle:function(){return this.title},getContent:function(){return this.content},setContent:function(e,t){this.hide(),this.content=e,t&&(this.title=t),this.show()},setTitle:function(e,t){this.hide(),this.title=e,t&&(this.content=t),this.show()},setPlacement:function(e){this.placement=e},getPlacement:function(){return this.placement}})}(window.jQuery),Oskari.clazz.define("Oskari.userinterface.component.Grid",function(){this.model=null,this.template=jQuery("<table><thead><tr></tr></thead><tbody></tbody></table>"),this.templateTableHeader=jQuery('<th><a href="JavaScript:void(0);"></a></th>'),this.templateRow=jQuery("<tr></tr>"),this.templateCell=jQuery("<td></td>"),this.templatePopupLink=jQuery('<a href="JavaScript: void(0);"></a>'),this.table=null,this.fieldNames=[],this.selectionListeners=[],this.additionalDataHandler=null,this.uiNames={},this.valueRenderer={},this.lastSort=null},{setDataModel:function(e){this.model=e},getDataModel:function(){return this.model},setColumnUIName:function(e,t){this.uiNames[e]=t},setColumnValueRenderer:function(e,t){this.valueRenderer[e]=t},setVisibleFields:function(e){this.fieldNames=e},addSelectionListener:function(e){this.selectionListeners.push(e)},setAdditionalDataHandler:function(e,t){this.additionalDataHandler={title:e,handler:t}},_createAdditionalDataField:function(e){var t=this._renderAdditionalData(e);if(!e.size&&this.additionalDataHandler){var i=this,s=this.templatePopupLink.clone();return s.append(this.additionalDataHandler.title),s.bind("click",function(){return i.additionalDataHandler.handler(s,t),!1}),s}return t},_renderAdditionalData:function(e){if(e.size){for(var t="",i=0;e.size()>i;++i)0!=i&&(t+=", "),t+=e[i];return t}var s=this.template.clone(),a=s.find("tbody");for(var r in e){var n=this.templateRow.clone(),t=e[r],o=this.templateCell.clone();o.append(r),n.append(o);var l=this.templateCell.clone();try{var h=typeof t;if("object"===h){var u=this._renderAdditionalData(t);l.append(u)}else"function"!==h&&l.append(t);n.append(l)}catch(p){}a.append(n)}return s},_renderHeader:function(e,t){for(var i=this,s=e.find("thead tr"),a=e.find("tbody"),r=function(r){return function(){var n=jQuery(this),o=i.getSelection();a.empty();var l=!1;i.lastSort&&i.lastSort.attr==r&&(l=!i.lastSort.descending),i._sortBy(r,l),i._renderBody(e,t),s.find("th").removeClass("asc"),s.find("th").removeClass("desc"),l?n.parent().addClass("desc"):n.parent().addClass("asc");for(var h=i.model.getIdField(),u=0;o.length>u;++u)i.select(o[u][h],!0);return!1}},n=0;t.length>n;++n){var o=this.templateTableHeader.clone(),l=o.find("a"),h=t[n],u=this.uiNames[h];u||(u=h),l.append(u),i.lastSort&&h==i.lastSort.attr&&(i.lastSort.descending?o.addClass("desc"):o.addClass("asc")),l.bind("click",r(t[n])),s.append(o)}},_renderBody:function(e,t){for(var i=this,s=e.find("tbody"),a=this.model.getData(),r=0;a.length>r;++r){var n=this.templateRow.clone(),o=a[r];n.attr("data-id",o[this.model.getIdField()]);for(var l=0;t.length>l;++l){var h=t[l],u=o[h],p=this.templateCell.clone();if("object"==typeof u)p.append(this._createAdditionalDataField(u));else{var c=this.valueRenderer[h];c&&(u=c(u,o)),p.append(u)}n.append(p)}s.append(n)}var d=e.find("tbody tr"),m=function(){i._dataSelected(jQuery(this).attr("data-id"))};d.bind("click",m),d.find("a").hover(function(){jQuery(this).parents("tr").unbind("click")},function(){jQuery(this).parents("tr").bind("click",m)})},renderTo:function(e){var t=this.fieldNames;0==t.length&&(t=this.model.getFields());var i=this.template.clone();this.table=i,this._renderHeader(i,t),this.lastSort&&this._sortBy(this.lastSort.attr,this.lastSort.descending),this._renderBody(i,t),e.append(i)},_dataSelected:function(e){for(var t=0;this.selectionListeners.length>t;t++)this.selectionListeners[t](this,e)},select:function(e,t){for(var i=this.model.getIdField(),s=this.model.getData(),a=0;s.length>a;++a){var r=s[a];if(r[i]==e)break}var n=this.table.find("tbody tr");1!=t&&n.removeClass("selected"),jQuery(n[a]).addClass("selected")},getSelection:function(){for(var e=this.model.getData(),t=[],i=this.table.find("tbody tr"),s=0;i.length>s;++s){var a=jQuery(i[s]);a.hasClass("selected")&&t.push(e[s])}return t},_sortBy:function(e,t){var i=this,s=this.model.getData();0!=s.length&&(this.lastSort={attr:e,descending:t},s.sort(function(s,a){return i._sortComparator(s,a,e,t)}))},_sortComparator:function(e,t,i,s){if("object"==typeof e[i]||"object"==typeof t[i])return 0;var a=e[i];a?a.toLowerCase&&(a=a.toLowerCase()):a="";var r=t[i];r?r.toLowerCase&&(r=r.toLowerCase()):r="";var n=0;return r>a?n=-1:a>r&&(n=1),s&&(n=-1*n),n}}),Oskari.clazz.define("Oskari.userinterface.component.GridModel",function(){this.fields=[],this.data=[],this.idField=null},{_addField:function(e){this.idField||(this.idField=e),this.fields.push(e)},getFields:function(){return this.fields},setIdField:function(e){this.idField=e},getIdField:function(){return this.idField},addData:function(e){if(0==this.fields.length)for(var t in e)this._addField(t);this.data.push(e)},getData:function(){return this.data}}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.ToolbarBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/button-methods.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/default-buttons.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/AddToolButtonRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/RemoveToolButtonRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/ToolButtonStateRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/SelectToolButtonRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/ToolButtonRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/request/ShowMapMeasurementRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/event/ToolSelectedEvent.js"},{type:"text/css",src:"../../../../resources/framework/bundle/toolbar/css/toolbar.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/toolbar/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"toolbar","Bundle-Name":"toolbar","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"Toolbar",Title:"Toolbar"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("toolbar","Oskari.mapframework.bundle.toolbar.ToolbarBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance",function(){this.sandbox=null,this.started=!1,this.buttons={},this.selectedButton=null,this.defaultButton=null,this.container=null},{__name:"Toolbar",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},update:function(){},start:function(){var e=this;if(!e.started){e.started=!0;var t=Oskari.$("sandbox");t.register(e),e.setSandbox(t),this.container=jQuery("#toolbar");for(var i in e.eventHandlers)i&&t.registerForEventByName(e,i);t.addRequestHandler("Toolbar.AddToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),t.addRequestHandler("Toolbar.RemoveToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),t.addRequestHandler("Toolbar.ToolButtonStateRequest",this.requestHandlers.toolButtonRequestHandler),t.addRequestHandler("Toolbar.SelectToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),t.addRequestHandler("ShowMapMeasurementRequest",this.requestHandlers.showMapMeasurementRequestHandler),t.registerAsStateful(this.mediator.bundleId,this),this._addDefaultButtons&&this._addDefaultButtons()}},init:function(){var e=this;this.templateGroup=jQuery('<div class="toolrow"></div>'),this.templateTool=jQuery('<div class="tool"></div>'),this.requestHandlers={toolButtonRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ToolButtonRequestHandler",e),showMapMeasurementRequestHandler:Oskari.clazz.create("Oskari.mapframework.bundle.toolbar.request.ShowMapMeasurementRequestHandler",e)}},getToolbarContainer:function(){return this.container},onEvent:function(e){var t=this,i=t.eventHandlers[e.getName()];return i?i.apply(this,[e]):void 0},measureTools:{basictools:{measureline:!0,measurearea:!0}},eventHandlers:{"Toolbar.ToolSelectedEvent":function(e){var t=this,i=this.getSandbox();if(t.measureTools[e.getGroupId()]&&t.measureTools[e.getGroupId()][e.getToolId()]){var s=t.getLocalization("measure").guidance[e.getToolId()];i.request(t,i.getRequestBuilder("ShowMapMeasurementRequest")(s?s:"",!1,null,null))}}},stop:function(){var e=this,t=e.sandbox();for(var i in e.eventHandlers)i&&t.unregisterFromEventByName(e,i);t.removeRequestHandler("ShowMapMeasurementRequest",this.requestHandlers.showMapMeasurementRequestHandler),t.removeRequestHandler("Toolbar.AddToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),t.removeRequestHandler("Toolbar.RemoveToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),t.removeRequestHandler("Toolbar.ToolButtonStateRequest",this.requestHandlers.toolButtonRequestHandler),t.removeRequestHandler("Toolbar.SelectToolButtonRequest",this.requestHandlers.toolButtonRequestHandler),this.sandbox.unregisterStateful(this.mediator.bundleId),e.sandbox.unregister(e),e.started=!1},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},setState:function(e){if(e)if(e.selected){this.selectedButton=e.selected;var t=e.selected.id,i=e.selected.group,s=this.getToolbarContainer();this._removeToolSelections();var a=s.find("div.toolrow[tbgroup="+i+"]");if(a.length>0){var r=a.find("div.tool[tool="+t+"]");r.length>0&&(r.addClass("selected"),this.buttons[i][t].callback())}}else this.selectedButton=null},getState:function(){var e={};return this.selectedButton&&(e.selected=this.selectedButton),e}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),Oskari.clazz.category("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance","button-methods",{addToolButton:function(e,t,i){if(e&&t&&i&&i.callback){var s=this,a=this.getToolbarContainer(),r=null;if(this.buttons[t]?r=a.find("div.toolrow[tbgroup="+t+"]"):(this.buttons[t]={},r=this.templateGroup.clone(),r.attr("tbgroup",t),a.append(r)),!this.buttons[t][e]){this.buttons[t][e]=i;var n=this.templateTool.clone();n.attr("tool",e),n.attr("title",i.tooltip),n.addClass(i.iconCls),this.selectedButton?this.selectedButton.id==e&&this.selectedButton.group==t&&(n.addClass("selected"),i.callback()):i.selected&&(n.addClass("selected"),this.selectedButton={id:e,group:t}),i.selected&&(this.defaultButton={id:e,group:t}),n.bind("click",function(){s._clickButton(e,t)}),i.prepend?r.prepend(n):r.append(n)}}},_clickButton:function(e,t){e||(e=this.defaultButton.id,t=this.defaultButton.group);var i=this.buttons[t][e];if(0!=i.enabled){if(1==i.sticky){var s=this.sandbox.getEventBuilder("Toolbar.ToolSelectedEvent")(e,t);this.sandbox.notifyAll(s),this._removeToolSelections();var a=this.getToolbarContainer(),r=a.find("div.toolrow[tbgroup="+t+"]"),n=r.find("div.tool[tool="+e+"]");n.addClass("selected"),this.selectedButton={id:e,group:t}}i.callback()}},_removeToolSelections:function(){var e=this.getToolbarContainer(),t=e.find("div.tool");t.removeClass("selected")},removeToolButton:function(e,t){if(t&&this.buttons[t]){var i=this.getToolbarContainer(),s=i.find("div.toolrow[tbgroup="+t+"]");if(e){var a=s.find("div.tool[tool="+e+"]");a.remove(),this.buttons[t][e]=null,delete this.buttons[t][e]}else s.remove(),this.buttons[t]=null,delete this.buttons[t]}},changeToolButtonState:function(e,t,i){if(t&&this.buttons[t]){var s=this.getToolbarContainer(),a=s.find("div.toolrow[tbgroup="+t+"]");if(e){var r=a.find("div.tool[tool="+e+"]");this.buttons[t][e].enabled=i,i?r.removeClass("disabled"):r.addClass("disabled")}else{var n=a.find("div.tool");i?n.removeClass("disabled"):n.addClass("disabled");for(var o in this.buttons[t])this.buttons[t][o].enabled=i}}}}),Oskari.clazz.category("Oskari.mapframework.bundle.toolbar.ToolbarBundleInstance","default-buttons",{_addDefaultButtons:function(){var e=this,t=this.getLocalization("buttons"),i=this.getSandbox().getRequestBuilder("ToolSelectionRequest"),s="MapModulePlugin.GetFeatureInfoActivationRequest",a=this.getSandbox().getRequestBuilder(s);this.addToolButton("reset","history",{iconCls:"tool-reset",tooltip:t.history.reset,sticky:!1,callback:function(){var t=e.getSandbox().getRequestBuilder("StateHandler.SetStateRequest");t&&e.getSandbox().request(e,t());var i=e.getSandbox().getRequestBuilder("ClearHistoryRequest")();e.getSandbox().request(e,i)}}),this.addToolButton("history_back","history",{iconCls:"tool-history-back",tooltip:t.history.back,sticky:!1,callback:function(){e.getSandbox().request(e,i("map_control_tool_prev"))}}),this.addToolButton("history_forward","history",{iconCls:"tool-history-forward",tooltip:t.history.next,sticky:!1,callback:function(){e.getSandbox().request(e,i("map_control_tool_next"))}}),this.addToolButton("zoombox","basictools",{iconCls:"tool-zoombox",tooltip:t.zoom,sticky:!0,callback:function(){var t="map_control_zoom_tool";e.getSandbox().request(e,a(!1)),e.getSandbox().request(e,i(t))}}),this.addToolButton("select","basictools",{iconCls:"tool-pan",tooltip:t.pan,selected:!0,sticky:!0,callback:function(){var t="map_control_navigate_tool";e.getSandbox().request(e,a(!0)),e.getSandbox().request(e,i(t))}}),this.addToolButton("measureline","basictools",{iconCls:"tool-measure-line",tooltip:t.measure.line,sticky:!0,callback:function(){var t="map_control_measure_tool";e.getSandbox().request(e,a(!1)),e.getSandbox().request(e,i(t))}}),this.addToolButton("measurearea","basictools",{iconCls:"tool-measure-area",tooltip:t.measure.area,sticky:!0,callback:function(){var t="map_control_measure_area_tool";e.getSandbox().request(e,a(!1)),e.getSandbox().request(e,i(t))}}),this.addToolButton("link","viewtools",{iconCls:"tool-link",tooltip:t.link.tooltip,sticky:!1,callback:function(){var i=e.getSandbox().generateMapLinkParameters({marker:!0}),s="Oskari.userinterface.component.Popup",a="Oskari.userinterface.component.Button",r=Oskari.clazz.create(s),n=Oskari.clazz.create(a);n.setTitle(t.link.ok),n.addClass("primary"),n.setHandler(function(){var t="EnableMapKeyboardMovementRequest";r.close(),e.getSandbox().postRequestByName(t)});var o='<textarea rows="3" cols="80">'+t.link.prefixUrl+i+"</textarea>",l="DisableMapKeyboardMovementRequest";e.getSandbox().postRequestByName(l),r.show(t.link.title,o,[n])}})}}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.AddToolButtonRequest",function(e,t,i){this._id=e,this._group=t,this._config=i},{__name:"Toolbar.AddToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group},getConfig:function(){return this._config}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.RemoveToolButtonRequest",function(e,t){this._id=e,this._group=t},{__name:"Toolbar.RemoveToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolButtonStateRequest",function(e,t,i){this._id=e,this._group=t,this._state=1==i},{__name:"Toolbar.ToolButtonStateRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group},getState:function(){return this._state}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.SelectToolButtonRequest",function(e,t){this._id=e,this._group=t},{__name:"Toolbar.SelectToolButtonRequest",getName:function(){return this.__name},getId:function(){return this._id},getGroup:function(){return this._group}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ToolButtonRequestHandler",function(e){this._toolbar=e},{handleRequest:function(e,t){var i=e.getSandbox();"Toolbar.AddToolButtonRequest"==t.getName()?this._handleAdd(i,t):"Toolbar.RemoveToolButtonRequest"==t.getName()?this._handleRemove(i,t):"Toolbar.ToolButtonStateRequest"==t.getName()?this._handleState(i,t):"Toolbar.SelectToolButtonRequest"==t.getName()&&this._handleClick(i,t)},_handleAdd:function(e,t){this._toolbar.addToolButton(t.getId(),t.getGroup(),t.getConfig())},_handleRemove:function(e,t){this._toolbar.removeToolButton(t.getId(),t.getGroup())},_handleState:function(e,t){this._toolbar.changeToolButtonState(t.getId(),t.getGroup(),t.getState())},_handleClick:function(e,t){this._toolbar._clickButton(t.getId(),t.getGroup())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.request.ShowMapMeasurementRequestHandler",function(e){var t=this;t._toolbar=e;var i=this._toolbar.getLocalization("measure"),s=i.title;t._title=s,t._dialog=Oskari.clazz.create("Oskari.userinterface.component.Popup"),t._dialog.addClass("oskari-measurement");var a=[],r=Oskari.clazz.create("Oskari.userinterface.component.Button");r.setTitle(i.close),a.push(r),t._buttons=a,t._dialogShown=!1,t._content=null},{handleRequest:function(e,t){e.getSandbox(),this._showMeasurementResults(t.getValue())},getValue:function(){return this._value},_showMeasurementResults:function(e){var t=this,i=t._dialog;if(!t._dialogShown){i.show(t._title,"",t._buttons);var s=t._buttons[0];s.setHandler(function(){t._dialogShown=!1;var e=t._toolbar.getSandbox().getRequestBuilder("Toolbar.SelectToolButtonRequest")();t._toolbar.getSandbox().request(t._toolbar,e),t._dialog.close(!0)}),i.moveTo("#toolbar div.toolrow[tbgroup=basictools]","top"),t._content=jQuery("<div></div>"),i.setContent(t._content),t._dialogShown=!0}t._content.html(e)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.toolbar.event.ToolSelectedEvent",function(e,t){this._toolId=e,this._groupId=t},{__name:"Toolbar.ToolSelectedEvent",getName:function(){return this.__name},getToolId:function(){return this._toolId},getGroupId:function(){return this._groupId}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.StateHandlerBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.statehandler.StateHandlerBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/state-methods.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/plugin/Plugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/plugin/SaveViewPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/request/SetStateRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/request/SetStateRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/event/StateSavedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/request/SaveStateRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/statehandler/request/SaveStateRequestHandler.js"}]},bundle:{manifest:{"Bundle-Identifier":"statehandler","Bundle-Name":"statehandler","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"statehandler",Title:"statehandler"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("statehandler","Oskari.mapframework.bundle.statehandler.StateHandlerBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.StateHandlerBundleInstance",function(){this._localization=null,this._pluginInstances={},this._startupState=null,this._historyPollingInterval=1500,this._historyTimer=null,this._historyPrevious=[],this._historyNext=[],this._historyEnabled=!0,this._defaultViewId=1,this._currentViewId=this._defaultViewId},{__name:"StateHandler",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},start:function(){var e=this;if(!e.started){e.started=!0;var t=Oskari.$("sandbox");e.sandbox=t,t.register(e);for(p in e.eventHandlers)t.registerForEventByName(e,p);var i=t.getAjaxUrl(),s=Oskari.clazz.create("Oskari.mapframework.bundle.statehandler.plugin.SaveViewPlugin",i);this.registerPlugin(s),this.startPlugin(s),t.addRequestHandler("StateHandler.SetStateRequest",this.requestHandlers.setStateHandler),t.addRequestHandler("StateHandler.SaveStateRequest",this.requestHandlers.saveStateHandler)}},update:function(){},stop:function(){var e=this.sandbox();e.removeRequestHandler("StateHandler.SetStateRequest",this.requestHandlers.setStateHandler),e.removeRequestHandler("StateHandler.SaveStateRequest",this.requestHandlers.saveStateHandler);var t=e.getRequestBuilder("MapControls.ToolButtonRequest");t&&e.request(this,t(this.toolbar.config,"remove"));for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);this.sandbox.unregister(this),this.started=!1},init:function(){var e=Oskari.$("sandbox");return this.requestHandlers={setStateHandler:Oskari.clazz.create("Oskari.mapframework.bundle.statehandler.request.SetStateRequestHandler",e,this),saveStateHandler:Oskari.clazz.create("Oskari.mapframework.bundle.statehandler.request.SaveStateRequestHandler",e,this)},null},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapMoveEvent:function(){var e=this;e._pushState()},AfterMapLayerAddEvent:function(){var e=this;e._pushState()},AfterMapLayerRemoveEvent:function(){var e=this;e._pushState()},AfterChangeMapLayerStyleEvent:function(){var e=this;
e._pushState()},MapLayerVisibilityChangedEvent:function(){var e=this;e._pushState()}},registerPlugin:function(e){e.setHandler(this);var t=e.getName();this.sandbox.printDebug("["+this.getName()+"]"+" Registering "+t),this._pluginInstances[t]=e},unregisterPlugin:function(e){var t=e.getName();this.sandbox.printDebug("["+this.getName()+"]"+" Unregistering "+t),this._pluginInstances[t]=void 0,e.setHandler(null)},startPlugin:function(e){var t=e.getName();this.sandbox.printDebug("["+this.getName()+"]"+" Starting "+t),e.startPlugin(this.sandbox)},stopPlugin:function(e){var t=e.getName();this.sandbox.printDebug("["+this.getName()+"]"+" Starting "+t),e.stopPlugin(this.sandbox)},setCurrentViewId:function(e){this._currentViewId=e},getCurrentViewId:function(){return this._currentViewId},_stateComparators:[{rule:"nohistory",cmp:function(e){return e?void 0:!0}},{rule:"location",cmp:function(e,t){return e.east!=t.east||e.north!=t.north?!0:e.zoom!=t.zoom?!0:void 0}},{rule:"layers",cmp:function(e,t){var i=this,s=e.selectedLayers,a=t.selectedLayers;if(s.length!=a.length)return!0;for(var r=0;a.length>r;r++){var n=s[r],o=a[r];if(i.sandbox.printDebug("[StateHandler] comparing layer state "+n.id+" vs "+o.id),n.id!==o.id)return!0;if(n.opacity!==o.opacity)return!0;if(n.hidden!==o.hidden)return!0;if(n.style!==o.style)return!0}return!1}}],_compareState:function(e,t,i){for(var s={result:!1,rule:null,rulesMatched:{}},a=this,r=0;a._stateComparators.length>r;r++){var n=a._stateComparators[r];if(a.sandbox.printDebug("[StateHandler] comparing state "+n.rule),n.cmp.apply(this,[e,t])&&(a.sandbox.printDebug("[StateHandler] comparing state MATCH "+n.rule),s.result=!0,s.rule=n.rule,s.rulesMatched[n.rule]=n.rule,i))return s}return s},_pushState:function(){var e=this;if(e._historyEnabled){var t=e._historyPrevious,i=this._getMapState(),s=0==t.length?null:t[t.length-1],a=e._compareState(s,i,!0);a.result&&(e.sandbox.printDebug("[StateHandler] PUSHING state"),i.rule=a.rule,e._historyPrevious.push(i),e._historyNext=[])}},historyMoveNext:function(){var e=this.getSandbox();if(this._historyNext.length>0){var t=this._historyNext.pop();this._historyPrevious.push(t);var i=e.findRegisteredModuleInstance("MainMapModule");this._historyEnabled=!1;var s=this._getMapState();this._setMapState(i,t,s),this._historyEnabled=!0}},historyMovePrevious:function(){var e=this.getSandbox();switch(this._historyPrevious.length){case 0:break;case 1:var t=this._historyNext;this.resetState(),this._historyNext=t;break;default:var i=this._historyPrevious.pop();this._historyNext.push(i);var s=this._historyPrevious[this._historyPrevious.length-1],a=e.findRegisteredModuleInstance("MainMapModule"),r=this._getMapState();this._historyEnabled=!1,this._setMapState(a,s,r),this._historyEnabled=!0}},_getMapState:function(){var e=this.getSandbox(),t=e.getMap(),i=e.findAllSelectedMapLayers();t.getZoom();for(var s=t.getX(),a=t.getY(),r={north:a,east:s,zoom:t.getZoom(),selectedLayers:[]},n=0;i.length>n;n++){var o=i[n],l={id:o.getId(),opacity:o.getOpacity()};o.isVisible()||(l.hidden=!0),o.getCurrentStyle&&o.getCurrentStyle()&&o.getCurrentStyle().getName()&&"!default!"!=o.getCurrentStyle().getName()&&(l.style=o.getCurrentStyle().getName()),r.selectedLayers.push(l)}return r},_setMapState:function(e,t,i){var s=this.getSandbox(),a=this._compareState(i,t,!1);if(t.selectedLayers&&a.rulesMatched.layers){s.printDebug("[StateHandler] restoring LAYER state"),this._teardownState(e);for(var r=s.getRequestBuilder("AddMapLayerRequest"),n=s.getRequestBuilder("ChangeMapLayerOpacityRequest"),o=s.getRequestBuilder("MapModulePlugin.MapLayerVisibilityRequest"),l=s.getRequestBuilder("ChangeMapLayerStyleRequest"),h=t.selectedLayers.length,u=0;h>u;++u){var p=t.selectedLayers[u];s.request(e.getName(),r(p.id,!0)),p.hidden?s.request(e.getName(),o(p.id,!1)):s.request(e.getName(),o(p.id,!0)),p.style&&s.request(e.getName(),l(p.id,p.style)),p.opacity&&s.request(e.getName(),n(p.id,p.opacity))}}t.east&&(s.printDebug("[StateHandler] restoring LOCATION state"),this.getSandbox().getMap().moveTo(t.east,t.north,t.zoom)),s.syncMapState(!0)},_teardownState:function(e){for(var t=this.getSandbox(),i=t.findAllSelectedMapLayers(),s=t.getRequestBuilder("RemoveMapLayerRequest"),a=0;i.length>a;a++)t.request(e.getName(),s(i[a].getId()))}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),Oskari.clazz.category("Oskari.mapframework.bundle.statehandler.StateHandlerBundleInstance","state-methods",{useState:function(e){if(e){var t=this.sandbox.getStatefulComponents(),i=[];for(var s in e)t[s]&&t[s].setState(e[s].state),i.push(s);return i}},resetState:function(){var e=this;e._historyEnabled=!1,e._historyPrevious=[],e._historyNext=[];for(var t in this._pluginInstances)e.sandbox.printDebug("["+e.getName()+"]"+" resetting state on "+t),e._pluginInstances[t].resetState();e._currentViewId=this._defaultViewId,e._startupState?e._resetComponentsWithNoStateData(e.useState(this._startupState)):jQuery.ajax({dataType:"json",type:"GET",url:e.sandbox.getAjaxUrl()+"action_route=GetMapConfiguration&noSavedState=true",success:function(t){e._startupState=t,e._resetComponentsWithNoStateData(e.useState(t)),e._historyEnabled=!0},error:function(){alert("error loading conf"),e._historyEnabled=!0},complete:function(){e._historyEnabled=!0}}),e._historyEnabled=!0},_resetComponentsWithNoStateData:function(e){var t=this.sandbox.getStatefulComponents();for(var i in t){for(var s=!1,a=0;e.length>a;++a)if(i==e[a]){s=!0;break}s||t[i].setState()}},saveState:function(e,t){if(t)this.sandbox.printDebug("["+this.getName()+"]"+" saving state with "+t),this._pluginInstances[t].saveState(e);else for(var t in this._pluginInstances)this.saveState(e,t)},getCurrentState:function(){var e={},t=this.sandbox.getStatefulComponents();for(var i in t)e[i]={state:t[i].getState()};return e},getSavedState:function(e){return this._pluginInstances[e].getState()}}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.plugin.Plugin",function(){throw"Oskari.mapframework.bundle.statehandler.Plugin should not be instantiated"},{getName:function(){throw"Implement your own"},setHandler:function(){throw"Implement your own"},startPlugin:function(){throw"Implement your own"},stopPlugin:function(){throw"Implement your own"},getState:function(){throw"Implement your own"},resetState:function(){throw"Implement your own"},saveState:function(){throw"Implement your own"}}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.plugin.SaveViewPlugin",function(e){this.handler=null,this.pluginName=null,this._sandbox=null,this._ajaxUrl=e},{__name:"statehandler.SaveViewPlugin",getName:function(){return this.pluginName},getHandler:function(){return this.handler},setHandler:function(e){this.handler=e,this.pluginName=e.getName()+this.__name},getState:function(){},resetState:function(){},saveState:function(e,t){var i=t,s=this;i||(i=this.handler.getCurrentState());var a={currentViewId:s.handler.getCurrentViewId(),viewData:JSON.stringify(i)};e&&(a.viewName=e);var r=s._sandbox.getEventBuilder("StateSavedEvent"),n=r(e,i);jQuery.ajax({type:"POST",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:this._ajaxUrl+"action_route=AddView",data:a,success:function(e){s._sandbox.notifyAll(n),s.handler.setCurrentViewId(e.id)},error:function(){e&&(n.setError(!0),s._sandbox.notifyAll(n))}})},serializeJSON:function(e){var t=this,i=typeof e;if("object"!=i||null===e)return"string"==i&&(e='"'+e+'"'),e+"";var s=[],a=e&&e.constructor==Array;return jQuery.each(e,function(e,r){i=typeof r,"string"==i?r='"'+r+'"':"object"==i&null!==r&&(r=t.serializeJSON(r)),s.push((a?"":'"'+e+'":')+(r+""))}),(a?"[":"{")+(s+"")+(a?"]":"}")},startPlugin:function(e){this._sandbox=e;var t=this;jQuery(document).ready(function(){window.onbeforeunload=function(){t.saveState()}})},stopPlugin:function(){this._sandbox=null}},{protocol:["Oskari.mapframework.bundle.statehandler.plugin.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SetStateRequest",function(e){this._creator=null,this._state=e,this._currentViewId=1},{__name:"StateHandler.SetStateRequest",getName:function(){return this.__name},getState:function(){return this._state},getCurrentViewId:function(){return this._currentViewId},setCurrentViewId:function(e){this.currentViewId=e}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SetStateRequestHandler",function(e,t){this.sandbox=e,this.statehandler=t},{handleRequest:function(e,t){t.getState()?(this.statehandler.setCurrentViewId(t.getCurrentViewId()),this.statehandler.useState(t.getState())):this.statehandler.resetState()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.event.StateSavedEvent",function(e,t){this._name=e,this._state=t,this._error=!1},{__name:"StateSavedEvent",getName:function(){return this.__name},getViewName:function(){return this._name},getState:function(){return this._state},isError:function(){return this._error},setError:function(e){this._error=1==e}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SaveStateRequest",function(e){this._viewName=e},{__name:"StateHandler.SaveStateRequest",getName:function(){return this.__name},getViewName:function(){return this._viewName}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.statehandler.request.SaveStateRequestHandler",function(e,t){this.sandbox=e,this.statehandler=t},{handleRequest:function(e,t){this.statehandler.saveState(t.getViewName())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.InfoBoxBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.infobox.InfoBoxBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/plugin/openlayerspopup/OpenlayersPopupPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/request/ShowInfoBoxRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/request/ShowInfoBoxRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/request/HideInfoBoxRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/infobox/request/HideInfoBoxRequestHandler.js"},{type:"text/css",src:"../../../../resources/framework/bundle/infobox/css/infobox.css"}]},bundle:{manifest:{"Bundle-Identifier":"infobox","Bundle-Name":"infobox","Bundle-Author":[{Name:"ev",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("infobox","Oskari.mapframework.bundle.infobox.InfoBoxBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.InfoBoxBundleInstance",function(){this.sandbox=null,this.started=!1,this.mediator=null},{__name:"Infobox",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},update:function(){},start:function(){var e=this;if(!e.started){e.started=!0;var t=Oskari.$("sandbox");t.register(e),e.setSandbox(t);for(var i in e.eventHandlers)i&&t.registerForEventByName(e,i);var s=t.findRegisteredModuleInstance("MainMapModule");s.registerPlugin(this.popupPlugin),s.startPlugin(this.popupPlugin),t.addRequestHandler("InfoBox.ShowInfoBoxRequest",this.requestHandlers.showInfoHandler),t.addRequestHandler("InfoBox.HideInfoBoxRequest",this.requestHandlers.hideInfoHandler),t.registerAsStateful(this.mediator.bundleId,this)}},init:function(){return this.popupPlugin=Oskari.clazz.create("Oskari.mapframework.bundle.infobox.plugin.mapmodule.OpenlayersPopupPlugin"),this.requestHandlers={showInfoHandler:Oskari.clazz.create("Oskari.mapframework.bundle.infobox.request.ShowInfoBoxRequestHandler",this.popupPlugin),hideInfoHandler:Oskari.clazz.create("Oskari.mapframework.bundle.infobox.request.HideInfoBoxRequestHandler",this.popupPlugin)},null},onEvent:function(e){var t=this,i=t.eventHandlers[e.getName()];return i?i.apply(this,[e]):void 0},eventHandlers:{},stop:function(){var e=this,t=this.sandbox;t.unregisterStateful(this.mediator.bundleId);for(var i in e.eventHandlers)i&&t.unregisterFromEventByName(e,i);e.sandbox.unregister(e),e.started=!1},setState:function(e){if(e&&e.popups){this.popupPlugin.close();for(var t=0;e.popups.length>t;++t){var i=e.popups[t];this.popupPlugin.popup(i.id,i.title,i.data,i.lonlat)}}},getState:function(){var e={popups:[]},t=this.popupPlugin.getPopups();for(var i in t){var s=t[i],a={id:i,title:s.title,data:s.contentData,lonlat:s.lonlat};e.popups.push(a)}return e}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),jQuery.fn.outerHTML=function(e){var t;return this.length?e?(jQuery.each(this,function(t,i){var s,a=i,r=i.outerHTML?"outerHTML":"innerHTML";i.outerHTML||(i=jQuery(i).wrap("<div>").parent()[0]),jQuery.isFunction(e)?(s=e.call(a,t,i[r]))!==!1&&(i[r]=s):i[r]=e,i.outerHTML||jQuery(i).children().unwrap()}),this):this[0].outerHTML||(t=this.wrap("<div>").parent().html(),this.unwrap(),t):"undefined"==typeof val?this:null},Oskari.clazz.define("Oskari.mapframework.bundle.infobox.plugin.mapmodule.OpenlayersPopupPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._popups={}},{__name:"OpenLayersPopupPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this._map=e.getMap(),this.pluginName=e.getName()+this.__name},init:function(){this._arrow=jQuery('<div class="popupHeaderArrow"></div>'),this._header=jQuery("<div></div>"),this._headerWrapper=jQuery('<div class="popupHeader"></div>'),this._headerCloseButton=jQuery('<div class="olPopupCloseBox icon-close-white" style="position: absolute; top: 12px;"></div>'),this._contentDiv=jQuery('<div class="popupContent"></div>'),this._contentWrapper=jQuery('<div class="contentWrapper"></div>'),this._actionLink=jQuery('<span class="infoboxActionLinks"><a href="#"></a></span>'),this._actionButton=jQuery('<span class="infoboxActionLinks"><input type="button" /></span>'),this._contentSeparator=jQuery('<div class="infoboxLine">separator</div>')},popup:function(e,t,i,s){var a=this,r=this._arrow.clone(),n=this._header.clone(),o=this._headerWrapper.clone(),l=this._contentDiv.clone(),h=this._headerCloseButton.clone();n.append(t),o.append(n),o.append(h);for(var u=0;i.length>u;u++){0!=u&&l.append(this._contentSeparator.clone());var p=i[u].html,c=this._contentWrapper.clone();c.append(p);var d=i[u].actions,m=1==i[u].useButtons,y=i[u].primaryButton;for(var f in d){var g=f;d[f];var v=null;if(m){v=this._actionButton.clone();var L=v.find("input");L.attr("contentdata",u),L.attr("value",g),g==y&&L.addClass("primary")}else{v=this._actionLink.clone();var b=v.find("a");b.attr("contentdata",u),b.append(g)}c.append(v)}l.append(c)}var O=this.getMapModule().getMap(),S=new OpenLayers.Popup(e,new OpenLayers.LonLat(s.lon,s.lat),new OpenLayers.Size(400,300),r.outerHTML()+o.outerHTML()+l.outerHTML(),!1);S.moveTo=function(e){if(null!=e&&null!=this.div){this.div.style.left=e.x+"px";var t=e.y-20;this.div.style.top=t+"px"}},S.setBackgroundColor("transparent"),this._popups[e]={title:t,contentData:i,lonlat:s,popup:S},jQuery(S.div).css("overflow","visible"),jQuery(S.groupDiv).css("overflow","visible"),S.events.un({click:S.onclick,scope:S}),S.events.on({click:function(t){var s=jQuery(t.target||t.srcElement);if(s.hasClass("olPopupCloseBox"))a.close(e);else{var r=s.attr("contentdata"),n=s.attr("value");n||(n=s.html()),i[r]&&i[r].actions&&i[r].actions[n]&&i[r].actions[n]()}},scope:S}),O.addPopup(S),this._panMapToShowPopup(s)},_panMapToShowPopup:function(e){var t=this._map.getViewPortPxFromLonLat(e),i=this._map.getCurrentSize(),s=i.w,a=i.h,r=0,n=0,o=450,l=300;t.x+o>s&&(r=s-(t.x+o)),t.y+l>a?n=a-(t.y+l):25>t.y&&(n=25),(0!=r||0!=n)&&this.getMapModule().panMapByPixels(-r,-n)},close:function(e){if(e)this._popups[e]&&(this._popups[e].popup&&this._popups[e].popup.destroy(),delete this._popups[e]);else for(var t in this._popups)this._popups[t].popup.destroy(),delete this._popups[t]},getPopups:function(){return this._popups},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this)},stopPlugin:function(e){e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.ShowInfoBoxRequest",function(e,t,i,s,a){this._creator=null,this._id=e,this._title=t,this._content=i,this._position=s,this._hidePrevious=1==a},{__name:"InfoBox.ShowInfoBoxRequest",getName:function(){return this.__name},getId:function(){return this._id},getTitle:function(){return this._title},getContent:function(){return this._content},getPosition:function(){return this._position},getHidePrevious:function(){return this._hidePrevious}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.ShowInfoBoxRequestHandler",function(e){this.popupPlugin=e},{handleRequest:function(e,t){t.getHidePrevious()&&this.popupPlugin.close(),this.popupPlugin.popup(t.getId(),t.getTitle(),t.getContent(),t.getPosition())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.HideInfoBoxRequest",function(e){this._creator=null,this._id=e},{__name:"InfoBox.HideInfoBoxRequest",getName:function(){return this.__name},getId:function(){return this._id}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.infobox.request.HideInfoBoxRequestHandler",function(e){this.popupPlugin=e},{handleRequest:function(e,t){this.popupPlugin.close(t.getId())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.search.SearchBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.search.SearchBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/search/service/searchservice.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/search/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/search/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/search/Tile.js"},{type:"text/css",src:"../../../../resources/framework/bundle/search/css/style.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/search/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/search/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/search/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"search","Bundle-Name":"search","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("search","Oskari.mapframework.bundle.search.SearchBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.search.service.SearchService",function(e){this._searchUrl=e},{__qname:"Oskari.mapframework.bundle.search.service.SearchService",getQName:function(){return this.__qname},__name:"SearchService",getName:function(){return this.__name},doSearch:function(e,t,i){var s=Oskari.getLang();jQuery.ajax({dataType:"json",type:"POST",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/json")},url:this._searchUrl,data:"searchKey="+e+"&Language="+s,error:i,success:t})}},{protocol:["Oskari.mapframework.service.Service"]}),Oskari.clazz.define("Oskari.mapframework.bundle.search.SearchBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null,this.service=null},{__name:"Search",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e&&this._localization[e]?this._localization[e]:this.localization?this._localization:{}},start:function(){var e=this;if(!e.started){e.started=!0;var t=Oskari.$("sandbox");e.sandbox=t,this.localization=Oskari.getLocalization(this.getName());var i=null;i=this.conf&&this.conf.url?this.conf.url:t.getAjaxUrl()+"action_route=GetSearchResult";var s="Oskari.mapframework.bundle.search.service.SearchService";this.service=Oskari.clazz.create(s,i),t.register(e);for(p in e.eventHandlers)t.registerForEventByName(e,p);var a="userinterface.AddExtensionRequest",r=t.getRequestBuilder(a),n=r(this);t.request(this,n),t.registerAsStateful(this.mediator.bundleId,this),e.createUi()}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{},stop:function(){var e=this.sandbox();for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);var t="userinterface.RemoveExtensionRequest",i=e.getRequestBuilder(t),s=i(this);e.request(this,s),this.sandbox.unregisterStateful(this.mediator.bundleId),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.search.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.search.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi(),this.plugins["Oskari.userinterface.Tile"].refresh()},setState:function(e){this.plugins["Oskari.userinterface.Flyout"].setState(e)},getState:function(){return this.plugins["Oskari.userinterface.Flyout"].getState()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.search.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null,this.templateResultTable=null,this.templateResultTableHeader=null,this.templateResultTableRow=null,this.resultHeaders=[],this.lastResult=null,this.lastSort=null,this._searchContainer=null},{getName:function(){return"Oskari.mapframework.bundle.search.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("search")||jQuery(this.container).addClass("search")},startPlugin:function(){this.template=jQuery('<div class="searchContainer"><div class="searchDescription"></div><div class="controls"></div><div><br></div><div class="info"></div><div><br></div><div class="resultList"></div></div>'),this.templateResultTable=jQuery('<table class="search_result"><thead><tr></tr></thead><tbody></tbody></table>'),this.templateResultTableHeader=jQuery('<th><a href="JavaScript:void(0);"></a></th>'),this.templateResultTableRow=jQuery('<tr><td><a href="JavaScript:void(0);"></a></td><td></td><td></td></tr>'),this.resultHeaders=[{title:this.instance.getLocalization("grid").name,prop:"name"},{title:this.instance.getLocalization("grid").village,prop:"village"},{title:this.instance.getLocalization("grid").type,prop:"type"}]},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},getState:function(){return this.state?this.state:{}},createUi:function(){var e=this,t=e.instance.getSandbox(),i=jQuery(this.container);i.empty();var s=this.template.clone();this._searchContainer=s;var a=s.find("div.searchDescription");a.html(this.instance.getLocalization("searchDescription"));var r=Oskari.clazz.create("Oskari.userinterface.component.FormInput");r.bindChange(function(){null===e.state&&(e.state={});var i=r.getValue();if(e.state.searchtext=i,!i){var a=s.find("div.info");a.empty();var n=s.find("div.resultList");n.empty();var o=t.getRequestBuilder("MapModulePlugin.RemoveMarkerRequest");o&&t.request(e.instance.getName(),o())}}),r.addClearButton();var n=Oskari.clazz.create("Oskari.userinterface.component.Button");n.setTitle(this.instance.getLocalization("searchButton"));var o=function(){r.setEnabled(!1),n.setEnabled(!1);var t=s.find("div.resultList");t.empty();var i=s.find("div.info");i.empty();var a=r.getValue(!0);e.instance.service.doSearch(a,function(t){r.setEnabled(!0),n.setEnabled(!0),e._renderResults(t,a)},function(){r.setEnabled(!0),n.setEnabled(!0);var t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=t.createCloseButton("OK"),s=e.instance.getLocalization("searchservice_search_alert_title");t.show(s,s,[i])})};n.setHandler(o),r.bindEnterKey(o);var l=s.find("div.controls");l.append(r.getField()),l.append(n.getButton()),i.append(s)},_renderResults:function(e,t){if(e&&"number"==typeof e.totalCount){var i=this._searchContainer.find("div.resultList");i.empty(),this.lastResult=e;var s=this,a=this._searchContainer.find("div.info");a.empty();var r=this.instance;if(-1==e.totalCount)return i.append(this.instance.getLocalization("searchservice_search_alert_title")+this.instance.getLocalization(e.errorText)),void 0;if(0==e.totalCount){var n="searchservice_search_alert_title",o=r.getLocalization(n),l="searchservice_search_not_found_anything_text",h=r.getLocalization(l);return i.append(o+":"+h),void 0}a.append(this.instance.getLocalization("searchResultCount")+e.totalCount+this.instance.getLocalization("searchResultCount2")),a.append("<br/>"),e.hasMore&&(a.append(this.instance.getLocalization("searchResultDescriptionMoreResults")),a.append("<br/>")),a.append(this.instance.getLocalization("searchResultDescriptionOrdering")),1==e.totalCount&&(s._resultClicked(e.locations[0]),r.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[s.instance,"close"]));for(var u=this.templateResultTable.clone(),p=u.find("thead tr"),c=u.find("tbody"),d=function(e){return function(){c.empty();var t=!1;s.lastSort&&s.lastSort.attr==e.prop&&(t=!s.lastSort.descending),s._sortResults(e.prop,t),s._populateResultTable(c);var i=p.find("a:contains("+e.title+")");return p.find("th").removeClass("asc"),p.find("th").removeClass("desc"),t?i.parent().addClass("desc"):i.parent().addClass("asc"),!1}},m=0;this.resultHeaders.length>m;++m){var y=this.templateResultTableHeader.clone(),f=y.find("a");f.append(this.resultHeaders[m].title),f.bind("click",d(this.resultHeaders[m])),p.append(y)}this._populateResultTable(c),i.append("<div><h3>"+this.instance.getLocalization("searchResults")+e.totalCount+this.instance.getLocalization("searchResultsDescription")+t+"</h3></div>"),i.append(u)}},_populateResultTable:function(e){for(var t=this,i=function(e){return function(){return t._resultClicked(e),!1}},s=this.lastResult.locations,a=0;s.length>a;++a){var r=s[a],n=this.templateResultTableRow.clone(),o=n.find("td"),l=jQuery(o[0]),h=l.find("a");h.append(r.name),h.bind("click",i(r)),jQuery(o[1]).append(r.village),jQuery(o[2]).append(r.type),e.append(n)}},_resultClicked:function(e){var t=this,i="searchResultPopup",s=this.instance,a=s.sandbox,r=a.getRequestBuilder("MapMoveRequest");a.request(t.instance.getName(),r(e.lon,e.lat,e.zoomLevel,!1));var n=this.instance.getLocalization("resultBox"),o={html:"<h3>"+e.name+"</h3>"+"<p>"+e.village+"<br/>"+e.type+"</p>",actions:{}},l=[o];o.actions[n.close]=function(){var e="InfoBox.HideInfoBoxRequest",s=a.getRequestBuilder(e),r=s(i);a.request(t.instance.getName(),r)};var h="InfoBox.ShowInfoBoxRequest",u=a.getRequestBuilder(h),p=u(i,n.title,l,new OpenLayers.LonLat(e.lon,e.lat),!0);a.request(this.instance.getName(),p)},_sortResults:function(e,t){var i=this;this.lastResult&&(this.lastSort={attr:e,descending:t},this.lastResult.locations.sort(function(s,a){return i._searchResultComparator(s,a,e,t)}))},_searchResultComparator:function(e,t,i,s){var a=e[i].toLowerCase(),r=t[i].toLowerCase(),n=0;return(a==r||"name"==i)&&(a=e.id,r=t.id),r>a?n=-1:a>r&&(n=1),s&&(n=-1*n),n}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.mapframework.bundle.search.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.search.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(){},refresh:function(){var e=this,t=e.instance,i=this.container;this.template,t.getSandbox(),i.children(".oskari-tile-status")}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.LayerSelectorBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.LayerSelectorBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/Tile.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/model/LayerGroup.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/view/Layer.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/view/LayersTab.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/view/PublishedLayersTab.js"},{type:"text/css",src:"../../../../resources/framework/bundle/layerselector2/css/style.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselector2/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"layerselector2","Bundle-Name":"layerselector2","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("layerselector2","Oskari.mapframework.bundle.layerselector2.LayerSelectorBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.LayerSelectorBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null
},{__name:"LayerSelector",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t=Oskari.$("sandbox");e.sandbox=t,t.register(e);for(p in e.eventHandlers)t.registerForEventByName(e,p);var i=t.getRequestBuilder("userinterface.AddExtensionRequest")(this);t.request(this,i),e.createUi();var s=this.sandbox.getService("Oskari.mapframework.service.MapLayerService");t.registerAsStateful(this.mediator.bundleId,this);var a=function(){},r=function(){alert(e.getLocalization("errors").loadFailed)};s.loadAllLayersAjax(a,r)}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(e.getMapLayer(),!1)},AfterMapLayerAddEvent:function(e){this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(e.getMapLayer(),!0)},MapLayerEvent:function(e){var t=this.sandbox.getService("Oskari.mapframework.service.MapLayerService"),i=e.getLayerId();if("update"===e.getOperation()){var s=t.findMapLayer(i);this.plugins["Oskari.userinterface.Flyout"].handleLayerModified(s)}else if("add"===e.getOperation()){var s=t.findMapLayer(i);this.plugins["Oskari.userinterface.Flyout"].handleLayerAdded(s),this.plugins["Oskari.userinterface.Tile"].refresh()}else"remove"===e.getOperation()&&(this.plugins["Oskari.userinterface.Flyout"].handleLayerRemoved(i),this.plugins["Oskari.userinterface.Tile"].refresh())}},stop:function(){var e=this.sandbox();for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);var t=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,t),this.sandbox.unregisterStateful(this.mediator.bundleId),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi(),this.plugins["Oskari.userinterface.Tile"].refresh()},setState:function(e){this.plugins["Oskari.userinterface.Flyout"].setContentState(e)},getState:function(){return this.plugins["Oskari.userinterface.Flyout"].getContentState()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.Flyout",function(e){this.instance=e,this.container=null,this.template=null,this.state=null,this.layerTabs=[]},{getName:function(){return"Oskari.mapframework.bundle.layerselector2.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("layerselector2")||jQuery(this.container).addClass("layerselector2")},startPlugin:function(){this.template=jQuery('<div class="allLayersTabContent"></div>');var e=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.view.LayersTab",this.instance,this.instance.getLocalization("filter").inspire);e.groupingMethod="getInspireName";var t=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.view.LayersTab",this.instance,this.instance.getLocalization("filter").organization);if(t.groupingMethod="getOrganizationName",this.layerTabs.push(e),this.layerTabs.push(t),this.instance.conf&&1==this.instance.conf.showPublishedTab){var i=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.view.PublishedLayersTab",this.instance,this.instance.getLocalization("filter").published);this.layerTabs.push(i)}},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e,console.log("Flyout.setState",this,e)},setContentState:function(e){e||(e={});for(var t=0;this.layerTabs.length>t;++t){var i=this.layerTabs[t];i.getTitle()==e.tab&&(this.tabContainer.select(i.getTabPanel()),i.setState(e))}},getContentState:function(){for(var e={},t=0;this.layerTabs.length>t;++t){var i=this.layerTabs[t];if(this.tabContainer.isSelected(i.getTabPanel())){e=i.getState();break}}return e},createUi:function(){var e=this;e.instance.getSandbox();var t=jQuery(this.container);t.empty(),this.tabContainer=Oskari.clazz.create("Oskari.userinterface.component.TabContainer"),this.tabContainer.insertTo(t);for(var i=0;this.layerTabs.length>i;++i){var s=this.layerTabs[i];this.tabContainer.addPanel(s.getTabPanel())}this.populateLayers()},populateLayers:function(){for(var e=this.instance.getSandbox(),t=e.getService("Oskari.mapframework.service.MapLayerService"),i=t.getAllLayers(),s=0;this.layerTabs.length>s;++s){var a=this.layerTabs[s];if(a.groupingMethod){var r=i.slice(0),n=this._getLayerGroups(r,a.groupingMethod);a.showLayerGroups(n)}}},_getLayerGroups:function(e,t){var i=this;this.instance.getSandbox();var s=[];e.sort(function(e,s){return i._layerListComparator(e,s,t)});for(var a=null,r=0;e.length>r;++r){var n=e[r];if(!n.getMetaType||"published"!=n.getMetaType()){var o=n[t]();a&&a.getTitle()==o||(a=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.model.LayerGroup",o),s.push(a)),a.addLayer(n)}}return s},_layerListComparator:function(e,t,i){var s=e[i]().toLowerCase(),a=t[i]().toLowerCase();return s==a&&(s=e.getName().toLowerCase(),a=t.getName().toLowerCase()),a>s?-1:s>a?1:0},handleLayerSelectionChanged:function(e,t){for(var i=0;this.layerTabs.length>i;++i){var s=this.layerTabs[i];s.setLayerSelected(e.getId(),t)}},handleLayerModified:function(e){for(var t=0;this.layerTabs.length>t;++t){var i=this.layerTabs[t];i.updateLayerContent(e.getId(),e)}},handleLayerAdded:function(){this.populateLayers()},handleLayerRemoved:function(){this.populateLayers()}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.layerselector2.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){console.log("Tile.setState",this,e)},refresh:function(){}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.model.LayerGroup",function(e){this.name=e,this.layers=[],this.searchIndex={}},{setTitle:function(e){this.name=e},getTitle:function(){return this.name},addLayer:function(e){this.layers.push(e),this.searchIndex[e.getId()]=this._getSearchIndex(e)},getLayers:function(){return this.layers},_getSearchIndex:function(e){var t=e.getName()+" "+e.getInspireName()+" "+e.getOrganizationName();return t.toLowerCase()},matchesKeyword:function(e,t){var i=this.searchIndex[e];return-1!=i.indexOf(t)}}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.view.Layer",function(e,t,i){this.sandbox=t,this.localization=i,this.layer=e,this.backendStatus="OK",this.ui=this._createLayerContainer(e)},{__template:'<div class="layer"><input type="checkbox" /> <div class="layer-tools"><div class="layer-backendstatus-icon backendstatus-ok"></div><div class="layer-icon"></div><div class="layer-info"></div></div><div class="layer-title"></div></div>',getId:function(){return this.layer.getId()},setVisible:function(e){1==e?this.ui.show():this.ui.hide()},setSelected:function(e){this.ui.find("input").attr("checked",1==e)},updateLayerContent:function(e){var t=e.getName();this.ui.find(".layer-title").html(t);var i=this.backendStatus,s=e.getBackendStatus(),a=this.localization.backendStatus,r=i?a[i]:null,n=s?a[s]:null,o=r?r.iconClass:null,l=n?n.iconClass:null,h=r?r.tooltip:null,u=n?n.tooltip:null,p=this.ui.find(".layer-backendstatus-icon");o&&o!=l&&p.removeClass(o),l&&o!=l&&p.addClass(l),u?h!=u&&p.attr("title",u):h&&p.attr("title",""),this.backendStatus=s},getContainer:function(){return this.ui},_createLayerContainer:function(e){var t=this.sandbox,i=jQuery(this.__template),s=this.localization.tooltip,a=jQuery(i).find("div.layer-tools"),r=a.find("div.layer-icon");e.isBaseLayer()?(r.addClass("layer-base"),r.attr("title",s["type-base"])):e.isLayerOfType("WMS")?(e.isGroupLayer()?r.addClass("layer-group"):r.addClass("layer-wms"),r.attr("title",s["type-wms"])):e.isLayerOfType("WMTS")?(r.addClass("layer-wmts"),r.attr("title",s["type-wms"])):e.isLayerOfType("WFS")?(r.addClass("layer-wfs"),r.attr("title",s["type-wfs"])):e.isLayerOfType("VECTOR")&&(r.addClass("layer-vector"),r.attr("title",s["type-wms"])),e.getMetadataIdentifier()&&(a.find("div.layer-info").addClass("icon-info"),a.find("div.layer-info").click(function(){var i="catalogue.ShowMetadataRequest",s=e.getMetadataIdentifier();t.postRequestByName(i,[{uuid:s}])})),jQuery(i).attr("layer_id",e.getId()),jQuery(i).find(".layer-title").append(e.getName()),jQuery(i).find("input").change(function(){var i=jQuery(this);i.is(":checked")?t.postRequestByName("AddMapLayerRequest",[e.getId(),!0]):t.postRequestByName("RemoveMapLayerRequest",[e.getId()])});var n=a.find(".layer-backendstatus-icon");return n.click(function(){var i=e.getId();t.postRequestByName("ShowMapLayerInfoRequest",[i])}),i}},{protocol:["Oskari.mapframework.module.Module"]}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.view.LayersTab",function(e,t){this.instance=e,this.title=t,this.layerGroups=[],this.layerContainers={},this._createUI()},{getTitle:function(){return this.title},getTabPanel:function(){return this.tabPanel},getState:function(){var e={tab:this.getTitle(),filter:this.filterField.getValue(),groups:[]};return e},setState:function(e){e&&(e.filter||(this.filterField.setValue(e.filter),this.filterLayers(e.filter)),e.groups&&e.groups.length>0)},_createUI:function(){this.tabPanel=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),this.tabPanel.setTitle(this.title),this.tabPanel.getContainer().append(this.getFilterField().getField()),this.accordion=Oskari.clazz.create("Oskari.userinterface.component.Accordion"),this.accordion.insertTo(this.tabPanel.getContainer())},getFilterField:function(){if(this.filterField)return this.filterField;var e=this,t=Oskari.clazz.create("Oskari.userinterface.component.FormInput");return t.setPlaceholder(this.instance.getLocalization("filter").text),t.addClearButton(),t.bindChange(function(){e.filterLayers(t.getValue())},!0),this.filterField=t,t},showLayerGroups:function(e){this.accordion.removeAllPanels(),this.layerContainers=void 0,this.layerContainers={},this.layerGroups=e;for(var t=0;e.length>t;++t){var i=e[t],s=i.getLayers(),a=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");a.setTitle(i.getTitle()+" ("+s.length+")"),i.layerListPanel=a;for(var r=a.getContainer(),n=0;s.length>n;++n){var o=s[n],l=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.view.Layer",o,this.instance.sandbox,this.instance.getLocalization()),h=l.getContainer();r.append(h),this.layerContainers[o.getId()]=l}this.accordion.addPanel(a)}for(var u=this.instance.sandbox.findAllSelectedMapLayers(),t=0;u.length>t;++t)this.setLayerSelected(u[t].getId(),!0);this.filterLayers(this.filterField.getValue())},filterLayers:function(e){if(this.accordion.showPanels(),!e||0==e.length)return this._showAllLayers(),void 0;for(var t=0,i=0;this.layerGroups.length>i;++i){for(var s=this.layerGroups[i],a=s.getLayers(),r=0,n=0;a.length>n;++n){var o=a[n],l=o.getId(),h=this.layerContainers[l],u=s.matchesKeyword(l,e);h.setVisible(u),u&&(r++,1==r%2?h.getContainer().addClass("odd"):h.getContainer().removeClass("odd"),s.layerListPanel.open())}s.layerListPanel.setVisible(r>0),s.layerListPanel.isVisible()&&t++,s.layerListPanel.setTitle(s.getTitle()+" ("+r+"/"+a.length+")")}if(0==t){var p=this.instance.getLocalization("errors");this.accordion.showMessage(p.noResults)}else this.accordion.removeMessage()},_showAllLayers:function(){for(var e=0;this.layerGroups.length>e;++e){for(var t=this.layerGroups[e],i=t.getLayers(),s=0;i.length>s;++s){var a=i[s],r=a.getId(),n=this.layerContainers[r];n.setVisible(!0),1==s%2?n.getContainer().addClass("odd"):n.getContainer().removeClass("odd")}t.layerListPanel.setVisible(!0),t.layerListPanel.close(),t.layerListPanel.setTitle(t.getTitle()+" ("+i.length+")")}},setLayerSelected:function(e,t){var i=this.layerContainers[e];i&&i.setSelected(t)},updateLayerContent:function(e,t){var i=this.layerContainers[e];i&&i.updateLayerContent(t)}}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselector2.view.PublishedLayersTab",function(e,t){this.instance=e,this.title=t,this.layerGroups=[],this.layerContainers={},this._createUI()},{getTitle:function(){return this.title},getTabPanel:function(){return this.tabPanel},getState:function(){var e={tab:this.getTitle(),filter:this.filterField.getValue(),groups:[]};return e},setState:function(e){e&&(e.filter||(this.filterField.setValue(e.filter),this.filterLayers(e.filter)),e.groups&&e.groups.length>0)},_createUI:function(){var e=this;this.tabPanel=Oskari.clazz.create("Oskari.userinterface.component.TabPanel"),this.tabPanel.setTitle(this.title),this.tabPanel.setSelectionHandler(function(t){t?e.tabSelected():e.tabUnselected()}),this.tabPanel.getContainer().append(this.getFilterField().getField()),this.accordion=Oskari.clazz.create("Oskari.userinterface.component.Accordion"),this.accordion.insertTo(this.tabPanel.getContainer())},getFilterField:function(){if(this.filterField)return this.filterField;var e=this,t=Oskari.clazz.create("Oskari.userinterface.component.FormInput");return t.setPlaceholder(this.instance.getLocalization("filter").text),t.addClearButton(),t.bindChange(function(){e._searchTrigger(t.getValue())},!0),this.filterField=t,t},_searchTrigger:function(e){var t=this;this.searchTimer&&clearTimeout(this.searchTimer),e&&0!=e.length?this.searchTimer=setTimeout(function(){t._search(e),t.searchTimer=void 0},500):t._search(e)},tabSelected:function(){if(0==this.layerGroups.length){this.accordion.showMessage(this.instance.getLocalization("loading"));var e=this,t=this.instance.sandbox.getAjaxUrl();jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:t+"action_route=GetPublishedMyPlaceLayers",success:function(t){e._populateLayerGroups(t),e.showLayerGroups(e.layerGroups)},error:function(){var t=e.instance.getLocalization("errors");e.accordion.showMessage(t.generic)}})}},tabUnselected:function(){},_populateLayerGroups:function(e){var t=this.instance.getSandbox();this.layerGroups=[];for(var i=t.getService("Oskari.mapframework.service.MapLayerService"),s=t.getUser().getUuid(),a=null,r=0;e.length>r;++r){var n=e[r];a&&a.getTitle()==n.name||(a=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.model.LayerGroup",n.name),this.layerGroups.push(a));for(var o=0;n.layers.length>o;++o){var l=n.layers[o],h=this._getPublishedLayer(l,i,s==n.id);h.setDescription(n.name),a.addLayer(h)}}},_getPublishedLayer:function(e,t,i){var s=this._getMapLayerJsonBase();s.wmsUrl="/karttatiili/myplaces?myCat="+e.id+"&",s.name=e.name,s.id="myplaces_"+e.id,s.permissions=i?{publish:"publication_permission_ok"}:{publish:"no_publication_permission"};var a=t.createMapLayer(s);if(!i)try{t.addLayer(a)}catch(r){}return a},_getMapLayerJsonBase:function(){var e=this.instance.getLocalization("published"),t={wmsName:"ows:my_places_categories",type:"wmslayer",isQueryable:!0,opacity:50,metaType:"published",orgName:e.organization,inspire:e.inspire};return t},showLayerGroups:function(e){this.accordion.removeAllPanels(),this.layerContainers=void 0,this.layerContainers={},this.layerGroups=e;for(var t=0;e.length>t;++t){var i=e[t],s=i.getLayers(),a=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");a.setTitle(i.getTitle()+" ("+s.length+")"),i.layerListPanel=a;for(var r=a.getContainer(),n=0;s.length>n;++n){var o=s[n],l=Oskari.clazz.create("Oskari.mapframework.bundle.layerselector2.view.Layer",o,this.instance.sandbox,this.instance.getLocalization()),h=l.getContainer();r.append(h),this.layerContainers[o.getId()]=l}this.accordion.addPanel(a)}if(0==this.layerGroups.length){var u=this.instance.getLocalization("errors");this.accordion.showMessage(u.noResults)}else for(var p=this.instance.sandbox.findAllSelectedMapLayers(),t=0;p.length>t;++t)this.setLayerSelected(p[t].getId(),!0)},_search:function(e){var t=this;return e&&0!=e.length?(this.showLayerGroups([]),this.accordion.showMessage(this.instance.getLocalization("loading")),jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},data:{searchKey:e},url:ajaxUrl+"action_route=FreeFindFromMyPlaceLayers",success:function(e){t._populateLayerGroups(e),t.showLayerGroups(t.layerGroups)},error:function(){var e=t.instance.getLocalization("errors");t.accordion.showMessage(e.generic)}}),void 0):(this.updateLayerContent(),void 0)},setLayerSelected:function(e,t){var i=this.layerContainers[e];i&&i.setSelected(t)},updateLayerContent:function(){this.showLayerGroups([]),this.tabSelected()}}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.LayerSelectionBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.layerselection2.LayerSelectionBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/Tile.js"},{type:"text/css",src:"../../../../resources/framework/bundle/layerselection2/css/style.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/layerselection2/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"layerselection2","Bundle-Name":"layerselection2","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("layerselection2","Oskari.mapframework.bundle.layerselection2.LayerSelectionBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.LayerSelectionBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null},{__name:"LayerSelection",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t=Oskari.$("sandbox");e.sandbox=t,this.localization=Oskari.getLocalization(this.getName()),t.register(e);for(p in e.eventHandlers)t.registerForEventByName(e,p);var i=t.getRequestBuilder("userinterface.AddExtensionRequest")(this);t.request(this,i),e.createUi()}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerRemoveEvent:function(e){this.plugins["Oskari.userinterface.Tile"].refresh(),this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(e.getMapLayer(),!1)},AfterMapLayerAddEvent:function(e){this.plugins["Oskari.userinterface.Tile"].refresh(),this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged(e.getMapLayer(),!0,e.getKeepLayersOrder())},MapLayerEvent:function(e){var t=this.sandbox.getService("Oskari.mapframework.service.MapLayerService"),i=e.getLayerId();if("update"===e.getOperation()){var s=t.findMapLayer(i);this.plugins["Oskari.userinterface.Flyout"].handleLayerModified(s)}},MapLayerVisibilityChangedEvent:function(e){this.plugins["Oskari.userinterface.Flyout"].handleLayerVisibilityChanged(e.getMapLayer(),e.isInScale(),e.isGeometryMatch())},AfterChangeMapLayerOpacityEvent:function(e){e._creator!=this.getName()&&this.plugins["Oskari.userinterface.Flyout"].handleLayerOpacityChanged(e.getMapLayer())},AfterChangeMapLayerStyleEvent:function(e){e._creator!=this.getName()&&this.plugins["Oskari.userinterface.Flyout"].handleLayerStyleChanged(e.getMapLayer())},"userinterface.ExtensionUpdatedEvent":function(e){var t=this;e.getExtension().getName()==t.getName()&&"close"!=e.getViewState()}},stop:function(){var e=this.sandbox;for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);var t=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,t),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselection2.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.layerselection2.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi(),this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null,this.templateLayer=null,this.templateLayerTools=null,this.templateLayerOutOfScale=null,this.templateLayerOutOfContentArea=null,this.sortableBinded=!1,this._sliders={}},{getName:function(){return"Oskari.mapframework.bundle.layerselection2.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("layerselection2")||jQuery(this.container).addClass("layerselection2")},startPlugin:function(){var e=this.instance.getLocalization("layer");this.template=jQuery('<ul class="selectedLayersList sortable" data-sortable=\'{itemCss: "li.layer.selected", handleCss: "div.layer-title" }\'></ul>'),this.templateLayer=jQuery('<li class="layer selected"><div class="layer-info"><div class="layer-icon"></div><div class="layer-tool-remove"></div><div class="layer-title"><h4></h4></div></div><div class="stylesel"><label for="style">'+e.style+"</label>"+'<select name="style"></select></div>'+'<div class="layer-tools volatile">'+"</div>"+"</li>"),this.templateLayerFooterTools=jQuery('<div class="left-tools"><div class="layer-visibility"><a href="JavaScript:void(0);">'+e.hide+"</a>"+"&nbsp;"+'<span class="temphidden" '+'style="display: none;">'+e.hidden+"</span>"+"</div>"+'<div class="oskariui layer-opacity">'+'<div class="layout-slider" id="layout-slider">'+"</div> "+'<div class="opacity-slider" style="display:inline-block">'+'<input type="text" name="opacity-slider" class="opacity-slider opacity" id="opacity-slider" />%</div>'+"</div>"+"</div>"+'<div class="right-tools">'+'<div class="layer-rights"></div>'+'<div class="layer-description">'+'<div class="icon-info"></div>'+"</div></div>"),this.templateLayerFooterHidden=jQuery('<p class="layer-msg"><a href="JavaScript:void(0);">'+e.show+"</a> "+e.hidden+"</p>"),this.templateLayerFooterOutOfScale=jQuery('<p class="layer-msg">'+e["out-of-scale"]+' <a href="JavaScript:void(0);">'+e["move-to-scale"]+"</a></p>"),this.templateLayerFooterOutOfContentArea=jQuery('<p class="layer-msg">'+e["out-of-content-area"]+' <a href="JavaScript:void(0);">'+e["move-to-content-area"]+"</a></p>")},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},createUi:function(){var e=this,t=jQuery(this.container);t.empty();var i=this.template.clone();t.append(i);for(var s=e.instance.getSandbox(),a=s.findAllSelectedMapLayers(),r=s.getMap().getScale(),n=a.length-1;n>=0;--n){var o=a[n],l=this._createLayerContainer(o);i.append(l),this._appendLayerFooter(l,o,o.isInScale(r),!0)}i.sortable({stop:function(t,i){var s=i.item;e._layerOrderChanged(s)}}),i.disableSelection(),this.sortableBinded||(this.sortableBinded=!0)},_appendLayerFooter:function(e,t,i,s){var a=e.find("div.layer-tools"),r=this._createLayerFooter(t,e);if(t.isVisible())if(i)if(s)r.css("display","");else{var n=this._createLayerFooterOutOfContentArea(t);a.addClass("out-of-content"),r.css("display","none"),a.append(n)}else{var o=this._createLayerFooterOutOfScale(t);a.addClass("out-of-scale"),r.css("display","none"),a.append(o)}else a.addClass("hidden"),r.css("display","none"),a.append(this._createLayerFooterHidden(t));a.append(r),this._addSlider(t,e);var l=e.find("div.layer-opacity input.opacity");l.attr("value",t.getOpacity())},_addSlider:function(e,t){var i=this,s=e.getId(),a=e.getOpacity(),r=t.find(".layout-slider"),n=r.slider({min:0,max:100,value:a,slide:function(t,s){i._layerOpacityChanged(e,s.value)},stop:function(t,s){i._layerOpacityChanged(e,s.value)}});return i._sliders[s]=n,n},_layerOrderChanged:function(e){var t=jQuery(this.container).find(".selectedLayersList li"),i=e.attr("layer_id"),s=-1;if(t.each(function(e){return $(this).attr("layer_id")==i?(s=e,!1):!0}),s>-1){s=t.length-1-s;var a=this.instance.getSandbox(),r="RearrangeSelectedMapLayerRequest",n=a.getRequestBuilder(r),o=n(i,s);a.request(this.instance.getName(),o)}},_createLayerContainer:function(e){var t=this,i=t.instance.getSandbox(),s="ChangeMapLayerOpacityRequest";i.getRequestBuilder(s);var a=e.getId();e.getOpacity();var r=this.templateLayer.clone();r.attr("layer_id",a),r.find("div.layer-title h4").append(e.getName()),r.find("div.layer-title").append(e.getDescription());var n=r.find("div.stylesel");if(n.hide(),e.getStyles&&e.getStyles().length>1){for(var o=!1,l=e.getStyles(),h=n.find("select"),u=0;l.length>u;u++)if(l[u].getName()){var p=jQuery('<option value="'+l[u].getName()+'">'+l[u].getTitle()+"</option>");h.append(p),o=!0}h.change(function(){var s=h.find("option:selected").val();e.selectStyle(s);var a="ChangeMapLayerStyleRequest",r=i.getRequestBuilder(a),n=r(e.getId(),s);i.request(t.instance.getName(),n)}),o&&(h.val(e.getCurrentStyle().getName()),n.show())}var c=this.instance.getLocalization("layer").tooltip,d=r.find("div.layer-icon");return e.isBaseLayer()?(d.addClass("layer-base"),d.attr("title",c["type-base"])):e.isLayerOfType("WMS")?(e.isGroupLayer()?d.addClass("layer-group"):d.addClass("layer-wms"),d.attr("title",c["type-wms"])):e.isLayerOfType("WMTS")?(d.addClass("layer-wmts"),d.attr("title",c["type-wms"])):e.isLayerOfType("WFS")?(d.addClass("layer-wfs"),d.attr("title",c["type-wfs"])):e.isLayerOfType("VECTOR")&&(d.addClass("layer-vector"),d.attr("title",c["type-wms"])),r.find("div.layer-tool-remove").addClass("icon-close"),r.find("div.layer-tool-remove").bind("click",function(){var s="RemoveMapLayerRequest",a=i.getRequestBuilder(s),r=a(e.getId());i.request(t.instance.getName(),r)}),r},handleLayerVisibilityChanged:function(e,t,i){var s=this;s.instance.getSandbox();var a="li.layer.selected[layer_id="+e.getId()+"]",r=jQuery(this.container).find(a);this.instance.getLocalization("layer");var n=r.find("div.layer-tools");n.empty(),r.removeClass("hidden"),r.removeClass("out-of-scale"),r.removeClass("out-of-content"),this._sliders[e.getId()]=null,this._appendLayerFooter(r,e,t,i)},_layerOpacityChanged:function(e,t){var i=this.instance.getSandbox(),s="ChangeMapLayerOpacityRequest",a=i.getRequestBuilder(s),r=a(e.getId(),t);i.request(this.instance.getName(),r);var n="li.layer.selected[layer_id="+e.getId()+"]",o=jQuery(this.container).find(n),l=o.find("div.layer-opacity input.opacity");l.attr("value",e.getOpacity())},handleLayerOpacityChanged:function(e){this._sliders[e.getId()]&&this._sliders[e.getId()].slider("value",e.getOpacity())},handleLayerStyleChanged:function(e){var t="li.layer.selected[layer_id="+e.getId()+"]",i=jQuery(this.container).find(t),s=i.find("div.stylesel select");s.val(e.getCurrentStyle().getName())},_createLayerFooterOutOfScale:function(e){var t=this,i=t.instance.getSandbox(),s=this.templateLayerFooterOutOfScale.clone();s.addClass("layer-msg-for-outofscale");var a="MapModulePlugin.MapMoveByLayerContentRequest",r=i.getRequestBuilder(a);return s.find("a").bind("click",function(){var s=r(e.getId());return i.request(t.instance.getName(),s),!1}),s},_createLayerFooterHidden:function(e){var t=this,i=t.instance.getSandbox(),s=this.templateLayerFooterHidden.clone();s.addClass("layer-msg-for-hidden");var a="MapModulePlugin.MapLayerVisibilityRequest",r=i.getRequestBuilder(a);return s.find("a").bind("click",function(){var s=r(e.getId(),!0);return i.request(t.instance.getName(),s),!1}),s},_createLayerFooterOutOfContentArea:function(e){var t=this,i=t.instance.getSandbox(),s=this.templateLayerFooterOutOfContentArea.clone();s.addClass("layer-msg-for-outofcontentarea");var a="MapModulePlugin.MapMoveByLayerContentRequest",r=i.getRequestBuilder(a);return s.find("a").bind("click",function(){var s=r(e.getId());return i.request(t.instance.getName(),s),!1}),s},_createLayerFooter:function(e){var t=this,i=t.instance.getSandbox(),s=this.templateLayerFooterTools.clone();this.instance.getLocalization("layer");var a="MapModulePlugin.MapLayerVisibilityRequest",r=i.getRequestBuilder(a);return s.find("div.layer-visibility a").bind("click",function(){var s=r(e.getId(),!1);return i.request(t.instance.getName(),s),!1}),e.getMetadataIdentifier()?s.find("div.icon-info").bind("click",function(){var t="catalogue.ShowMetadataRequest",s=e.getMetadataIdentifier();i.postRequestByName(t,[{uuid:s}])}):s.find("div.layer-description").hide(),this._updatePublishPermissionText(e,s),s},_updatePublishPermissionText:function(e,t){var i=this.instance.getSandbox(),s=this.instance.getLocalization("layer"),a=e.getPermission("publish");"publication_permission_ok"==a&&i.getUser().isLoggedIn()&&(t.find("div.layer-rights").html(s.rights.can_be_published_map_user.label),t.find("div.layer-rights").attr("title",s.rights.can_be_published_map_user.tooltip))},handleLayerSelectionChanged:function(e,t,i){if(1==t){var s=this,a=s.instance.getSandbox(),r=a.getMap().getScale(),n=jQuery("ul.selectedLayersList"),o=this._createLayerContainer(e);o.find("div.layer-tools");var l=[];l=e.isBaseLayer()&&1!=i?n.find("li[layer_id^=base_]"):n.find(".layer.selected"),l.length>0?l.first().before(o):n.append(o),this._appendLayerFooter(o,e,e.isInScale(r),!0)}else{var h=jQuery(this.container).find("li[layer_id="+e.getId()+"]");h&&(this._sliders[e.getId()]=null,h.remove())}},handleLayerModified:function(e){var t=jQuery(this.container).find("li[layer_id="+e.getId()+"]");
jQuery(t).find(".layer-title h4").html(e.getName());var i=t.find("div.layer-tools");this._updatePublishPermissionText(e,i)},refresh:function(){for(var e=this,t=e.instance.getSandbox(),i=t.findAllSelectedMapLayers(),s=i.length-1;s>=0;--s){var a=i[s];this.handleLayerOpacityChanged(a)}}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.mapframework.bundle.layerselection2.Tile",function(e){this.instance=e,this.container=null,this.template=null,this.shownLayerCount=null},{getName:function(){return"Oskari.mapframework.bundle.layerselection2.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){console.log("Tile.setState",this,e)},notifyUser:function(){var e=this.container.children(".oskari-tile-status");e.stop(),this._blink(e,2)},_blink:function(e,t){var i=this;e&&(t||(t=1),e.animate({opacity:.25},500,function(){e.animate({opacity:1},500,function(){t>1&&i._blink(e,--t)})}))},refresh:function(){var e=this,t=e.instance;this.container,this.template;var i=t.getSandbox(),s=i.findAllSelectedMapLayers(),a=s.length,r=this.container.children(".oskari-tile-status");r.addClass("icon-bubble-right"),r.html(a),this.notifyUser()}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.PersonalDataBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.PersonalDataBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/Tile.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/MyPlacesTab.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/MyViewsTab.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/service/ViewService.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/PublishedMapsTab.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/AccountTab.js"},{type:"text/css",src:"../../../../resources/framework/bundle/personaldata/css/personaldata.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/personaldata/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"personaldata","Bundle-Name":"personaldata","Bundle-Author":[{Name:"ejv",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("personaldata","Oskari.mapframework.bundle.personaldata.PersonalDataBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.PersonalDataBundleInstance",function(){this.core=null,this.sandbox=null,this.started=!1,this.template=null,this.plugins={},this.viewService=null},{__name:"PersonalData",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getViewService:function(){return this.viewService},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t=Oskari.$("sandbox");e.sandbox=t,this.viewService=Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.service.ViewService",t.getAjaxUrl()),t.register(e);for(p in e.eventHandlers)t.registerForEventByName(e,p);var i=t.getRequestBuilder("userinterface.AddExtensionRequest")(this);t.request(this,i),e.createUi()}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{},stop:function(){var e=this.sandbox();for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);var t=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,t),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi(),this.plugins["Oskari.userinterface.Tile"].refresh()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null,this.templateTabHeader=null,this.templateTabContent=null,this.tabsData=[]},{getName:function(){return"Oskari.mapframework.bundle.personaldata.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("personaldata")||jQuery(this.container).addClass("personaldata")},startPlugin:function(){var e=this.instance.getLocalization("tabs");this.tabsData={myPlaces:Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.MyPlacesTab",this.instance,e.myplaces),myViews:Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.MyViewsTab",this.instance,e.myviews),publishedMaps:Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.PublishedMapsTab",this.instance,e.publishedmaps),account:Oskari.clazz.create("Oskari.mapframework.bundle.personaldata.AccountTab",this.instance,e.account)}},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e,console.log("Flyout.setState",this,e)},createUi:function(){var e=this,t=e.instance.getSandbox(),i=jQuery(this.container);if(i.empty(),this.tabsContainer=Oskari.clazz.create("Oskari.userinterface.component.TabContainer",this.instance.getLocalization("notLoggedIn")),this.tabsContainer.insertTo(i),t.getUser().isLoggedIn())for(var s in this.tabsData){var a=this.tabsData[s],r=Oskari.clazz.create("Oskari.userinterface.component.TabPanel");r.setTitle(a.getTitle()),a.addTabContent(r.getContainer()),a.bindEvents&&a.bindEvents(),this.tabsContainer.addPanel(r)}}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.personaldata.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){},getOptions:function(){},setState:function(e){console.log("Tile.setState",this,e)},refresh:function(){}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.MyPlacesTab",function(e,t){this.instance=e,this.loc=t,this.tabsContainer=void 0,this.tabPanels={},this.linkTemplate=jQuery('<a href="JavaScript:void(0);"></a>'),this.iconTemplate=jQuery('<div class="icon"></div>')},{getName:function(){return"PersonalData.MyPlaces"},getTitle:function(){return this.loc.title},addTabContent:function(e){this.tabsContainer=Oskari.clazz.create("Oskari.userinterface.component.TabDropdownContainer",this.loc.nocategories),this.tabsContainer.insertTo(e)},eventHandlers:{"MyPlaces.MyPlacesChangedEvent":function(){var e=this.instance.sandbox.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService"),t=e.getAllCategories();e.getAllMyPlaces();for(var i=this,s=function(e,t){return function(){var s=i.instance.sandbox.getRequestBuilder("MyPlaces.PublishCategoryRequest")(e,t);return i.instance.sandbox.request(i.instance,s),!1}},a=function(e){return function(){var t=i.instance.sandbox.getRequestBuilder("MyPlaces.EditCategoryRequest")(e);return i.instance.sandbox.request(i.instance,t),!1}},r=function(e){return function(){var t=i.instance.sandbox.getRequestBuilder("MyPlaces.DeleteCategoryRequest")(e);return i.instance.sandbox.request(i.instance,t),!1}},n=0;t.length>n;++n){var o=t[n].getId(),l=this.tabPanels[o];l||(l=this._createCategoryTab(t[n]),this.tabsContainer.addPanel(l),this.tabPanels[o]=l),this._populatePlaces(o),l.getContainer().empty(),l.grid.renderTo(l.getContainer());var h=this.linkTemplate.clone();h.addClass("categoryOp"),h.append(this.loc.editCategory),h.bind("click",a(o)),l.getContainer().append(h);var u=this.linkTemplate.clone();u.addClass("categoryOp"),u.append(this.loc.deleteCategory),u.bind("click",r(o)),l.getContainer().append(u);var p=this.linkTemplate.clone();p.addClass("categoryOp");var c=t[n].isPublic(),d=this.iconTemplate.clone();c?(d.addClass("icon-public"),p.attr("title",this.loc.publishCategory.publicTooltip)):(d.addClass("icon-private"),p.attr("title",this.loc.publishCategory.privateTooltip)),p.append(d),p.bind("click",s(o,!c)),l.getContainer().append(p)}this._removeObsoleteCategories()}},_showPlace:function(e,t){var i=e.getCentroid(),s=this.instance.sandbox.getRequestBuilder("MapMoveRequest")(i.x,i.y,e.getBounds(),!1);this.instance.sandbox.request(this.instance,s);var a="myplaces_"+t,r=this.instance.sandbox.findMapLayerFromSelectedMapLayers(a);if(!r){var n=this.instance.sandbox.getRequestBuilder("AddMapLayerRequest")(a,!0);this.instance.sandbox.request(this.instance,n)}},_editPlace:function(e){this._showPlace(e.geometry,e.categoryId);var t=this.instance.sandbox.getRequestBuilder("MyPlaces.EditPlaceRequest")(e.id);this.instance.sandbox.request(this.instance,t)},_deletePlace:function(e){var t=this,i=this.instance.sandbox,s=this.loc.notification["delete"],a=Oskari.clazz.create("Oskari.userinterface.component.Popup"),r=Oskari.clazz.create("Oskari.userinterface.component.Button");r.setTitle(s.btnDelete),r.addClass("primary"),r.setHandler(function(){a.close();var r=i.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService"),n=function(r){var n=e.categoryId,o="myplaces_"+n,l=i.findMapLayerFromSelectedMapLayers(o);if(l){var h=i.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest"),u=h(o,!0);i.request(t.instance,u)}r?a.show(s.title,s.success):a.show(s.title,s.error),a.fadeout()};r.deleteMyPlace(e.id,n)});var n=a.createCloseButton(s.btnCancel),o=s.confirm+'"'+e.name+'"'+"?";a.show(s.title,o,[n,r]),a.makeModal()},_getDrawModeFromGeometry:function(e){var t=e.CLASS_NAME;return"OpenLayers.Geometry.Point"===t?"point":"OpenLayers.Geometry.LineString"===t?"line":"OpenLayers.Geometry.Polygon"===t?"area":null},_createCategoryTab:function(e){var t=this;e.getId();var i=Oskari.clazz.create("Oskari.userinterface.component.TabPanel");i.setTitle(e.getName()),i.grid=Oskari.clazz.create("Oskari.userinterface.component.Grid");var s=["name","desc","createDate","updateDate","edit","delete"];i.grid.setVisibleFields(s);var a=function(e,i){var s=t.linkTemplate.clone(),a=t.iconTemplate.clone(),r=t._getDrawModeFromGeometry(i.geometry);return a.addClass("myplaces-"+r),s.append(a),s.append(e),s.bind("click",function(){return t._showPlace(i.geometry,i.categoryId),!1}),s};i.grid.setColumnValueRenderer("name",a);var r=function(e,i){var s=t.linkTemplate.clone();return s.append(e),s.bind("click",function(){return t._editPlace(i),!1}),s};i.grid.setColumnValueRenderer("edit",r);var n=function(e,i){var s=t.linkTemplate.clone();return s.append(e),s.bind("click",function(){return t._deletePlace(i),!1}),s};i.grid.setColumnValueRenderer("delete",n);for(var o=0;s.length>o;++o){var l=s[o];i.grid.setColumnUIName(l,this.loc.grid[l])}return i},_populatePlaces:function(e){var t=this.instance.sandbox.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService"),i=t.getAllMyPlaces(),s=this.tabPanels[e],a=Oskari.clazz.create("Oskari.userinterface.component.GridModel");a.setIdField("id"),s.grid.setDataModel(a);for(var r=0;i.length>r;++r)i[r].getCategoryID()==e&&a.addData({id:i[r].getId(),name:i[r].getName(),desc:i[r].getDescription(),geometry:i[r].getGeometry(),categoryId:i[r].getCategoryID(),edit:this.loc.edit,"delete":this.loc["delete"],createDate:this._formatDate(t,i[r].getCreateDate()),updateDate:this._formatDate(t,i[r].getUpdateDate())})},_formatDate:function(e,t){var i=e.parseDate(t),s="";return i.length>0&&(s=i[0]),s},_removeObsoleteCategories:function(){var e=this.instance.sandbox.getService("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService");for(var t in this.tabPanels){var i=e.findCategory(t);i||(this.tabsContainer.removePanel(this.tabPanels[t]),this.tabPanels[t].grid=void 0,delete this.tabPanels[t].grid,this.tabPanels[t]=void 0,delete this.tabPanels[t])}},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},bindEvents:function(){var e=this.instance,t=e.getSandbox();for(p in this.eventHandlers)t.registerForEventByName(this,p)},unbindEvents:function(){var e=this.instance,t=e.getSandbox();for(p in this.eventHandlers)t.unregisterForEventByName(this,p)}}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.MyViewsTab",function(e,t){this.instance=e,this.template=jQuery('<div class="viewsList volatile"></div>'),this.templateLink=jQuery('<a href="JavaScript:void(0);"></a>'),this.loc=t,this.container=null;var i=e.sandbox,s=this,a=i.getRequestBuilder("StateHandler.SaveStateRequest");if(a){var r=i.getRequestBuilder("Toolbar.AddToolButtonRequest"),n="localization.button.toolbarsave";t&&t.button&&t.button.toolbarsave&&(n=t.button.toolbarsave),i.request(e,r("save_view","viewtools",{iconCls:"tool-save-view",tooltip:n,sticky:!1,prepend:!0,callback:function(){s._promptForViewName(function(t){var s=i.getRequestBuilder("StateHandler.SaveStateRequest");i.request(e,s(t))})}}))}if(!i.getUser().isLoggedIn()){var r=i.getRequestBuilder("Toolbar.ToolButtonStateRequest");i.request(e,r("save_view","viewtools",!1))}},{_promptForViewName:function(e,t){var i=this,s=Oskari.clazz.create("Oskari.userinterface.component.Form"),a=Oskari.clazz.create("Oskari.userinterface.component.FormInput","name");a.setPlaceholder(this.loc.popup.placeholder);var r=this.loc.popup.title;t&&(r=this.loc.popup.edit,a.setValue(t)),a.setRequired(!0,i.loc.save.error_noname),a.setContentCheck(!0,i.loc.save.error_illegalchars),s.addField(a);var n=Oskari.clazz.create("Oskari.userinterface.component.Popup"),o=Oskari.clazz.create("Oskari.userinterface.component.Button");o.setTitle(this.loc.button.save),o.addClass("primary"),this.instance.sandbox,o.setHandler(function(){var t=s.validate();0==t.length?(e(a.getValue()),n.close()):s.showErrors()});var l=n.createCloseButton(this.loc.button.cancel);n.show(r,s.getForm(),[l,o])},getName:function(){return"PersonalData.MyViews"},getTitle:function(){return this.loc.title},addTabContent:function(e){var t=this,i=t.template.clone();t.container=e,e.append(i),t._refreshViewsList()},_renderViewsList:function(e){e||(e=[]);var t=this,i=t.container.find(".viewsList");i.empty(),this.viewData=e;var s=this._getGridModel(e),a=this._getGrid(s);a.renderTo(i)},_refreshViewsList:function(){var e=this,t=e.instance.getViewService();t.loadViews("USER",function(t,i){t?e._renderViewsList(i.views):e._showErrorMessage(e.loc.error.loadfailed)})},editView:function(e){var t=this;this.instance.getSandbox();var i=t.instance.getViewService(),s=function(s){i.renameView(e.id,s,function(e){if(e){var i=Oskari.clazz.create("Oskari.userinterface.component.Popup");i.show(t.loc.popup.title,t.loc.save.success),i.fadeout(),t._refreshViewsList()}else t._showErrorMessage(t.loc.error.notsaved)})};this._promptForViewName(s,e.name)},_getGridModel:function(e){var t=Oskari.clazz.create("Oskari.userinterface.component.GridModel");t.setIdField("id");for(var i=0;e.length>i;++i){var s=e[i],a=s.isPublic===!0,r={id:s.id,state:s.state,name:s.name,isPublic:a,edit:this.loc.edit,publish:a?this.loc.unpublish:this.loc.publish,"delete":this.loc["delete"]};t.addData(r)}return t},_getGrid:function(e){var t=this,i=this.instance,s=i.getSandbox(),a=["name","edit","delete"],r=Oskari.clazz.create("Oskari.userinterface.component.Grid");r.setDataModel(e),r.setVisibleFields(a);var n=function(e,a){var r=t.templateLink.clone();return r.append(e),r.bind("click",function(){var e=s.getRequestBuilder("StateHandler.SetStateRequest");if(e){var t=e(a.state);t.setCurrentViewId(a.id),s.request(i,t)}return!1}),r};r.setColumnValueRenderer("name",n);var o=function(e,i){var s=t.templateLink.clone();return s.append(e),s.bind("click",function(){var e=t.getViewById(i.id);return e&&t.editView(e),!1}),s};r.setColumnValueRenderer("edit",o);var l=function(e,i){var s=t.templateLink.clone();return s.append(e),s.bind("click",function(){var e=t.getViewById(i.id);return e&&t._confirmDelete(e),!1}),s};r.setColumnValueRenderer("delete",l);for(var h=0;a.length>h;++h){var u=a[h],p="grid."+u;this.loc&&this.loc.grid&&this.loc.grid[u]&&(p=this.loc.grid[u]),r.setColumnUIName(u,p)}return r},getViewById:function(e){for(var t=0;this.viewData.length>t;++t)if(this.viewData[t].id==e)return this.viewData[t];this._showErrorMessage(me.loc.error.generic)},bindEvents:function(){var e=this.instance,t=e.getSandbox();for(p in this.eventHandlers)t.registerForEventByName(this,p)},_confirmDelete:function(e){var t=this,i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=Oskari.clazz.create("Oskari.userinterface.component.Button");s.setTitle(this.loc["delete"]),s.addClass("primary"),this.instance.sandbox,s.setHandler(function(){t._deleteView(e),i.close()});var a=i.createCloseButton(this.loc.button.cancel);i.show(t.loc.popup.deletetitle,t.loc.popup.deletemsg,[a,s]),i.makeModal()},_deleteView:function(e){var t=this,i=t.instance.getViewService();i.deleteView(e,function(e){e?t._refreshViewsList():t._showErrorMessage(t.loc.error.notdeleted)})},_showErrorMessage:function(e){var t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=t.createCloseButton(this.loc.button.ok);i.addClass("primary"),t.show(this.loc.error.title,e,[i])},unbindEvents:function(){var e=this.instance,t=e.getSandbox();for(p in this.eventHandlers)t.unregisterForEventByName(this,p)},eventHandlers:{StateSavedEvent:function(e){if(e.isError())return this._showErrorMessage(this.loc.error.notsaved),void 0;var t=Oskari.clazz.create("Oskari.userinterface.component.Popup");t.show(this.loc.popup.title,this.loc.save.success),t.fadeout(),this._refreshViewsList()}},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])}}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.service.ViewService",function(e){this._viewUrl=e},{__qname:"Oskari.mapframework.bundle.personaldata.service.ViewService",getQName:function(){return this.__qname},__name:"ViewService",getName:function(){return this.__name},loadViews:function(e,t){var i=this;e||(e="USER"),jQuery.ajax({url:i._viewUrl+"action_route=GetViews",data:{viewType:e},type:"POST",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(e){t(!0,e)},error:function(){t(!1)}})},deleteView:function(e,t){var i=this;jQuery.ajax({url:i._viewUrl+"action_route=DeleteView",data:{id:e.id},type:"POST",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(){t(!0)},error:function(){t(!1)}})},makeViewPublic:function(e,t,i){var s=this;jQuery.ajax({url:s._viewUrl+"action_route=AdjustViewAccess",data:{id:e,isPublic:t},type:"POST",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(){i(!0)},error:function(){i(!1)}})},renameView:function(e,t,i){var s=this;jQuery.ajax({url:s._viewUrl+"action_route=RenameView",type:"POST",data:{id:e,newName:t},dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(){i(!0)},error:function(){i(!1)}})}},{protocol:["Oskari.mapframework.service.Service"]}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.PublishedMapsTab",function(e,t){this.instance=e,this.template=jQuery('<div class="viewsList volatile"></div>'),this.templateLink=jQuery('<a href="JavaScript:void(0);"></a>'),this.loc=t,this.container=null},{getName:function(){return"PersonalData.MyViews"},getTitle:function(){return this.loc.title},addTabContent:function(e){var t=this,i=t.template.clone();t.container=e,e.append(i),t._refreshViewsList()},_renderViewsList:function(e){e||(e=[]);var t=this,i=t.container.find(".viewsList");i.empty(),this.viewData=e;var s=this._getGridModel(e),a=this._getGrid(s);a.renderTo(i)},_refreshViewsList:function(){var e=this,t=e.instance.getViewService();t.loadViews("PUBLISHED",function(t,i){t?e._renderViewsList(i.views):e._showErrorMessage(e.loc.error.loadfailed)})},getViewById:function(e){for(var t=0;this.viewData.length>t;++t)if(this.viewData[t].id==e)return this.viewData[t];this._showErrorMessage(me.loc.error.generic)},bindEvents:function(){var e=this.instance,t=e.getSandbox();for(p in this.eventHandlers)t.registerForEventByName(this,p)},_confirmDelete:function(e){var t=this,i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=Oskari.clazz.create("Oskari.userinterface.component.Button");s.setTitle(this.loc["delete"]),s.addClass("primary"),this.instance.sandbox,s.setHandler(function(){t._deleteView(e),i.close()});var a=i.createCloseButton(this.loc.button.cancel);i.show(t.loc.popup.deletetitle,t.loc.popup.deletemsg,[a,s]),i.makeModal()},_deleteView:function(e){var t=this,i=t.instance.getViewService();i.deleteView(e,function(e){e?t._refreshViewsList():t._showErrorMessage(t.loc.error.notdeleted)})},_showErrorMessage:function(e){var t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=t.createCloseButton(this.loc.button.ok);i.addClass("primary"),t.show(this.loc.error.title,e,[i])},unbindEvents:function(){var e=this.instance,t=e.getSandbox();for(p in this.eventHandlers)t.unregisterForEventByName(this,p)},_getGridModel:function(e){var t=Oskari.clazz.create("Oskari.userinterface.component.GridModel");t.setIdField("id");for(var i=0;e.length>i;++i){var s=e[i],a=s.isPublic===!0,r={id:s.id,state:s.state,name:s.name,domain:s.pubDomain,isPublic:a,edit:this.loc.edit,publish:a?this.loc.unpublish:this.loc.publish,"delete":this.loc["delete"]};t.addData(r)}return t},_getGrid:function(e){var t=this,i=this.instance,s=i.getSandbox(),a=["name","domain","publish","edit","delete"],r=Oskari.clazz.create("Oskari.userinterface.component.Grid");r.setDataModel(e),r.setVisibleFields(a);var n=function(e,i){var s=t.templateLink.clone();return s.append(e),s.bind("click",function(){return window.open("/web/fi/kartta?p_p_id=Portti2Map_WAR_portti2mapportlet&p_p_lifecycle=0&p_p_state=exclusive&published=true&viewId="+i.id,"Published","location=1,status=1,scrollbars=yes,width=850,height=800"),!1}),s};r.setColumnValueRenderer("name",n);var o=function(e,a){var r=t.templateLink.clone();return r.append(e),r.bind("click",function(){var e=s.getRequestBuilder("StateHandler.SetStateRequest");if(e){var t=e(a.state);t.setCurrentViewId(a.id),s.request(i,t)}return!1}),r};r.setColumnValueRenderer("edit",o);var l=function(e,i){var s=t.templateLink.clone();return s.append(e),s.bind("click",function(){var e=t.getViewById(i.id);return e&&t._confirmDelete(e),!1}),s};r.setColumnValueRenderer("delete",l);var h=i.getViewService(),u=function(e,i){var s=t.templateLink.clone();return s.html(e),s.bind("click",function(){var e=t.getViewById(i.id);if(e){var a=!e.isPublic;h.makeViewPublic(i.id,a,function(r){r?(e.isPublic=a,i.publish=e.isPublic?t.loc.unpublish:t.loc.publish,s.html(i.publish)):a?t._showErrorMessage(t.loc.error.makePublic):t._showErrorMessage(t.loc.error.makePrivate)})}return!1}),s};r.setColumnValueRenderer("publish",u);for(var p=0;a.length>p;++p){var c=a[p],d="grid."+c;this.loc&&this.loc.grid&&this.loc.grid[c]&&(d=this.loc.grid[c]),r.setColumnUIName(c,d)}return r},eventHandlers:{"Publisher.MapPublishedEvent":function(){this._refreshViewsList()}},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])}}),Oskari.clazz.define("Oskari.mapframework.bundle.personaldata.AccountTab",function(e,t){this.instance=e,this.template=jQuery('<div class="account"><div class="info"></div><div class="bottomlinks"></div></div>'),this.loc=t},{getTitle:function(){return this.loc.title},addTabContent:function(e){var t=this.template.clone();e.append(t),this._createAccountTab(e)},_createAccountTab:function(e){for(var t=this,i=t.instance.getSandbox(),s=jQuery('<div class="dataField"><div class="label"></div><div class="value"></div><br clear="all" /></div>'),a=i.getUser(),r=this.loc,n=[{label:r.firstName,value:a.getFirstName()},{label:r.lastName,value:a.getLastName()},{label:r.nickName,value:a.getNickName()},{label:r.email,value:a.getLoginName()}],o=e.find("div.info"),l=0;n.length>l;++l){var h=n[l],u=s.clone();u.find(".label").html(h.label),u.find(".value").html(h.value),o.append(u)}for(var p=[{label:r.changeInfo,href:r.changeInfoUrl}],c=e.find("div.bottomlinks"),l=0;p.length>l;++l){var h=p[l],d=jQuery('<a href="'+h.href+'">'+h.label+"</a>&nbsp; ");c.append(d)}}}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.PublisherBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.publisher.PublisherBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/Tile.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/event/MapPublishedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/view/NotLoggedIn.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/view/StartView.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/view/BasicPublisher.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/view/PublisherLocationForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/view/PublisherLayerForm.js"},{type:"text/css",src:"../../../../resources/framework/bundle/publisher/css/style.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/publisher/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"publisher","Bundle-Name":"publisher","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("publisher","Oskari.mapframework.bundle.publisher.PublisherBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.PublisherBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null,this.publisher=null,this.disabledLayers=null},{__name:"Publisher",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t=Oskari.$("sandbox");e.sandbox=t,this.localization=Oskari.getLocalization(this.getName()),t.register(e);for(p in e.eventHandlers)t.registerForEventByName(e,p);var i=t.getRequestBuilder("userinterface.AddExtensionRequest")(this);t.request(this,i),e._createUi()}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerRemoveEvent:function(){this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged()},AfterMapLayerAddEvent:function(){this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged()},MapLayerEvent:function(){this.plugins["Oskari.userinterface.Flyout"].handleLayerSelectionChanged()},"Publisher.MapPublishedEvent":function(e){var t=this.getLocalization(),i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=i.createCloseButton(t.BasicView.buttons.ok);s.addClass("primary");var a=t.published.urlPrefix+"/published/"+e.getLanguage()+"/"+e.getId(),r='<iframe src="'+a+'" width="'+e.getWidth()+'" height="'+e.getHeight()+'"></iframe>',n='<textarea rows="3" cols="80">'+r+"</textarea>",o=t.published.desc+"<br/>"+n;i.show(t.published.title,o,[s]),this.setPublishMode(!1)}},stop:function(){var e=this.sandbox();for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);var t=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,t),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.publisher.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.publisher.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},_createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi(),this.plugins["Oskari.userinterface.Tile"].refresh()},setPublishMode:function(e,t){var i=this,s=jQuery("#contentMap");jQuery("#maptools"),1==e?(this.disabledLayers=t,this.oskariLang=Oskari.getLang(),this._removeLayers(),s.addClass("mapPublishMode"),i.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[,"close"]),this.publisher=Oskari.clazz.create("Oskari.mapframework.bundle.publisher.view.BasicPublisher",this,this.getLocalization("BasicView")),this.publisher.render(s),this.publisher.setEnabled(!0)):(Oskari.setLang(this.oskariLang),this.publisher&&(this.publisher.setEnabled(!1),this.publisher.destroy()),s.removeClass("mapPublishMode"),this._addLayers())},_addLayers:function(){var e=this,t=this.sandbox,i=t.getRequestBuilder("AddMapLayerRequest");if(this.disabledLayers)for(var s=0;this.disabledLayers.length>s;++s){var a=this.disabledLayers[s];t.request(e,i(a.getId(),!0))
}},_removeLayers:function(){var e=this,t=this.sandbox,i=t.getRequestBuilder("RemoveMapLayerRequest");if(this.disabledLayers)for(var s=0;this.disabledLayers.length>s;++s){var a=this.disabledLayers[s];t.request(e,i(a.getId()))}}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null,this.view=null},{getName:function(){return"Oskari.mapframework.bundle.publisher.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("publisher")||jQuery(this.container).addClass("publisher")},startPlugin:function(){this.template=jQuery("<div></div>")},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("flyouttitle")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e,console.log("Flyout.setState",this,e)},createUi:function(){var e=this,t=jQuery(this.container);t.empty();var i=e.instance.getSandbox();this.view=i.getUser().isLoggedIn()?Oskari.clazz.create("Oskari.mapframework.bundle.publisher.view.StartView",this.instance,this.instance.getLocalization("StartView")):Oskari.clazz.create("Oskari.mapframework.bundle.publisher.view.NotLoggedIn",this.instance,this.instance.getLocalization("NotLoggedView")),this.view.render(t)},handleLayerSelectionChanged:function(){this.view&&this.view.handleLayerSelectionChanged&&this.view.handleLayerSelectionChanged()}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.publisher.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){console.log("Tile.setState",this,e)},refresh:function(){}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.event.MapPublishedEvent",function(e,t,i,s){this._id=e,this._width=t,this._height=i,this._language=s},{__name:"Publisher.MapPublishedEvent",getName:function(){return this.__name},getId:function(){return this._id},getWidth:function(){return this._width},getHeight:function(){return this._height},getLanguage:function(){return this._language}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.view.NotLoggedIn",function(e,t){this.instance=e,this.template=jQuery("<div class='notLoggedIn'></div>"),this.signupTemplate=jQuery("<div class='notLoggedIn'><a></a></div>"),this.registerTemplate=jQuery("<div class='notLoggedIn'><a></a></div>"),this.loc=t},{render:function(e){var t=this.template.clone(),i=this.signupTemplate.clone(),s=this.registerTemplate.clone();t.append(this.loc.text);var a=i.find("a");a.attr("href",this.loc.signupUrl),a.append(this.loc.signup);var r=s.find("a");r.attr("href",this.loc.registerUrl),r.append(this.loc.register),e.append(t),e.append(i),e.append(s)}}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.view.StartView",function(e,t){this.instance=e,this.template=jQuery("<div class='startview'><div class='content'></div><div class='buttons'></div></div>"),this.templateLayerList=jQuery("<div class='layerlist'><h4></h4><ul></ul></div>"),this.templateListItem=jQuery("<li></li>"),this.templateError=jQuery('<div class="error"><ul></ul></div>'),this.templateInfo=jQuery("<div class='icon-info'></div>"),this.loc=t,this.content=void 0,this.buttons={}},{render:function(e){var t=this,i=this.template.clone();this.content=i;var s="<missing_localisation>";this.loc&&this.loc.text&&(s=this.loc.txt),i.find("div.content").before(s),e.append(i);var a=Oskari.clazz.create("Oskari.userinterface.component.Button");a.addClass("primary");var s="loc.buttons.continue";this.loc&&this.loc.buttons&&this.loc.buttons["continue"]&&(s=this.loc.buttons["continue"]),a.setTitle(s),a.setHandler(function(){t.instance.setPublishMode(!0,t.getLayersWithoutPublishRights())}),this.buttons["continue"]=a;var r=Oskari.clazz.create("Oskari.userinterface.component.Button");s="loc.buttons.cancel",this.loc&&this.loc.buttons&&this.loc.buttons.cancel&&(s=this.loc.buttons.cancel),r.setTitle(s),r.setHandler(function(){t.instance.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[t.instance,"close"])}),this.buttons.cancel=r,r.insertTo(i.find("div.buttons")),a.insertTo(i.find("div.buttons")),this._renderLayerLists()},_renderLayerLists:function(){var e=this.content.find("div.content");e.find("div.error").remove(),e.find("div.layerlist").remove();for(var t=[],i=[],s=this.instance.sandbox.findAllSelectedMapLayers(),a=0;s.length>a;++a){var r=s[a];this._hasPublishRight(r)?t.push(r):i.push(r)}if(t.length>0){var n=this._getRenderedLayerList(t),o=n.find("h4"),l="loc.layerlist_title";if(this.loc&&this.loc.layerlist_title&&(l=this.loc.layerlist_title),o.append(l),e.append(n),i.length>0){var h=this._getRenderedLayerList(i),o=h.find("h4");l="loc.layerlist_denied",this.loc&&this.loc.layerlist_denied&&(l=this.loc.layerlist_denied),o.append(l);var u=this.templateInfo.clone();u.attr("title",this.loc.denied_tooltip),o.before(u),e.append(h)}}else{var p=this.templateError.clone(),c=this.templateListItem.clone();c.append(this.loc.layerlist_empty),p.find("ul").append(c),e.append(p)}},_getRenderedLayerList:function(e){for(var t=this.templateLayerList.clone(),i=t.find("ul"),s=0;e.length>s;++s){var a=e[s],r=this.templateListItem.clone();r.append(a.getName()),i.append(r)}return t},handleLayerSelectionChanged:function(){this._renderLayerLists()},_hasPublishRight:function(e){return"publication_permission_ok"==e.getPermission("publish")},getLayersWithoutPublishRights:function(){for(var e=[],t=this.instance.sandbox.findAllSelectedMapLayers(),i=0;t.length>i;++i){var s=t[i];this._hasPublishRight(s)||e.push(s)}return e}}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.view.BasicPublisher",function(e,t){this.instance=e,this.template=jQuery('<div class="basic_publisher"><div class="header"><div class="icon-close"></div><h3></h3></div><div class="content"></div></div>'),this.templateButtonsDiv=jQuery('<div class="buttons"></div>'),this.templateHelp=jQuery('<div class="help icon-info"></div>'),this.templateTool=jQuery('<div class="tool "><input type="checkbox"/><span></span></div>'),this.templateSizeOptionTool=jQuery('<div class="tool "><input type="radio" name="size" /><span></span></div>'),this.templateCustomSize=jQuery('<div class="customsize"><input type="text" name="width" placeholder="'+t.sizes.width+'"/> x '+'<input type="text" name="height" placeholder="'+t.sizes.height+'"/></div>'),this.tools=[{id:"Oskari.mapframework.bundle.mapmodule.plugin.ScaleBarPlugin",selected:!1},{id:"Oskari.mapframework.bundle.mapmodule.plugin.IndexMapPlugin",selected:!1},{id:"Oskari.mapframework.bundle.mapmodule.plugin.Portti2Zoombar",selected:!0,config:{location:{top:"10px",left:"10px"}}},{id:"Oskari.mapframework.bundle.mapmodule.plugin.SearchPlugin",selected:!1},{id:"Oskari.mapframework.mapmodule.ControlsPlugin",selected:!0},{id:"Oskari.mapframework.mapmodule.GetInfoPlugin",selected:!0}],this.sizeOptions=[{id:"small",width:580,height:387},{id:"medium",width:700,height:525,selected:!0},{id:"large",width:1240,height:700},{id:"custom",minWidth:30,minHeight:20,maxWidth:4e3,maxHeight:2e3}],this.loc=t,this.accordion=null,this.maplayerPanel=null,this.mainPanel=null,this.normalMapPlugins=[],this.logoPlugin=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.plugin.LogoPlugin"),this.latestGFI=null},{render:function(e){var t=this,i=this.template.clone();this.mainPanel=i,i.find("div.header h3").append(this.loc.title),e.append(i);var s=i.find("div.content"),a=Oskari.clazz.create("Oskari.userinterface.component.Accordion");this.accordion=a;var r=Oskari.clazz.create("Oskari.mapframework.bundle.publisher.view.PublisherLocationForm",this.loc,this);this.locationForm=r,r.init();var n=r.getPanel();n.open(),a.addPanel(n),a.addPanel(this._createSizePanel()),a.addPanel(this._createToolsPanel()),this.maplayerPanel=Oskari.clazz.create("Oskari.mapframework.bundle.publisher.view.PublisherLayerForm",this.loc,this.instance),this.maplayerPanel.init(),a.addPanel(this.maplayerPanel.getPanel()),a.insertTo(s),e.find("div.header div.icon-close").bind("click",function(){t.instance.setPublishMode(!1)}),s.append(this._getButtons());var o=this.mainPanel.find("input[type=text]");o.focus(function(){t.instance.sandbox.postRequestByName("DisableMapKeyboardMovementRequest")}),o.blur(function(){t.instance.sandbox.postRequestByName("EnableMapKeyboardMovementRequest")});var l=Oskari.clazz.create("Oskari.userinterface.component.UIHelper",this.instance.sandbox);l.processHelpLinks(this.loc.help,i,this.loc.error.title,this.loc.error.nohelp)},_setSelectedSize:function(){var e=this,t=this.mainPanel.find("div.customsize input[name=width]");t.removeClass("error");var i=this.mainPanel.find("div.customsize input[name=height]");i.removeClass("error");for(var s=this.instance.sandbox.findRegisteredModuleInstance("MainMapModule"),a=0;e.sizeOptions.length>a;++a){var r=e.sizeOptions[a];if(r.selected){var n=jQuery(s.getMap().div);if("custom"==r.id){var o=t.val();this._validateNumberRange(o,r.minWidth,r.maxWidth)?n.width(o):t.addClass("error");var l=i.val();this._validateNumberRange(l,r.minHeight,r.maxHeight)?n.height(l):i.addClass("error");break}n.width(r.width),n.height(r.height);break}}s.getMap().updateSize(),this._updateDomain()},_createSizePanel:function(){var e=this,t=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");t.setTitle(this.loc.size.label);var i=t.getContainer(),s=this.templateHelp.clone();s.attr("title",this.loc.size.tooltip),i.append(s);for(var a=function(t){return function(){i.find("input[name=size]:checked").val();for(var s=0;e.sizeOptions.length>s;++s)e.sizeOptions[s].selected=!1;t.selected=!0,e._setSelectedSize()}},r=0;this.sizeOptions.length>r;++r){var n=this.sizeOptions[r],o=this.templateSizeOptionTool.clone(),l=this.loc.sizes[n.id];n.width&&n.height&&(l=l+" ("+n.width+" x "+n.height+"px)"),o.find("span").append(l),n.selected&&o.find("input").attr("checked","checked"),i.append(o),o.find("input").attr("value",n.id),o.find("input").change(a(n))}var h=this.templateCustomSize.clone(),u=h.find("input");return u.focus(function(){var e=i.find("input[name=size][value=custom]");e.attr("checked","checked"),e.trigger("change")}),u.bind("keyup",function(){e._setSelectedSize()}),i.append(h),t},_createToolsPanel:function(){var e=this,t=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");t.setTitle(this.loc.tools.label);var i=t.getContainer(),s=this.templateHelp.clone();s.attr("title",this.loc.tools.tooltip),i.append(s);for(var a=function(t){return function(){var i=jQuery(this),s=i.is(":checked");t.selected=s,e._activatePreviewPlugin(t,s)}},r=0;this.tools.length>r;++r){var n=this.templateTool.clone(),o=this.tools[r].id;o=o.substring(o.lastIndexOf(".")+1);var l=this.loc.tools[o];n.find("span").append(l),this.tools[r].selected&&n.find("input").attr("checked","checked"),i.append(n),n.find("input").change(a(this.tools[r]))}return t},handleMapMoved:function(){var e=this.instance.sandbox.getMap();e.getX(),e.getY(),e.getZoom()},_activatePreviewPlugin:function(e,t){if(!e.plugin&&t){var i=this.instance.sandbox.findRegisteredModuleInstance("MainMapModule");e.plugin=Oskari.clazz.create(e.id,e.config),i.registerPlugin(e.plugin)}e.plugin&&(t?(e.plugin.startPlugin(this.instance.sandbox),e._isPluginStarted=!0):e._isPluginStarted&&(e._isPluginStarted=!1,e.plugin.stopPlugin(this.instance.sandbox)))},_getButtons:function(){var e=this,t=this.templateButtonsDiv.clone(),i=Oskari.clazz.create("Oskari.userinterface.component.Button");i.setTitle(this.loc.buttons.cancel),i.setHandler(function(){e.instance.setPublishMode(!1)}),i.insertTo(t);var s=Oskari.clazz.create("Oskari.userinterface.component.Button");return s.setTitle(this.loc.buttons.save),s.addClass("primary"),s.setHandler(function(){var t=e._gatherSelections();t&&e._publishMap(t)}),s.insertTo(t),t},_showValidationErrorMessage:function(e){for(var t=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=t.createCloseButton(this.loc.buttons.ok),s=jQuery("<ul></ul>"),a=0;e.length>a;++a){var r=jQuery("<li></li>");r.append(e[a].error),s.append(r)}t.show(this.loc.error.title,s,[i])},_gatherSelections:function(){for(var e=this.mainPanel,t=this.instance.getSandbox(),i=this.locationForm.validate(),s=this.locationForm.getValues(),a=e.find("input[name=size]:checked").val(),r={domain:s.domain,name:s.name,language:s.language,plugins:[]},n=0;this.tools.length>n;++n)if(this.tools[n].selected){var o={id:this.tools[n].id};this.tools[n].config&&(o.config=this.tools[n].config),r.plugins.push(o)}if("custom"==a){var l=e.find("div.customsize input[name=width]").val(),h=e.find("div.customsize input[name=height]").val();this._validateSize(l,h)?r.size={width:l,height:h}:i.push({field:"size",error:this.loc.error.size})}else for(var n=0;this.sizeOptions.length>n;++n){var u=this.sizeOptions[n];if(u.id==a){r.size={width:u.width,height:u.height};break}}var p=this.maplayerPanel.getValues();p.layerSelection&&(r.plugins.push(p.layerSelection),r.defaultBase=p.defaultBase,r.baseLayers=p.baseLayers);var c=t.getStatefulComponents().mapfull.getState();return r.mapstate=c,t.getStatefulComponents().infobox&&(r.infobox=t.getStatefulComponents().infobox.getState()),i.length>0?(this._showValidationErrorMessage(i),void 0):r},_publishMap:function(e){var t=this,i=this.instance.getSandbox(),s=i.getAjaxUrl(),a=function(){var e=Oskari.clazz.create("Oskari.userinterface.component.Popup"),i=e.createCloseButton(t.loc.buttons.ok);e.show(t.loc.error.title,t.loc.error.saveFailed,[i])};jQuery.ajax({url:s+"&action_route=Publish",type:"POST",dataType:"json",data:{pubdata:JSON.stringify(e)},beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(t){if(t.id>0){var s=i.getEventBuilder("Publisher.MapPublishedEvent")(t.id,e.size.width,e.size.height,e.language);i.notifyAll(s)}else a()},error:a})},_validateNumberRange:function(e,t,i){return isNaN(parseInt(e))?!1:isFinite(e)?t>e||e>i?!1:!0:!1},_validateSize:function(e,t){for(var i=null,s=0;this.sizeOptions.length>s;++s){var a=this.sizeOptions[s];if("custom"==a.id){i=a;break}}var r=this._validateNumberRange(e,i.minWidth,i.maxWidth)&&this._validateNumberRange(t,i.minHeight,i.maxHeight);return r},_enablePreview:function(){var e=this,t=this.instance.sandbox.findRegisteredModuleInstance("MainMapModule"),i=t.getPluginInstances();for(var s in i){var a=i[s];a.hasUI&&a.hasUI()&&(a.stopPlugin(e.instance.sandbox),t.unregisterPlugin(a),this.normalMapPlugins.push(a))}this.maplayerPanel.start(),this._setSelectedSize();for(var r=0;this.tools.length>r;++r)this.tools[r].selected&&this._activatePreviewPlugin(this.tools[r],!0);t.registerPlugin(this.logoPlugin),this.logoPlugin.startPlugin(e.instance.sandbox)},_disablePreview:function(){var e=this,t=this.instance.sandbox.findRegisteredModuleInstance("MainMapModule");t.getPluginInstances();for(var i=0;this.tools.length>i;++i)this.tools[i].plugin&&(this._activatePreviewPlugin(this.tools[i],!1),t.unregisterPlugin(this.tools[i].plugin),this.tools[i].plugin=void 0,delete this.tools[i].plugin);this.maplayerPanel.stop();var s=jQuery(t.getMap().div);s.width(""),s.height(jQuery(window).height()),t.getMap().updateSize(),this._updateDomain();for(var i=0;this.normalMapPlugins.length>i;++i){var a=this.normalMapPlugins[i];t.registerPlugin(a),a.startPlugin(e.instance.sandbox)}this.normalMapPlugins=[],t.unregisterPlugin(this.logoPlugin),this.logoPlugin.stopPlugin(e.instance.sandbox)},_updateDomain:function(){var e=this.instance.sandbox.findRegisteredModuleInstance("MainMapModule"),t=this.instance.sandbox.getMap();t.setExtent(e.getMap().getExtent()),t.setMaxExtent(e.getMap().getMaxExtent()),t.setBbox(e.getMap().calculateBounds());var i=jQuery(e.getMap().div);t.setWidth(i.width()),t.setHeight(i.height())},setEnabled:function(e){e?this._enablePreview():this._disablePreview()},destroy:function(){this.mainPanel.remove()},setPluginLanguage:function(e){Oskari.setLang(e);for(var t=0;this.tools.length>t;++t){var i=this.tools[t];i._isPluginStarted&&(this._activatePreviewPlugin(i,!1),this._activatePreviewPlugin(i,!0))}if(this.maplayerPanel.isEnabled()){var s=this.maplayerPanel.plugin.getBaseLayers();this.maplayerPanel.enablePlugin(!1),this.maplayerPanel.enablePlugin(!0);for(var a=s.baseLayers,r=s.defaultBaseLayer,t=0;a.length>t;++t){var n=this.instance.sandbox.findMapLayerFromSelectedMapLayers(a[t]);this.maplayerPanel.plugin.addBaseLayer(n)}this.maplayerPanel.plugin.selectBaseLayer(r)}this.logoPlugin.stopPlugin(this.instance.sandbox),this.logoPlugin.startPlugin(this.instance.sandbox)}}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.view.PublisherLocationForm",function(e,t){this.loc=e,this._publisher=t,this.fields={domain:{label:e.domain.label,placeholder:e.domain.placeholder,helptags:"portti,help,publisher,domain",tooltip:e.domain.tooltip},name:{label:e.name.label,placeholder:e.name.placeholder,helptags:"portti,help,publisher,name",tooltip:e.name.tooltip}},this.langField={template:jQuery('<div class="field"><div class="help icon-info" title="'+e.language.tooltip+'" helptags="portti,help,publisher,language"></div>'+'<label for="language">'+e.language.label+'</label><br clear="all" />'+'<select name="language"></select>'+"</div>"),optionTemplate:jQuery("<option></option>")}},{init:function(){var e=this;for(var t in this.fields){var i=this.fields[t],s=Oskari.clazz.create("Oskari.userinterface.component.FormInput",t);s.setLabel(i.label),s.setTooltip(i.tooltip,i.helptags),s.setPlaceholder(i.placeholder),i.field=s}this.fields.domain.field.setRequired(!0,this.loc.error.domain),this.fields.domain.field.setContentCheck(!0,this.loc.error.domainIllegalCharacters),this.fields.domain.field.setValidator(function(t){var i=t.getValue(),s=t.getName(),a=[];return i.startsWith("http")||i.startsWith("www")?(a.push({field:s,error:e.loc.error.domainStart}),a):a}),this.fields.name.field.setRequired(!0,this.loc.error.name),this.fields.name.field.setContentCheck(!0,this.loc.error.nameIllegalCharacters);var a=this.langField.template.clone(),r=a.find("select[name=language]"),n=this.loc.language.options;for(var o in n){var l=this.langField.optionTemplate.clone();l.attr("value",o),o==Oskari.getLang()&&l.attr("selected","selected"),l.append(n[o]),r.append(l)}r.change(function(){e._publisher.setPluginLanguage(jQuery(this).attr("value"))}),this.langField.field=a},getPanel:function(){var e=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");e.setTitle(this.loc.domain.title);var t=e.getContainer();for(var i in this.fields){var s=this.fields[i];t.append(s.field.getField())}return t.append(this.langField.field),e},getValues:function(){var e={};for(var t in this.fields){var i=this.fields[t];e[t]=i.field.getValue()}return e.language=this.langField.field.find("select[name=language]").val(),e},validate:function(){var e=[];for(var t in this.fields){var i=this.fields[t];e=e.concat(i.field.validate())}return e}}),Oskari.clazz.define("Oskari.mapframework.bundle.publisher.view.PublisherLayerForm",function(e,t){this.loc=e,this.instance=t,this.panel=null,this.plugin=null,this.templateHelp=jQuery('<div class="help icon-info"></div>'),this.templateTool=jQuery('<div class="tool"><input type="checkbox"/><span></span></div>'),this.config={layers:{promote:[{text:this.loc.layerselection.promote,id:[24]}],preselect:"base_35"}},this.showLayerSelection=!1},{init:function(){this.panel||(this.panel=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel"),this.panel.setTitle(this.loc.layers.label)),this.plugin=Oskari.clazz.create("Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin")},getPanel:function(){return this._populateMapLayerPanel(),this.panel},enablePlugin:function(e){e?this.plugin.startPlugin(this.instance.sandbox):this.plugin.stopPlugin(this.instance.sandbox)},isEnabled:function(){return this.showLayerSelection},start:function(){var e=this.instance.sandbox.findRegisteredModuleInstance("MainMapModule");e.registerPlugin(this.plugin)},stop:function(){this.enablePlugin(!1);var e=this.instance.sandbox.findRegisteredModuleInstance("MainMapModule");e.unregisterPlugin(this.plugin)},getValues:function(){var e={};if(this.showLayerSelection){e.layerSelection={id:"Oskari.mapframework.bundle.mapmodule.plugin.LayerSelectionPlugin",config:{}};var t=this.plugin.getBaseLayers();t.defaultBaseLayer&&(e.layerSelection.config.baseLayers=t.baseLayers,e.layerSelection.config.defaultBaseLayer=t.defaultBaseLayer)}return e},validate:function(){var e=[];return e},_getLayersList:function(){var e=this.instance.sandbox.findAllSelectedMapLayers();return e},_populateMapLayerPanel:function(){var e=this,t=this.panel.getContainer(),i=this.templateHelp.clone();i.attr("title",this.loc.layerselection.tooltip),t.append(i);var s=this.templateTool.clone();if(s.find("span").append(this.loc.layerselection.label),this.showLayerSelection&&s.find("input").attr("checked","checked"),t.append(s),t.append(this.loc.layerselection.info),s.find("input").change(function(){var i=jQuery(this),s=i.is(":checked");e.showLayerSelection=s,e.enablePlugin(s),t.empty(),e._populateMapLayerPanel()}),this.showLayerSelection){for(var a=function(t){return function(){var i=jQuery(this),s=i.is(":checked");t.selected=s,s?e.plugin.addBaseLayer(t):e.plugin.removeBaseLayer(t)}},r=this._getLayersList(),n=0;r.length>n;++n){var o=r[n],l=this.templateTool.clone();l.attr("data-id",o.getId()),l.find("span").append(o.getName());var h=l.find("input");this.config.layers.preselect&&this.config.layers.preselect==o.getId()&&(h.attr("checked","checked"),o.selected=!0,this.plugin.addBaseLayer(o)),h.change(a(o)),t.append(l)}this.config.layers.promote&&this.config.layers.promote.length>0&&this._populateLayerPromotion(t)}},_populateLayerPromotion:function(e){for(var t=this,i=this.instance.getSandbox(),s=i.getRequestBuilder("AddMapLayerRequest"),a=i.getRequestBuilder("RemoveMapLayerRequest"),r=function(e){return function(){var r=jQuery(this),n=r.is(":checked");n?(i.request(t.instance,s(e.getId(),!0)),t.plugin.addBaseLayer(e)):i.request(t.instance,a(e.getId()))}},n=0;this.config.layers.promote.length>n;++n){var o=this.config.layers.promote[n],l=this._getActualPromotionLayers(o.id);if(l.length>0){e.append(o.text);for(var h=0;l.length>h;++h){var u=l[h],p=this.templateTool.clone();p.attr("data-id",u.getId()),p.find("span").append(u.getName());var c=p.find("input");c.change(r(u)),e.append(p)}}}},_getActualPromotionLayers:function(e){for(var t=this.instance.getSandbox(),i=[],s=0;e.length>s;++s)if(!t.isLayerAlreadySelected(e[s])){var a=t.findMapLayerFromAllAvailable(e[s]);a&&i.push(a)}return i}}),Oskari.clazz.define("Oskari.mapframework.bundle.coordinatedisplay.CoordinateDisplayBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.coordinatedisplay.CoordinateDisplayBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/coordinatedisplay/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/coordinatedisplay/plugin/CoordinatesPlugin.js"},{type:"text/css",src:"../../../../resources/framework/bundle/coordinatedisplay/css/coordinatedisplay.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/coordinatedisplay/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/coordinatedisplay/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/coordinatedisplay/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"coordinatedisplay","Bundle-Name":"coordinatedisplay","Bundle-Author":[{Name:"ah",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("coordinatedisplay","Oskari.mapframework.bundle.coordinatedisplay.CoordinateDisplayBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.coordinatedisplay.CoordinateDisplayBundleInstance",function(){this.sandbox=null,this.started=!1,this._localization=null},{__name:"coordinatedisplay",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},update:function(){},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t=Oskari.$("sandbox");e.setSandbox(t);var i=t.findRegisteredModuleInstance("MainMapModule"),s={},a=this.getLocalization("display"),r=Oskari.clazz.create("Oskari.mapframework.bundle.coordinatedisplay.plugin.CoordinatesPlugin",s,a);i.registerPlugin(r),i.startPlugin(r),this.plugin=r}},stop:function(){this.sandbox=null,this.started=!1}},{protocol:["Oskari.bundle.BundleInstance"]}),Oskari.clazz.define("Oskari.mapframework.bundle.coordinatedisplay.plugin.CoordinatesPlugin",function(e,t){this._conf=e,this._locale=t,this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._elements={},this.__templates={}},{__name:"CoordinatesPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(){this.__templates.latlondiv=jQuery('<div class="cbDiv"> <div class="cbSpansWrapper"> <div class="cbRow">  <div class="cbCrsLabel"></div> </div> <div class="cbRow">  <div class="cbLabel cbLabelN" axis="lat"></div>  <div class="cbValue" axis="lat"></div> </div>  <br clear="both"> <div class="cbRow">  <div class="cbLabel cbLabelE" axis="lon"></div>  <div class="cbValue" axis="lon"></div> </div> </div></div>')},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this),this._createUI();for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);this._elements.display&&(this._elements.display.remove(),delete this._elements.display),e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},_createUI:function(){this._sandbox;var e=this,t=jQuery(this._map.div),i=e._elements.display;e._elements.display||(i=e._elements.display=e.__templates.latlondiv.clone());var s=e._map.getProjection(),a=e._locale.crs[s];i.find(".cbCrsLabel").html(a),i.find(".cbLabelN").html(e._locale.compass.N),i.find(".cbLabelE").html(e._locale.compass.E),t.append(i),this.update(),i.show()},update:function(e){if(!e||!e.latlon){var t=this._sandbox.getMap();e={latlon:{lat:t.getY(),lon:t.getX()}}}var i=this,s=e.latlon,a=i._elements.display,r=a.find('.cbValue[axis="lat"]'),n=a.find('.cbValue[axis="lon"]');r&&n&&(r.text(s.lat),n.text(s.lon))},eventHandlers:{MouseHoverEvent:function(e){this.update({latlon:{lat:Math.floor(e.getLat()),lon:Math.floor(e.getLon())}})},AfterMapMoveEvent:function(){this.update()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.maplegend.MapLegendBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.maplegend.MapLegendBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/maplegend/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/maplegend/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/maplegend/Tile.js"},{type:"text/css",src:"../../../../resources/framework/bundle/maplegend/css/style.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/maplegend/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/maplegend/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/maplegend/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"maplegend","Bundle-Name":"maplegend","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2012"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("maplegend","Oskari.mapframework.bundle.maplegend.MapLegendBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.maplegend.MapLegendBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null},{__name:"maplegend",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t=Oskari.$("sandbox");e.sandbox=t,t.register(e);for(p in e.eventHandlers)t.registerForEventByName(e,p);var i=t.getRequestBuilder("userinterface.AddExtensionRequest")(this);t.request(this,i),e.createUi(),t.registerAsStateful(this.mediator.bundleId,this)}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerRemoveEvent:function(){this.plugins["Oskari.userinterface.Flyout"].refresh()},AfterMapLayerAddEvent:function(){this.plugins["Oskari.userinterface.Flyout"].refresh()},AfterChangeMapLayerStyleEvent:function(){this.plugins["Oskari.userinterface.Flyout"].refresh()},AfterRearrangeSelectedMapLayerEvent:function(){this.plugins["Oskari.userinterface.Flyout"].refresh()}},stop:function(){var e=this.sandbox();for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);var t=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,t),this.sandbox.unregisterStateful(this.mediator.bundleId),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.maplegend.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.maplegend.Tile",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null,this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi(),this.plugins["Oskari.userinterface.Tile"].refresh()},setState:function(e){this.plugins["Oskari.userinterface.Flyout"].setContentState(e)},getState:function(){return this.plugins["Oskari.userinterface.Flyout"].getContentState()
}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.maplegend.Flyout",function(e){this.instance=e,this.container=null,this.templateLayer=null,this.templateLayerLegend=null,this.state=null},{getName:function(){return"Oskari.mapframework.bundle.maplegend.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("maplegend")||jQuery(this.container).addClass("maplegend")},startPlugin:function(){var e=this;e.templateLayer=jQuery('<div class="maplegend-layer"><div class="maplegend-tools"><div class="layer-description"><div class="icon-info"></div></div></div></div>'),e.templateLayerLegend=jQuery('<div class="maplegend-legend"><img /></div>')},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},setContentState:function(){},getContentState:function(){return{}},createUi:function(){this.refresh()},refresh:function(){this._populateLayerList()},_populateLayerList:function(){var e=this,t=jQuery(this.container);t.empty();var i=Oskari.clazz.create("Oskari.userinterface.component.Accordion");i.insertTo(t);for(var s=this.instance.getSandbox(),a=s.findAllSelectedMapLayers().slice(0),r=a.length-1;r>=0;r--){var n=a[r];n.getName(),this._createLayerContainer(n);var o=Oskari.clazz.create("Oskari.userinterface.component.AccordionPanel");o.open(),o.setTitle(n.getName()),o.getContainer().append(e._createLayerContainer(n)),i.addPanel(o)}},_createLayerContainer:function(e){var t=this,i=t.instance.getSandbox(),s=this.templateLayer.clone(),a={},r=t._createLegendDiv(e,a);r&&s.append(r);var n=e.getSubLayers?e.getSubLayers():null;if(n)for(var o=0;n.length>o;o++){var l=n[o],h=t._createLegendDiv(l,a);h&&s.append(h)}var u=e.getMetadataIdentifier(),p=s.find(".maplegend-tools");return u?p.find("div.icon-info").bind("click",function(){var e="catalogue.ShowMetadataRequest";i.postRequestByName(e,[{uuid:u}])}):p.find("div.layer-description").hide(),s},_createLegendDiv:function(e,t){var i=this,s=e.getLegendImage?e.getLegendImage():null;if(s&&""!=s&&!t[s]){var a=i.templateLayerLegend.clone(),r=a.find("img");t[s]=!0;var n=new Image;return n.onload=function(){r.attr("src",s),n.onload=null},n.src=s,a}}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.mapframework.bundle.maplegend.Tile",function(e){this.instance=e,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.maplegend.Tile"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){console.log("Tile.setState",this,e)},refresh:function(){}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.UserGuideBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.userguide.UserGuideBundleInstance")},update:function(){}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/request/ShowUserGuideRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/request/ShowUserGuideRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/service/UserGuideService.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/Tile.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/Flyout.js"},{type:"text/css",src:"../../../../resources/framework/bundle/userguide/css/style.css"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/fi.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/sv.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/userguide/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"userguide","Bundle-Name":"userguide","Bundle-Tag":{mapframework:!0},"Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"userguide",Title:"userguide"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("userguide","Oskari.mapframework.bundle.userguide.UserGuideBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.UserGuideBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null,this.ui=null,this._requestHandlers={},this.attachedToDefault=!1,this.helper=null,this.isContentLoaded=!1},{templates:{userguide:'<div class="oskari-userguide"><span class="oskari-prompt"></span><br /></div>'},__name:"userinterface.UserGuide",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t=Oskari.$("sandbox");e.sandbox=t,this._localization=Oskari.getLocalization(this.getName());var i=this.getLocalization("title"),s=Oskari.clazz.create("Oskari.userinterface.component.Popover",i,"");this.ui=s,s.setContent($(this.templates.userguide)),t.register(e);for(p in e.eventHandlers)t.registerForEventByName(e,p);this._requestHandlers["userguide.ShowUserGuideRequest"]=Oskari.clazz.create("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler",t,this),t.addRequestHandler("userguide.ShowUserGuideRequest",this._requestHandlers["userguide.ShowUserGuideRequest"]);var a=t.getRequestBuilder("userinterface.AddExtensionRequest")(this);t.request(this,a),e.createUi();var r=Oskari.clazz.create("Oskari.userinterface.component.UIHelper",t);this.helper=r}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{"userinterface.ExtensionUpdatedEvent":function(e){var t=this;if(e.getExtension().getName()==t.getName()){var i="close"!=e.getViewState();t.displayContent(i)}}},displayContent:function(e){var t=this;if(e&&!t.isContentLoaded){var i="help.contentPart";t.getLocalization("help")&&t.getLocalization("help").contentPart&&(i=t.getLocalization("help").contentPart);var s="help.tags";this.getLocalization("help")&&this.getLocalization("help").tags&&(s=this.getLocalization("help").tags),this.helper.getHelpArticle(s,function(e,s){var a=s,r="error.generic";t.getLocalization("error")&&t.getLocalization("error").generic&&(r=t.getLocalization("error").generic),e?a[i]&&(a=a[i]):a=r,t.plugins["Oskari.userinterface.Flyout"].setContent(a),t.isContentLoaded=!0})}},toggleUserInterface:function(e,t){var i=this,s=this.ui;if(e){if(!i.attachedToDefault){var t=i.plugins["Oskari.userinterface.Tile"].getEl();s.setPlacement("right"),s.attachTo(t),i.attachedToDefault=!0}s.show()}else s.hide()},scheduleShowUserGuide:function(e){var t=this,i=t.ui,s=e.isToggle();if(s&&i.shown)return t.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[this,"close"]),void 0;t.getSandbox().postRequestByName("userinterface.UpdateExtensionRequest",[this,"attach"]);var a=jQuery(this.templates.userguide),r=jQuery("<div />"),n=Oskari.getLang(),o=r.clone(),l=e.getContent();if(l)a.append(l);else{o.append("Lang: "+n),a.append(o);var o=r.clone();o.append("Extension: "+e.getExtension()),a.append(o);var o=r.clone();o.append("Context: "+e.getContext()),a.append(o);var o=r.clone();o.append("Element: "+(e.getEl()?"YES":"NO")),a.append(o)}var h=e.getEl(),u=e.getPlacement();u&&i.setPlacement(u),h?(i.hide(),t.attachedToDefault=!1,i.attachTo(h)):t.attachedToDefault||(h=t.plugins["Oskari.userinterface.Tile"].getEl(),i.attachTo(h),t.attachedToDefault=!0),i.setContent(a)},stop:function(){var e=this.sandbox();for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.removeRequestHandler("userguide.ShowUserGuideRequest",this._requestHandlers["userguide.ShowUserGuideRequest"]);var t=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,t),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.userguide.Flyout",this),this.plugins["Oskari.userinterface.Tile"]=Oskari.clazz.create("Oskari.mapframework.bundle.userguide.Tile",this,this.getLocalization("tile"))},stopExtension:function(){this.plugins["Oskari.userinterface.Tile"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Tile"].refresh(),this.plugins["Oskari.userinterface.Flyout"].setContent("")}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequest",function(e){var t=e||{};this._creator=null,this._el=t.el,this._context=t.context,this._extension=t.extension,this._toggle=t.toggle,this._placement=t.placement,this._content=t.content},{__name:"userguide.ShowUserGuideRequest",getName:function(){return this.__name},getUuid:function(){return this._uuid},getContext:function(){return this._context},getExtension:function(){return this._extension},getEl:function(){return this._el},isToggle:function(){return this._toggle},getPlacement:function(){return this._placement},getContent:function(){return this._content}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler",function(e,t){this.sandbox=e,this.instance=t},{handleRequest:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.userguide.request.ShowUserGuideRequestHandler] Show UserGuide: "+t.getUuid()),this.instance.scheduleShowUserGuide(t)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.Tile",function(e,t){this.instance=e,this.locale=t,this.container=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.userguide.Tile"},setEl:function(e){this.container=jQuery(e),this.container.children(".oskari-tile-status")},getEl:function(){return this.container},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.locale.title},getDescription:function(){return this.locale.desciption},getOptions:function(){},refresh:function(){var e=this,t=e.instance;this.container,this.template,t.getSandbox()}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.mapframework.bundle.userguide.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.template=null},{getName:function(){return"Oskari.mapframework.bundle.userguide.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("userguide")||jQuery(this.container).addClass("userguide")},startPlugin:function(){this.template=jQuery('<div class="userguide"></div>')},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e},getState:function(){return this.state?this.state:{}},setContent:function(e){var t=this;t.instance.getSandbox();var i=jQuery(this.container);i.empty();var s=this.template.clone();s.append(e),i.append(s)}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.registerLocalization({lang:"fi",key:"userinterface.UserGuide",value:{title:"Ohje",desc:"",flyout:{title:"Kartan ohje"},tile:{title:"Kartan ohje"},error:{title:"Virhe!",generic:"Ohjeen lataaminen epäonnistui. Yritä myöhemmin uudelleen."},help:{tags:"karttaikkuna,pikaohje",contentPart:"body"}}}),Oskari.registerLocalization({lang:"sv",key:"userinterface.UserGuide",value:{title:"Hjälp",desc:"",flyout:{title:"Så här använder du Paikkatietoikkuna"},tile:{title:"Bruksanvisningar"},error:{title:"Fel!",generic:"Laddningen av anvisningarna misslyckades. Försök på nytt senare."},help:{tags:"kartfönstret,snappguide",contentPart:"body"}}}),Oskari.registerLocalization({lang:"en",key:"userinterface.UserGuide",value:{title:"Help",desc:"",flyout:{title:"Paikkatietoikkuna user guide"},tile:{title:"Map user guide"},error:{title:"Error!",generic:"Loading user guide failed. Please try again later."},help:{tags:"map window,user guide",contentPart:"body"}}}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.MetadataFlyoutBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.MetadataFlyoutBundleInstance")},start:function(){},stop:function(){},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.bundle.BundleInstance","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/instance.js"},{type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/service/MetadataLoader.js"},{type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/Tile.js"},{type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/request/ShowMetadataRequest.js"},{type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/request/ShowMetadataRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/plugin/MetadataLayerPlugin.js"},{type:"text/css",src:"../../../../resources/catalogue/bundle/metadataflyout/css/style.css"},{language:"fi",type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/locale/fi.js"},{language:"en",type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/locale/en.js"},{language:"sv",type:"text/javascript",src:"../../../../bundles/catalogue/bundle/metadataflyout/locale/sv.js"}],resources:[]},bundle:{manifest:{"Bundle-Identifier":"metadataflyout","Bundle-Name":"catalogue.bundle.metadataflyout","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2012",End:"2012"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}}}),Oskari.bundle_manager.installBundleClass("metadataflyout","Oskari.catalogue.bundle.metadataflyout.MetadataFlyoutBundle"),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.MetadataFlyoutBundleInstance",function(){this.map=null,this.core=null,this.sandbox=null,this.mapmodule=null,this.started=!1,this.plugins={},this._locale=null,this._requestHandlers={},this.loader=null,this.layerPlugin=null,this.layer=null},{__name:"catalogue.bundle.metadataflyout",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},getLocale:function(){return this._locale},getLoader:function(){return this.loader},layerSpec:{text:"",name:"Metadata",wmsName:"1",type:"vectorlayer",styles:{title:"Trains",legend:"",name:"1"},descriptionLink:"http://www.paikkatietohakemisto.fi/",orgName:"Metadata",inspire:"Metadata",legendImage:"",info:"",isQueryable:!0,formats:{value:"text/html"},id:"catalogue_metadataflyout_layer",minScale:36e6,maxScale:1,style:"",dataUrl:"",wmsUrl:"x",opacity:60,checked:"false",styledLayerDescriptor:'<StyledLayerDescriptor version="1.0.0" xsi:schemaLocation="http://www.opengis.net/sld StyledLayerDescriptor.xsd"     xmlns="http://www.opengis.net/sld"     xmlns:ogc="http://www.opengis.net/ogc"     xmlns:xlink="http://www.w3.org/1999/xlink"     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">   <NamedLayer>     <Name>Simple point with stroke</Name>    <UserStyle><Title>GeoServer SLD Cook Book: Simple point with stroke</Title>     <FeatureTypeStyle><Rule><PolygonSymbolizer> <Graphic><Mark><WellKnownName>circle</WellKnownName><Fill>        <CssParameter name="fill">#000040</CssParameter>       </Fill><Stroke>          <CssParameter name="stroke">#000040</CssParameter>           <CssParameter name="stroke-width">2</CssParameter>          </Stroke></Mark><Size>12</Size></Graphic>     </PolygonSymbolizer><TextSymbolizer><Label><ogc:PropertyName>title</ogc:PropertyName></Label><Fill><CssParameter name="fill">#000000</CssParameter></Fill></TextSymbolizer></Rule></FeatureTypeStyle></UserStyle></NamedLayer></StyledLayerDescriptor>'},start:function(){if(!this.started){this.started=!0,this._locale=Oskari.getLocalization(this.getName());var e=Oskari.$("sandbox");this.sandbox=e,this.loader=Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.service.MetadataLoader",this.getLocale().loader,e),e.register(this);for(i in this.eventHandlers)e.registerForEventByName(this,i);this._requestHandlers["catalogue.ShowMetadataRequest"]=Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.request.ShowMetadataRequestHandler",e,this),e.addRequestHandler("catalogue.ShowMetadataRequest",this._requestHandlers["catalogue.ShowMetadataRequest"]);var t={};for(var i in this.layerSpec)t[i]=this.layerSpec[i];var s=this.getLocale().layer;for(var i in s)t[i]=s[i];var a=e.getService("Oskari.mapframework.service.MapLayerService"),r=a.createMapLayer(t);a.addLayer(r,!0),this.layer=r;var n=e.findRegisteredModuleInstance("MainMapModule"),o=Oskari.clazz.create("Oskari.mapframework.mapmodule.MetadataLayerPlugin");o.setMapLayer(r),n.registerPlugin(o),n.startPlugin(o),this.layerPlugin=o;var l=e.getRequestBuilder("userinterface.AddExtensionRequest")(this);e.request(this,l),e.registerAsStateful(this.mediator.bundleId,this)}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerAddEvent:function(){},AfterMapLayerRemoveEvent:function(){},AfterMapMoveEvent:function(){}},stop:function(){var e=this.sandbox;e.removeRequestHandler("catalogue.ShowMetadataRequest",this._requestHandlers["catalogue.ShowMetadataRequest"]);for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);var t=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,t),this.sandbox.unregisterStateful(this.mediator.bundleId),this.sandbox.unregister(this),this.started=!1},setSandbox:function(){this.sandbox=null},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.catalogue.bundle.metadataflyout.Flyout",this,this.getLocale().flyout,this.getLoader())},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null},getTitle:function(){return this.getLocale().title},getDescription:function(){return"Sample"},getPlugins:function(){return this.plugins},scheduleShowMetadata:function(e,t,i){this.plugins["Oskari.userinterface.Flyout"].scheduleShowMetadata(e,t,i),this.getSandbox().requestByName(this,"userinterface.UpdateExtensionRequest",[this,"detach"])},showExtentOnMap:function(e,t,i){var s=this;if(t){for(var a=[],r=0;t.length>r;r++){var n=t[r],o=new OpenLayers.Bounds(n.westBoundLongitude,n.southBoundLatitude,n.eastBoundLongitude,n.northBoundLatitude),l=o.toGeometry(),h=new OpenLayers.Feature.Vector(l);h.attributes=i||h.attributes,a.push(h)}var u=s.getSandbox().getEventBuilder("FeaturesAvailableEvent")(this.layer,a,"application/nlsfi-x-openlayers-feature","EPSG:3067","replace");s.sandbox.notifyAll(u)}},setState:function(e){this.plugins["Oskari.userinterface.Flyout"].setContentState(e)},getState:function(){return this.plugins["Oskari.userinterface.Flyout"].getContentState()}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.service.MetadataLoader",function(e,t){this.urls=e,this.sandbox=t,this.dev=!1},{getURLForView:function(e,t){var i=this.urls[e],s=i+"uuid="+t;if(this.dev){var a={"abstract":"abstract",jhs:"jhs158",inspire:"inspire",json:"json"}[e];null!=a&&(s=a)}return s},loadMetadata:function(e,t,i,s,a,r){var n=this.getURLForView(e,t,i,s);this.sandbox.printDebug("loadMetadata "+n),null!=n&&jQuery.ajax({url:n,dataType:r||"xml",beforeSend:function(e){e&&e.overrideMimeType&&(r&&"json"==r?e.overrideMimeType("application/json"):e.overrideMimeType("text/html"))},success:function(e){a(e,!0)},error:function(){a(null,!1)}})},loadGeonetworkAjaxHTML:function(e,t,i,s,a){var r=this.getURLForView(t,i,s,a);OpenLayers.Request.GET({url:r,callback:e})},openMetadata:function(e,t,i,s,a,r,n){var o=this.getURLForView(e,t,i,s);this.sandbox.printDebug("openMetadata "+o),window.open(o,n,"resizable=yes,scrollbars=yes,status=yes")}}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.Flyout",function(e,t){this.instance=e,this.locale=t,this.container=null,this.views={},this.titles={},this.tabs={},this.browseGraphic=null,this.compileTemplates(),this.alert=Oskari.clazz.create("Oskari.userinterface.component.Alert"),this.showQueue=[],this.state=null,this.contentState={metadata:{uuid:null,RS_Identifier_Code:null,RS_Identifier_CodeSpace:null},view:"abstract"}},{compileTemplates:function(){},templates:{content:"<div class='metadataflyout_content'></div>",browseGraphic:"<div class='metadataflyout_content_browseGraphic'><img /></div>",viewTabs:"<div class='metadataflyout_content_tabs'></div>",viewTab:"<div class='metadataflyout_content_tab'></div>",titles:{"abstract":"<div class='metadataflyout_content_abstract_title'></div>",jhs:"<div class='metadataflyout_content_jhs_title'></div>",inspire:"<div class='metadataflyout_content_inspire_title'></div>"},views:{"abstract":"<div class='metadataflyout_content_abstract'></div>",jhs:"<div class='metadataflyout_content_jhs'></div>",inspire:"<div class='metadataflyout_content_inspire'></div>"}},getName:function(){return"Oskari.catalogue.bundle.metadataflyout.Flyout"},setEl:function(e){this.container=jQuery(e)},startPlugin:function(){var e=this.locale,t=jQuery(this.templates.content),i=this,s=jQuery(this.templates.viewTabs),a=jQuery(this.templates.viewTab);for(var r in this.templates.views){var n=s.clone(),o=e.tabs[r];for(var l in o){var h=a.clone();if("string"==typeof o[l])h.append(o[l]),n.append(h),l!=r&&h.click({viewId:l},function(e){var t=e.data;i.showMetadataView(t.viewId)});else{var u=o[l].text,p=o[l].target;h.append(u),n.append(h),h.click({viewId:l,target:p},function(e){var t=e.data;i.openMetadataView(t.viewId,t.target)})}}n.hide(),this.tabs[r]=n,t.append(n)}var c=jQuery(this.templates.browseGraphic);this.browseGraphic=c,t.append(c);for(var r in this.templates.views)this.titles[r]=jQuery(this.templates.titles[r]),this.titles[r].append(this.locale[r]),this.views[r]=jQuery(this.templates.views[r]),t.append(this.titles[r]),t.append(this.views[r]);t.append(s),this.alert.insertTo(this.container),this.container.append(t)},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.locale.title},getDescription:function(){},getOptions:function(){},setState:function(e){this.state=e},openMetadataView:function(e,t){if(this.contentState){var i=this.contentState.metadata;this.instance.getLoader().openMetadata(e,i.uuid,i.RS_Identifier_Code,i.RS_Identifier_CodeSpace,function(){},null,t)}},showMetadataView:function(e){this.instance.getSandbox().printDebug("ShowMetadataView "+e);var t=this.tabs,i=this.views,s=this.titles;for(var a in i)a!=e?(t[a].hide(),s[a].hide(),i[a].hide()):(t[a].show(),s[a].show(),i[a].hide());this.contentState.view=e,this.loadMetadataForState()},resetBrowseGraphic:function(e){var t=jQuery(this.browseGraphic);t.empty();var e=e||jQuery("<img />");t.append(e)},loadMetadataForState:function(){function e(e){i[s].html(e.responseText);var a=i[s].find("a[href]"),r=RegExp("^\\?.*");jQuery.each(a,function(e,i){var a=jQuery(i),n=a.attr("href");if(n&&r.test(n)){var o=n.split("&"),l={};jQuery.each(o,function(e,t){var i=t.split("=");l[i[0]]=i[1]}),a.attr("href",null),a.click({viewId:s,uuid:l.uuid},function(e){var i=e.data,s=i.uuid;t.showMetadata(s)})}}),i[s].css("display","")}var t=this,i=this.views;if(!this.contentState||!this.contentState.metadata||!this.contentState.metadata.uuid)return!1;var s=this.contentState.view,a=this.contentState.metadata;i[s].empty(),t.instance.getLoader().loadGeonetworkAjaxHTML(e,s,a.uuid,a.RS_Identifier_Code,a.RS_Identifier_CodeSpace)},loadMetadataJSONForState:function(){var e=this;if(!this.contentState||!this.contentState.metadata||!this.contentState.metadata.uuid)return!1;var t=this.contentState.metadata;return this.instance.getLoader().loadMetadata("json",t.uuid,t.RS_Identifier_Code,t.RS_Identifier_CodeSpace,function(t){if(t&&t.mdcs&&t.mdcs.length&&0!=t.mdcs.length){var i=t.mdcs[0];e.processJSON(i)}},"json"),!0},processJSON:function(e){var t=e.browseGraphic,i=e.env;if(t){var s=jQuery("<img />");this.resetBrowseGraphic(s),this.instance.getLoader().dev?s.attr("src","espoo_johtokartta_s.png"):s.attr("src",t)}else this.resetBrowseGraphic();i&&this.instance.showExtentOnMap(this.contentState.metadata.uuid,i,e)},showMetadata:function(e,t,i){this.resetContentState(),this.contentState.metadata.uuid=e,this.contentState.metadata.RS_Identifier_Code=t,this.contentState.metadata.RS_Identifier_CodeSpace=i,this.instance.getSandbox().printDebug("showMetadata { uuid="+e+", view="+this.contentState.view+"}"),this.loadMetadataJSONForState(),this.showMetadataView(this.contentState.view)},scheduleShowMetadata:function(e,t,i){this.showMetadata(e,t,i)},setContentState:function(e){return e?(this.contentState=e,this.loadMetadataJSONForState()&&this.showMetadataView(this.contentState.view),void 0):(this.resetContentState(),void 0)},getContentState:function(){return this.contentState},resetContentState:function(){this.contentState={metadata:{uuid:null,RS_Identifier_Code:null,RS_Identifier_CodeSpace:null},view:"abstract"}}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.Tile",function(e,t){this.instance=e,this.locale=t,this.container=null,this.template=null},{getName:function(){return"Oskari.catalogue.bundle.metadataflyout.Tile"},setEl:function(e){this.container=$(e)},startPlugin:function(){this.refresh()},stopPlugin:function(){this.container.empty()},getTitle:function(){return this.locale.title},getDescription:function(){},getOptions:function(){},setState:function(e){this.state=e},refresh:function(){var e=this,t=e.instance;this.container,this.template,t.getSandbox()}},{protocol:["Oskari.userinterface.Tile"]}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.request.ShowMetadataRequest",function(e){this._creator=null,this._uuid=e.uuid,this._RS_Identifier_Code=e._RS_Identifier_Code,this._RS_Identifier_CodeSpace=e._RS_Identifier_CodeSpace},{__name:"catalogue.ShowMetadataRequest",getName:function(){return this.__name},getUuid:function(){return this._uuid},getRS_Identifier_Code:function(){return this._RS_Identifier_Code},getRS_Identifier_CodeSpace:function(){return this._RS_Identifier_CodeSpace}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.catalogue.bundle.metadataflyout.request.ShowMetadataRequestHandler",function(e,t){this.sandbox=e,this.instance=t},{handleRequest:function(e,t){this.sandbox.printDebug("[Oskari.catalogue.bundle.metadataflyout.request.ShowMetadataRequestHandler] Show Metadata: "+t.getUuid()),this.instance.scheduleShowMetadata(t.getUuid(),t.getRS_Identifier_Code(),t.getRS_Identifier_CodeSpace())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.mapmodule.MetadataLayerPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._layer=null,this._supportedFormats={},this._features=null,this._sldFormat=new OpenLayers.Format.SLD({multipleSymbolizers:!1,namedLayersAsArray:!0})},{__name:"MetadataLayerPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this.pluginName=e.getName()+this.__name},register:function(){this.getMapModule().setLayerPlugin("metadatalayer",this)},unregister:function(){this.getMapModule().setLayerPlugin("metadatalayer",null)},init:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),this.registerVectorFormats(),e.register(this);for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){},eventHandlers:{AfterMapLayerAddEvent:function(e){this.afterMapLayerAddEvent(e)},AfterMapLayerRemoveEvent:function(e){this.afterMapLayerRemoveEvent(e)},FeaturesAvailableEvent:function(e){this.handleFeaturesAvailableEvent(e)},AfterChangeMapLayerOpacityEvent:function(e){this.afterChangeMapLayerOpacityEvent(e)}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])},preselectLayers:function(e){for(var t=this.getMapLayer(),i=this._sandbox,s=0;e.length>s;s++){var a=e[s],r=a.getId();a.isLayerOfType("VECTOR")&&t.getId()==a.getId()&&(i.printDebug("preselecting "+r),this.addMapLayerToMap(a,!0,a.isBaseLayer()))}},setMapLayer:function(e){this._layer=e},getMapLayer:function(){return this._layer},registerVectorFormat:function(e,t){this._supportedFormats[e]=t},registerVectorFormats:function(){this.registerVectorFormat("application/json",new OpenLayers.Format.GeoJSON({})),this.registerVectorFormat("application/nlsfi-x-openlayers-feature",new function(){this.read=function(e){return e}})},afterMapLayerAddEvent:function(e){this.addMapLayerToMap(e.getMapLayer(),e.getKeepLayersOrder(),e.isBasemap())},afterMapLayerRemoveEvent:function(e){var t=e.getMapLayer();this.removeMapLayerFromMap(t)},afterChangeMapLayerOpacityEvent:function(e){var t=e.getMapLayer(),i=this.getMapLayer();if(t.isLayerOfType("VECTOR")&&t.getId()==i.getId()){this._sandbox.printDebug("Setting Layer Opacity for "+t.getId()+" to "+t.getOpacity());var s=this._map.getLayersByName("layer_"+t.getId());null!=s[0]&&s[0].setOpacity(t.getOpacity()/100)}},addMapLayerToMap:function(e,t){var i=this.getMapLayer();if(e.isLayerOfType("VECTOR")&&e.getId()==i.getId()){var s=this._map.getLayersByName("Markers");this._map.removeLayer(s[0],!1);var a=new OpenLayers.StyleMap,r={styleMap:a},n=e.getStyledLayerDescriptor();if(n){this._sandbox.printDebug(n);var o=this._sldFormat.read(n);window.styleInfo=o;var l=o.namedLayers[0].userStyles,h=l[0];a.styles["default"]=h}else this._sandbox.printDebug("NO SLD FOUND");var u=new OpenLayers.Layer.Vector("layer_"+e.getId(),r);u.opacity=e.getOpacity()/100,this._map.addLayer(u),this._features&&u.addFeatures(this._features),this._sandbox.printDebug("#!#! CREATED VECTOR / OPENLAYER.LAYER.VECTOR for "+e.getId()),t?this._map.setLayerIndex(u,this._map.layers.length):this._map.setLayerIndex(u,0),this._map.addLayer(s[0])}},removeMapLayerFromMap:function(e){var t=this.getMapLayer();if(e.isLayerOfType("VECTOR")&&e.getId()==t.getId()){var i=this._map.getLayersByName("layer_"+e.getId());i[0].destroy()}},getOLMapLayers:function(e){if(e.isLayerOfType("VECTOR")){var t=this.getMapLayer();if(e.getId()==t.getId())return this._map.getLayersByName("layer_"+e.getId())}},handleFeaturesAvailableEvent:function(e){var t=e.getMapLayer();if(null!=t){var i=this.getMapLayer();if(t.getId()==i.getId()){var s=e.getMimeType(),a=e.getFeatures(),r=e.getOp(),n=this._supportedFormats[s];
if(n){var o=n.read(a);this._features=o;var l=this._map.getLayersByName("layer_"+t.getId())[0];l&&(r&&"replace"==r&&l.removeFeatures(l.features),l.addFeatures(o))}}}}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.registerLocalization({lang:"fi",key:"catalogue.bundle.metadataflyout",value:{title:"Metatieto",desc:"",loader:{json:"/catalogue/portti-metadata-printout-service/MetadataServlet?","abstract":"/geonetwork/srv/fi/metadata.show.portti.abstract?",inspire:"/geonetwork/srv/fi/metadata.show.portti?",jhs:"/geonetwork/srv/fi/metadata.show.portti.jhs158?",pdf:"/catalogue/portti-metadata-printout-service/MetadataPrintoutServlet?lang=fi&title=METATIETOTULOSTE&metadataresource",xml:"/geonetwork/srv/fi/iso19139.xml?",schemas:"/geonetwork/srv/fi/metadata.show.portti.skeemat?"},layer:{name:"Metatieto",description:"",orgName:"Paikkatietohakemisto",inspire:"Metatieto"},flyout:{title:"Metatieto","abstract":"Perustiedot",inspire:"INSPIRE",jhs:"JHS",xml:"XML",map:"Kattavuus",pdf:"Tuloste",select_metadata_prompt:"Valitse metatieto kuvakkeista painamalla.",metadata_printout_title:"METATIETOTULOSTE",linkto:"Metatietolinkki",tabs:{"abstract":{"abstract":"",jhs:"Näytä JHS",inspire:"Näytä INSPIRE",xml:{text:"Avaa ISO 19139 XML",target:"_blank"},pdf:{text:"Avaa PDF -tuloste",target:"_blank"}},jhs:{"abstract":"Näytä perustiedot",jhs:"",inspire:"Näytä INSPIRE",xml:{text:"Avaa ISO 19139 XML",target:"_blank"},pdf:{text:"Avaa PDF -tuloste",target:"_blank"}},inspire:{"abstract":"Näytä perustiedot",jhs:"Näytä JHS",inspire:"",xml:{text:"Avaa ISO 19139 XML",target:"_blank"},pdf:{text:"Avaa PDF -tuloste",target:"_blank"}}}},tile:{title:"Metatieto",tooltip:"Metatiedoista selviää aineiston käyttöehdot ja saatavuus."}}}),Oskari.registerLocalization({lang:"en",key:"catalogue.bundle.metadataflyout",value:{title:"Metadata",desc:"",loader:{json:"/catalogue/portti-metadata-printout-service/MetadataServlet?","abstract":"/geonetwork/srv/en/metadata.show.portti.abstract?",inspire:"/geonetwork/srv/en/metadata.show.portti?",jhs:"/geonetwork/srv/en/metadata.show.portti.jhs158?",pdf:"/catalogue/portti-metadata-printout-service/MetadataPrintoutServlet?lang=sv&title=METADATAPRINTOUT&metadataresource",xml:"/geonetwork/srv/en/iso19139.xml?",schemas:"/geonetwork/srv/en/metadata.show.portti.skeemat?"},layer:{name:"Metadata",description:"",orgName:"Metadata",inspire:"Metadata"},flyout:{title:"Metadata","abstract":"Abstract",inspire:"INSPIRE",jhs:"JHS",xml:"XML",map:"Geographic Extent",pdf:"Printout",select_metadata_prompt:"Select metadata by clicking the icons.",metadata_printout_title:"METADATA PRINTOUT",linkto:"Link to this metadata",tabs:{"abstract":{"abstract":"",jhs:"Show JHS",inspire:"Show INSPIRE",xml:{text:"Open ISO 19139 XML",target:"_blank"},pdf:{text:"Open PDF-printout",target:"_blank"}},jhs:{"abstract":"Show abstract",jhs:"",inspire:"Show INSPIRE",xml:{text:"Open ISO 19139 XML",target:"_blank"},pdf:{text:"Open PDF-printout",target:"_blank"}},inspire:{"abstract":"Show abstract",jhs:"Show JHS",inspire:"",xml:{text:"Open ISO 19139 XML",target:"_blank"},pdf:{text:"Open PDF-printout",target:"_blank"}}}},tile:{title:"Metadata",tooltip:"Metadata contains information about terms of use and availability of data."}}}),Oskari.registerLocalization({lang:"sv",key:"catalogue.bundle.metadataflyout",value:{title:"Metadata",desc:"",loader:{json:"/catalogue/portti-metadata-printout-service/MetadataServlet?","abstract":"/geonetwork/srv/sv/metadata.show.portti.abstract?",inspire:"/geonetwork/srv/sv/metadata.show.portti?",jhs:"/geonetwork/srv/sv/metadata.show.portti.jhs158?",pdf:"/catalogue/portti-metadata-printout-service/MetadataPrintoutServlet?lang=sv&title=METADATAUTSKRIFT&metadataresource",xml:"/geonetwork/srv/sv/iso19139.xml?",schemas:"/geonetwork/srv/sv/metadata.show.portti.skeemat?"},layer:{name:"Metadata",description:"",orgName:"Metadata",inspire:"Metadata"},flyout:{title:"Metadata","abstract":"Abstrakt",inspire:"INSPIRE",jhs:"JHS",xml:"XML",map:"Omfattning",pdf:"Utskrift",select_metadata_prompt:"Välj metadata genom att klicka på ikonerna",metadata_printout_title:"METATIETOTULOSTE",linkto:"Metadatalänk",tabs:{"abstract":{"abstract":"",jhs:"Visa JHS",inspire:"Visa INSPIRE",xml:{text:"Öppna ISO 19139 XML",target:"_blank"},pdf:{text:"Öppna PDF-utskrift",target:"_blank"}},jhs:{"abstract":"Visa basuppgifter",jhs:"",inspire:"Visa INSPIRE",xml:{text:"Öppna ISO 19139 XML",target:"_blank"},pdf:{text:"Öppna PDF-utskrift",target:"_blank"}},inspire:{"abstract":"Visa basuppgifter",jhs:"Visa JHS",inspire:"",xml:{text:"Öppna ISO 19139 XML",target:"_blank"},pdf:{text:"Öppna PDF-utskrift",target:"_blank"}}}},tile:{title:"Metadata",tooltip:"Metadata innehåller uppgifter om användningsvillkor och tillgång till datamaterial."}}}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.FeatureDataBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata.FeatureDataBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/instance.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/Flyout.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/plugin/FeaturedataPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/service/GridJsonService.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/service/GridModelManager.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/domain/WfsGridUpdateParams.js"},{type:"text/css",src:"../../../../resources/framework/bundle/featuredata/css/style.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/featuredata/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"featuredata","Bundle-Name":"featuredata","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("featuredata","Oskari.mapframework.bundle.featuredata.FeatureDataBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.FeatureDataBundleInstance",function(){this.sandbox=null,this.started=!1,this.plugins={},this.localization=null},{__name:"FeatureData",getName:function(){return this.__name},setSandbox:function(e){this.sandbox=e},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){var e=this;if(!e.started){e.started=!0;var t=Oskari.$("sandbox");e.sandbox=t,this.localization=Oskari.getLocalization(this.getName()),t.register(e);for(p in e.eventHandlers)t.registerForEventByName(e,p);var i=t.getRequestBuilder("userinterface.AddExtensionRequest")(this);t.request(this,i),e.createUi();for(var s=t.findAllSelectedMapLayers(),a=0;s.length>a;++a)s[a].isLayerOfType("WFS")&&(this.plugin.update(),this.plugins["Oskari.userinterface.Flyout"].layerAdded(s[a]))}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{AfterMapLayerRemoveEvent:function(e){e.getMapLayer().isLayerOfType("WFS")&&(this.plugin.update(),this.plugins["Oskari.userinterface.Flyout"].layerRemoved(e.getMapLayer()))},AfterMapLayerAddEvent:function(e){e.getMapLayer().isLayerOfType("WFS")&&(this.plugin.update(),this.plugins["Oskari.userinterface.Flyout"].layerAdded(e.getMapLayer()))},AfterMapMoveEvent:function(){this.plugins["Oskari.userinterface.Flyout"].handleMapMoved()},WFSFeaturesSelectedEvent:function(e){this.plugins["Oskari.userinterface.Flyout"].featureSelected(e)},"userinterface.ExtensionUpdatedEvent":function(e){var t=this;if(e.getExtension().getName()==t.getName()){var i="close"!=e.getViewState();this.plugins["Oskari.userinterface.Flyout"].setEnabled(i)}}},stop:function(){var e=this.sandbox();for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);var t=e.getRequestBuilder("userinterface.RemoveExtensionRequest")(this);e.request(this,t),this.sandbox.unregister(this),this.started=!1},startExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata.Flyout",this)},stopExtension:function(){this.plugins["Oskari.userinterface.Flyout"]=null},getPlugins:function(){return this.plugins},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},createUi:function(){this.plugins["Oskari.userinterface.Flyout"].createUi();var e=this.sandbox.findRegisteredModuleInstance("MainMapModule"),t=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata.plugin.FeaturedataPlugin",{instance:this});e.registerPlugin(t),e.startPlugin(t),this.plugin=t}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module","Oskari.userinterface.Extension"]}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.Flyout",function(e){this.instance=e,this.container=null,this.state=null,this.layers={},this.tabsContainer=null,this.service=null,this.modelMngr=null,this.selectedTab=null,this.active=!1},{getName:function(){return"Oskari.mapframework.bundle.featuredata.Flyout"},setEl:function(e){this.container=e[0],jQuery(this.container).hasClass("featuredata")||jQuery(this.container).addClass("featuredata")},startPlugin:function(){this.tabsContainer=Oskari.clazz.create("Oskari.userinterface.component.TabContainer",this.instance.getLocalization("nodata")),this.service=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata.service.GridJsonService",this.instance.sandbox.getAjaxUrl()),this.modelMngr=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata.service.GridModelManager")},stopPlugin:function(){},getTitle:function(){return this.instance.getLocalization("title")},getDescription:function(){return this.instance.getLocalization("desc")},getOptions:function(){},setState:function(e){this.state=e,console.log("Flyout.setState",this,e)},createUi:function(){var e=this,t=jQuery(this.container);t.empty();var i=this.instance.sandbox,s=i.getRequestBuilder("DimMapLayerRequest"),a=i.getRequestBuilder("HighlightMapLayerRequest");this.tabsContainer.addTabChangeListener(function(t,r){if(t){e.service.cancelWFSGridUpdateForLayer(t.layer.getId());var n=s(t.layer.getId());i.request(e.instance.getName(),n)}if(e.selectedTab=r,r&&(e._updateData(r.layer),e.active)){var n=a(r.layer.getId());i.request(e.instance.getName(),n)}}),this.tabsContainer.insertTo(t)},layerAdded:function(e){var t=Oskari.clazz.create("Oskari.userinterface.component.TabPanel");t.setTitle(e.getName()),t.getContainer().append(this.instance.getLocalization("loading")),t.layer=e,this.layers[""+e.getId()]=t,this.tabsContainer.addPanel(t)},layerRemoved:function(e){var t=""+e.getId();this.service.cancelWFSGridUpdateForLayer(t);var i=this.layers[t];this.tabsContainer.removePanel(i),i.grid=null,delete i.grid,i.layer=null,delete i.layer,this.layers[t]=null,delete this.layers[t]},_updateData:function(e){if(this.active){this.service.cancelWFSGridUpdateForLayer(e.getId());var t=this.instance.sandbox.getMap(),i=this.layers[""+e.getId()],s=null;if(i.grid&&(s=i.grid.getSelection()),i.getContainer().empty(),!e.isInScale(t.getScale()))return i.getContainer().append(this.instance.getLocalization("errorscale")),void 0;i.getContainer().append(this.instance.getLocalization("loading"));var a=this,r=t.getBbox(),n=t.getWidth(),o=t.getHeight(),l=function(t){if(a._prepareData(e,t),s)for(var r=0;s.length>r;++r)i.grid.select(s[r].featureId,!0)};this.service.scheduleWFSGridUpdate(e,r,n,o,l)}},handleMapMoved:function(){this.selectedTab&&this._updateData(this.selectedTab.layer)},_prepareData:function(e,t){var i=this,s=this.layers[""+e.getId()],a=this.tabsContainer.isSelected(s);if(a){var r=this.modelMngr.getData(t);if(s.getContainer().empty(),!r)return s.getContainer().append(this.instance.getLocalization("errordata")),void 0;var n=r.all;n.setIdField("featureId");var o=n.getFields();if(!s.grid){var l=Oskari.clazz.create("Oskari.userinterface.component.Grid");l.setColumnUIName("__featureName",this.instance.getLocalization("featureNameAll")),l.addSelectionListener(function(t,s){i._handleGridSelect(e,s)});var h=this.instance.getLocalization("showmore");l.setAdditionalDataHandler(h,function(e,t){var i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=i.createCloseButton("OK");s.addClass("primary"),i.show(h,t,[s]),i.moveTo(e,"bottom")});for(var u=[],p=0;o.length>p;++p)"featureId"!=o[p]&&"qName"!=o[p]&&u.push(o[p]);l.setVisibleFields(u),s.grid=l}s.grid.setDataModel(n);try{s.grid.renderTo(s.getContainer())}catch(c){alert(c)}}},_handleGridSelect:function(e,t,i){var s=this.instance.sandbox,a=[t],r=s.getEventBuilder("WFSFeaturesSelectedEvent");void 0===i&&(i=s.isCtrlKeyDown());var n=r(a,e,i);s.notifyAll(n)},featureSelected:function(e){if(this.active){var t=e.getMapLayer(),i=this.layers[""+t.getId()],s=e.getWfsFeatureIds()[0];i.grid.select(s,e.isKeepSelection())}},setEnabled:function(e){if(this.active!=e){this.active=1==e;var t=this.instance.sandbox;if(this.active){if(this.selectedTab){var i=t.getRequestBuilder("HighlightMapLayerRequest"),s=i(this.selectedTab.layer.getId());t.request(this.instance.getName(),s),this._updateData(this.selectedTab.layer)}}else{if(this.selectedTab){this.service.cancelWFSGridUpdateForLayer(this.selectedTab.layer.getId());var a=t.getRequestBuilder("DimMapLayerRequest"),s=a(this.selectedTab.layer.getId());t.request(this.instance.getName(),s)}for(var r in this.layers)r.getContainer&&r.getContainer().empty()}}}},{protocol:["Oskari.userinterface.Flyout"]}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.plugin.FeaturedataPlugin",function(e){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this._conf=e,this.__elements={},this.__templates={},this.instance=e.instance},{__name:"FeaturedataPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,e&&(this.pluginName=e.getName()+this.__name)},hasUI:function(){return!0},init:function(){this.__templates.main=jQuery('<div class="mapplugin featuredataplugin"><a href="JavaScript: void(0);">Test</a></div>')},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,this._map=this.getMapModule().getMap(),e.register(this),this._createUI();for(p in this.eventHandlers)e.registerForEventByName(this,p)},stopPlugin:function(e){for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);this.__elements.main&&(this.__elements.main.remove(),delete this.__elements.main),e.unregister(this)},start:function(){},stop:function(){},_createUI:function(){this._sandbox;var e=this,t=jQuery(this._map.div);e.__elements.main||(e.__elements.main=e.__templates.main.clone());var i=e.__elements.main.find("a");i.html(this.instance.getLocalization("title")),i.bind("click",function(){return e.instance.sandbox.postRequestByName("userinterface.UpdateExtensionRequest",[e.instance,"detach"]),!1}),t.append(e.__elements.main),this.update()},update:function(){for(var e=this.mapModule.getSandbox(),t=e.findAllSelectedMapLayers(),i=0,s=0;t.length>s;s++){var a=t[s];a.isLayerOfType("WFS")&&i++}var r=this;i>0?r.__elements.main.show():r.__elements.main.hide()},eventHandlers:{AfterMapMoveEvent:function(){this.update()}},onEvent:function(e){return this.eventHandlers[e.getName()].apply(this,[e])}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.service.GridJsonService",function(e){this._gridPollingInterval=200,this.endpointUrl=e,this.pendingOperations={},this._wfsTableQueryId=0},{__qname:"Oskari.mapframework.bundle.featuredata.service.GridJsonService",getQName:function(){return this.__qname},__name:"GridJsonService",getName:function(){return this.__name},cancelWFSGridUpdateForLayer:function(e){var t=this.pendingOperations[e];t&&(t.timer&&clearTimeout(t.timer),t.query&&t.query.abort(),this.pendingOperations[e]=null,delete this.pendingOperations[e])},scheduleWFSGridUpdate:function(e,t,i,s,a){this.cancelWFSGridUpdateForLayer(e.getId());var r=Oskari.clazz.create("Oskari.mapframework.bundle.featuredata.domain.WfsGridUpdateParams",e,t,i,s,a),n=this,o=setTimeout(function(){n._processGridUpdate(r)},this._gridPollingInterval);this.pendingOperations[e.getId()]={timer:o}},_processGridUpdate:function(e){var t=this,i=e.getMapLayer();this.pendingOperations[i.getId()].timer=null,delete this.pendingOperations[i.getId()].timer;var s=function(s){t.cancelWFSGridUpdateForLayer(i.getId()),"true"!=s.error&&t._getLatestWfsTableQueryId()==parseInt(s.wfsQueryId)&&e.getCallback()(s)},a=jQuery.ajax({dataType:"json",type:"POST",data:{flow_pm_wfsLayerId:i.getId(),flow_pm_bbox_min_x:e.getBbox().left,flow_pm_bbox_min_y:e.getBbox().bottom,flow_pm_bbox_max_x:e.getBbox().right,flow_pm_bbox_max_y:e.getBbox().top,flow_pm_map_width:e.getMapWidth(),flow_pm_map_heigh:e.getMapHeight(),flow_pm_map_wfs_query_id:t._generateWfsTableQueryId()},beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},url:this.endpointUrl+"action_route=QUERY_FIND_RAW_DATA_TO_TABLE",success:s});this.pendingOperations[i.getId()].query=a},_getLatestWfsTableQueryId:function(){return this._wfsTableQueryId},_generateWfsTableQueryId:function(){return this._wfsTableQueryId++,this._wfsTableQueryId}},{protocol:["Oskari.mapframework.service.Service"]}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.service.GridModelManager",function(){},{getData:function(e){if(!this._isValidData(e))return!1;var t=this._getModels(e);if(2>e.featureDatas.length)for(var i in t)t.all=t[i];else{var s="__featureName",a=Oskari.clazz.create("Oskari.userinterface.component.GridModel");a._addField(s);for(var i in t){for(var r=t[i],n=r.getFields(),o=0;n.length>o;o++){var l=n[o],h=this._findInList(a.getFields(),l);-1===h&&a._addField(l)}for(var e=r.getData(),o=0;e.length>o;o++){var u=e[o];u[s]=i,a.addData(u)}}t.all=a}return t},_isValidData:function(e){if(!e||!e.headers||!e.featureDatas)return!1;for(var t=0;e.featureDatas.length>t;t++)if(null==e.featureDatas[t].children)return!1;return!0},_findInList:function(e,t){for(var i=0;e.length>i;++i)if(e[i]==t)return i;return-1},_getModels:function(e){for(var t=Oskari.getLang(),i={},s=0;e.featureDatas.length>s;s++){var a=e.featureDatas[s],r=this._getIndividualModel(a),n=a["feature_"+t];i[n]=r}return i},_getIndividualModel:function(e){for(var t=Oskari.clazz.create("Oskari.userinterface.component.GridModel"),i=0;e.children.length>i;i++)t.addData(e.children[i]);return t}}),Oskari.clazz.define("Oskari.mapframework.bundle.featuredata.domain.WfsGridUpdateParams",function(e,t,i,s,a){this._bbox=t,this._mapWidth=i,this._mapHeight=s,this._mapLayer=e,this._onReady=a},{getMapLayer:function(){return this._mapLayer},getBbox:function(){return this._bbox},getMapWidth:function(){return this._mapWidth},getMapHeight:function(){return this._mapHeight},getCallback:function(){return this._onReady}}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.MyPlacesBundle",function(){},{create:function(){return Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.MyPlacesBundleInstance")},update:function(e,t,i,s){e.alert("RECEIVED update notification "+s)}},{protocol:["Oskari.bundle.Bundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/event/FinishedDrawingEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/event/MyPlaceHoverEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/event/MyPlacesChangedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/event/MyPlaceSelectedEvent.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/model/MyPlace.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/model/MyPlacesCategory.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/plugin/DrawPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/plugin/HoverPlugin.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/StopDrawingRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/StartDrawingRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/GetGeometryRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/GetGeometryRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/StartDrawingRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/StopDrawingRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/EditPlaceRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/EditCategoryRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/DeleteCategoryRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/PublishCategoryRequest.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/request/EditRequestHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/service/MyPlacesService.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/service/MyPlacesWFSTStore.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/view/MainView.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/view/PlaceForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/view/CategoryForm.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/ButtonHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/CategoryHandler.js"},{type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/instance.js"},{type:"text/javascript",src:"../../../../libraries/jscolor/jscolor.js"},{type:"text/css",src:"../../../../resources/framework/bundle/myplaces2/css/myplaces.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/myplaces2/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"myplaces2","Bundle-Name":"myplaces2","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("myplaces2","Oskari.mapframework.bundle.myplaces2.MyPlacesBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.event.FinishedDrawingEvent",function(e,t){this._drawing=e,this._modification=1==t},{__name:"MyPlaces.FinishedDrawingEvent",getName:function(){return this.__name},getDrawing:function(){return this._drawing},isModification:function(){return this._modification}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.myplaces.event.MyPlaceHoverEvent",function(e,t,i){this._creator=null,this._lonlat=e,this._hoverEvent=t,this._zoom=i},{__name:"MyPlaces.MyPlaceHoverEvent",getName:function(){return this.__name},getHoverEvent:function(){return this._hoverEvent},getLonLat:function(){return this._lonlat},getZoomLevel:function(){return this._zoom}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.myplaces.event.MyPlacesChangedEvent",function(){this._creator=null},{__name:"MyPlaces.MyPlacesChangedEvent",getName:function(){return this.__name}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.myplaces.event.MyPlaceSelectedEvent",function(e,t){this._creator=null,this._myPlace=e,this._dblClick=t},{__name:"MyPlaces.MyPlaceSelectedEvent",getName:function(){return this.__name},getPlace:function(){return this._myPlace},isDblClick:function(){return this._dblClick}},{protocol:["Oskari.mapframework.event.Event"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.model.MyPlace",function(){this.id=void 0,this.name=void 0,this.description=void 0,this.categoryID=void 0,this.geometry=void 0,this.link=void 0,this.createDate=void 0,this.updateDate=void 0},{setId:function(e){this.id=e},getId:function(){return this.id},setName:function(e){this.name=e},getName:function(){return this.name},setDescription:function(e){this.description=e},getDescription:function(){return this.description},setLink:function(e){this.link=e},getLink:function(){return this.link},setCategoryID:function(e){this.categoryID=e},getCategoryID:function(){return this.categoryID},setGeometry:function(e){this.geometry=e},getGeometry:function(){return this.geometry},setCreateDate:function(e){this.createDate=e},getCreateDate:function(){return this.createDate},setUpdateDate:function(e){this.updateDate=e},getUpdateDate:function(){return this.updateDate},setUUID:function(e){this.uuid=e},getUUID:function(){return this.uuid}}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.model.MyPlacesCategory",function(){this.id=void 0,this.name=void 0,this._isDefault=!1,this._isPublic=!1,this.lineWidth=1,this.lineColor="993300",this.areaLineWidth=1,this.areaLineColor="993300",this.areaFillColor="993300",this.dotSize=4,this.dotColor="993300",this.uuid=void 0},{setId:function(e){this.id=e},getId:function(){return this.id},setName:function(e){this.name=e},getName:function(){return this.name},setDefault:function(e){this._isDefault=1==e},isDefault:function(){return 1==this._isDefault},setPublic:function(e){this._isPublic=1==e},isPublic:function(){return 1==this._isPublic},setLineWidth:function(e){this.lineWidth=e},getLineWidth:function(){return this.lineWidth},setLineColor:function(e){this.lineColor=e},getLineColor:function(){return this.lineColor},setAreaLineWidth:function(e){this.areaLineWidth=e},getAreaLineWidth:function(){return this.areaLineWidth},setAreaLineColor:function(e){this.areaLineColor=e},getAreaLineColor:function(){return this.areaLineColor},setAreaFillColor:function(e){this.areaFillColor=e},getAreaFillColor:function(){return this.areaFillColor},setDotSize:function(e){this.dotSize=e},getDotSize:function(){return this.dotSize},setDotColor:function(e){this.dotColor=e},getDotColor:function(){return this.dotColor},setUUID:function(e){this.uuid=e},getUUID:function(){return this.uuid}}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.plugin.DrawPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null,this.drawControls=null,this.drawLayer=null,this.editMode=!1,this.currentDrawMode=null},{__name:"MyPlaces.DrawPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this._map=e.getMap(),this.pluginName=e.getName()+this.__name},startDrawing:function(e){if(e.isModify)this.modifyControls.modify.selectControl.select(this.drawLayer.features[0]);else if(this.drawLayer.removeAllFeatures(),e.geometry){this.editMode=!0;var t=[new OpenLayers.Feature.Vector(e.geometry)];this.drawLayer.addFeatures(t),this.modifyControls.modify.selectControl.select(this.drawLayer.features[0])}else this.editMode=!1,this.toggleControl(e.drawMode)},stopDrawing:function(){this.toggleControl(),this.drawLayer.removeAllFeatures()},forceFinishDraw:function(){try{this.drawControls[this.currentDrawMode].finishSketch()}catch(e){this.stopDrawing();var t=this._sandbox.getEventBuilder("MyPlaces.MyPlaceSelectedEvent")();this._sandbox.notifyAll(t)}},finishedDrawing:function(){this.toggleControl(),this.editMode||this.modifyControls.modify.selectControl.select(this.drawLayer.features[0]);var e=this._sandbox.getEventBuilder("MyPlaces.FinishedDrawingEvent")(this.getDrawing(),this.editMode);this._sandbox.notifyAll(e)},toggleControl:function(e){this.currentDrawMode=e;for(var t in this.drawControls){var i=this.drawControls[t];e==t?i.activate():i.deactivate()}},init:function(e){var t=this;this.requestHandlers={startDrawingHandler:Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.request.StartDrawingRequestPluginHandler",e,t),stopDrawingHandler:Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.request.StopDrawingRequestPluginHandler",e,t),getGeometryHandler:Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.request.GetGeometryRequestPluginHandler",e,t)},this.drawLayer=new OpenLayers.Layer.Vector("MyPlaces Draw Layer",{eventListeners:{featuresadded:function(){t.finishedDrawing()}}}),this.drawControls={point:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.Point),line:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.Path),area:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.Polygon),box:new OpenLayers.Control.DrawFeature(t.drawLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:!0}})},this.modifyControls={modify:new OpenLayers.Control.ModifyFeature(t.drawLayer)},this._map.addLayers([t.drawLayer]);for(var i in this.drawControls)this._map.addControl(this.drawControls[i]);for(var i in this.modifyControls)this._map.addControl(this.modifyControls[i]);this.modifyControls.modify.activate()},getDrawing:function(){return this.drawLayer.features[0].geometry},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this),e.addRequestHandler("MyPlaces.StartDrawingRequest",this.requestHandlers.startDrawingHandler),e.addRequestHandler("MyPlaces.StopDrawingRequest",this.requestHandlers.stopDrawingHandler),e.addRequestHandler("MyPlaces.GetGeometryRequest",this.requestHandlers.getGeometryHandler)},stopPlugin:function(e){e.removeRequestHandler("MyPlaces.StartDrawingRequest",this.requestHandlers.startDrawingHandler),e.removeRequestHandler("MyPlaces.StopDrawingRequest",this.requestHandlers.stopDrawingHandler),e.removeRequestHandler("MyPlaces.GetGeometryRequest",this.requestHandlers.getGeometryHandler),e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.plugin.HoverPlugin",function(){this.mapModule=null,this.pluginName=null,this._sandbox=null,this._map=null},{__name:"MyPlaces.HoverPlugin",getName:function(){return this.pluginName},getMapModule:function(){return this.mapModule},setMapModule:function(e){this.mapModule=e,this._map=e.getMap(),this.pluginName=e.getName()+this.__name},init:function(e){var t=this;OpenLayers.Control.Hover=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{delay:500,pixelTolerance:null,stopMove:!1},initialize:function(){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Hover(this,{pause:this.onPause,move:this.onMove},this.handlerOptions)
},onPause:function(){},onMove:function(){}}),this.hoverControl=new OpenLayers.Control.Hover({handlerOptions:{delay:500,pixelTolerance:6},onPause:function(i){var s=t._map.getLonLatFromPixel(i.xy),a=e.getEventBuilder("MyPlaces.MyPlaceHoverEvent")(s,i,t._map.getZoom());e.notifyAll(a)}}),this._map.addControl(this.hoverControl)},activate:function(){this.hoverControl.activate()},deactivate:function(){this.hoverControl.deactivate()},register:function(){},unregister:function(){},startPlugin:function(e){this._sandbox=e,e.register(this)},stopPlugin:function(e){e.unregister(this),this._map=null,this._sandbox=null},start:function(){},stop:function(){}},{protocol:["Oskari.mapframework.module.Module","Oskari.mapframework.ui.module.common.mapmodule.Plugin"]}),Oskari.clazz.define("Oskari.mapframework.myplaces.request.StopDrawingRequest",function(e){this._creator=null,this._isCancel=1==e},{__name:"MyPlaces.StopDrawingRequest",getName:function(){return this.__name},isCancel:function(){return this._isCancel===!0}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.StartDrawingRequest",function(e){if(e.geometry)this._geometry=e.geometry;else if(e.continueCurrent)this._continueCurrent=e.continueCurrent;else{if(!this.drawModes[e.drawMode])throw"Unknown draw mode '"+e.drawMode+"'";this._drawMode=e.drawMode}},{__name:"MyPlaces.StartDrawingRequest",getName:function(){return this.__name},isModify:function(){return this._continueCurrent?!0:!1},drawModes:{point:"point",line:"line",area:"area",box:"box"},getDrawMode:function(){return this._drawMode},getGeometry:function(){return this._geometry}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.GetGeometryRequest",function(e){this._creator=null,this._callbackMethod=e},{__name:"MyPlaces.GetGeometryRequest",getName:function(){return this.__name},getCallBack:function(){return this._callbackMethod}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.GetGeometryRequestPluginHandler",function(e,t){this.sandbox=e,this.drawPlugin=t},{handleRequest:function(e,t){var i=t.getCallBack();this.sandbox.printDebug("[Oskari.mapframework.bundle.myplaces2.request.GetGeometryRequestPluginHandler] geometry requested");var s=this.drawPlugin.getDrawing();i(s.geometry)}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.StartDrawingRequestPluginHandler",function(e,t){this.sandbox=e,this.drawPlugin=t},{handleRequest:function(e,t){var i=t.getDrawMode();this.sandbox.printDebug("[Oskari.mapframework.bundle.myplaces2.request.StartDrawingRequestPluginHandler] Start Drawing: "+i),this.drawPlugin.startDrawing({drawMode:t.getDrawMode(),geometry:t.getGeometry(),isModify:t.isModify(),style:""})}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.StopDrawingRequestPluginHandler",function(e,t){this.sandbox=e,this.drawPlugin=t},{handleRequest:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.myplaces2.request.StopDrawingRequestPluginHandler] Stop drawing"),t.isCancel()?this.drawPlugin.stopDrawing():this.drawPlugin.forceFinishDraw()}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.EditPlaceRequest",function(e){this._placeId=e},{__name:"MyPlaces.EditPlaceRequest",getName:function(){return this.__name},getId:function(){return this._placeId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.EditCategoryRequest",function(e){this._categoryId=e},{__name:"MyPlaces.EditCategoryRequest",getName:function(){return this.__name},getId:function(){return this._categoryId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.DeleteCategoryRequest",function(e){this._categoryId=e},{__name:"MyPlaces.DeleteCategoryRequest",getName:function(){return this.__name},getId:function(){return this._categoryId}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.PublishCategoryRequest",function(e,t){this._categoryId=e,this._isPublic=1==t},{__name:"MyPlaces.PublishCategoryRequest",getName:function(){return this.__name},getId:function(){return this._categoryId},isPublic:function(){return this._isPublic}},{protocol:["Oskari.mapframework.request.Request"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler",function(e,t){this.sandbox=e,this.instance=t},{handleRequest:function(e,t){var i=e.getSandbox();"MyPlaces.EditPlaceRequest"==t.getName()?this._handleEditPlace(i,t):"MyPlaces.EditCategoryRequest"==t.getName()?this._handleEditCategory(i,t):"MyPlaces.DeleteCategoryRequest"==t.getName()?this._handleDeleteCategory(i,t):"MyPlaces.PublishCategoryRequest"==t.getName()&&this._handlePublishCategory(i,t)},_handleEditPlace:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler] edit requested for place "+t.getId());var i=this.instance.getService(),s=i.findMyPlace(t.getId());if(s){var a=s.getGeometry().getCentroid(),r={lon:a.x,lat:a.y};this.instance.getDrawPlugin().startDrawing({geometry:s.getGeometry()}),this.instance.getMainView().showPlaceForm(r,s)}},_handleEditCategory:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler] edit requested for category "+t.getId());var i=this.instance.getService(),s=i.findCategory(t.getId());s&&this.instance.getCategoryHandler().editCategory(s)},_handleDeleteCategory:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler] delete requested for category "+t.getId());var i=this.instance.getService(),s=i.findCategory(t.getId());s&&this.instance.getCategoryHandler().confirmDeleteCategory(s)},_handlePublishCategory:function(e,t){this.sandbox.printDebug("[Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler] (un/)publish requested for category "+t.getId());var i=this.instance.getService(),s=i.findCategory(t.getId());s&&this.instance.getCategoryHandler().confirmPublishCategory(s,t.isPublic())}},{protocol:["Oskari.mapframework.core.RequestHandler"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService",function(e,t,i,s){this._categoryList=[],this._placesList=[],this.wfstStore=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.service.MyPlacesWFSTStore",e,t),this._sandbox=i,this.defaultCategory=null,this.defaultCategoryName=s},{__qname:"Oskari.mapframework.bundle.myplaces2.service.MyPlacesService",getQName:function(){return this.__qname},__name:"MyPlacesService",getName:function(){return this.__name},init:function(){var e=this;this.wfstStore.connect();var t=!1,i=!1,s=function(s){if(s)for(var a=0;s.length>a;++a)e._addCategory(s[a]);t=!0,0===e.getAllCategories().length&&e.defaultCategoryName?e._createDefaultCategory():i&&e._notifyDataChanged()},a=function(s){s&&(e._placesList=s),i=!0,t&&e._notifyDataChanged()};this.wfstStore.getCategories(s),this.wfstStore.getMyPlaces(a)},_createDefaultCategory:function(){var e=this,t=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.model.MyPlacesCategory");t.setName(e.defaultCategoryName),t.setLineWidth(2),t.setLineColor("cc9900"),t.setAreaLineWidth(2),t.setAreaLineColor("cc9900"),t.setAreaFillColor("ffdc00"),t.setDotColor("cc9900"),t.setDotSize(4),t.setDefault(!0);var i=function(){0===e.getAllCategories().length?alert("error couldn't create default category"):e._notifyDataChanged()};this.saveCategory(t,i)},_addCategory:function(e){e.isDefault()&&(this.defaultCategory=e),this._categoryList.push(e)},_movePlacesToCategory:function(e,t,i){var s=this,a=this.getPlacesInCategory(e);if(0==a.length)return i(!0),void 0;for(var r=0;a.length>r;r++)a[r].setCategoryID(t);var n=function(e){s._notifyDataChanged(),i(e)};this.wfstStore.commitMyPlaces(a,n)},_deletePlacesInCategory:function(e,t){for(var i=this.getPlacesInCategory(e),s=[],a=0;i.length>a;a++)s.push(i[a].getId());if(0==s.length)return t(!0),void 0;var r=this,n=function(e,s){if(e){for(var a=0;i.length>a;a++)r._removeMyPlace(s[a]);r._notifyDataChanged()}t(e)};this.wfstStore.deleteMyPlaces(s,n)},parseDate:function(e){if(!e&&10>e.length)return[];var t=e.substring(0,4),i=e.substring(5,7),s=e.substring(8,10),a=[s+"."+i+"."+t],r="";if(29==e.length){r=e.substring(11);var n=r.split("+");r=n[0],r=r.split(".")[0];var o=r.split(":"),l=o[0],h=o[1],u=o[2];r=l+":"+h+":"+u,a.push(r)}return a},getPlacesInCategory:function(e){for(var t=[],i=0;this._placesList.length>i;i++)this._placesList[i].getCategoryID()==e&&t.push(this._placesList[i]);return t},deleteCategory:function(e,t,i){var s=this,a=function(t){t?s._deleteEmptyCategory(e,i):i(t)};if(t===!0){var r=s.getDefaultCategory();s._movePlacesToCategory(e,r.getId(),a)}else s._deletePlacesInCategory(e,a)},_deleteEmptyCategory:function(e,t){var i=this,s=function(e,s){e&&i._removeCategory(s[0]),t(e),i._notifyDataChanged()};this.wfstStore.deleteCategories([e],s)},_removeCategory:function(e){for(var t=0;this._categoryList.length>t;t++)if(this._categoryList[t].getId()==e){this._categoryList.splice(t,1);break}},saveCategory:function(e,t){var i=this,s=!e.getId(),a=function(a,r){if(s&&a)i._addCategory(r[0]);else{var n=i.findCategory(r[0].getId());n?(n.setName(e.getName()),n.setDotSize(e.getDotSize()),n.setDotColor(e.getDotColor()),n.setLineWidth(e.getLineWidth()),n.setLineColor(e.getLineColor()),n.setAreaLineWidth(e.getAreaLineWidth()),n.setAreaLineColor(e.getAreaLineColor()),n.setAreaFillColor(e.getAreaFillColor())):a=!1}i._notifyDataChanged(),t(a,r[0],s)};this.wfstStore.commitCategories([e],a)},getAllCategories:function(){return this._categoryList},getDefaultCategory:function(){return this.defaultCategory},_addMyPlace:function(e){this._placesList.push(e)},_removeMyPlace:function(e){var t=this.findBy(this._placesList,"id",e);-1!==t&&this._placesList.splice(t,1)},_notifyDataChanged:function(){var e=this._sandbox.getEventBuilder("MyPlaces.MyPlacesChangedEvent")();this._sandbox.notifyAll(e)},deleteMyPlace:function(e,t){var i=this,s=function(e,s){e&&(i._removeMyPlace(s[0]),i._notifyDataChanged()),t(e,s[0])};this.wfstStore.deleteMyPlaces([e],s)},findMyPlaceByLonLat:function(e,t){for(var i=[],s=this.getAllMyPlaces(),a=0;s.length>a;++a){var r=s[a].getGeometry(),n=!1;if("OpenLayers.Geometry.Point"===r.CLASS_NAME){var o=720-5*t*t;t>10?o=5:t>8?o=20:t>5&&(o=50),n=r.atPoint(e,o,o)}else n=r.atPoint(e);n&&i.push(s[a])}return i},findMyPlace:function(e){var t=this.findBy(this._placesList,"id",e);return-1!==t?this._placesList[t]:null},findCategory:function(e){var t=this.findBy(this._categoryList,"id",e);return-1!==t?this._categoryList[t]:null},findBy:function(e,t,i){for(var s=0;e.length>s;s++)if(e[s][t]===i)return s;return-1},saveMyPlace:function(e,t){var i=this,s=!e.getId(),a=function(a,r){if(s&&a)i._addMyPlace(r[0]);else{var n=i.findMyPlace(r[0].getId());n?(n.setName(e.getName()),n.setDescription(e.getDescription()),n.setLink(e.getLink()),n.setCategoryID(e.getCategoryID()),n.setGeometry(e.getGeometry()),n.setUpdateDate(r[0].getUpdateDate())):a=!1}i._notifyDataChanged(),t(a,r[0],s)};this.wfstStore.commitMyPlaces([e],a)},getAllMyPlaces:function(){return this._placesList},publishCategory:function(e,t,i){var s=this.findCategory(e);s||i(!1);var a=this,r=this._sandbox.getAjaxUrl();jQuery.ajax({type:"GET",dataType:"json",beforeSend:function(e){e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},data:{id:s.getId(),makePublic:t},url:r+"action_route=PublishMyPlaceLayer",success:function(e){e?(s.setPublic(t),i(!0),a._notifyDataChanged()):i(!1)},error:function(e){0!=e.status&&i(!1)}})}},{protocol:["Oskari.mapframework.service.Service"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.service.MyPlacesWFSTStore",function(e,t){this.uuid=t,this.protocols={},this.url=e},{connect:function(){var e=this.url;this.protocols.categories=new OpenLayers.Protocol.WFS({version:"1.1.0",srsName:"EPSG:3067",featureType:"categories",featureNS:"http://www.paikkatietoikkuna.fi",url:e}),this.protocols.my_places=new OpenLayers.Protocol.WFS({version:"1.1.0",srsName:"EPSG:3067",geometryName:"geometry",featureType:"my_places",featureNS:"http://www.paikkatietoikkuna.fi",url:e})},getCategories:function(e){var t=this.uuid,i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"uuid",value:t}),s=this.protocols.categories,a=this;s.read({filter:i,callback:function(t){a._handleCategoriesResponse(t,e)}})},_handleCategoriesResponse:function(e,t){var i=this.uuid,s=e.features;if(null==s||0==s.length)return t&&t(),void 0;for(var a=[],r=0;s.length>r;r++){var n=s[r],o=n.attributes,l=this._parseNumericId(n.fid),h=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.model.MyPlacesCategory");h.setId(l),h.setDefault("true"===o["default"]),h.setName(o.category_name),h.setLineWidth(o.stroke_width),h.setLineColor(this._formatColorFromServer(o.stroke_color)),h.setAreaLineWidth(o.border_width),h.setAreaLineColor(this._formatColorFromServer(o.border_color)),h.setAreaFillColor(this._formatColorFromServer(o.fill_color)),h.setDotColor(this._formatColorFromServer(o.dot_color)),h.setDotSize(o.dot_size),h.setUUID(i),o.publisher_name&&h.setPublic(!0),a.push(h)}t&&t(a)},_formatColorFromServer:function(e){return"#"==e.charAt(0)?e.substring(1):e},_prefixColorForServer:function(e){return"#"!=e.charAt(0)?"#"+e:e},commitCategories:function(e,t){for(var i=this.uuid,s=this.protocols.categories,a=this,r=[],n=0;e.length>n;n++){var o=e[n],l=o.getId(),h={category_name:o.getName(),"default":o.isDefault(),stroke_width:o.getLineWidth(),stroke_color:this._prefixColorForServer(o.getLineColor()),border_width:o.getAreaLineWidth(),border_color:this._prefixColorForServer(o.getAreaLineColor()),fill_color:this._prefixColorForServer(o.getAreaFillColor()),dot_color:this._prefixColorForServer(o.getDotColor()),dot_size:o.getDotSize(),uuid:i},u=new OpenLayers.Feature.Vector(null,h);l?(u.fid=s.featureType+"."+l,u.state=OpenLayers.State.UPDATE):u.toState(OpenLayers.State.INSERT),r.push(u)}s.commit(r,{callback:function(i){a._handleCommitCategoriesResponse(i,e,t)}})},_handleCommitCategoriesResponse:function(e,t,i){if(e.success()){for(var s,a,r=e.reqFeatures,n=e.insertIds||[],o=0,l=r.length;l>o;++o)if(a=r[o],s=a.state){if(s==OpenLayers.State.INSERT){a.fid=n[o],a.attributes.id=a.fid;var h=this._parseNumericId(a.fid);t[o].setId(h)}a.state=null}i(!0,t)}else i(!1,t)},deleteCategories:function(e,t){for(var i=this.protocols.categories,s=this.uuid,a=[],r=0;e.length>r;r++){var n=e[r];if(n){var o={uuid:s},l=new OpenLayers.Feature.Vector(null,o);l.fid=i.featureType+"."+n,l.state=OpenLayers.State.DELETE,a.push(l)}}var h=this;i.commit(a,{callback:function(i){h._handleDeleteCategoriesResponse(i,e,t)}})},_handleDeleteCategoriesResponse:function(e,t,i){e.success()?i(!0,t):i(!1,t)},_parseNumericId:function(e){var t=e.split(".")[1];return t},getMyPlaces:function(e){var t=this.uuid,i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"uuid",value:t}),s=this.protocols.my_places,a=this;s.read({filter:i,callback:function(t){a._handleMyPlacesResponse(t,e)}})},_handleMyPlacesResponse:function(e,t){var i=this.uuid,s=e.features;if(null==s||0==s.length)return t&&t(),void 0;for(var a=[],r=0;s.length>r;r++){var n=s[r],o=n.attributes,l=this._parseNumericId(n.fid),h=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.model.MyPlace");h.setId(l),h.setName(o.name),h.setDescription(o.place_desc),h.setLink(o.link),h.setCategoryID(o.category_id),h.setCreateDate(o.created),h.setUpdateDate(o.updated),h.setGeometry(n.geometry),h.setUUID(i),a.push(h)}t&&t(a)},getMyPlacesByIdList:function(e,t){var i=this.uuid,s=this.protocols.my_places,a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"uuid",value:i}),new OpenLayers.Filter.FeatureId({fids:e})]}),r=this;s.read({filter:a,callback:function(e){r._handleMyPlacesResponse(e,t)}})},commitMyPlaces:function(e,t){for(var i=this.protocols.my_places,s=this.uuid,a=[],r=0;e.length>r;r++){var n=e[r],o=n.getId(),l=n.getGeometry(),h={name:n.getName(),place_desc:n.getDescription(),link:n.getLink(),category_id:n.getCategoryID(),uuid:s},u=new OpenLayers.Feature.Vector(l,h);o?(u.fid=i.featureType+"."+o,u.state=OpenLayers.State.UPDATE):u.toState(OpenLayers.State.INSERT),a.push(u)}var p=this;i.commit(a,{callback:function(i){p._handleCommitMyPlacesResponse(i,e,t)}})},_handleCommitMyPlacesResponse:function(e,t,i){if(e.success()){for(var s,a,r=e.reqFeatures,n=e.insertIds||[],o=[],l=0,h=r.length;h>l;++l)if(a=r[l],s=a.state){if(s==OpenLayers.State.INSERT){a.fid=n[l],a.attributes.id=a.fid;var u=this._parseNumericId(a.fid);t[l].setId(u),o.push(u)}else o.push(t[l].getId());a.state=null}var p=function(e){i(!0,e)};this.getMyPlacesByIdList(o,p)}else i(!1,t)},deleteMyPlaces:function(e,t){for(var i=this.protocols.my_places,s=this.uuid,a=[],r=0;e.length>r;r++){var n=e[r];if(n){var o={uuid:s},l=new OpenLayers.Feature.Vector(null,o);l.fid=i.featureType+"."+n,l.state=OpenLayers.State.DELETE,a.push(l)}}var h=this;i.commit(a,{callback:function(i){h._handleDeleteMyPlacesResponse(i,e,t)}})},_handleDeleteMyPlacesResponse:function(e,t,i){e.success()?i(!0,t):i(!1,t)},disconnect:function(){}}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.view.MainView",function(e){this.instance=e,this.popupId="myplacesForm",this.form=void 0},{__name:"MyPlacesMainView",getName:function(){return this.__name},getSandbox:function(){return this.instance.sandbox},init:function(){},start:function(){var e=this,t=this.instance.sandbox;t.register(e);for(p in e.eventHandlers)t.registerForEventByName(e,p);var i=t.findRegisteredModuleInstance("MainMapModule"),s=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.plugin.DrawPlugin");i.registerPlugin(s),i.startPlugin(s),this.drawPlugin=s},stop:function(){var e=this.instance.sandbox;for(p in this.eventHandlers)e.unregisterFromEventByName(this,p);e.unregister(this)},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{"Toolbar.ToolSelectedEvent":function(){this._cleanupPopup()},"MyPlaces.FinishedDrawingEvent":function(e){this._handleFinishedDrawingEvent(e)}},_handleFinishedDrawingEvent:function(e){var t=e.getDrawing().getCentroid(),i={lon:t.x,lat:t.y};this.showPlaceForm(i)},showPlaceForm:function(e,t){var i=this,s=this.instance.sandbox;s.postRequestByName("DisableMapKeyboardMovementRequest");var a=this.instance.getLocalization();this.form=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.view.PlaceForm",this.instance);var r=this.instance.getService().getAllCategories();if(t){var n={place:{id:t.getId(),name:t.getName(),link:t.getLink(),desc:t.getDescription(),category:t.getCategoryID()}};this.form.setValues(n)}var o=[{html:i.form.getForm(r),useButtons:!0,primaryButton:a.buttons.save,actions:{}}];o[0].actions[a.buttons.cancel]=function(){i._cleanupPopup();var e=i.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();i.instance.sandbox.request(i,e)},o[0].actions[a.buttons.save]=function(){i._saveForm()};var l=s.getRequestBuilder("InfoBox.ShowInfoBoxRequest")(this.popupId,a.placeform.title,o,e,!0);s.request(i.getName(),l)},_validateForm:function(e){var t=[],i=this.instance.getCategoryHandler(),t=i.validateCategoryFormValues(e.category),s=this.instance.getLocalization("validation");return e.place.name?i.hasIllegalChars(e.place.name)&&t.push({name:"name",error:s.placeNameIllegal}):t.push({name:"name",error:s.placeName}),i.hasIllegalChars(e.place.desc)&&t.push({name:"desc",error:s.descIllegal}),t},_showValidationErrorMessage:function(e){for(var t=this.instance.getLocalization(),i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=i.createCloseButton(t.buttons.ok),a=jQuery("<ul></ul>"),r=0;e.length>r;++r){var n=jQuery("<li></li>");n.append(e[r].error),a.append(n)}i.show(t.validation.title,a,[s])},_saveForm:function(){if(this.form){var e=this,t=this.form.getValues(),i=this._validateForm(t);if(0!=i.length)return this._showValidationErrorMessage(i),void 0;if(t.category){var s=this.instance.getCategoryHandler().getCategoryFromFormValues(t.category),a=function(i,s,a){if(i)t.place.category=s.getId(),e.__savePlace(t.place);else{var r=e.instance.getLocalization("notification").error;a?e.instance.showMessage(r.error.title,r.error.addCategory):e.instance.showMessage(r.error.title,r.error.editCategory)}};this.instance.getService().saveCategory(s,a)}else this.__savePlace(t.place)}},__savePlace:function(e){var t=this;if(!e){var i=t.instance.getLocalization("notification").error;return t.instance.showMessage(i.title,i.savePlace),void 0}var s=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.model.MyPlace"),a=-1;e.id&&(s=this.instance.getService().findMyPlace(e.id),a=s.getCategoryID()),s.setId(e.id),s.setName(e.name),s.setLink(e.link),s.setDescription(e.desc),s.setCategoryID(e.category),s.setGeometry(this.drawPlugin.getDrawing());var r=this.instance.sandbox,n=function(e,i,n){if(e){var o=t.instance.getCategoryHandler()._getMapLayerId(s.getCategoryID()),l=r.getRequestBuilder("AddMapLayerRequest"),h=r.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest"),u=l(o,!0);if(r.request(t,u),n){var p=h(o,!0);r.request(t,p)}else{var p=h(o,!0);r.request(t,p),a!=s.getCategoryID()&&(o=t.instance.getCategoryHandler()._getMapLayerId(a),u=l(o,!0),r.request(t,u))}t._cleanupPopup();var c=Oskari.clazz.create("Oskari.userinterface.component.Popup"),d=t.instance.getLocalization("notification").placeAdded;c.show(d.title,d.message),c.fadeout(),t.drawPlugin.stopDrawing()}else{var d=t.instance.getLocalization("notification").error;t.instance.showMessage(d.title,d.savePlace)}};this.instance.getService().saveMyPlace(s,n)},_cleanupPopup:function(){if(this.form){var e=this.instance.sandbox,t=e.getRequestBuilder("InfoBox.HideInfoBoxRequest")(this.popupId);e.request(this,t),this.form.destroy(),this.form=void 0,e.postRequestByName("EnableMapKeyboardMovementRequest"),this.instance.enableGfi(!0)}}},{protocol:["Oskari.mapframework.module.Module"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.view.PlaceForm",function(e){this.instance=e,this.newCategoryId="-new-",this.placeId=void 0,this.initialValues=void 0;var t=e.getLocalization("placeform");this.template=jQuery('<div class="myplacesform"><div class="field"><div class="help icon-info" title="'+t.tooltip+'"></div>'+'<input type="text" name="placename" placeholder="'+t.placename.placeholder+'"/>'+"</div>"+'<div class="field">'+'<input type="text" name="placelink" placeholder="'+t.placelink.placeholder+'"/>'+"</div>"+'<div class="field">'+'<textarea name="placedesc" placeholder="'+t.placedesc.placeholder+'">'+"</textarea>"+"</div>"+'<div class="field">'+'<label for="category">'+t.category.label+'</label><br clear="all" />'+'<select name="category">'+"</select>"+"</div>"+"</div>"),this.templateOption=jQuery("<option></option>"),this.categoryForm=void 0},{getForm:function(e){var t=this.template.clone(),i=this.instance.getLocalization("placeform");if(e){var s=t.find("select[name=category]"),a=this.templateOption.clone();a.append(i.category["new"]),a.attr("value",this.newCategoryId),s.append(a);for(var r=0;e.length>r;++r){var n=e[r],a=this.templateOption.clone();a.append(n.getName()),a.attr("value",n.getId()),this.initialValues?this.initialValues.place.category==n.getId()&&a.attr("selected","selected"):n.isDefault()&&a.attr("selected","selected"),s.append(a)}this._bindCategoryChange()}return this.initialValues&&(t.find("input[name=placename]").attr("value",this.initialValues.place.name),t.find("input[name=placelink]").attr("value",this.initialValues.place.link),t.find("textarea[name=placedesc]").append(this.initialValues.place.desc)),t},getValues:function(){var e={},t=this._getOnScreenForm();if(t.length>0){var i=t.find("input[name=placename]").val(),s=t.find("input[name=placelink]").val();s&&((-1==s.indexOf("://")||s.indexOf("://")>6)&&(s="http://"+s),s=s.replace("<",""),s=s.replace(">",""));var a=t.find("textarea[name=placedesc]").val(),r=t.find("select[name=category]").val();e.place={name:i,link:s,desc:a,category:r},this.placeId&&(e.place.id=this.placeId)}return this.categoryForm&&(e.category=this.categoryForm.getValues()),e},setValues:function(e){this.placeId=e.place.id;var t=this._getOnScreenForm();t.length>0&&(t.find("input[name=placename]").val(e.place.name),t.find("input[name=placelink]").val(e.place.link),t.find("textarea[name=placedesc]").val(e.place.desc),t.find("select[name=category]").val(e.place.category)),this.initialValues=e},_bindCategoryChange:function(){var e=this,t=this._getOnScreenForm();t.find("select[name=category]").live("change",function(){var t=jQuery(this).val(),i=e._getOnScreenForm();t==e.newCategoryId?(e.categoryForm=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.view.CategoryForm",e.instance),i.append(e.categoryForm.getForm())):e.categoryForm&&(e.categoryForm.destroy(),e.categoryForm=void 0)})},destroy:function(){var e=this._getOnScreenForm();e.find("select[name=category]").die(),this.categoryForm&&(this.categoryForm.destroy(),this.categoryForm=void 0)},_getOnScreenForm:function(){return jQuery("div.myplacesform")}}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.view.CategoryForm",function(e){this.instance=e,jscolor.dir="/Oskari/libraries/jscolor/";var t=e.getLocalization("categoryform");this.template=jQuery('<div class="myplacescategoryform"><div class="field"><label for="categoryname">'+t.name.label+'</label><br clear="all" />'+'<input type="text" name="categoryname" placeholder="'+t.name.placeholder+'"/>'+"</div>"+'<div class="field drawing">'+"<label>"+t.drawing.label+'</label><br clear="all" />'+"<table></table>"+"</div>"+"</div>"),this.templateTableRow=jQuery("<tr></tr>"),this.templateTableCell=jQuery("<td></td>"),this.templateTextInput=jQuery('<input type="text"/>'),this.defaults={dotSize:4,dotColor:"cc9900",lineSize:2,lineColor:"cc9900",areaLineSize:2,areaLineColor:"cc9900",areaFillColor:"ffdc00"},this.categoryId=void 0,this.initialValues=void 0},{getForm:function(){var e=this.template.clone(),t=e.find("div.drawing table");if(this._populatePointTool(t),this._populateLineTool(t),this._populateAreaTool(t),this.initialValues){e.find("input[name=categoryname]").attr("value",this.initialValues.name),e.find("input[name=dotSize]").attr("value",this.initialValues.dot.size);var i=e.find("input[name=dotColor]");i.attr("value",this.initialValues.dot.color),new jscolor.color(i[0]),e.find("input[name=lineSize]").attr("value",this.initialValues.line.size);var s=e.find("input[name=lineColor]");s.attr("value",this.initialValues.line.color),new jscolor.color(s[0]),e.find("input[name=areaLineSize]").attr("value",this.initialValues.area.size);var a=e.find("input[name=areaLineColor]");a.attr("value",this.initialValues.area.lineColor),new jscolor.color(a[0]);var r=e.find("input[name=areaFillColor]");r.attr("value",this.initialValues.area.fillColor),new jscolor.color(r[0])}return e},getValues:function(){var e={},t=this._getOnScreenForm();if(t.length>0){var i=t.find("input[name=categoryname]").val();e.name=i,this.categoryId&&(e.id=this.categoryId);var s=t.find("input[name=dotSize]").val(),a=t.find("input[name=dotColor]").val();e.dot={size:s,color:a};var r=t.find("input[name=lineSize]").val(),n=t.find("input[name=lineColor]").val();e.line={size:r,color:n};var o=t.find("input[name=areaLineSize]").val(),l=t.find("input[name=areaLineColor]").val(),h=t.find("input[name=areaFillColor]").val();e.area={size:o,lineColor:l,fillColor:h}}return e},setValues:function(e){this.categoryId=e.id;var t=this._getOnScreenForm();t.length>0&&(t.find("input[name=categoryname]").val(e.name),t.find("input[name=dotSize]").val(e.dot.size),t.find("input[name=dotColor]").val(e.dot.color),t.find("input[name=lineSize]").val(e.line.size),t.find("input[name=lineColor]").val(e.line.color),t.find("input[name=areaLineSize]").val(e.area.size),t.find("input[name=areaLineColor]").val(e.area.lineColor),t.find("input[name=areaFillColor]").val(e.area.fillColor)),this.initialValues=e},_createInput:function(e,t,i){var s=this.templateTextInput.clone();return s.attr("name",e),s.attr("value",t),i&&s.attr("class",i),"oskaricolor"==i&&(s.picker=new jscolor.color(s[0])),s},_populatePointTool:function(e){var t=this.instance.getLocalization("categoryform").drawing.point,i=this.templateTableRow.clone();for(var s in t){var a=this.templateTableCell.clone();a.append(t[s]),i.append(a)}i.append(this.templateTableCell.clone());var r=this.templateTableRow.clone();r.append(this.templateTableCell.clone());var n=this.templateTableCell.clone();n.append(this._createInput("dotColor",this.defaults.dotColor,"oskaricolor")),r.append(n);var o=this.templateTableCell.clone();o.append(this._createInput("dotSize",this.defaults.dotSize)),r.append(o),r.append(this.templateTableCell.clone()),e.append(i),e.append(r)},_populateLineTool:function(e){var t=this.instance.getLocalization("categoryform").drawing.line,i=this.templateTableRow.clone();for(var s in t){var a=this.templateTableCell.clone();a.append(t[s]),i.append(a)}i.append(this.templateTableCell.clone());var r=this.templateTableRow.clone();r.append(this.templateTableCell.clone());var n=this.templateTableCell.clone();n.append(this._createInput("lineColor",this.defaults.lineColor,"oskaricolor")),r.append(n);var o=this.templateTableCell.clone();o.append(this._createInput("lineSize",this.defaults.lineSize)),r.append(o),r.append(this.templateTableCell.clone()),e.append(i),e.append(r)},_populateAreaTool:function(e){var t=this.instance.getLocalization("categoryform").drawing.area,i=this.templateTableRow.clone();for(var s in t){var a=this.templateTableCell.clone();a.append(t[s]),i.append(a)}var r=this.templateTableRow.clone();r.append(this.templateTableCell.clone());var n=this.templateTableCell.clone();n.append(this._createInput("areaFillColor",this.defaults.areaFillColor,"oskaricolor")),r.append(n);var o=this.templateTableCell.clone();o.append(this._createInput("areaLineColor",this.defaults.areaLineColor,"oskaricolor")),r.append(o);var l=this.templateTableCell.clone();l.append(this._createInput("areaLineSize",this.defaults.areaLineSize)),r.append(l),e.append(i),e.append(r)},_getOnScreenForm:function(){return jQuery("div.myplacescategoryform")},destroy:function(){var e=this._getOnScreenForm();e.remove()}}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.ButtonHandler",function(e){this.instance=e,this.buttonGroup="myplaces",this.ignoreEvents=!1,this.dialog=null;var t=this;this.buttons={point:{iconCls:"myplaces-draw-point",tooltip:"",sticky:!0,callback:function(){t.startNewDrawing({drawMode:"point"})}},line:{iconCls:"myplaces-draw-line",tooltip:"",sticky:!0,callback:function(){t.startNewDrawing({drawMode:"line"})}},area:{iconCls:"myplaces-draw-area",tooltip:"",sticky:!0,callback:function(){t.startNewDrawing({drawMode:"area"})}}},this.templateGuide=jQuery('<div><div class="guide"></div><div class="buttons"><div class="cancel button"></div><div class="finish button"></div></div></div>')},{__name:"MyPlacesButtonHandler",getName:function(){return this.__name},init:function(){var e=this.instance.getLocalization("tools"),t=this.instance.sandbox.getUser(),i=" - "+this.instance.getLocalization("guest").loginShort;for(var s in this.buttons){var a=e[s].tooltip;t.isLoggedIn()||(a+=i),this.buttons[s].tooltip=a}},start:function(){var e=this,t=this.instance.sandbox;t.register(e);for(p in e.eventHandlers)t.registerForEventByName(e,p);var i=t.getRequestBuilder("Toolbar.AddToolButtonRequest");for(var s in this.buttons)t.request(this,i(s,this.buttonGroup,this.buttons[s]));
var a=this.instance.sandbox.getUser();if(!a.isLoggedIn()){var r=t.getRequestBuilder("Toolbar.ToolButtonStateRequest");t.request(this,r(void 0,this.buttonGroup,!1))}},startNewDrawing:function(e){var t=this.instance.sandbox.getEventBuilder("MyPlaces.MyPlaceSelectedEvent")();this.instance.sandbox.notifyAll(t),this.sendDrawRequest(e),this.instance.enableGfi(!1)},sendDrawRequest:function(e){var t=this.instance.sandbox.getRequestBuilder("MyPlaces.StartDrawingRequest")(e);this.instance.sandbox.request(this,t),e.geometry||this._showDrawHelper(e.drawMode)},_showDrawHelper:function(e){var t=this,i=this.instance.getLocalization("tools")[e],s=this.instance.getLocalization("buttons"),a=this.instance.getLocalization("title"),r=i["new"],n=Oskari.clazz.create("Oskari.userinterface.component.Popup");this.dialog=n;var o=[],l=Oskari.clazz.create("Oskari.userinterface.component.Button");if(l.setTitle(s.cancel),l.setHandler(function(){var e=t.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();t.instance.sandbox.request(t,e),t.sendStopDrawRequest(!0)}),o.push(l),"point"!=e){var h=Oskari.clazz.create("Oskari.userinterface.component.Button");h.setTitle(s.finish),h.addClass("primary"),h.setHandler(function(){t.sendStopDrawRequest()}),o.push(h)}n.show(a,r,o),n.addClass("myplaces2"),n.moveTo("#toolbar div.toolrow[tbgroup=myplaces]","top")},sendStopDrawRequest:function(e){var t=this.instance.sandbox.getRequestBuilder("MyPlaces.StopDrawingRequest")(e);this.instance.sandbox.request(this,t),this.dialog&&this.dialog.close()},stop:function(){jQuery("div.myplaces2 div.button").die()},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{"Toolbar.ToolSelectedEvent":function(){this.ignoreEvents||(this.sendStopDrawRequest(!0),this.instance.enableGfi(!0))},"MyPlaces.MyPlaceSelectedEvent":function(e){if(!e.getPlace()){var t=this.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();this.instance.sandbox.request(this,t)}},"MyPlaces.FinishedDrawingEvent":function(){this.ignoreEvents=!0;var e=this.instance.sandbox.getRequestBuilder("Toolbar.SelectToolButtonRequest")();this.instance.sandbox.request(this,e),this.ignoreEvents=!1,this.instance.enableGfi(!1),this.dialog&&this.dialog.close()}}},{protocol:["Oskari.mapframework.module.Module"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.CategoryHandler",function(e){this.instance=e,this.initialLoad=!0,this.validateTool=Oskari.clazz.create("Oskari.userinterface.component.FormInput")},{__name:"MyPlacesCategoryHandler",getName:function(){return this.__name},init:function(){},start:function(){var e=this,t=this.instance.sandbox,i=t.getUser();if(i.isLoggedIn()){t.register(e);for(p in e.eventHandlers)t.registerForEventByName(e,p)}},stop:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},eventHandlers:{"MyPlaces.MyPlacesChangedEvent":function(){this._handlePlacesChanged()}},_handlePlacesChanged:function(){for(var e=this.instance.sandbox,t=e.getService("Oskari.mapframework.service.MapLayerService"),i=this.instance.getService().getAllCategories(),s=t.getAllLayersByMetaType(this.instance.idPrefix),a=0;s.length>a;++a){for(var r=s[a],n=!1,o=0;i.length>o;++o){var l=i[o];this._getMapLayerId(l.getId())===r.getId()&&(n=!0)}n||(e.requestByName(this.getName(),"RemoveMapLayerRequest",[r.getId()]),t.removeLayer(r.getId()))}for(var o=0;i.length>o;++o){for(var l=i[o],n=!1,a=0;s.length>a;++a)if(this._getMapLayerId(l.getId())===s[a].getId()&&(n=!0,l.getName()!==s[a].getName())){var h={name:l.getName()};t.updateLayer(s[a].getId(),h)}if(!n){var u=this._getMapLayerJson(l),p=t.createMapLayer(u);t.addLayer(p)}}this.initialLoad&&(this._processStartupLinkLayers(e),this.initialLoad=!1)},addLayerToMap:function(e){var t=this._getMapLayerId(e),i=this.sandbox.findMapLayerFromSelectedMapLayers(t);if(!i){var s=this.sandbox.getRequestBuilder("AddMapLayerRequest")(t,!0);this.sandbox.request(this.getName(),s)}},addLayerToService:function(e){var t=this._sandbox.getService("Oskari.mapframework.service.MapLayerService"),i=this._getMapLayerJson(e),s=t.createMapLayer(i);t.addLayer(s)},_getMapLayerId:function(e){if(!e){var t=this.myPlacesService.getDefaultCategory();e=t?t.getId():"-99"}return this.instance.idPrefix+"_"+e},_getMapLayerJson:function(e){var t=this._getMapLayerJsonBase();return t.wmsUrl=this.instance.conf.wmsUrl+e.getId()+"&",t.name=e.getName(),t.id=this._getMapLayerId(e.getId()),t.permissions=e.isPublic()?{publish:"publication_permission_ok"}:{publish:"no_publication_permission"},t},_getMapLayerJsonBase:function(){var e=this.instance.getLocalization("category"),t={wmsName:"ows:my_places_categories",type:"wmslayer",isQueryable:!0,opacity:50,metaType:this.instance.idPrefix,orgName:e.organization,inspire:e.inspire};return t},_processStartupLinkLayers:function(e){var t=e.getRequestParameter("mapLayers");if(null!==t&&""!==t)for(var i=t.split(","),s=!0,a=0;i.length>a;a++){var r=i[a].split("+"),n=r[0],o=r[1];if(null!==n&&-1!==n.indexOf(this.instance.idPrefix)){var l=null,h=null;l=e.getRequestBuilder("AddMapLayerRequest"),h=l(n,s),e.request(this.getName(),h),l=e.getRequestBuilder("ChangeMapLayerOpacityRequest"),h=l(n,o),e.request(this.getName(),h)}}},editCategory:function(e){var t=this;this.instance.sandbox.postRequestByName("DisableMapKeyboardMovementRequest");var i=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.view.CategoryForm",t.instance),s={name:e.getName(),id:e.getId(),dot:{size:e.getDotSize(),color:e.getDotColor()},line:{size:e.getLineWidth(),color:e.getLineColor()},area:{size:e.getAreaLineWidth(),lineColor:e.getAreaLineColor(),fillColor:e.getAreaFillColor()}};i.setValues(s);var a=i.getForm(),r=Oskari.clazz.create("Oskari.userinterface.component.Popup"),n=[],o=Oskari.clazz.create("Oskari.userinterface.component.Button"),l=this.instance.getLocalization("buttons"),h=this.instance.getLocalization("categoryform").edit;o.setTitle(l.save),o.addClass("primary"),o.setHandler(function(){var e=i.getValues(),s=t.validateCategoryFormValues(e);if(0!=s.length)return t.showValidationErrorMessage(s),void 0;var a=t.getCategoryFromFormValues(e);t.saveCategory(a),r.close(),t.instance.sandbox.postRequestByName("EnableMapKeyboardMovementRequest")});var u=Oskari.clazz.create("Oskari.userinterface.component.Button");u.setTitle(l.cancel),u.setHandler(function(){r.close()}),n.push(u),n.push(o),r.show(h.title,a,n),r.moveTo("div.personaldata ul li select","right"),r.makeModal()},showValidationErrorMessage:function(e){var t=this.instance.getLocalization(),i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=Oskari.clazz.create("Oskari.userinterface.component.Button");s.setTitle(t.buttons.ok),s.addClass("primary"),s.setHandler(function(){i.close(!0)});for(var a=jQuery("<ul></ul>"),r=0;e.length>r;++r){var n=jQuery("<li></li>");n.append(e[r].error),a.append(n)}i.show(t.validation.title,a,[s])},_showMessage:function(e,t){var i=this.instance.getLocalization(),s=Oskari.clazz.create("Oskari.userinterface.component.Popup"),a=Oskari.clazz.create("Oskari.userinterface.component.Button");a.setTitle(i.buttons.ok),a.addClass("primary"),a.setHandler(function(){s.close(!0)}),s.show(e,t,[a])},hasIllegalChars:function(e){return this.validateTool.setValue(e),!this.validateTool.checkValue()},_validateNumber:function(e,t,i){return this.validateTool.validateNumberRange(e,t,i)},_isColor:function(e){return this.validateTool.validateHexColor(e)},validateCategoryFormValues:function(e){var t=[];if(!e)return t;var i=this.instance.getLocalization("validation");return e.name?this.hasIllegalChars(e.name)&&t.push({field:"name",error:i.categoryNameIllegal}):t.push({field:"name",error:i.categoryName}),this._validateNumber(e.dot.size,1,50)||t.push({field:"dotSize",error:i.dotSize}),this._isColor(e.dot.color)||t.push({field:"dotColor",error:i.dotColor}),this._validateNumber(e.line.size,1,50)||t.push({field:"lineSize",error:i.lineSize}),this._isColor(e.line.color)||t.push({field:"lineColor",error:i.lineColor}),this._validateNumber(e.area.size,0,50)||t.push({field:"areaLineSize",error:i.areaLineSize}),this._isColor(e.area.lineColor)||t.push({field:"areaLineColor",error:i.areaLineColor}),this._isColor(e.area.fillColor)||t.push({field:"areaFillColor",error:i.areaFillColor}),t},getCategoryFromFormValues:function(e){var t=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.model.MyPlacesCategory");return t.setName(e.name),t.setId(e.id),t.setDotSize(e.dot.size),t.setDotColor(e.dot.color),t.setLineWidth(e.line.size),t.setLineColor(e.line.color),t.setAreaLineWidth(e.area.size),t.setAreaLineColor(e.area.lineColor),t.setAreaFillColor(e.area.fillColor),t},saveCategory:function(e){var t=this,i=t.instance.getLocalization("notification"),s=function(s,a,r){if(s){var n=Oskari.clazz.create("Oskari.userinterface.component.Popup");n.show(i.categorySaved.title,i.categorySaved.message),n.fadeout();var o=t._getMapLayerId(e.getId()),l=t.instance.sandbox.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest")(o,!0);t.instance.sandbox.request(t,l)}else r?t.instance.showMessage(i.error.title,i.error.addCategory):t.instance.showMessage(i.error.title,i.error.editCategory)};this.instance.getService().saveCategory(e,s)},confirmDeleteCategory:function(e){var t=this,i=t.instance.getLocalization("buttons"),s=this.instance.getService(),a=s.getDefaultCategory(),r=Oskari.clazz.create("Oskari.userinterface.component.Popup");if(a.getId()==e.getId()){var n=t.instance.getLocalization(),o=r.createCloseButton(n.buttons.ok);return r.show(n.notification.error.title,n.notification.error.deleteDefault,[o]),void 0}var l=s.getPlacesInCategory(e.getId()),h=[],u=r.createCloseButton(i.cancel);h.push(u);var n=t.instance.getLocalization("notification"),p="";if(l.length>0){var c=Oskari.clazz.create("Oskari.userinterface.component.Button");c.setTitle(i.deleteCategoryAndPlaces),c.setHandler(function(){r.close(),t._deleteCategory(e,!1)}),h.push(c);var d=Oskari.clazz.create("Oskari.userinterface.component.Button");d.setTitle(i.movePlaces),d.addClass("primary"),d.setHandler(function(){r.close(),t._deleteCategory(e,!0)}),h.push(d);var m=[e.getName(),l.length,a.getName()];p=this._formatMessage(n.categoryDelete.deleteConfirmMove,m)}else{var c=Oskari.clazz.create("Oskari.userinterface.component.Button");c.setTitle(i.deleteCategory),c.addClass("primary"),h.push(c),c.setHandler(function(){r.close(),t._deleteCategory(e,!1)}),p=this._formatMessage(n.categoryDelete.deleteConfirm,[e.getName()])}r.show(n.categoryDelete.title,p,h),r.makeModal()},_formatMessage:function(e,t){for(var i=e,s=0;t.length>s;++s)i=i.replace("{"+s+"}",t[s]);return i},_deleteCategory:function(e,t){var i=this,s=e.getId(),a=function(e){i._deleteCategoryCallback(e,t,s)},r=this.instance.getService();r.deleteCategory(s,t,a)},_deleteCategoryCallback:function(e,t){var i=Oskari.clazz.create("Oskari.userinterface.component.Popup"),s=this.instance.getService(),a=this;if(e){if(t){var r=s.getDefaultCategory(),n=this._getMapLayerId(r.getId()),o=this.instance.sandbox.getRequestBuilder("MapModulePlugin.MapLayerUpdateRequest")(n,!0);this.instance.sandbox.request(this,o)}var l=a.instance.getLocalization();i.show(l.notification.categoryDelete.title,l.notification.categoryDelete.deleted),i.fadeout()}else{var l=a.instance.getLocalization(),h=i.createCloseButton(btnLoc.buttons.ok);i.show(l.notification.error.title,l.notification.error.deleteCategory,[h])}},confirmPublishCategory:function(e,t){var i=this,s=i.instance.getLocalization(),a=Oskari.clazz.create("Oskari.userinterface.component.Popup"),r=this.instance.getService(),n=[],o=a.createCloseButton(s.buttons.cancel);n.push(o);var l=Oskari.clazz.create("Oskari.userinterface.component.Button");l.addClass("primary"),l.setHandler(function(){r.publishCategory(e.getId(),t,function(s){i._handlePublishCategory(e,t,s)}),a.close()}),n.push(l);var h=[e.getName()];if(t){l.setTitle(s.buttons.changeToPublic);var u=this._formatMessage(s.notification.categoryToPublic.message,h);a.show(s.notification.categoryToPublic.title,u,n)}else{l.setTitle(s.buttons.changeToPrivate);var u=this._formatMessage(s.notification.categoryToPrivate.message,h);a.show(s.notification.categoryToPrivate.title,u,n)}},_handlePublishCategory:function(e,t,i){if(!i){var s=this.instance.getLocalization("notification");return this._showMessage(s.error.title,s.error.generic),void 0}var a=this.instance.sandbox,r=a.getService("Oskari.mapframework.service.MapLayerService"),n=this._getMapLayerId(e.getId()),o=r.findMapLayer(n);if(!o){var s=this.instance.getLocalization("notification");return this._showMessage(s.error.title,s.error.generic),void 0}t?o.addPermission("publish","publication_permission_ok"):o.addPermission("publish","no_publication_permission");var l=a.getEventBuilder("MapLayerEvent")(n,"update");a.notifyAll(l)}},{protocol:["Oskari.mapframework.module.Module"]}),Oskari.clazz.define("Oskari.mapframework.bundle.myplaces2.MyPlacesBundleInstance",function(){this._localization=null,this.sandbox=null,this.buttons=void 0,this.categoryHandler=void 0,this.myPlacesService=void 0,this.idPrefix="myplaces"},{__name:"MyPlaces2",getName:function(){return this.__name},getSandbox:function(){return this.sandbox},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization&&this._localization[e]?this._localization[e]:e:this._localization},showMessage:function(e,t){var i=this.instance.getLocalization(),s=Oskari.clazz.create("Oskari.userinterface.component.Popup"),a=Oskari.clazz.create("Oskari.userinterface.component.Button");a.setTitle(i.buttons.ok),a.addClass("primary"),a.setHandler(function(){s.close(!0)}),s.show(e,t,[a])},enableGfi:function(e){var t=this.sandbox.getRequestBuilder("MapModulePlugin.GetFeatureInfoActivationRequest");t&&this.sandbox.request(this.buttons,t(e))},getService:function(){return this.myPlacesService},getDrawPlugin:function(){return this.view.drawPlugin},getCategoryHandler:function(){return this.categoryHandler},getMainView:function(){return this.view},update:function(){},start:function(){var e=Oskari.$("sandbox");this.sandbox=e;var t=this;e.printDebug("Initializing my places module..."),this.buttons=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.ButtonHandler",this),this.buttons.start();var i=e.getUser();if(i.isLoggedIn()){this.categoryHandler=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.CategoryHandler",this),this.categoryHandler.start();var s=this.getLocalization("category").defaultName,a=this.conf.queryUrl;this.myPlacesService=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.service.MyPlacesService",a,i.getUuid(),e,s),this.sandbox.registerService(this.myPlacesService),this.myPlacesService.init(),this.view=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.view.MainView",this),this.view.start(),this.editRequestHandler=Oskari.clazz.create("Oskari.mapframework.bundle.myplaces2.request.EditRequestHandler",e,t),e.addRequestHandler("MyPlaces.EditPlaceRequest",this.editRequestHandler),e.addRequestHandler("MyPlaces.EditCategoryRequest",this.editRequestHandler),e.addRequestHandler("MyPlaces.DeleteCategoryRequest",this.editRequestHandler),e.addRequestHandler("MyPlaces.PublishCategoryRequest",this.editRequestHandler)}},stop:function(){this.sandbox=null}},{protocol:["Oskari.bundle.BundleInstance"]});var jscolor={dir:"",bindClass:"color",binding:!0,preloading:!0,install:function(){jscolor.addEvent(window,"load",jscolor.init)},init:function(){jscolor.binding&&jscolor.bind(),jscolor.preloading&&jscolor.preload()},getDir:function(){if(!jscolor.dir){var e=jscolor.detectDir();jscolor.dir=e!==!1?e:"jscolor/"}return jscolor.dir},detectDir:function(){for(var e=location.href,t=document.getElementsByTagName("base"),i=0;t.length>i;i+=1)t[i].href&&(e=t[i].href);for(var t=document.getElementsByTagName("script"),i=0;t.length>i;i+=1)if(t[i].src&&/(^|\/)jscolor\.js([?#].*)?$/i.test(t[i].src)){var s=new jscolor.URI(t[i].src),a=s.toAbsolute(e);return a.path=a.path.replace(/[^\/]+$/,""),a.query=null,a.fragment=null,""+a}return!1},bind:function(){for(var matchClass=RegExp("(^|\\s)("+jscolor.bindClass+")\\s*(\\{[^}]*\\})?","i"),e=document.getElementsByTagName("input"),i=0;e.length>i;i+=1){var m;if(!e[i].color&&e[i].className&&(m=e[i].className.match(matchClass))){var prop={};if(m[3])try{eval("prop="+m[3])}catch(eInvalidProp){}e[i].color=new jscolor.color(e[i],prop)}}},preload:function(){for(var e in jscolor.imgRequire)jscolor.imgRequire.hasOwnProperty(e)&&jscolor.loadImage(e)},images:{pad:[181,101],sld:[16,101],cross:[15,15],arrow:[7,11]},imgRequire:{},imgLoaded:{},requireImage:function(e){jscolor.imgRequire[e]=!0},loadImage:function(e){jscolor.imgLoaded[e]||(jscolor.imgLoaded[e]=new Image,jscolor.imgLoaded[e].src=jscolor.getDir()+e)},fetchElement:function(e){return"string"==typeof e?document.getElementById(e):e},addEvent:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)},fireEvent:function(e,t){if(e)if(document.createEvent){var i=document.createEvent("HTMLEvents");i.initEvent(t,!0,!0),e.dispatchEvent(i)}else if(document.createEventObject){var i=document.createEventObject();e.fireEvent("on"+t,i)}else e["on"+t]&&e["on"+t]()},getElementPos:function(e){var t=e,i=e,s=0,a=0;if(t.offsetParent)do s+=t.offsetLeft,a+=t.offsetTop;while(t=t.offsetParent);for(;(i=i.parentNode)&&"BODY"!==i.nodeName.toUpperCase();)s-=i.scrollLeft,a-=i.scrollTop;return[s,a]},getElementSize:function(e){return[e.offsetWidth,e.offsetHeight]},getRelMousePos:function(e){var t=0,i=0;return e||(e=window.event),"number"==typeof e.offsetX?(t=e.offsetX,i=e.offsetY):"number"==typeof e.layerX&&(t=e.layerX,i=e.layerY),{x:t,y:i}},getViewPos:function(){return"number"==typeof window.pageYOffset?[window.pageXOffset,window.pageYOffset]:document.body&&(document.body.scrollLeft||document.body.scrollTop)?[document.body.scrollLeft,document.body.scrollTop]:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)?[document.documentElement.scrollLeft,document.documentElement.scrollTop]:[0,0]},getViewSize:function(){return"number"==typeof window.innerWidth?[window.innerWidth,window.innerHeight]:document.body&&(document.body.clientWidth||document.body.clientHeight)?[document.body.clientWidth,document.body.clientHeight]:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?[document.documentElement.clientWidth,document.documentElement.clientHeight]:[0,0]},URI:function(e){function t(e){for(var t="";e;)if("../"===e.substr(0,3)||"./"===e.substr(0,2))e=e.replace(/^\.+/,"").substr(1);else if("/./"===e.substr(0,3)||"/."===e)e="/"+e.substr(3);else if("/../"===e.substr(0,4)||"/.."===e)e="/"+e.substr(4),t=t.replace(/\/?[^\/]*$/,"");else if("."===e||".."===e)e="";else{var i=e.match(/^\/?[^\/]*/)[0];e=e.substr(i.length),t+=i}return t}this.scheme=null,this.authority=null,this.path="",this.query=null,this.fragment=null,this.parse=function(e){var t=e.match(/^(([A-Za-z][0-9A-Za-z+.-]*)(:))?((\/\/)([^\/?#]*))?([^?#]*)((\?)([^#]*))?((#)(.*))?/);return this.scheme=t[3]?t[2]:null,this.authority=t[5]?t[6]:null,this.path=t[7],this.query=t[9]?t[10]:null,this.fragment=t[12]?t[13]:null,this},this.toString=function(){var e="";return null!==this.scheme&&(e=e+this.scheme+":"),null!==this.authority&&(e=e+"//"+this.authority),null!==this.path&&(e+=this.path),null!==this.query&&(e=e+"?"+this.query),null!==this.fragment&&(e=e+"#"+this.fragment),e},this.toAbsolute=function(e){var e=new jscolor.URI(e),i=this,s=new jscolor.URI;return null===e.scheme?!1:(null!==i.scheme&&i.scheme.toLowerCase()===e.scheme.toLowerCase()&&(i.scheme=null),null!==i.scheme?(s.scheme=i.scheme,s.authority=i.authority,s.path=t(i.path),s.query=i.query):(null!==i.authority?(s.authority=i.authority,s.path=t(i.path),s.query=i.query):(""===i.path?(s.path=e.path,s.query=null!==i.query?i.query:e.query):("/"===i.path.substr(0,1)?s.path=t(i.path):(s.path=null!==e.authority&&""===e.path?"/"+i.path:e.path.replace(/[^\/]+$/,"")+i.path,s.path=t(s.path)),s.query=i.query),s.authority=e.authority),s.scheme=e.scheme),s.fragment=i.fragment,s)},e&&this.parse(e)},color:function(target,prop){function RGB_HSV(e,t,i){var s=Math.min(Math.min(e,t),i),a=Math.max(Math.max(e,t),i),r=a-s;if(0===r)return[null,0,a];var n=e===s?3+(i-t)/r:t===s?5+(e-i)/r:1+(t-e)/r;return[6===n?0:n,r/a,a]}function HSV_RGB(e,t,i){if(null===e)return[i,i,i];var s=Math.floor(e),a=s%2?e-s:1-(e-s),r=i*(1-t),n=i*(1-t*a);switch(s){case 6:case 0:return[i,n,r];case 1:return[n,i,r];case 2:return[r,i,n];case 3:return[r,n,i];case 4:return[n,r,i];case 5:return[i,r,n]}}function removePicker(){delete jscolor.picker.owner,document.getElementsByTagName("body")[0].removeChild(jscolor.picker.boxB)}function drawPicker(e,t){function i(){var e=THIS.pickerInsetColor.split(/\s+/),t=2>e.length?e[0]:e[1]+" "+e[0]+" "+e[0]+" "+e[1];n.btn.style.borderColor=t}if(!jscolor.picker){jscolor.picker={box:document.createElement("div"),boxB:document.createElement("div"),pad:document.createElement("div"),padB:document.createElement("div"),padM:document.createElement("div"),sld:document.createElement("div"),sldB:document.createElement("div"),sldM:document.createElement("div"),btn:document.createElement("div"),btnS:document.createElement("span"),btnT:document.createTextNode(THIS.pickerCloseText)};for(var s=0,a=4;jscolor.images.sld[1]>s;s+=a){var r=document.createElement("div");r.style.height=a+"px",r.style.fontSize="1px",r.style.lineHeight="0",jscolor.picker.sld.appendChild(r)}jscolor.picker.sldB.appendChild(jscolor.picker.sld),jscolor.picker.box.appendChild(jscolor.picker.sldB),jscolor.picker.box.appendChild(jscolor.picker.sldM),jscolor.picker.padB.appendChild(jscolor.picker.pad),jscolor.picker.box.appendChild(jscolor.picker.padB),jscolor.picker.box.appendChild(jscolor.picker.padM),jscolor.picker.btnS.appendChild(jscolor.picker.btnT),jscolor.picker.btn.appendChild(jscolor.picker.btnS),jscolor.picker.box.appendChild(jscolor.picker.btn),jscolor.picker.boxB.appendChild(jscolor.picker.box)}var n=jscolor.picker;n.box.onmouseup=n.box.onmouseout=function(){target.focus()},n.box.onmousedown=function(){abortBlur=!0},n.box.onmousemove=function(e){(holdPad||holdSld)&&(holdPad&&setPad(e),holdSld&&setSld(e),document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),dispatchImmediateChange())},n.padM.onmouseup=n.padM.onmouseout=function(){holdPad&&(holdPad=!1,jscolor.fireEvent(valueElement,"change"))},n.padM.onmousedown=function(e){switch(modeID){case 0:0===THIS.hsv[2]&&THIS.fromHSV(null,null,1);break;case 1:0===THIS.hsv[1]&&THIS.fromHSV(null,1,null)}holdPad=!0,setPad(e),dispatchImmediateChange()},n.sldM.onmouseup=n.sldM.onmouseout=function(){holdSld&&(holdSld=!1,jscolor.fireEvent(valueElement,"change"))},n.sldM.onmousedown=function(e){holdSld=!0,setSld(e),dispatchImmediateChange()};var o=getPickerDims(THIS);n.box.style.width=o[0]+"px",n.box.style.height=o[1]+"px",n.boxB.style.position="absolute",n.boxB.style.clear="both",n.boxB.style.left=e+"px",n.boxB.style.top=t+"px",n.boxB.style.zIndex=THIS.pickerZIndex,n.boxB.style.border=THIS.pickerBorder+"px solid",n.boxB.style.borderColor=THIS.pickerBorderColor,n.boxB.style.background=THIS.pickerFaceColor,n.pad.style.width=jscolor.images.pad[0]+"px",n.pad.style.height=jscolor.images.pad[1]+"px",n.padB.style.position="absolute",n.padB.style.left=THIS.pickerFace+"px",n.padB.style.top=THIS.pickerFace+"px",n.padB.style.border=THIS.pickerInset+"px solid",n.padB.style.borderColor=THIS.pickerInsetColor,n.padM.style.position="absolute",n.padM.style.left="0",n.padM.style.top="0",n.padM.style.width=THIS.pickerFace+2*THIS.pickerInset+jscolor.images.pad[0]+jscolor.images.arrow[0]+"px",n.padM.style.height=n.box.style.height,n.padM.style.cursor="crosshair",n.sld.style.overflow="hidden",n.sld.style.width=jscolor.images.sld[0]+"px",n.sld.style.height=jscolor.images.sld[1]+"px",n.sldB.style.display=THIS.slider?"block":"none",n.sldB.style.position="absolute",n.sldB.style.right=THIS.pickerFace+"px",n.sldB.style.top=THIS.pickerFace+"px",n.sldB.style.border=THIS.pickerInset+"px solid",n.sldB.style.borderColor=THIS.pickerInsetColor,n.sldM.style.display=THIS.slider?"block":"none",n.sldM.style.position="absolute",n.sldM.style.right="0",n.sldM.style.top="0",n.sldM.style.width=jscolor.images.sld[0]+jscolor.images.arrow[0]+THIS.pickerFace+2*THIS.pickerInset+"px",n.sldM.style.height=n.box.style.height;try{n.sldM.style.cursor="pointer"}catch(l){n.sldM.style.cursor="hand"}n.btn.style.display=THIS.pickerClosable?"block":"none",n.btn.style.position="absolute",n.btn.style.left=THIS.pickerFace+"px",n.btn.style.bottom=THIS.pickerFace+"px",n.btn.style.padding="0 15px",n.btn.style.height="18px",n.btn.style.border=THIS.pickerInset+"px solid",i(),n.btn.style.color=THIS.pickerButtonColor,n.btn.style.font="12px sans-serif",n.btn.style.textAlign="center";try{n.btn.style.cursor="pointer"}catch(l){n.btn.style.cursor="hand"}switch(n.btn.onmousedown=function(){THIS.hidePicker()},n.btnS.style.lineHeight=n.btn.style.height,modeID){case 0:var h="hs.png";break;case 1:var h="hv.png"}n.padM.style.backgroundImage="url('"+jscolor.getDir()+"cross.gif')",n.padM.style.backgroundRepeat="no-repeat",n.sldM.style.backgroundImage="url('"+jscolor.getDir()+"arrow.gif')",n.sldM.style.backgroundRepeat="no-repeat",n.pad.style.backgroundImage="url('"+jscolor.getDir()+h+"')",n.pad.style.backgroundRepeat="no-repeat",n.pad.style.backgroundPosition="0 0",redrawPad(),redrawSld(),jscolor.picker.owner=THIS,document.getElementsByTagName("body")[0].appendChild(n.boxB)}function getPickerDims(e){var t=[2*e.pickerInset+2*e.pickerFace+jscolor.images.pad[0]+(e.slider?2*e.pickerInset+2*jscolor.images.arrow[0]+jscolor.images.sld[0]:0),e.pickerClosable?4*e.pickerInset+3*e.pickerFace+jscolor.images.pad[1]+e.pickerButtonHeight:2*e.pickerInset+2*e.pickerFace+jscolor.images.pad[1]];return t}function redrawPad(){switch(modeID){case 0:var e=1;break;case 1:var e=2}var t=Math.round(THIS.hsv[0]/6*(jscolor.images.pad[0]-1)),i=Math.round((1-THIS.hsv[e])*(jscolor.images.pad[1]-1));jscolor.picker.padM.style.backgroundPosition=THIS.pickerFace+THIS.pickerInset+t-Math.floor(jscolor.images.cross[0]/2)+"px "+(THIS.pickerFace+THIS.pickerInset+i-Math.floor(jscolor.images.cross[1]/2))+"px";var s=jscolor.picker.sld.childNodes;switch(modeID){case 0:for(var a=HSV_RGB(THIS.hsv[0],THIS.hsv[1],1),r=0;s.length>r;r+=1)s[r].style.backgroundColor="rgb("+100*a[0]*(1-r/s.length)+"%,"+100*a[1]*(1-r/s.length)+"%,"+100*a[2]*(1-r/s.length)+"%)";break;case 1:var a,n,o=[THIS.hsv[2],0,0],r=Math.floor(THIS.hsv[0]),l=r%2?THIS.hsv[0]-r:1-(THIS.hsv[0]-r);switch(r){case 6:case 0:a=[0,1,2];break;case 1:a=[1,0,2];break;case 2:a=[2,0,1];break;case 3:a=[2,1,0];break;case 4:a=[1,2,0];break;case 5:a=[0,2,1]}for(var r=0;s.length>r;r+=1)n=1-1/(s.length-1)*r,o[1]=o[0]*(1-n*l),o[2]=o[0]*(1-n),s[r].style.backgroundColor="rgb("+100*o[a[0]]+"%,"+100*o[a[1]]+"%,"+100*o[a[2]]+"%)"}}function redrawSld(){switch(modeID){case 0:var e=2;break;case 1:var e=1}var t=Math.round((1-THIS.hsv[e])*(jscolor.images.sld[1]-1));jscolor.picker.sldM.style.backgroundPosition="0 "+(THIS.pickerFace+THIS.pickerInset+t-Math.floor(jscolor.images.arrow[1]/2))+"px"}function isPickerOwner(){return jscolor.picker&&jscolor.picker.owner===THIS}function blurTarget(){valueElement===target&&THIS.importColor(),THIS.pickerOnfocus&&THIS.hidePicker()}function blurValue(){valueElement!==target&&THIS.importColor()}function setPad(e){var t=jscolor.getRelMousePos(e),i=t.x-THIS.pickerFace-THIS.pickerInset,s=t.y-THIS.pickerFace-THIS.pickerInset;switch(modeID){case 0:THIS.fromHSV(i*(6/(jscolor.images.pad[0]-1)),1-s/(jscolor.images.pad[1]-1),null,leaveSld);break;case 1:THIS.fromHSV(i*(6/(jscolor.images.pad[0]-1)),null,1-s/(jscolor.images.pad[1]-1),leaveSld)}}function setSld(e){var t=jscolor.getRelMousePos(e),i=t.y-THIS.pickerFace-THIS.pickerInset;switch(modeID){case 0:THIS.fromHSV(null,null,1-i/(jscolor.images.sld[1]-1),leavePad);break;case 1:THIS.fromHSV(null,1-i/(jscolor.images.sld[1]-1),null,leavePad)}}function dispatchImmediateChange(){THIS.onImmediateChange&&("string"==typeof THIS.onImmediateChange?eval(THIS.onImmediateChange):THIS.onImmediateChange(THIS))}this.required=!0,this.adjust=!0,this.hash=!1,this.caps=!0,this.slider=!0,this.valueElement=target,this.styleElement=target,this.onImmediateChange=null,this.hsv=[0,0,1],this.rgb=[1,1,1],this.pickerOnfocus=!0,this.pickerMode="HSV",this.pickerPosition="bottom",this.pickerSmartPosition=!0,this.pickerButtonHeight=20,this.pickerClosable=!1,this.pickerCloseText="Close",this.pickerButtonColor="ButtonText",this.pickerFace=10,this.pickerFaceColor="ThreeDFace",this.pickerBorder=1,this.pickerBorderColor="ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight",this.pickerInset=1,this.pickerInsetColor="ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow",this.pickerZIndex=1e4;for(var p in prop)prop.hasOwnProperty(p)&&(this[p]=prop[p]);this.hidePicker=function(){isPickerOwner()&&removePicker()},this.showPicker=function(){if(!isPickerOwner()){var e,t,i,s=jscolor.getElementPos(target),a=jscolor.getElementSize(target),r=jscolor.getViewPos(),n=jscolor.getViewSize(),o=getPickerDims(this);switch(this.pickerPosition.toLowerCase()){case"left":e=1,t=0,i=-1;break;case"right":e=1,t=0,i=1;break;case"top":e=0,t=1,i=-1;break;default:e=0,t=1,i=1}var l=(a[t]+o[t])/2;if(this.pickerSmartPosition)var h=[-r[e]+s[e]+o[e]>n[e]?-r[e]+s[e]+a[e]/2>n[e]/2&&s[e]+a[e]-o[e]>=0?s[e]+a[e]-o[e]:s[e]:s[e],-r[t]+s[t]+a[t]+o[t]-l+l*i>n[t]?-r[t]+s[t]+a[t]/2>n[t]/2&&s[t]+a[t]-l-l*i>=0?s[t]+a[t]-l-l*i:s[t]+a[t]-l+l*i:s[t]+a[t]-l+l*i>=0?s[t]+a[t]-l+l*i:s[t]+a[t]-l-l*i];else var h=[s[e],s[t]+a[t]-l+l*i];drawPicker(h[e],h[t])}},this.importColor=function(){valueElement?this.adjust?!this.required&&/^\s*$/.test(valueElement.value)?(valueElement.value="",styleElement.style.backgroundImage=styleElement.jscStyle.backgroundImage,styleElement.style.backgroundColor=styleElement.jscStyle.backgroundColor,styleElement.style.color=styleElement.jscStyle.color,this.exportColor(leaveValue|leaveStyle)):this.fromString(valueElement.value)||this.exportColor():this.fromString(valueElement.value,leaveValue)||(styleElement.style.backgroundImage=styleElement.jscStyle.backgroundImage,styleElement.style.backgroundColor=styleElement.jscStyle.backgroundColor,styleElement.style.color=styleElement.jscStyle.color,this.exportColor(leaveValue|leaveStyle)):this.exportColor()},this.exportColor=function(e){if(!(e&leaveValue)&&valueElement){var t=""+this;this.caps&&(t=t.toUpperCase()),this.hash&&(t="#"+t),valueElement.value=t}e&leaveStyle||!styleElement||(styleElement.style.backgroundImage="none",styleElement.style.backgroundColor="#"+(""+this),styleElement.style.color=.5>.213*this.rgb[0]+.715*this.rgb[1]+.072*this.rgb[2]?"#FFF":"#000"),e&leavePad||!isPickerOwner()||redrawPad(),e&leaveSld||!isPickerOwner()||redrawSld()},this.fromHSV=function(e,t,i,s){0>e&&(e=0)||e>6&&(e=6),0>t&&(t=0)||t>1&&(t=1),0>i&&(i=0)||i>1&&(i=1),this.rgb=HSV_RGB(null===e?this.hsv[0]:this.hsv[0]=e,null===t?this.hsv[1]:this.hsv[1]=t,null===i?this.hsv[2]:this.hsv[2]=i),this.exportColor(s)},this.fromRGB=function(e,t,i,s){0>e&&(e=0)||e>1&&(e=1),0>t&&(t=0)||t>1&&(t=1),0>i&&(i=0)||i>1&&(i=1);var a=RGB_HSV(null===e?this.rgb[0]:this.rgb[0]=e,null===t?this.rgb[1]:this.rgb[1]=t,null===i?this.rgb[2]:this.rgb[2]=i);null!==a[0]&&(this.hsv[0]=a[0]),0!==a[2]&&(this.hsv[1]=a[1]),this.hsv[2]=a[2],this.exportColor(s)},this.fromString=function(e,t){var i=e.match(/^\W*([0-9A-F]{3}([0-9A-F]{3})?)\W*$/i);return i?(6===i[1].length?this.fromRGB(parseInt(i[1].substr(0,2),16)/255,parseInt(i[1].substr(2,2),16)/255,parseInt(i[1].substr(4,2),16)/255,t):this.fromRGB(parseInt(i[1].charAt(0)+i[1].charAt(0),16)/255,parseInt(i[1].charAt(1)+i[1].charAt(1),16)/255,parseInt(i[1].charAt(2)+i[1].charAt(2),16)/255,t),!0):!1},this.toString=function(){return(256|Math.round(255*this.rgb[0])).toString(16).substr(1)+(256|Math.round(255*this.rgb[1])).toString(16).substr(1)+(256|Math.round(255*this.rgb[2])).toString(16).substr(1)
};var THIS=this,modeID="hvs"===this.pickerMode.toLowerCase()?1:0,abortBlur=!1,valueElement=jscolor.fetchElement(this.valueElement),styleElement=jscolor.fetchElement(this.styleElement),holdPad=!1,holdSld=!1,leaveValue=1,leaveStyle=2,leavePad=4,leaveSld=8;if(jscolor.addEvent(target,"focus",function(){THIS.pickerOnfocus&&THIS.showPicker()}),jscolor.addEvent(target,"blur",function(){abortBlur?abortBlur=!1:window.setTimeout(function(){abortBlur||blurTarget(),abortBlur=!1},0)}),valueElement){var updateField=function(){THIS.fromString(valueElement.value,leaveValue),dispatchImmediateChange()};jscolor.addEvent(valueElement,"keyup",updateField),jscolor.addEvent(valueElement,"input",updateField),jscolor.addEvent(valueElement,"blur",blurValue),valueElement.setAttribute("autocomplete","off")}switch(styleElement&&(styleElement.jscStyle={backgroundImage:styleElement.style.backgroundImage,backgroundColor:styleElement.style.backgroundColor,color:styleElement.style.color}),modeID){case 0:jscolor.requireImage("hs.png");break;case 1:jscolor.requireImage("hv.png")}jscolor.requireImage("cross.gif"),jscolor.requireImage("arrow.gif"),this.importColor()}};jscolor.install(),Oskari.clazz.define("Oskari.framework.bundle.guidedtour.GuidedTourBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.framework.bundle.guidedtour.GuidedTourBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/guidedtour/instance.js"},{type:"text/javascript",src:"../../../../resources/framework/bundle/guidedtour/js/jquery.cookie.js"},{type:"text/css",src:"../../../../resources/framework/bundle/guidedtour/css/style.css"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/guidedtour/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/guidedtour/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/guidedtour/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"guidedtour","Bundle-Name":"guidedtour","Bundle-Author":[{Name:"ev",Organisation:"nls.fi",Temporal:{Start:"2009",End:"2011"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:" style-1",Title:" style-1"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("guidedtour","Oskari.framework.bundle.guidedtour.GuidedTourBundle"),Oskari.clazz.define("Oskari.framework.bundle.guidedtour.GuidedTourBundleInstance",function(){this.sandbox=null,this._localization=null,this.mediator=null,this.guideStep=0},{__name:"GuidedTour",getName:function(){return this.__name},getTitle:function(){return this.getLocalization("title")},getDescription:function(){return this.getLocalization("desc")},getSandbox:function(){return this.sandbox},update:function(){},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},start:function(){if("1"!=jQuery.cookie("pti_tour_seen")){var e=this,t=Oskari.$("sandbox");this.sandbox=t,this.localization=Oskari.getLocalization(this.getName()),t.register(e),e._startGuide()}},_startGuide:function(){this.guideStep=0;var e="Oskari.userinterface.component.Popup",t=Oskari.clazz.create(e);t.makeDraggable(),t.addClass("guidedtour"),this._showGuideContentForStep(this.guideStep,t)},_guideSteps:[{appendTourSeenCheckbox:!0,setScope:function(e){this.ref=e},getTitle:function(){return this.ref.getLocalization("page1").title},getContent:function(){var e=this.ref;e.getLocalization("page1");var t=jQuery("<div></div>");return t.append(this.ref.getLocalization("page1").message),t}},{setScope:function(e){this.ref=e},getTitle:function(){return""+this.ref.getLocalization("page2").title+"<span>1/8</span>"},getContent:function(){var e=this.ref;e._openExtension("Search");var t=e.getLocalization("page2"),i=jQuery("<div></div>");i.append(t.message);var s=jQuery('<a href="#"></a>'),a=s.clone();a.append(t.openLink),a.bind("click",function(){e._openExtension("Search"),a.hide(),r.show()});var r=s.clone();return r.append(t.closeLink),r.bind("click",function(){e._closeExtension("Search"),a.show(),r.hide()}),i.append("<br /><br />"),i.append(a),i.append(r),r.show(),a.hide(),i}},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref.getLocalization("page3").title;return e+"<span>2/8</span>"},getContent:function(){var e=this.ref;e._openExtension("LayerSelector");var t=e.getLocalization("page3"),i=jQuery("<div></div>");i.append(t.message);var s=jQuery('<a href="#"></a>'),a=s.clone();a.append(t.openLink),a.bind("click",function(){e._openExtension("LayerSelector"),a.hide(),r.show()});var r=s.clone();return r.append(t.closeLink),r.bind("click",function(){e._closeExtension("LayerSelector"),a.show(),r.hide()}),i.append("<br><br>"),i.append(a),i.append(r),r.show(),a.hide(),i}},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref.getLocalization("page4").title;return e+"<span>3/8</span>"},getContent:function(){var e=this.ref;e._openExtension("LayerSelection");var t=e.getLocalization("page4"),i=jQuery("<div></div>");i.append(t.message);var s=jQuery('<a href="#"></a>'),a=s.clone();a.append(t.openLink),a.bind("click",function(){e._openExtension("LayerSelection"),a.hide(),r.show()});var r=s.clone();return r.append(t.closeLink),r.bind("click",function(){e._closeExtension("LayerSelection"),a.show(),r.hide()}),i.append("<br><br>"),i.append(a),i.append(r),r.show(),a.hide(),i}},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref.getLocalization("page5").title;return e+"<span>4/8</span>"},getContent:function(){var e=this.ref;e._openExtension("PersonalData");var t=e.getLocalization("page5"),i=jQuery("<div></div>");i.append(t.message);var s=jQuery('<a href="#"></a>'),a=s.clone();a.append(t.openLink),a.bind("click",function(){e._openExtension("PersonalData"),a.hide(),r.show()});var r=s.clone();return r.append(t.closeLink),r.bind("click",function(){e._closeExtension("PersonalData"),a.show(),r.hide()}),i.append("<br><br>"),i.append(a),i.append(r),r.show(),a.hide(),i}},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref.getLocalization("page6").title;return e+"<span>5/8</span>"},getContent:function(){var e=this.ref;e._openExtension("Publisher");var t=e.getLocalization("page6"),i=jQuery("<div></div>");i.append(t.message);var s=jQuery('<a href="#"></a>'),a=s.clone();a.append(t.openLink),a.bind("click",function(){e._openExtension("Publisher"),a.hide(),r.show()});var r=s.clone();return r.append(t.closeLink),r.bind("click",function(){e._closeExtension("Publisher"),a.show(),r.hide()}),i.append("<br><br>"),i.append(a),i.append(r),r.show(),a.hide(),i}},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref.getLocalization("page7").title;return e+"<span>6/8</span>"},getContent:function(){var e=this.ref;e._closeExtension("Publisher");var t=e.getLocalization("page7"),i=jQuery("<div></div>");return i.append(t.message),i},getPositionRef:function(){return jQuery("#toolbar")},positionAlign:"right"},{setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref.getLocalization("page8").title;return e+"<span>7/8</span>"},getContent:function(){var e=this.ref,t=e.getLocalization("page8"),i=jQuery("<div></div>");return i.append(t.message),i},getPositionRef:function(){return jQuery(".panbuttonDiv")},positionAlign:"left"},{appendTourSeenCheckbox:!0,setScope:function(e){this.ref=e},getTitle:function(){var e=this.ref.getLocalization("page9").title;return e+"<span>8/8</span>"},getContent:function(){var e=this.ref,t=e.getLocalization("page9"),i=jQuery("<div></div>");return i.append(t.message),i},getPositionRef:function(){return jQuery(".pzbDiv")},positionAlign:"left"}],_showGuideContentForStep:function(e,t){var i=this._guideSteps[e];i.setScope(this);var s=this._getDialogButton(t),a=i.getTitle(),r=i.getContent();if(i.appendTourSeenCheckbox){r.append("<br><br>");var n=jQuery('<input type="checkbox" name="pti_tour_seen" id="pti_tour_seen" value="1">'),o=n.clone(),l=jQuery('<label for="pti_tour_seen"></label>'),h=l.clone();h.append(this.getLocalization("tourseen").label),o.bind("change",function(){jQuery(this).attr("checked")?jQuery.cookie("pti_tour_seen","1",{expires:365}):jQuery.cookie("pti_tour_seen","0",{expires:1})}),r.append(o),r.append("&nbsp;"),r.append(h)}t.show(a,r,s),i.getPositionRef?t.moveTo(i.getPositionRef(),i.positionAlign):t.resetPosition()},_getFakeExtension:function(e){return{getName:function(){return e}}},_openExtension:function(e){var t=this._getFakeExtension(e),i="userinterface.UpdateExtensionRequest";this.sandbox.postRequestByName(i,[t,"attach"])},_closeExtension:function(e){var t=this._getFakeExtension(e),i="userinterface.UpdateExtensionRequest";this.sandbox.postRequestByName(i,[t,"close"])},_getDialogButton:function(e){var t=this,i=[],s="!button.close!";this.localization&&this.localization.button&&this.localization.button.previous&&(s=this.localization.button.close);var a=e.createCloseButton(s);if(i.push(a),this.guideStep>1){var r="Oskari.userinterface.component.Button",n=Oskari.clazz.create(r),o="!button.previous!";this.localization&&this.localization.button&&this.localization.button.previous&&(o=this.localization.button.previous),n.setTitle(o),n.setHandler(function(){t.guideStep--,t._showGuideContentForStep(t.guideStep,e)}),i.push(n)}if(0==this.guideStep){var r="Oskari.userinterface.component.Button",l=Oskari.clazz.create(r),h="!button.start!";this.localization&&this.localization.button&&this.localization.button.start&&(h=this.localization.button.start),l.setTitle(h),l.setHandler(function(){t.guideStep++,t._showGuideContentForStep(t.guideStep,e)}),i.push(l)}else if(this.guideStep<this._guideSteps.length-1){var r="Oskari.userinterface.component.Button",u=Oskari.clazz.create(r),p="!button.next!";this.localization&&this.localization.button&&this.localization.button.start&&(p=this.localization.button.next),u.setTitle(p),u.setHandler(function(){t.guideStep++,t._showGuideContentForStep(t.guideStep,e)}),i.push(u),e.addClass("bluetitle")}else if(this.guideStep==this._guideSteps.length-1){var c="!button.finish!";this.localization&&this.localization.button&&this.localization.button.start&&(c=this.localization.button.finish);var d=e.createCloseButton(c);i.push(d)}return i},init:function(){return null},onEvent:function(e){var t=this,i=t.eventHandlers[e.getName()];if(!i){var s=i.apply(this,[e]);if(s)return s}return null},eventHandlers:{},stop:function(){var e=this;e.sandbox(),e.sandbox.unregister(e)}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]}),function(e,t,i){function s(e){return e}function a(e){return decodeURIComponent(e.replace(r," "))}var r=/\+/g,n=e.cookie=function(r,o,l){if(o!==i){if(l=e.extend({},n.defaults,l),null===o&&(l.expires=-1),"number"==typeof l.expires){var h=l.expires,u=l.expires=new Date;u.setDate(u.getDate()+h)}return o=n.json?JSON.stringify(o):o+"",t.cookie=[encodeURIComponent(r),"=",n.raw?o:encodeURIComponent(o),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}for(var p,c=n.raw?s:a,d=t.cookie.split("; "),m=0;p=d[m]&&d[m].split("=");m++)if(c(p.shift())===r){var y=c(p.join("="));return n.json?JSON.parse(y):y}return null};n.defaults={},e.removeCookie=function(t,i){return null!==e.cookie(t)?(e.cookie(t,null,i),!0):!1}}(jQuery,document),Oskari.clazz.define("Oskari.mapframework.bundle.backendstatus.BackendStatusBundle",function(){},{create:function(){var e=Oskari.clazz.create("Oskari.mapframework.bundle.backendstatus.BackendStatusBundleInstance");return e},update:function(){}},{protocol:["Oskari.bundle.Bundle","Oskari.mapframework.bundle.extension.ExtensionBundle"],source:{scripts:[{type:"text/javascript",src:"../../../../bundles/framework/bundle/backendstatus/instance.js"}],locales:[{lang:"fi",type:"text/javascript",src:"../../../../bundles/framework/bundle/backendstatus/locale/fi.js"},{lang:"sv",type:"text/javascript",src:"../../../../bundles/framework/bundle/backendstatus/locale/sv.js"},{lang:"en",type:"text/javascript",src:"../../../../bundles/framework/bundle/backendstatus/locale/en.js"}]},bundle:{manifest:{"Bundle-Identifier":"backendstatus","Bundle-Name":"backendstatus","Bundle-Author":[{Name:"jjk",Organisation:"nls.fi",Temporal:{Start:"2012"},Copyleft:{License:{"License-Name":"EUPL","License-Online-Resource":"http://www.paikkatietoikkuna.fi/license"}}}],"Bundle-Name-Locale":{fi:{Name:"backendstatus",Title:"backendstatus"},en:{}},"Bundle-Version":"1.0.0","Import-Namespace":["Oskari","jquery"],"Import-Bundle":{}}},dependencies:["jquery"]}),Oskari.bundle_manager.installBundleClass("backendstatus","Oskari.mapframework.bundle.backendstatus.BackendStatusBundle"),Oskari.clazz.define("Oskari.mapframework.bundle.backendstatus.BackendStatusBundleInstance",function(){this._localization=null,this._sandbox=null,this._started=!1,this._pendingAjaxQuery={busy:!1,jqhr:null,timestamp:null},this.timeInterval=this.ajaxSettings.defaultTimeThreshold,this.backendStatus={},this.backendExtendedStatus={}},{ajaxSettings:{defaultTimeThreshold:3e4},getLocalization:function(e){return this._localization||(this._localization=Oskari.getLocalization(this.getName())),e?this._localization[e]:this._localization},__name:"BackendStatus",getName:function(){return this.__name},setSandbox:function(e){this._sandbox=e},getSandbox:function(){return this._sandbox},getAjaxUrl:function(e,t){var i=this.getSandbox().getAjaxUrl(),s=null;return s=t?i+"action_route=GetBackendStatus&Subset=AllKnown":i+"action_route=GetBackendStatus&Subset=Alert"},start:function(){var e=this;if(!e._started){e._started=!0;var t=Oskari.$("sandbox");e._sandbox=t,t.register(e);for(p in e.eventHandlers)t.registerForEventByName(e,p)}},init:function(){return null},update:function(){},onEvent:function(e){var t=this.eventHandlers[e.getName()];if(t)return t.apply(this,[e])},extensionsByName:{LayerSelector:!0},extensionStatesByName:{attach:!0,detach:!0},eventHandlers:{"userinterface.ExtensionUpdatedEvent":function(e){var t=e.getExtension();if(t){var i=t.getName();if(i&&this.extensionsByName[i]){var s=e.getViewState();this.extensionStatesByName[s]&&this.updateBackendStatus()}}},AfterShowMapLayerInfoEvent:function(e){var t=e.getMapLayer(),i=t.getId();t.getBackendStatus();var s=this.backendExtendedStatus[i];if(!s)return this.showFeedbackDialog("missing_backendstatus_information"),void 0;var a=s.infourl;return a?(this.openURLinWindow(a),void 0):(this.showFeedbackDialog("missing_backendstatus_infourl"),void 0)},MapLayerEvent:function(e){if(null==e.getLayerId()&&"add"==e.getOperation()){var t=this;window.setTimeout(function(){t.updateBackendStatus(!0)},1e3)}}},showFeedbackDialog:function(e){var t=this.getLocalization("feedback")[e],i=Oskari.clazz.create("Oskari.userinterface.component.Popup");i.show(t.title,t.message),i.fadeout()},openURLinWindow:function(e){var t="location=1,status=1,scrollbars=1,width=850,height=1200",i=e;window.open(i,"BackendStatus",t)},stop:function(){var e=this,t=e._sandbox;e._cancelAjaxRequest();for(p in e.eventHandlers)t.unregisterFromEventByName(this,p);t.unregister(this),this._started=!1,this._sandbox=null},getTitle:function(){return"Backend Status"},getDescription:function(){return"Backend Status"},_cancelAjaxRequest:function(){var e=this;if(e._pendingAjaxQuery.busy){var t=e._pendingAjaxQuery.jqhr;e._pendingAjaxQuery.jqhr=null,t&&(this._sandbox.printDebug("[BackendStatus] Abort jqhr ajax request"),t.abort(),t=null,e._pendingAjaxQuery.busy=!1)}},_startAjaxRequest:function(e){var t=this;t._pendingAjaxQuery.busy=!0,t._pendingAjaxQuery.timestamp=e},_finishAjaxRequest:function(){var e=this;e._pendingAjaxQuery.busy=!1,e._pendingAjaxQuery.jqhr=null,this._sandbox.printDebug("[BackendStatus] finished jqhr ajax request")},_notifyAjaxFailure:function(){var e=this;e._sandbox.printDebug("[BackendStatus] BackendStatus AJAX failed"),e._processResponse({backendstatus:[]})},_isAjaxRequestBusy:function(){var e=this;return e._pendingAjaxQuery.busy},updateBackendStatus:function(e){var t=this,i=t._sandbox;if(t._pendingAjaxQuery.busy)return i.printDebug("[BackendStatus] updateBackendStatus NOT SENT previous query is busy"),void 0;var s=new Date,a=s.getTime();if(t._pendingAjaxQuery.timestamp&&a-t._pendingAjaxQuery.timestamp<t.timeInterval)return i.printDebug("[BackendStatus] updateBackendStatus NOT SENT (time difference < "+t.timeInterval+"ms)"),void 0;t._cancelAjaxRequest(),t._startAjaxRequest(a);var r=t.getAjaxUrl(null,e);jQuery.ajax({beforeSend:function(e){t._pendingAjaxQuery.jqhr=e,e&&e.overrideMimeType&&e.overrideMimeType("application/j-son;charset=UTF-8")},success:function(i){t._finishAjaxRequest(),t._processResponse(i,e)},error:function(){t._finishAjaxRequest(),t._notifyAjaxFailure()},always:function(){t._finishAjaxRequest()},complete:function(){t._finishAjaxRequest()},data:{},type:"POST",dataType:"json",url:r})},_processResponse:function(e,t){var i=this,s=this._sandbox,a=s.getEventBuilder("MapLayerEvent"),r=e.backendstatus;if(!r||void 0==r.length)return s.printDebug("[BackendStatus] backendStatus NO data"),void 0;for(var n={},o=t?{}:this.backendExtendedStatus,l=0;r.length>l;l++){var h=r[l],u=h.maplayer_id;this.backendStatus[u]?this.backendStatus[u].status!=h.status?(n[u]={status:h.status,changed:!0},o[u]=h):(n[u]={status:h.status,changed:!1},o[u]=h):(n[u]={status:h.status,changed:!0},o[u]=h)}for(p in this.backendStatus)n[p]||null==this.backendStatus[p].status||(n[p]={status:null,changed:!0});this.backendExtendedStatus=o;var c={};for(p in n){this.backendStatus[p]=n[p];var d=s.findMapLayerFromAllAvailable(p);d&&(d.setBackendStatus(this.backendStatus[p].status),(n[p].changed||"DOWN"==d.getBackendStatus())&&(c[p]=d))}if(t)i._pendingAjaxQuery.timestamp=null,i.backendStatus={};else for(p in c){var m=a(p,"update");s.notifyAll(m)}}},{protocol:["Oskari.bundle.BundleInstance","Oskari.mapframework.module.Module"]});